{"version":3,"sources":["../../../../src/core/EventBus.js"],"names":[],"mappings":"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","file":"EventBus.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport FactoryMaker from './FactoryMaker';\n\nconst EVENT_PRIORITY_LOW = 0;\nconst EVENT_PRIORITY_HIGH = 5000;\n\nfunction EventBus() {\n\n    let handlers = {};\n\n    function on(type, listener, scope, priority = EVENT_PRIORITY_LOW) {\n\n        if (!type) {\n            throw new Error('event type cannot be null or undefined');\n        }\n        if (!listener || typeof (listener) !== 'function') {\n            throw new Error('listener must be a function: ' + listener);\n        }\n\n        if (getHandlerIdx(type, listener, scope) >= 0) return;\n\n        handlers[type] = handlers[type] || [];\n\n        const handler = {\n            callback: listener,\n            scope: scope,\n            priority: priority\n        };\n\n        const inserted = handlers[type].some((item , idx) => {\n            if (item && priority > item.priority ) {\n                handlers[type].splice(idx, 0, handler);\n                return true;\n            }\n        });\n\n        if (!inserted) {\n            handlers[type].push(handler);\n        }\n    }\n\n    function off(type, listener, scope) {\n        if (!type || !listener || !handlers[type]) return;\n        const idx = getHandlerIdx(type, listener, scope);\n        if (idx < 0) return;\n        handlers[type][idx] = null;\n    }\n\n    function trigger(type, payload) {\n        if (!type || !handlers[type]) return;\n\n        payload = payload || {};\n\n        if (payload.hasOwnProperty('type')) throw new Error('\\'type\\' is a reserved word for event dispatching');\n\n        payload.type = type;\n\n        handlers[type] = handlers[type].filter((item) => item);\n        handlers[type].forEach( handler => handler && handler.callback.call(handler.scope, payload) );\n    }\n\n    function getHandlerIdx(type, listener, scope) {\n\n        let idx = -1;\n\n        if (!handlers[type]) return idx;\n\n        handlers[type].some( (item, index) => {\n            if (item && item.callback === listener && (!scope || scope === item.scope)) {\n                idx = index;\n                return true;\n            }\n        });\n        return idx;\n    }\n\n    function reset() {\n        handlers = {};\n    }\n\n    const instance = {\n        on: on,\n        off: off,\n        trigger: trigger,\n        reset: reset\n    };\n\n    return instance;\n}\n\nEventBus.__dashjs_factory_name = 'EventBus';\nconst factory = FactoryMaker.getSingletonFactory(EventBus);\nfactory.EVENT_PRIORITY_LOW = EVENT_PRIORITY_LOW;\nfactory.EVENT_PRIORITY_HIGH = EVENT_PRIORITY_HIGH;\nFactoryMaker.updateSingletonFactory(EventBus.__dashjs_factory_name, factory);\nexport default factory;\n"]}