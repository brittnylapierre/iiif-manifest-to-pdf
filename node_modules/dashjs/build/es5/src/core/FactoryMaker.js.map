{"version":3,"sources":["../../../../src/core/FactoryMaker.js"],"names":[],"mappings":"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","file":"FactoryMaker.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\n/**\n * @module FactoryMaker\n */\nlet FactoryMaker = (function () {\n\n    let instance;\n    const extensions = [];\n    const singletonContexts = [];\n    const singletonFactories = [];\n    const classFactories = [];\n\n    function extend(name, childInstance, override, context) {\n        const extensionContext = getExtensionContext(context);\n        if (!extensionContext[name] && childInstance) {\n            extensionContext[name] = {\n                instance: childInstance,\n                override: override\n            };\n        }\n    }\n\n    /**\n     * Use this method from your extended object.  this.factory is injected into your object.\n     * this.factory.getSingletonInstance(this.context, 'VideoModel')\n     * will return the video model for use in the extended object.\n     *\n     * @param {Object} context - injected into extended object as this.context\n     * @param {string} className - string name found in all dash.js objects\n     * with name __dashjs_factory_name Will be at the bottom. Will be the same as the object's name.\n     * @returns {*} Context aware instance of specified singleton name.\n     * @memberof module:FactoryMaker\n     * @instance\n     */\n    function getSingletonInstance(context, className) {\n        for (const i in singletonContexts) {\n            const obj = singletonContexts[i];\n            if (obj.context === context && obj.name === className) {\n                return obj.instance;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Use this method to add an singleton instance to the system.  Useful for unit testing to mock objects etc.\n     *\n     * @param {Object} context\n     * @param {string} className\n     * @param {Object} instance\n     * @memberof module:FactoryMaker\n     * @instance\n     */\n    function setSingletonInstance(context, className, instance) {\n        for (const i in singletonContexts) {\n            const obj = singletonContexts[i];\n            if (obj.context === context && obj.name === className) {\n                singletonContexts[i].instance = instance;\n                return;\n            }\n        }\n        singletonContexts.push({\n            name: className,\n            context: context,\n            instance: instance\n        });\n    }\n\n    /*------------------------------------------------------------------------------------------*/\n\n    // Factories storage Management\n\n    /*------------------------------------------------------------------------------------------*/\n\n    function registerFactory(name, factory, factoriesArray) {\n        for (const i in factoriesArray) {\n            const obj = factoriesArray[i];\n            if (obj.name === name) {\n                factoriesArray[i].factory = factory;\n                return;\n            }\n        }\n        factoriesArray.push({\n            name: name,\n            factory: factory\n        });\n    }\n\n    function getFactoryByName(name, factoriesArray) {\n        for (const i in factoriesArray) {\n            const obj = factoriesArray[i];\n            if (obj.name === name) {\n                return factoriesArray[i].factory;\n            }\n        }\n        return null;\n    }\n\n    function updateFactory(name, factory, factoriesArray) {\n        for (const i in factoriesArray) {\n            const obj = factoriesArray[i];\n            if (obj.name === name) {\n                factoriesArray[i].factory = factory;\n                return;\n            }\n        }\n    }\n\n    /*------------------------------------------------------------------------------------------*/\n\n    // Class Factories Management\n\n    /*------------------------------------------------------------------------------------------*/\n\n    function updateClassFactory(name, factory) {\n        updateFactory(name, factory, classFactories);\n    }\n\n    function getClassFactoryByName(name) {\n        return getFactoryByName(name, classFactories);\n    }\n\n    function getClassFactory(classConstructor) {\n        let factory = getFactoryByName(classConstructor.__dashjs_factory_name, classFactories);\n\n        if (!factory) {\n            factory = function (context) {\n                if (context === undefined) {\n                    context = {};\n                }\n                return {\n                    create: function () {\n                        return merge(classConstructor.__dashjs_factory_name, classConstructor.apply({\n                            context: context\n                        }, arguments), context, arguments);\n                    }\n                };\n            };\n\n            registerFactory(classConstructor.__dashjs_factory_name, factory, classFactories); // store factory\n        }\n        return factory;\n    }\n\n    /*------------------------------------------------------------------------------------------*/\n\n    // Singleton Factory MAangement\n\n    /*------------------------------------------------------------------------------------------*/\n\n    function updateSingletonFactory(name, factory) {\n        updateFactory(name, factory, singletonFactories);\n    }\n\n    function getSingletonFactoryByName(name) {\n        return getFactoryByName(name, singletonFactories);\n    }\n\n    function getSingletonFactory(classConstructor) {\n        let factory = getFactoryByName(classConstructor.__dashjs_factory_name, singletonFactories);\n        if (!factory) {\n            factory = function (context) {\n                let instance;\n                if (context === undefined) {\n                    context = {};\n                }\n                return {\n                    getInstance: function () {\n                        // If we don't have an instance yet check for one on the context\n                        if (!instance) {\n                            instance = getSingletonInstance(context, classConstructor.__dashjs_factory_name);\n                        }\n                        // If there's no instance on the context then create one\n                        if (!instance) {\n                            instance = merge(classConstructor.__dashjs_factory_name, classConstructor.apply({\n                                context: context\n                            }, arguments), context, arguments);\n                            singletonContexts.push({\n                                name: classConstructor.__dashjs_factory_name,\n                                context: context,\n                                instance: instance\n                            });\n                        }\n                        return instance;\n                    }\n                };\n            };\n            registerFactory(classConstructor.__dashjs_factory_name, factory, singletonFactories); // store factory\n        }\n\n        return factory;\n    }\n\n    function merge(name, classConstructor, context, args) {\n        // Add getClassName function to class instance prototype (used by Debug)\n        classConstructor.getClassName = function () {return name;};\n\n        const extensionContext = getExtensionContext(context);\n        const extensionObject = extensionContext[name];\n        if (extensionObject) {\n            let extension = extensionObject.instance;\n            if (extensionObject.override) { //Override public methods in parent but keep parent.\n                extension = extension.apply({\n                    context: context,\n                    factory: instance,\n                    parent: classConstructor\n                }, args);\n                for (const prop in extension) {\n                    if (classConstructor.hasOwnProperty(prop)) {\n                        classConstructor[prop] = extension[prop];\n                    }\n                }\n            } else { //replace parent object completely with new object. Same as dijon.\n                return extension.apply({\n                    context: context,\n                    factory: instance\n                }, args);\n            }\n        }\n        return classConstructor;\n    }\n\n    function getExtensionContext(context) {\n        let extensionContext;\n        extensions.forEach(function (obj) {\n            if (obj === context) {\n                extensionContext = obj;\n            }\n        });\n        if (!extensionContext) {\n            extensions.push(context);\n            extensionContext = context;\n        }\n        return extensionContext;\n    }\n\n    instance = {\n        extend: extend,\n        getSingletonInstance: getSingletonInstance,\n        setSingletonInstance: setSingletonInstance,\n        getSingletonFactory: getSingletonFactory,\n        getSingletonFactoryByName: getSingletonFactoryByName,\n        updateSingletonFactory: updateSingletonFactory,\n        getClassFactory: getClassFactory,\n        getClassFactoryByName: getClassFactoryByName,\n        updateClassFactory: updateClassFactory\n    };\n\n    return instance;\n\n}());\n\nexport default FactoryMaker;\n"]}