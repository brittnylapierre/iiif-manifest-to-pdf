{"version":3,"sources":["../../../../src/streaming/MediaPlayerFactory.js"],"names":[],"mappings":"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","file":"MediaPlayerFactory.js","sourcesContent":["import MediaPlayer from './MediaPlayer';\n\nfunction MediaPlayerFactory() {\n\n    /**\n     * mime-type identifier for any source content to be accepted as a dash manifest by the create() method.\n     * @type {string}\n     */\n    const SUPPORTED_MIME_TYPE = 'application/dash+xml';\n\n    /**\n     *  A new MediaPlayer is instantiated for the supplied videoElement and optional source and context.  If no context is provided,\n     *  a default DashContext is used. If no source is provided, the videoElement is interrogated to extract the first source whose\n     *  type is application/dash+xml.\n     * The autoplay property of the videoElement is preserved. Any preload attribute is ignored. This method should be called after the page onLoad event is dispatched.\n     * @param {HTMLMediaElement} video\n     * @param {HTMLSourceElement} source\n     * @param {Object} context\n     * @returns {MediaPlayer|null}\n     */\n    function create(video, source, context) {\n        if (!video || video.nodeName !== 'VIDEO') return null;\n\n        if (video._dashjs_player) return video._dashjs_player;\n\n        let player;\n        let videoID = (video.id || video.name || 'video element');\n\n        source = source || [].slice.call(video.querySelectorAll('source')).filter(function (s) {\n                return s.type == SUPPORTED_MIME_TYPE;\n            })[0];\n        if (!source && video.src) {\n            source = document.createElement('source');\n            source.src = video.src;\n        } else if (!source && !video.src) {\n            return null;\n        }\n\n        context = context || {};\n        player = MediaPlayer(context).create();\n        player.initialize(video, source.src, video.autoplay);\n        player.getDebug().log('Converted ' + videoID + ' to dash.js player and added content: ' + source.src);\n\n        // Store a reference to the player on the video element so it can be gotten at for debugging and so we know its\n        // already been setup.\n        video._dashjs_player = player;\n\n        return player;\n    }\n\n    /**\n     * Searches the provided scope for all instances of the indicated selector. If no scope is provided, document is used. If no selector is\n     * specified, [data-dashjs-player] is used. The declarative setup also looks for source elements with the type attribute set to 'application/dash+xml'.\n     * It then looks for those video elements which have a source element defined with a type matching 'application/dash+xml'.\n     * A new MediaPlayer is instantiated for each matching video element and the appropriate source is assigned.\n     * The autoplay property of the video element is preserved. Any preload attribute is ignored. This method should be called after the page onLoad event is dispatched.\n     * Returns an array holding all the MediaPlayer instances that were added by this method.\n     * @param {string} selector - CSS selector\n     * @param {Object} scope\n     * @returns {Array} an array of MediaPlayer objects\n     */\n    function createAll(selector, scope) {\n        let aPlayers = [];\n        selector = selector || '[data-dashjs-player]';\n        scope = scope || document;\n        let videos = scope.querySelectorAll(selector);\n        for (let i = 0; i < videos.length; i++) {\n            let player = create(videos[i], null);\n            aPlayers.push(player);\n        }\n\n        let sources = scope.querySelectorAll('source[type=\"' + SUPPORTED_MIME_TYPE + '\"]');\n        for (let i = 0; i < sources.length; i++) {\n            let video = findVideo(sources[i]);\n            let player = create(video, null);\n            aPlayers.push(player);\n        }\n\n        return aPlayers;\n    }\n\n    function findVideo(el) {\n        if (el.nodeName.toLowerCase() === 'video') {\n            return el;\n        } else {\n            return findVideo(el.parentNode);\n        }\n    }\n\n    return {\n        create: create,\n        createAll: createAll\n    };\n}\n\nlet instance = MediaPlayerFactory();\nlet loadInterval;\n\nfunction loadHandler() {\n    window.removeEventListener('load', loadHandler);\n    instance.createAll();\n}\n\nfunction loadIntervalHandler() {\n    if (window.dashjs) {\n        window.clearInterval(loadInterval);\n        instance.createAll();\n    }\n}\n\nlet avoidAutoCreate = typeof window !== 'undefined' && window && window.dashjs && window.dashjs.skipAutoCreate;\n\nif (!avoidAutoCreate && typeof window !== 'undefined' && window && window.addEventListener) {\n    if (window.document.readyState === 'complete') {\n        if (window.dashjs) {\n            instance.createAll();\n        } else {\n            // If loaded asynchronously, window.readyState may be 'complete' even if dashjs hasn't loaded yet\n            loadInterval = window.setInterval(loadIntervalHandler, 500);\n        }\n    } else {\n        window.addEventListener('load', loadHandler);\n    }\n}\n\nexport default instance;\n"]}