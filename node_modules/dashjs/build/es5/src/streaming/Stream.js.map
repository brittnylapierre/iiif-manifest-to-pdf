{"version":3,"sources":["../../../../src/streaming/Stream.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;gMA8BsB,uBAAuB,oGACjB,mBAAmB,yGACnB,+BAA+B,kIAC5B,kCAAkC,uIACjC,iCAAiC,qHAC5C,kBAAkB,yFACpB,uBAAuB,0FACxB,eAAe,mFACR,sBAAsB,mEAE/C,SAAS,MAAM,CAAC,MAAM,CAAE,CAEpB,IAAM,6BAA6B,CAAG,CAAC,CAAC,AACxC,MAAM,GAAG,MAAM,IAAI,EAAE,CAAC,AACtB,IAAI,OAAO,CAAG,IAAI,CAAC,OAAO,CAAC,AAC3B,IAAI,GAAG,CAAG,2BAAM,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,AAC3C,IAAI,QAAQ,CAAG,8BAAS,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC,AAE/C,IAAI,aAAa,CAAG,MAAM,CAAC,aAAa,CAAC,AACzC,IAAI,iBAAiB,CAAG,MAAM,CAAC,iBAAiB,CAAC,AACjD,IAAI,gBAAgB,CAAG,MAAM,CAAC,gBAAgB,CAAC,AAC/C,IAAI,eAAe,CAAG,MAAM,CAAC,eAAe,CAAC,AAC7C,IAAI,OAAO,CAAG,MAAM,CAAC,OAAO,CAAC,AAC7B,IAAI,YAAY,CAAG,MAAM,CAAC,YAAY,CAAC,AACvC,IAAI,UAAU,CAAG,MAAM,CAAC,UAAU,CAAC,AACnC,IAAI,iBAAiB,CAAG,MAAM,CAAC,iBAAiB,CAAC,AACjD,IAAI,YAAY,CAAG,MAAM,CAAC,YAAY,CAAC,AACvC,IAAI,aAAa,CAAG,MAAM,CAAC,aAAa,CAAC,AACzC,IAAI,kBAAkB,CAAG,MAAM,CAAC,kBAAkB,CAAC,AACnD,IAAI,eAAe,CAAG,MAAM,CAAC,eAAe,CAAC,AAC7C,IAAI,cAAc,CAAG,MAAM,CAAC,cAAc,CAAC,AAE3C,IAAI,QAAQ,UAAA,CACR,gBAAgB,UAAA,CAChB,iBAAiB,UAAA,CACjB,kBAAkB,UAAA,CAClB,UAAU,UAAA,CACV,WAAW,UAAA,CACX,UAAU,UAAA,CACV,oBAAoB,UAAA,CACpB,kBAAkB,UAAA,CAClB,mBAAmB,UAAA,CACnB,eAAe,UAAA,CACf,iBAAiB,UAAA,CAAC,AAEtB,SAAS,KAAK,EAAG,CACb,oBAAoB,EAAE,CAAC,AAEvB,kBAAkB,GAAG,+CAAmB,OAAO,CAAC,CAAC,MAAM,CAAC,CACpD,gBAAgB,CAAE,gBAAgB,CAClC,YAAY,CAAE,YAAY,CAC1B,UAAU,CAAE,UAAU,CACzB,CAAC,CAAC,AAEH,QAAQ,CAAC,EAAE,CAAC,8BAAO,mBAAmB,CAAE,oBAAoB,CAAE,QAAQ,CAAC,CAAC,AACxE,QAAQ,CAAC,EAAE,CAAC,8BAAO,qBAAqB,CAAE,qBAAqB,CAAE,QAAQ,CAAC,CAAC,CAC9E,AAED,SAAS,UAAU,CAAC,UAAU,CAAE,oBAAoB,CAAE,CAClD,UAAU,GAAG,UAAU,CAAC,AACxB,oBAAoB,GAAG,oBAAoB,CAAC,AAC5C,GAAI,oBAAoB,CAAE,CACtB,QAAQ,CAAC,EAAE,CAAC,8BAAO,SAAS,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,AAC3D,QAAQ,CAAC,EAAE,CAAC,8BAAO,0BAA0B,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,AAC5E,QAAQ,CAAC,EAAE,CAAC,8BAAO,wBAAwB,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,AAC1E,QAAQ,CAAC,EAAE,CAAC,8BAAO,mBAAmB,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,AACrE,QAAQ,CAAC,EAAE,CAAC,8BAAO,mBAAmB,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,CACxE,CACJ;;;;OAOD,SAAS,QAAQ,CAAC,WAAW,CAAE,CAC3B,GAAI,CAAC,iBAAiB,CAAE,CACpB,QAAQ,CAAC,EAAE,CAAC,8BAAO,qBAAqB,CAAE,qBAAqB,CAAE,QAAQ,CAAC,CAAC,AAC3E,eAAe,CAAC,WAAW,CAAC,CAAC,AAC7B,iBAAiB,GAAG,IAAI,CAAC,CAC5B,AACD,aAAa,EAAE,CAAC,CACnB;;;OAMD,SAAS,UAAU,EAAG,CAClB,IAAI,EAAE,CAAG,gBAAgB,CAAG,gBAAgB,CAAC,MAAM,CAAG,CAAC,CAAC,AACxD,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,EAAE,CAAE,CAAC,EAAE,EAAE,CACzB,IAAI,aAAa,CAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC,gBAAgB,EAAE,CAAC,AAC3D,aAAa,CAAC,gCAAgC,CAAC,YAAY,EAAE,GAAG,WAAW,EAAE,CAAC,CAAC,AAC/E,gBAAgB,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAC/B,AACD,gBAAgB,GAAG,EAAE,CAAC,AACtB,iBAAiB,GAAG,KAAK,CAAC,AAC1B,kBAAkB,GAAG,KAAK,CAAC,AAC3B,QAAQ,CAAC,GAAG,CAAC,8BAAO,qBAAqB,CAAE,qBAAqB,CAAE,QAAQ,CAAC,CAAC,CAC/E,AAED,SAAS,cAAc,CAAC,WAAW,CAAE,CACjC,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,gBAAgB,CAAC,MAAM,GAAG,CAC1C,GAAI,gBAAgB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,CAAE,CACtD,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,AAChD,CAAC,EAAE,CAAC,CACP,KAAM,CACH,gBAAgB,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,AAC5B,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAChC,CACJ,AAED,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,gBAAgB,CAAC,MAAM,CAAE,CAAC,EAAE,EAAE;;AAG9C,gBAAgB,CAAC,CAAC,CAAC,CAAC,kBAAkB,EAAE,CAAC,CAC5C,AAED,GAAI,gBAAgB,CAAC,MAAM,KAAK,CAAC,CAAE,CAC/B,IAAI,GAAG,CAAG,qBAAqB,CAAC,AAChC,UAAU,CAAC,aAAa,CAAC,GAAG,CAAE,WAAW,CAAE,aAAa,CAAC,QAAQ,EAAE,CAAC,CAAC,AACrE,GAAG,CAAC,GAAG,CAAC,CAAC,CACZ,CACJ,AAED,SAAS,oBAAoB,EAAG,CAC5B,UAAU,EAAE,CAAC,AACb,UAAU,GAAG,IAAI,CAAC,AAClB,WAAW,GAAG,EAAE,CAAC,AACjB,UAAU,GAAG,KAAK,CAAC,CACtB,AAED,SAAS,KAAK,EAAG,CAEb,GAAI,kBAAkB,CAAE,CACpB,kBAAkB,CAAC,KAAK,EAAE,CAAC,CAC9B,AAED,GAAI,kBAAkB,CAAE,CACpB,kBAAkB,CAAC,KAAK,EAAE,CAAC,AAC3B,kBAAkB,GAAG,IAAI,CAAC,CAC7B,AAED,oBAAoB,EAAE,CAAC,AAEvB,GAAG,GAAG,IAAI,CAAC,AAEX,QAAQ,CAAC,GAAG,CAAC,8BAAO,qBAAqB,CAAE,qBAAqB,CAAE,QAAQ,CAAC,CAAC,AAC5E,QAAQ,CAAC,GAAG,CAAC,8BAAO,mBAAmB,CAAE,oBAAoB,CAAE,QAAQ,CAAC,CAAC,AACzE,QAAQ,CAAC,GAAG,CAAC,8BAAO,SAAS,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,AAC5D,QAAQ,CAAC,GAAG,CAAC,8BAAO,0BAA0B,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,AAC7E,QAAQ,CAAC,GAAG,CAAC,8BAAO,wBAAwB,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,AAC3E,QAAQ,CAAC,GAAG,CAAC,8BAAO,mBAAmB,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,AACtE,QAAQ,CAAC,GAAG,CAAC,8BAAO,mBAAmB,CAAE,iBAAiB,CAAE,QAAQ,CAAC,CAAC,CACzE,AAED,SAAS,WAAW,EAAG,CACnB,OAAO,UAAU,CAAG,UAAU,CAAC,QAAQ,CAAG,GAAG,CAAC,CACjD,AAED,SAAS,YAAY,EAAG,CACpB,OAAO,UAAU,CAAG,UAAU,CAAC,KAAK,CAAG,GAAG,CAAC,CAC9C,AAED,SAAS,KAAK,EAAG,CACb,OAAO,UAAU,CAAG,UAAU,CAAC,EAAE,CAAG,GAAG,CAAC,CAC3C,AAED,SAAS,aAAa,EAAG,CACrB,OAAO,UAAU,CAAC,CACrB,AAED,SAAS,kBAAkB,EAAG,CAC1B,OAAO,eAAe,CAAC,CAC1B,AAED,SAAS,qBAAqB,EAAG,CAC7B,OAAO,kBAAkB,CAAC,CAC7B,AAED,SAAS,sBAAsB,EAAG,CAC9B,OAAO,mBAAmB,CAAC,CAC9B,AAED,SAAS,WAAW,EAAG,CACnB,GAAI,CAAC,aAAa,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,gBAAgB,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,wBAAwB,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,cAAc,CAAC,CAAE,CAC/K,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC,CAClD,CACJ;;;;OAOD,SAAS,iBAAiB,CAAC,IAAI,CAAE,CAC7B,WAAW,EAAE,CAAC,AACd,GAAI,IAAI,KAAK,gCAAU,KAAK,CAAE,CAC1B,GAAI,CAAC,mBAAmB,CAAE,CACtB,OAAO,EAAE,CAAC,CACb,AACD,OAAO,mBAAmB,CAAC,cAAc,EAAE,CAAC,CAC/C,AACD,IAAM,SAAS,CAAG,YAAY,CAAC,IAAI,CAAC,CAAC,AACrC,OAAO,aAAa,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAClD,AAED,SAAS,oBAAoB,EAAG,CAC5B,GAAI,eAAe,CAAE,CACjB,eAAe,CAAC,KAAK,EAAE,CAAC,CAC3B,CACJ,AAED,SAAS,mBAAmB,EAAG,CAC3B,GAAI,eAAe,CAAE,CACjB,eAAe,CAAC,IAAI,EAAE,CAAC,CAC1B,CACJ,AAED,SAAS,iBAAiB,CAAC,KAAK,CAAE,CAC9B,GAAI,KAAK,CAAC,KAAK,CAAE,CACb,UAAU,CAAC,oBAAoB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,AAC7C,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,AACjB,KAAK,EAAE,CAAC,CACX,CACJ,AAED,SAAS,iBAAiB,CAAC,SAAS,CAAE,CAClC,OAAO,SAAS,CAAC,IAAI,KAAK,gCAAU,IAAI,CAAG,SAAS,CAAC,QAAQ,CAAG,SAAS,CAAC,IAAI,CAAC,CAClF,AAED,SAAS,gBAAgB,CAAC,SAAS,CAAE,CACjC,IAAM,IAAI,CAAG,SAAS,CAAC,IAAI,CAAC,AAC5B,IAAI,KAAK,UAAA,CACL,GAAG,UAAA,CAAC,AAER,GAAI,IAAI,KAAK,gCAAU,KAAK,IAAI,SAAS,CAAE,CACvC,GAAG,GAAG,yHAAyH,CAAC,AAChI,GAAG,CAAC,GAAG,CAAC,CAAC,AACT,UAAU,CAAC,aAAa,CAAC,GAAG,CAAE,gBAAgB,CAAE,aAAa,CAAC,QAAQ,EAAE,CAAC,CAAC,AAC1E,OAAO,KAAK,CAAC,CAChB,AAED,GAAI,IAAI,KAAK,gCAAU,IAAI,IAAI,IAAI,KAAK,gCAAU,eAAe,IAAI,IAAI,KAAK,gCAAU,aAAa,IAAI,IAAI,KAAK,gCAAU,KAAK,CAAE,CAC/H,OAAO,IAAI,CAAC,CACf,AACD,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC,AACxB,GAAG,CAAC,IAAI,GAAG,UAAU,GAAG,KAAK,CAAC,CAAC,AAE/B,GAAI,CAAC,CAAC,SAAS,CAAC,iBAAiB,IAAI,CAAC,YAAY,CAAC,sBAAsB,EAAE,CAAE,CACzE,UAAU,CAAC,eAAe,CAAC,gBAAgB,CAAC,CAAC,CAChD,KAAM,GAAI,CAAC,YAAY,CAAC,aAAa,CAAC,KAAK,CAAC,CAAE,CAC3C,GAAG,GAAG,IAAI,GAAG,SAAS,GAAG,KAAK,GAAG,qBAAqB,CAAC,AACvD,GAAG,CAAC,GAAG,CAAC,CAAC,AACT,OAAO,KAAK,CAAC,CAChB,AAED,OAAO,IAAI,CAAC,CACf,AAED,SAAS,qBAAqB,CAAC,CAAC,CAAE,CAC9B,GAAI,CAAC,CAAC,YAAY,CAAC,UAAU,CAAC,EAAE,KAAK,UAAU,CAAC,EAAE,CAAE,OAAO,AAE3D,IAAI,SAAS,CAAG,wBAAwB,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,AACzD,GAAI,CAAC,SAAS,CAAE,OAAO,AAEvB,IAAI,WAAW,CAAG,kBAAkB,CAAC,OAAO,EAAE,CAAC,AAC/C,GAAG,CAAC,kDAAkD,GAAG,WAAW,CAAC,CAAC,AACtE,IAAI,SAAS,CAAG,CAAC,CAAC,YAAY,CAAC,AAC/B,IAAI,QAAQ,CAAG,aAAa,CAAC,QAAQ,EAAE,CAAC,AAExC,GAAG,CAAC,oCAAoC,CAAC,CAAC,AAC1C,GAAI,QAAQ,CAAC,4BAA4B,CAAE,CACvC,GAAG,CAAC,gDAAgD,CAAC,CAAC,AACtD,iBAAiB,GAAG,CAAC,CAAC,AACtB,eAAe,CAAC,eAAe,EAAE,CAAC,CACrC,KAAM,CACH,SAAS,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,AACrC,GAAI,SAAS,CAAC,IAAI,KAAK,gCAAU,eAAe,CAAE,CAC9C,aAAa,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,AAC/C,SAAS,CAAC,gBAAgB,EAAE,CAAC,CAChC,CACJ,CACJ,AAED,SAAS,qBAAqB,CAAC,SAAS,CAAE,eAAe,CAAE,WAAW,CAAE,gBAAgB,CAAE,CACtF,IAAI,eAAe,CAAG,iCAAgB,OAAO,CAAC,CAAC,MAAM,CAAC,CAClD,IAAI,CAAE,iBAAiB,CAAC,SAAS,CAAC,CAClC,QAAQ,CAAE,SAAS,CAAC,QAAQ,CAC5B,iBAAiB,CAAE,iBAAiB,CACpC,OAAO,CAAE,OAAO,CAChB,aAAa,CAAE,aAAa,CAC5B,iBAAiB,CAAE,iBAAiB,CACpC,gBAAgB,CAAE,gBAAgB,CAClC,YAAY,CAAE,YAAY,CAC1B,WAAW,CAAE,MAAM,CAAC,WAAW,CAC/B,iBAAiB,CAAE,MAAM,CAAC,iBAAiB,CAC3C,MAAM,CAAE,QAAQ,CAChB,aAAa,CAAE,aAAa,CAC5B,UAAU,CAAE,MAAM,CAAC,UAAU,CAC7B,kBAAkB,CAAE,kBAAkB,CACtC,eAAe,CAAE,eAAe,CAChC,gBAAgB,CAAE,MAAM,CAAC,gBAAgB,CACzC,cAAc,CAAE,cAAc,CAC9B,UAAU,CAAE,UAAU,CACzB,CAAC,CAAC,AAEH,eAAe,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC,AACxC,aAAa,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,AAE/C,GAAI,gBAAgB,CAAE,CAClB,eAAe,CAAC,SAAS,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,AACnD,eAAe,CAAC,eAAe,EAAE,CAAC,cAAc,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC,AAC/E,gBAAgB,CAAC,gBAAgB,CAAC,UAAU,CAAC,GAAG,eAAe,CAAC,CACnE,KAAM,CACH,gBAAgB,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAC1C,AAED,GAAI,gBAAgB,IAAI,gBAAgB,CAAC,eAAe,CAAE,CACtD,OAAO,CACV,AAED,GAAK,SAAS,CAAC,IAAI,KAAK,gCAAU,IAAI,IAAI,SAAS,CAAC,IAAI,KAAK,gCAAU,eAAe,CAAG,CACrF,IAAI,GAAG,UAAA,CAAC,AACR,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,eAAe,CAAC,MAAM,CAAE,CAAC,EAAE,EAAE,CAC7C,GAAI,eAAe,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,SAAS,CAAC,KAAK,CAAE,CAC9C,GAAG,GAAG,CAAC,CAAC,CACX,AACD,eAAe,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;CACvD,AACD,GAAI,SAAS,CAAC,IAAI,KAAK,gCAAU,eAAe,CAAE,CAC9C,eAAe,CAAC,eAAe,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC;CACzD,CACJ,KAAM,CACH,eAAe,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,CAC9C,CACJ,AAED,SAAS,sBAAsB,CAAC,IAAI,CAAE,WAAW,CAAE,CAC/C,IAAM,eAAe,CAAG,OAAO,CAAC,sBAAsB,CAAC,UAAU,CAAE,IAAI,CAAC,CAAC,AAEzE,IAAI,SAAS,CAAG,IAAI,CAAC,AACrB,IAAI,gBAAgB,UAAA,CAAC,AAErB,GAAI,CAAC,eAAe,IAAI,eAAe,CAAC,MAAM,KAAK,CAAC,CAAE,CAClD,GAAG,CAAC,KAAK,GAAG,IAAI,GAAG,QAAQ,CAAC,CAAC,AAC7B,OAAO,CACV,AAED,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,EAAE,CAAG,eAAe,CAAC,MAAM,CAAE,CAAC,GAAG,EAAE,CAAE,CAAC,EAAE,EAAE,CACtD,SAAS,GAAG,eAAe,CAAC,CAAC,CAAC,CAAC,AAE/B,GAAI,IAAI,KAAK,gCAAU,aAAa,CAAE,CAClC,cAAc,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC,CAC9C,KAAM,CACH,GAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAE,SAAS,AAE3C,GAAI,eAAe,CAAC,2BAA2B,CAAC,SAAS,CAAC,IAAI,CAAC,CAAE,CAC7D,eAAe,CAAC,QAAQ,CAAC,SAAS,CAAE,UAAU,CAAC,CAAC,CACnD,CACJ,CACJ,AAED,GAAI,IAAI,KAAK,gCAAU,aAAa,IAAI,eAAe,CAAC,YAAY,CAAC,IAAI,CAAE,UAAU,CAAC,CAAC,MAAM,KAAK,CAAC,CAAE,CACjG,OAAO,CACV,AAED,GAAI,IAAI,KAAK,gCAAU,KAAK,CAAE,CAC1B,mBAAmB,GAAG,8CAAoB,OAAO,CAAC,CAAC,MAAM,CAAC,CACtD,iBAAiB,CAAE,iBAAiB,CACpC,OAAO,CAAE,OAAO,CAChB,iBAAiB,CAAE,MAAM,CAAC,iBAAiB,CAC3C,MAAM,CAAE,QAAQ,CACnB,CAAC,CAAC,AACH,OAAO,CACV,AAED,eAAe,CAAC,gCAAgC,CAAC,IAAI,CAAE,UAAU,CAAC,CAAC,AACnE,gBAAgB,GAAG,eAAe,CAAC,kBAAkB,CAAC,IAAI,CAAE,UAAU,CAAC,CAAC;;AAKxE,qBAAqB,CAAC,gBAAgB,CAAE,eAAe,CAAE,WAAW,CAAC,CAAC,CACzE,AAED,SAAS,eAAe,CAAC,WAAW,CAAE,CAClC,WAAW,EAAE,CAAC,AACd,IAAI,MAAM,UAAA,CAAC;AAGX,GAAI,CAAC,eAAe,CAAE,CAClB,eAAe,GAAG,4CAAgB,OAAO,CAAC,CAAC,MAAM,EAAE,CAAC,AAEpD,eAAe,CAAC,SAAS,CAAC,CACtB,aAAa,CAAE,aAAa,CAC5B,eAAe,CAAE,eAAe,CAChC,kBAAkB,CAAE,kBAAkB,CACzC,CAAC,CAAC,AACH,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,AAC1C,eAAe,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAC3C,AAED,UAAU,GAAG,IAAI,CAAC,AAElB,YAAY,CAAC,gCAAU,KAAK,CAAC,CAAC,AAC9B,YAAY,CAAC,gCAAU,KAAK,CAAC,CAAC,AAE9B,sBAAsB,CAAC,gCAAU,KAAK,CAAE,WAAW,CAAC,CAAC,AACrD,sBAAsB,CAAC,gCAAU,KAAK,CAAE,WAAW,CAAC,CAAC,AACrD,sBAAsB,CAAC,gCAAU,IAAI,CAAE,WAAW,CAAC,CAAC,AACpD,sBAAsB,CAAC,gCAAU,eAAe,CAAE,WAAW,CAAC,CAAC,AAC/D,sBAAsB,CAAC,gCAAU,aAAa,CAAE,WAAW,CAAC,CAAC,AAC7D,sBAAsB,CAAC,gCAAU,KAAK,CAAE,WAAW,CAAC,CAAC,AACrD,sBAAsB,CAAC,gCAAU,KAAK,CAAE,WAAW,CAAC,CAAC,AAErD,aAAa,EAAE,CAAC;AAIhB,kBAAkB,GAAG,IAAI,CAAC,AAC1B,UAAU,GAAG,KAAK,CAAC,AAEnB,GAAI,gBAAgB,CAAC,MAAM,KAAK,CAAC,CAAE,CAC/B,IAAI,GAAG,CAAG,qBAAqB,CAAC,AAChC,UAAU,CAAC,aAAa,CAAC,GAAG,CAAE,WAAW,CAAE,aAAa,CAAC,QAAQ,EAAE,CAAC,CAAC,AACrE,GAAG,CAAC,GAAG,CAAC,CAAC,CACZ,KAAM;AAEH,8BAA8B,EAAE,CAAC,CACpC,CACJ,AAED,SAAS,YAAY,CAAC,IAAI,CAAE,CACxB,IAAM,cAAc,CAAG,iBAAiB,CAAC,oBAAoB,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAE,UAAU,CAAC,KAAK,CAAE,IAAI,CAAE,UAAU,CAAC,CAAC,AAE5H,GAAI,CAAC,cAAc,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,sBAAsB,CAAC,CAAE,OAAO,IAAI,CAAC;AAG1F,cAAc,CAAC,sBAAsB,GAAG,cAAc,CAAC,sBAAsB,CAAC,MAAM,CAAC,SAAC,CAAC,CAAE,CAAC,CAAK;AAE3F,GAAI,CAAC,KAAK,CAAC,CAAE,OAAO,IAAI,CAAC,AAEzB,IAAM,KAAK,CAAG,iBAAiB,CAAC,QAAQ,CAAC,cAAc,CAAE,CAAC,CAAE,IAAI,CAAC,CAAC,AAClE,GAAI,CAAC,YAAY,CAAC,aAAa,CAAC,KAAK,CAAC,CAAE,CACpC,GAAG,CAAC,gCAAgC,GAAG,KAAK,CAAC,CAAC,AAC9C,OAAO,KAAK,CAAC,CAChB,AACD,OAAO,IAAI,CAAC,CACf,CAAC,CAAC,CACN,AAED,SAAS,8BAA8B,EAAG,CACtC,IAAM,EAAE,CAAG,gBAAgB,CAAC,MAAM,CAAC,AACnC,IAAM,QAAQ,CAAG,CAAC,CAAC,WAAW,CAAC,KAAK,IAAI,CAAC,CAAC,WAAW,CAAC,KAAK,CAAC,AAC5D,IAAI,KAAK,CAAG,QAAQ,CAAG,IAAI,KAAK,CAAC,6BAA6B,CAAE,oBAAoB,CAAE,IAAI,CAAC,CAAG,IAAI,CAAC,AAEnG,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,EAAE,CAAE,CAAC,EAAE,EAAE,CACzB,GAAI,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,EAAE,IAAI,UAAU,CAAE,CAChD,OAAO,CACV,CACJ,AAED,GAAI,CAAC,kBAAkB,CAAE,CACrB,OAAO,CACV,AAED,GAAI,oBAAoB,CAAE;;AAGtB,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,EAAE,IAAI,gBAAgB,CAAC,CAAC,CAAC,CAAE,CAAC,EAAE,EAAE,CAChD,GAAI,gBAAgB,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,KAAK,gCAAU,KAAK,IACjD,gBAAgB,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,KAAK,gCAAU,KAAK,IACjD,gBAAgB,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,KAAK,gCAAU,eAAe,CAAE,CAC7D,oBAAoB,CAAC,kBAAkB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,CAC/E,CACJ,CACJ,AACD,QAAQ,CAAC,OAAO,CAAC,8BAAO,kBAAkB,CAAE,CACxC,UAAU,CAAE,UAAU,CACtB,KAAK,CAAE,KAAK,CACf,CAAC,CAAC,CACN,AAED,SAAS,YAAY,CAAC,IAAI,CAAE,CACxB,IAAM,EAAE,CAAG,gBAAgB,CAAC,MAAM,CAAC,AACnC,IAAI,SAAS,CAAG,IAAI,CAAC,AAErB,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,EAAE,CAAE,CAAC,EAAE,EAAE,CACzB,SAAS,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC,AAEhC,GAAI,SAAS,CAAC,OAAO,EAAE,KAAK,IAAI,CAAE,CAC9B,OAAO,SAAS,CAAC,YAAY,EAAE,CAAC,CACnC,CACJ,AAED,OAAO,IAAI,CAAC,CACf,AAED,SAAS,aAAa,EAAG,CACrB,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,EAAE,CAAG,gBAAgB,CAAC,MAAM,CAAE,CAAC,GAAG,EAAE,CAAE,CAAC,EAAE,EAAE,CACvD,gBAAgB,CAAC,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,CACtC,CACJ,AAED,SAAS,oBAAoB,CAAC,CAAC,CAAE,CAC7B,GAAI,CAAC,CAAC,UAAU,KAAK,UAAU,CAAE,CAC7B,OAAO,CACV,AAED,IAAI,UAAU,CAAG,aAAa,EAAE,CAAC,AACjC,IAAM,EAAE,CAAG,UAAU,CAAC,MAAM,CAAC,AAE7B,GAAI,EAAE,KAAK,CAAC,CAAE,CACV,GAAG,CAAC,iHAAiH,CAAC,CAAC,AACvH,OAAO,CACV;AAGD,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,EAAE,CAAE,CAAC,EAAE,EAAE;AAEzB,GAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,oBAAoB,EAAE,KAAK,UAAU,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,KAAK,gCAAU,KAAK,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,KAAK,gCAAU,KAAK,CAAA,AAAC,CAAE,CACvI,GAAG,CAAC,oGAAoG,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,GAAG,6BAA6B,CAAC,CAAC,AACpK,OAAO,CACV,CACJ,AAED,GAAG,CAAC,oEAAoE,CAAC,CAAC,AAE1E,QAAQ,CAAC,OAAO,CAAC,8BAAO,0BAA0B,CAAE,CAChD,UAAU,CAAE,UAAU,CACzB,CAAC,CAAC,CACN,AAED,SAAS,qBAAqB,CAAC,CAAC,CAAE,CAC9B,IAAI,EAAE,CAAG,CAAC,CAAC,MAAM,CAAC,kBAAkB,EAAE,CAAC,AAEvC,GAAI,EAAE,CAAC,aAAa,EAAE,KAAK,UAAU,CAAE,CACnC,OAAO,CACV,AAED,WAAW,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,AACpC,8BAA8B,EAAE,CAAC,CACpC,AAED,SAAS,wBAAwB,CAAC,SAAS,CAAE,CACzC,GAAI,CAAC,SAAS,CAAE,CACZ,OAAO,KAAK,CAAC,CAChB,AAED,IAAI,UAAU,CAAG,aAAa,EAAE,CAAC,AAEjC,OAAO,UAAU,CAAC,MAAM,CAAC,SAAU,SAAS,CAAE,CAC1C,OAAQ,SAAS,CAAC,OAAO,EAAE,KAAK,SAAS,CAAC,IAAI,CAAE,CACnD,CAAC,CAAC,CAAC,CAAC,CAAC,CACT,AAED,SAAS,aAAa,EAAG,CACrB,IAAM,EAAE,CAAG,gBAAgB,CAAC,MAAM,CAAC,AACnC,IAAI,GAAG,CAAG,EAAE,CAAC,AAEb,IAAI,IAAI,UAAA,CACJ,UAAU,UAAA,CAAC,AAEf,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,CAAC,GAAG,EAAE,CAAE,CAAC,EAAE,EAAE,CACzB,UAAU,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC,AACjC,IAAI,GAAG,UAAU,CAAC,OAAO,EAAE,CAAC,AAE5B,GAAI,IAAI,KAAK,gCAAU,KAAK,IAAI,IAAI,KAAK,gCAAU,KAAK,IAAI,IAAI,KAAK,gCAAU,eAAe,CAAE,CAC5F,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CACxB,CACJ,AAED,OAAO,GAAG,CAAC,CACd,AAED,SAAS,UAAU,CAAC,iBAAiB,CAAE,CAEnC,GAAG,CAAC,gDAAgD,CAAC,CAAC,AAEtD,iBAAiB,GAAG,KAAK,CAAC,AAC1B,UAAU,GAAG,IAAI,CAAC,AAClB,UAAU,GAAG,iBAAiB,CAAC,AAE/B,GAAI,eAAe,CAAE,CACjB,IAAI,MAAM,CAAG,OAAO,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,AAC9C,eAAe,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAC3C,AAED,YAAY,CAAC,gCAAU,KAAK,CAAC,CAAC,AAC9B,YAAY,CAAC,gCAAU,KAAK,CAAC,CAAC,AAE9B,IAAK,IAAI,CAAC,CAAG,CAAC,CAAE,EAAE,CAAG,gBAAgB,CAAC,MAAM,CAAE,CAAC,GAAG,EAAE,CAAE,CAAC,EAAE,EAAE,CACvD,IAAI,eAAe,CAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC,AAC1C,IAAI,SAAS,CAAG,OAAO,CAAC,mBAAmB,CAAC,UAAU,CAAE,eAAe,CAAC,OAAO,EAAE,CAAC,CAAC,AACnF,aAAa,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,AAC/C,eAAe,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,CAC9C,AAED,GAAI,iBAAiB,CAAE,CACnB,IAAI,SAAS,CAAG,iBAAiB,CAAC,YAAY,CAAC,AAC/C,GAAI,SAAS,CAAC,IAAI,KAAK,gBAAgB,CAAE,CACrC,IAAI,SAAS,CAAG,wBAAwB,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC,AACzE,GAAI,CAAC,SAAS,CAAE,OAAO,AACvB,SAAS,CAAC,gBAAgB,EAAE,CAAC,AAC7B,iBAAiB,GAAG,SAAS,CAAC,CACjC,CACJ,AAED,UAAU,GAAG,KAAK,CAAC,AACnB,8BAA8B,EAAE,CAAC,CACpC,AAED,QAAQ,GAAG,CACP,UAAU,CAAE,UAAU,CACtB,QAAQ,CAAE,QAAQ,CAClB,UAAU,CAAE,UAAU,CACtB,WAAW,CAAE,WAAW,CACxB,YAAY,CAAE,YAAY,CAC1B,KAAK,CAAE,KAAK,CACZ,aAAa,CAAE,aAAa,CAC5B,qBAAqB,CAAE,qBAAqB,CAC5C,sBAAsB,CAAE,sBAAsB,CAC9C,kBAAkB,CAAE,kBAAkB,CACtC,iBAAiB,CAAE,iBAAiB,CACpC,oBAAoB,CAAE,oBAAoB,CAC1C,mBAAmB,CAAE,mBAAmB,CACxC,UAAU,CAAE,UAAU,CACtB,KAAK,CAAE,KAAK,CACZ,aAAa,CAAE,aAAa,CAC5B,cAAc,CAAE,cAAc,CACjC,CAAC,AAEF,KAAK,EAAE,CAAC,AACR,OAAO,QAAQ,CAAC,CACnB,AAED,MAAM,CAAC,qBAAqB,GAAG,QAAQ,CAAC,qBACzB,8BAAa,eAAe,CAAC,MAAM,CAAC","file":"Stream.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport Constants from './constants/Constants';\nimport StreamProcessor from './StreamProcessor';\nimport EventController from './controllers/EventController';\nimport FragmentController from './controllers/FragmentController';\nimport ThumbnailController from './thumbnail/ThumbnailController';\nimport EventBus from '../core/EventBus';\nimport Events from '../core/events/Events';\nimport Debug from '../core/Debug';\nimport FactoryMaker from '../core/FactoryMaker';\n\nfunction Stream(config) {\n\n    const DATA_UPDATE_FAILED_ERROR_CODE = 1;\n    config = config || {};\n    let context = this.context;\n    let log = Debug(context).getInstance().log;\n    let eventBus = EventBus(context).getInstance();\n\n    let manifestModel = config.manifestModel;\n    let dashManifestModel = config.dashManifestModel;\n    let mediaPlayerModel = config.mediaPlayerModel;\n    let manifestUpdater = config.manifestUpdater;\n    let adapter = config.adapter;\n    let capabilities = config.capabilities;\n    let errHandler = config.errHandler;\n    let timelineConverter = config.timelineConverter;\n    let metricsModel = config.metricsModel;\n    let abrController = config.abrController;\n    let playbackController = config.playbackController;\n    let mediaController = config.mediaController;\n    let textController = config.textController;\n\n    let instance,\n        streamProcessors,\n        isStreamActivated,\n        isMediaInitialized,\n        streamInfo,\n        updateError,\n        isUpdating,\n        protectionController,\n        fragmentController,\n        thumbnailController,\n        eventController,\n        trackChangedEvent;\n\n    function setup() {\n        resetInitialSettings();\n\n        fragmentController = FragmentController(context).create({\n            mediaPlayerModel: mediaPlayerModel,\n            metricsModel: metricsModel,\n            errHandler: errHandler\n        });\n\n        eventBus.on(Events.BUFFERING_COMPLETED, onBufferingCompleted, instance);\n        eventBus.on(Events.DATA_UPDATE_COMPLETED, onDataUpdateCompleted, instance);\n    }\n\n    function initialize(StreamInfo, ProtectionController) {\n        streamInfo = StreamInfo;\n        protectionController = ProtectionController;\n        if (protectionController) {\n            eventBus.on(Events.KEY_ERROR, onProtectionError, instance);\n            eventBus.on(Events.SERVER_CERTIFICATE_UPDATED, onProtectionError, instance);\n            eventBus.on(Events.LICENSE_REQUEST_COMPLETE, onProtectionError, instance);\n            eventBus.on(Events.KEY_SYSTEM_SELECTED, onProtectionError, instance);\n            eventBus.on(Events.KEY_SESSION_CREATED, onProtectionError, instance);\n        }\n    }\n\n    /**\n     * Activates Stream by re-initializing some of its components\n     * @param {MediaSource} mediaSource\n     * @memberof Stream#\n     */\n    function activate(mediaSource) {\n        if (!isStreamActivated) {\n            eventBus.on(Events.CURRENT_TRACK_CHANGED, onCurrentTrackChanged, instance);\n            initializeMedia(mediaSource);\n            isStreamActivated = true;\n        }\n        createBuffers();\n    }\n\n    /**\n     * Partially resets some of the Stream elements\n     * @memberof Stream#\n     */\n    function deactivate() {\n        let ln = streamProcessors ? streamProcessors.length : 0;\n        for (let i = 0; i < ln; i++) {\n            let fragmentModel = streamProcessors[i].getFragmentModel();\n            fragmentModel.removeExecutedRequestsBeforeTime(getStartTime() + getDuration());\n            streamProcessors[i].reset();\n        }\n        streamProcessors = [];\n        isStreamActivated = false;\n        isMediaInitialized = false;\n        eventBus.off(Events.CURRENT_TRACK_CHANGED, onCurrentTrackChanged, instance);\n    }\n\n    function setMediaSource(mediaSource) {\n        for (let i = 0; i < streamProcessors.length;) {\n            if (isMediaSupported(streamProcessors[i].getMediaInfo())) {\n                streamProcessors[i].setMediaSource(mediaSource);\n                i++;\n            } else {\n                streamProcessors[i].reset();\n                streamProcessors.splice(i,1);\n            }\n        }\n\n        for (let i = 0; i < streamProcessors.length; i++) {\n            //Adding of new tracks to a stream processor isn't guaranteed by the spec after the METADATA_LOADED state\n            //so do this after the buffers are created above.\n            streamProcessors[i].dischargePreBuffer();\n        }\n\n        if (streamProcessors.length === 0) {\n            let msg = 'No streams to play.';\n            errHandler.manifestError(msg, 'nostreams', manifestModel.getValue());\n            log(msg);\n        }\n    }\n\n    function resetInitialSettings() {\n        deactivate();\n        streamInfo = null;\n        updateError = {};\n        isUpdating = false;\n    }\n\n    function reset() {\n\n        if (playbackController) {\n            playbackController.pause();\n        }\n\n        if (fragmentController) {\n            fragmentController.reset();\n            fragmentController = null;\n        }\n\n        resetInitialSettings();\n\n        log = null;\n\n        eventBus.off(Events.DATA_UPDATE_COMPLETED, onDataUpdateCompleted, instance);\n        eventBus.off(Events.BUFFERING_COMPLETED, onBufferingCompleted, instance);\n        eventBus.off(Events.KEY_ERROR, onProtectionError, instance);\n        eventBus.off(Events.SERVER_CERTIFICATE_UPDATED, onProtectionError, instance);\n        eventBus.off(Events.LICENSE_REQUEST_COMPLETE, onProtectionError, instance);\n        eventBus.off(Events.KEY_SYSTEM_SELECTED, onProtectionError, instance);\n        eventBus.off(Events.KEY_SESSION_CREATED, onProtectionError, instance);\n    }\n\n    function getDuration() {\n        return streamInfo ? streamInfo.duration : NaN;\n    }\n\n    function getStartTime() {\n        return streamInfo ? streamInfo.start : NaN;\n    }\n\n    function getId() {\n        return streamInfo ? streamInfo.id : NaN;\n    }\n\n    function getStreamInfo() {\n        return streamInfo;\n    }\n\n    function getEventController() {\n        return eventController;\n    }\n\n    function getFragmentController() {\n        return fragmentController;\n    }\n\n    function getThumbnailController() {\n        return thumbnailController;\n    }\n\n    function checkConfig() {\n        if (!abrController || !abrController.hasOwnProperty('getBitrateList') || !adapter || !adapter.hasOwnProperty('getAllMediaInfoForType') || !adapter.hasOwnProperty('getEventsFor')) {\n            throw new Error('Missing config parameter(s)');\n        }\n    }\n\n    /**\n     * @param {string} type\n     * @returns {Array}\n     * @memberof Stream#\n     */\n    function getBitrateListFor(type) {\n        checkConfig();\n        if (type === Constants.IMAGE) {\n            if (!thumbnailController) {\n                return [];\n            }\n            return thumbnailController.getBitrateList();\n        }\n        const mediaInfo = getMediaInfo(type);\n        return abrController.getBitrateList(mediaInfo);\n    }\n\n    function startEventController() {\n        if (eventController) {\n            eventController.start();\n        }\n    }\n\n    function stopEventController() {\n        if (eventController) {\n            eventController.stop();\n        }\n    }\n\n    function onProtectionError(event) {\n        if (event.error) {\n            errHandler.mediaKeySessionError(event.error);\n            log(event.error);\n            reset();\n        }\n    }\n\n    function getMimeTypeOrType(mediaInfo) {\n        return mediaInfo.type === Constants.TEXT ? mediaInfo.mimeType : mediaInfo.type;\n    }\n\n    function isMediaSupported(mediaInfo) {\n        const type = mediaInfo.type;\n        let codec,\n            msg;\n\n        if (type === Constants.MUXED && mediaInfo) {\n            msg = 'Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines';\n            log(msg);\n            errHandler.manifestError(msg, 'multiplexedrep', manifestModel.getValue());\n            return false;\n        }\n\n        if (type === Constants.TEXT || type === Constants.FRAGMENTED_TEXT || type === Constants.EMBEDDED_TEXT || type === Constants.IMAGE) {\n            return true;\n        }\n        codec = mediaInfo.codec;\n        log(type + ' codec: ' + codec);\n\n        if (!!mediaInfo.contentProtection && !capabilities.supportsEncryptedMedia()) {\n            errHandler.capabilityError('encryptedmedia');\n        } else if (!capabilities.supportsCodec(codec)) {\n            msg = type + 'Codec (' + codec + ') is not supported.';\n            log(msg);\n            return false;\n        }\n\n        return true;\n    }\n\n    function onCurrentTrackChanged(e) {\n        if (e.newMediaInfo.streamInfo.id !== streamInfo.id) return;\n\n        let processor = getProcessorForMediaInfo(e.oldMediaInfo);\n        if (!processor) return;\n\n        let currentTime = playbackController.getTime();\n        log('Stream -  Process track changed at current time ' + currentTime);\n        let mediaInfo = e.newMediaInfo;\n        let manifest = manifestModel.getValue();\n\n        log('Stream -  Update stream controller');\n        if (manifest.refreshManifestOnSwitchTrack) {\n            log('Stream -  Refreshing manifest for switch track');\n            trackChangedEvent = e;\n            manifestUpdater.refreshManifest();\n        } else {\n            processor.updateMediaInfo(mediaInfo);\n            if (mediaInfo.type !== Constants.FRAGMENTED_TEXT) {\n                abrController.updateTopQualityIndex(mediaInfo);\n                processor.switchTrackAsked();\n            }\n        }\n    }\n\n    function createStreamProcessor(mediaInfo, allMediaForType, mediaSource, optionalSettings) {\n        let streamProcessor = StreamProcessor(context).create({\n            type: getMimeTypeOrType(mediaInfo),\n            mimeType: mediaInfo.mimeType,\n            timelineConverter: timelineConverter,\n            adapter: adapter,\n            manifestModel: manifestModel,\n            dashManifestModel: dashManifestModel,\n            mediaPlayerModel: mediaPlayerModel,\n            metricsModel: metricsModel,\n            dashMetrics: config.dashMetrics,\n            baseURLController: config.baseURLController,\n            stream: instance,\n            abrController: abrController,\n            domStorage: config.domStorage,\n            playbackController: playbackController,\n            mediaController: mediaController,\n            streamController: config.streamController,\n            textController: textController,\n            errHandler: errHandler\n        });\n\n        streamProcessor.initialize(mediaSource);\n        abrController.updateTopQualityIndex(mediaInfo);\n\n        if (optionalSettings) {\n            streamProcessor.setBuffer(optionalSettings.buffer);\n            streamProcessor.getIndexHandler().setCurrentTime(optionalSettings.currentTime);\n            streamProcessors[optionalSettings.replaceIdx] = streamProcessor;\n        } else {\n            streamProcessors.push(streamProcessor);\n        }\n\n        if (optionalSettings && optionalSettings.ignoreMediaInfo) {\n            return;\n        }\n\n        if ((mediaInfo.type === Constants.TEXT || mediaInfo.type === Constants.FRAGMENTED_TEXT)) {\n            let idx;\n            for (let i = 0; i < allMediaForType.length; i++) {\n                if (allMediaForType[i].index === mediaInfo.index) {\n                    idx = i;\n                }\n                streamProcessor.updateMediaInfo(allMediaForType[i]); //creates text tracks for all adaptations in one stream processor\n            }\n            if (mediaInfo.type === Constants.FRAGMENTED_TEXT) {\n                streamProcessor.updateMediaInfo(allMediaForType[idx]); //sets the initial media info\n            }\n        } else {\n            streamProcessor.updateMediaInfo(mediaInfo);\n        }\n    }\n\n    function initializeMediaForType(type, mediaSource) {\n        const allMediaForType = adapter.getAllMediaInfoForType(streamInfo, type);\n\n        let mediaInfo = null;\n        let initialMediaInfo;\n\n        if (!allMediaForType || allMediaForType.length === 0) {\n            log('No ' + type + ' data.');\n            return;\n        }\n\n        for (let i = 0, ln = allMediaForType.length; i < ln; i++) {\n            mediaInfo = allMediaForType[i];\n\n            if (type === Constants.EMBEDDED_TEXT) {\n                textController.addEmbeddedTrack(mediaInfo);\n            } else {\n                if (!isMediaSupported(mediaInfo)) continue;\n\n                if (mediaController.isMultiTrackSupportedByType(mediaInfo.type)) {\n                    mediaController.addTrack(mediaInfo, streamInfo);\n                }\n            }\n        }\n\n        if (type === Constants.EMBEDDED_TEXT || mediaController.getTracksFor(type, streamInfo).length === 0) {\n            return;\n        }\n\n        if (type === Constants.IMAGE) {\n            thumbnailController = ThumbnailController(context).create({\n                dashManifestModel: dashManifestModel,\n                adapter: adapter,\n                baseURLController: config.baseURLController,\n                stream: instance\n            });\n            return;\n        }\n\n        mediaController.checkInitialMediaSettingsForType(type, streamInfo);\n        initialMediaInfo = mediaController.getCurrentTrackFor(type, streamInfo);\n\n        // TODO : How to tell index handler live/duration?\n        // TODO : Pass to controller and then pass to each method on handler?\n\n        createStreamProcessor(initialMediaInfo, allMediaForType, mediaSource);\n    }\n\n    function initializeMedia(mediaSource) {\n        checkConfig();\n        let events;\n\n        //if initializeMedia is called from a switch period, eventController could have been already created.\n        if (!eventController) {\n            eventController = EventController(context).create();\n\n            eventController.setConfig({\n                manifestModel: manifestModel,\n                manifestUpdater: manifestUpdater,\n                playbackController: playbackController\n            });\n            events = adapter.getEventsFor(streamInfo);\n            eventController.addInlineEvents(events);\n        }\n\n        isUpdating = true;\n\n        filterCodecs(Constants.VIDEO);\n        filterCodecs(Constants.AUDIO);\n\n        initializeMediaForType(Constants.VIDEO, mediaSource);\n        initializeMediaForType(Constants.AUDIO, mediaSource);\n        initializeMediaForType(Constants.TEXT, mediaSource);\n        initializeMediaForType(Constants.FRAGMENTED_TEXT, mediaSource);\n        initializeMediaForType(Constants.EMBEDDED_TEXT, mediaSource);\n        initializeMediaForType(Constants.MUXED, mediaSource);\n        initializeMediaForType(Constants.IMAGE, mediaSource);\n\n        createBuffers();\n\n        //TODO. Consider initialization of TextSourceBuffer here if embeddedText, but no sideloadedText.\n\n        isMediaInitialized = true;\n        isUpdating = false;\n\n        if (streamProcessors.length === 0) {\n            let msg = 'No streams to play.';\n            errHandler.manifestError(msg, 'nostreams', manifestModel.getValue());\n            log(msg);\n        } else {\n            //log(\"Playback initialized!\");\n            checkIfInitializationCompleted();\n        }\n    }\n\n    function filterCodecs(type) {\n        const realAdaptation = dashManifestModel.getAdaptationForType(manifestModel.getValue(), streamInfo.index, type, streamInfo);\n\n        if (!realAdaptation || !Array.isArray(realAdaptation.Representation_asArray)) return null;\n\n        // Filter codecs that are not supported\n        realAdaptation.Representation_asArray = realAdaptation.Representation_asArray.filter((_, i) => {\n            // keep at least codec from lowest representation\n            if (i === 0) return true;\n\n            const codec = dashManifestModel.getCodec(realAdaptation, i, true);\n            if (!capabilities.supportsCodec(codec)) {\n                log('[Stream] codec not supported: ' + codec);\n                return false;\n            }\n            return true;\n        });\n    }\n\n    function checkIfInitializationCompleted() {\n        const ln = streamProcessors.length;\n        const hasError = !!updateError.audio || !!updateError.video;\n        let error = hasError ? new Error(DATA_UPDATE_FAILED_ERROR_CODE, 'Data update failed', null) : null;\n\n        for (let i = 0; i < ln; i++) {\n            if (streamProcessors[i].isUpdating() || isUpdating) {\n                return;\n            }\n        }\n\n        if (!isMediaInitialized) {\n            return;\n        }\n\n        if (protectionController) {\n            // Need to check if streamProcessors exists because streamProcessors\n            // could be cleared in case an error is detected while initializing DRM keysystem\n            for (let i = 0; i < ln && streamProcessors[i]; i++) {\n                if (streamProcessors[i].getType() === Constants.AUDIO ||\n                    streamProcessors[i].getType() === Constants.VIDEO ||\n                    streamProcessors[i].getType() === Constants.FRAGMENTED_TEXT) {\n                    protectionController.initializeForMedia(streamProcessors[i].getMediaInfo());\n                }\n            }\n        }\n        eventBus.trigger(Events.STREAM_INITIALIZED, {\n            streamInfo: streamInfo,\n            error: error\n        });\n    }\n\n    function getMediaInfo(type) {\n        const ln = streamProcessors.length;\n        let mediaCtrl = null;\n\n        for (let i = 0; i < ln; i++) {\n            mediaCtrl = streamProcessors[i];\n\n            if (mediaCtrl.getType() === type) {\n                return mediaCtrl.getMediaInfo();\n            }\n        }\n\n        return null;\n    }\n\n    function createBuffers() {\n        for (let i = 0, ln = streamProcessors.length; i < ln; i++) {\n            streamProcessors[i].createBuffer();\n        }\n    }\n\n    function onBufferingCompleted(e) {\n        if (e.streamInfo !== streamInfo) {\n            return;\n        }\n\n        let processors = getProcessors();\n        const ln = processors.length;\n\n        if (ln === 0) {\n            log('[Stream] onBufferingCompleted - can\\'t trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined');\n            return;\n        }\n\n        // if there is at least one buffer controller that has not completed buffering yet do nothing\n        for (let i = 0; i < ln; i++) {\n            //if audio or video buffer is not buffering completed state, do not send STREAM_BUFFERING_COMPLETED\n            if (!processors[i].isBufferingCompleted() && (processors[i].getType() === Constants.AUDIO || processors[i].getType() === Constants.VIDEO)) {\n                log('[Stream] onBufferingCompleted - can\\'t trigger STREAM_BUFFERING_COMPLETED because streamProcessor ' + processors[i].getType() + ' is not buffering completed');\n                return;\n            }\n        }\n\n        log('[Stream] onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED');\n\n        eventBus.trigger(Events.STREAM_BUFFERING_COMPLETED, {\n            streamInfo: streamInfo\n        });\n    }\n\n    function onDataUpdateCompleted(e) {\n        let sp = e.sender.getStreamProcessor();\n\n        if (sp.getStreamInfo() !== streamInfo) {\n            return;\n        }\n\n        updateError[sp.getType()] = e.error;\n        checkIfInitializationCompleted();\n    }\n\n    function getProcessorForMediaInfo(mediaInfo) {\n        if (!mediaInfo) {\n            return false;\n        }\n\n        let processors = getProcessors();\n\n        return processors.filter(function (processor) {\n            return (processor.getType() === mediaInfo.type);\n        })[0];\n    }\n\n    function getProcessors() {\n        const ln = streamProcessors.length;\n        let arr = [];\n\n        let type,\n            controller;\n\n        for (let i = 0; i < ln; i++) {\n            controller = streamProcessors[i];\n            type = controller.getType();\n\n            if (type === Constants.AUDIO || type === Constants.VIDEO || type === Constants.FRAGMENTED_TEXT) {\n                arr.push(controller);\n            }\n        }\n\n        return arr;\n    }\n\n    function updateData(updatedStreamInfo) {\n\n        log('Manifest updated... updating data system wide.');\n\n        isStreamActivated = false;\n        isUpdating = true;\n        streamInfo = updatedStreamInfo;\n\n        if (eventController) {\n            let events = adapter.getEventsFor(streamInfo);\n            eventController.addInlineEvents(events);\n        }\n\n        filterCodecs(Constants.VIDEO);\n        filterCodecs(Constants.AUDIO);\n\n        for (let i = 0, ln = streamProcessors.length; i < ln; i++) {\n            let streamProcessor = streamProcessors[i];\n            let mediaInfo = adapter.getMediaInfoForType(streamInfo, streamProcessor.getType());\n            abrController.updateTopQualityIndex(mediaInfo);\n            streamProcessor.updateMediaInfo(mediaInfo);\n        }\n\n        if (trackChangedEvent) {\n            let mediaInfo = trackChangedEvent.newMediaInfo;\n            if (mediaInfo.type !== 'fragmentedText') {\n                let processor = getProcessorForMediaInfo(trackChangedEvent.oldMediaInfo);\n                if (!processor) return;\n                processor.switchTrackAsked();\n                trackChangedEvent = undefined;\n            }\n        }\n\n        isUpdating = false;\n        checkIfInitializationCompleted();\n    }\n\n    instance = {\n        initialize: initialize,\n        activate: activate,\n        deactivate: deactivate,\n        getDuration: getDuration,\n        getStartTime: getStartTime,\n        getId: getId,\n        getStreamInfo: getStreamInfo,\n        getFragmentController: getFragmentController,\n        getThumbnailController: getThumbnailController,\n        getEventController: getEventController,\n        getBitrateListFor: getBitrateListFor,\n        startEventController: startEventController,\n        stopEventController: stopEventController,\n        updateData: updateData,\n        reset: reset,\n        getProcessors: getProcessors,\n        setMediaSource: setMediaSource\n    };\n\n    setup();\n    return instance;\n}\n\nStream.__dashjs_factory_name = 'Stream';\nexport default FactoryMaker.getClassFactory(Stream);\n"]}