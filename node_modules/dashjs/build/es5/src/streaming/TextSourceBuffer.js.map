{"version":3,"sources":["../../../../src/streaming/TextSourceBuffer.js"],"names":[],"mappings":"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","file":"TextSourceBuffer.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport TextTrackInfo from './vo/TextTrackInfo';\nimport FragmentedTextBoxParser from '../dash/utils/FragmentedTextBoxParser';\nimport BoxParser from './utils/BoxParser';\nimport CustomTimeRanges from './utils/CustomTimeRanges';\nimport FactoryMaker from '../core/FactoryMaker';\nimport Debug from '../core/Debug';\nimport VideoModel from './models/VideoModel';\nimport TextTracks from './TextTracks';\nimport ISOBoxer from 'codem-isoboxer';\nimport cea608parser from '../../externals/cea608-parser';\n\nfunction TextSourceBuffer() {\n\n    let context = this.context;\n    let log = Debug(context).getInstance().log;\n    let embeddedInitialized = false;\n    let captionId = 0;\n\n    let instance,\n        boxParser,\n        errHandler,\n        dashManifestModel,\n        mediaController,\n        allTracksAreDisabled,\n        parser,\n        VTTParser,\n        TTMLParser,\n        fragmentedTextBoxParser,\n        mediaInfos,\n        textTracks,\n        isFragmented,\n        fragmentModel,\n        initializationSegmentReceived,\n        timescale,\n        fragmentedTracks,\n        videoModel,\n        streamController,\n        firstSubtitleStart,\n        currFragmentedTrackIdx,\n        embeddedTracks,\n        embeddedInitializationSegmentReceived,\n        embeddedTimescale,\n        embeddedLastSequenceNumber,\n        embeddedSequenceNumbers,\n        embeddedCea608FieldParsers;\n\n    function initialize(type, bufferController) {\n        allTracksAreDisabled = false;\n        parser = null;\n        fragmentModel = null;\n        initializationSegmentReceived = false;\n        timescale = NaN;\n        fragmentedTracks = [];\n        firstSubtitleStart = null;\n\n        if (!embeddedInitialized) {\n            initEmbedded();\n        }\n\n        let streamProcessor = bufferController.getStreamProcessor();\n\n        mediaInfos = streamProcessor.getMediaInfoArr();\n        textTracks.setConfig({videoModel: videoModel});\n        textTracks.initialize();\n        isFragmented = !dashManifestModel.getIsTextTrack(type);\n        boxParser = BoxParser(context).getInstance();\n        fragmentedTextBoxParser = FragmentedTextBoxParser(context).getInstance();\n        fragmentedTextBoxParser.setConfig({boxParser: boxParser});\n\n        if (isFragmented) {\n            fragmentModel = streamProcessor.getFragmentModel();\n            this.buffered =  CustomTimeRanges(context).create();\n            fragmentedTracks = mediaController.getTracksFor('fragmentedText', streamController.getActiveStreamInfo());\n            var currFragTrack = mediaController.getCurrentTrackFor('fragmentedText', streamController.getActiveStreamInfo());\n            for (var i = 0 ; i < fragmentedTracks.length; i++) {\n                if (fragmentedTracks[i] === currFragTrack) {\n                    currFragmentedTrackIdx = i;\n                    break;\n                }\n            }\n        }\n    }\n\n    function initEmbedded() {\n        embeddedTracks = [];\n        mediaInfos = [];\n        videoModel = VideoModel(context).getInstance();\n        textTracks = TextTracks(context).getInstance();\n        textTracks.setConfig({videoModel: videoModel});\n        textTracks.initialize();\n        boxParser = BoxParser(context).getInstance();\n        fragmentedTextBoxParser = FragmentedTextBoxParser(context).getInstance();\n        fragmentedTextBoxParser.setConfig({boxParser: boxParser});\n        isFragmented = false;\n        currFragmentedTrackIdx = null;\n        embeddedInitializationSegmentReceived = false;\n        embeddedTimescale = 0;\n        embeddedCea608FieldParsers = [];\n        embeddedSequenceNumbers = [];\n        embeddedLastSequenceNumber = null;\n        embeddedInitialized = true;\n    }\n\n    function append(bytes, chunk) {\n        var result,\n            sampleList,\n            i, j, k,\n            samplesInfo,\n            ccContent;\n        var mediaInfo = chunk.mediaInfo;\n        var mediaType = mediaInfo.type;\n        var mimeType = mediaInfo.mimeType;\n        var codecType = mediaInfo.codec || mimeType;\n        if (!codecType) {\n            log('No text type defined');\n            return;\n        }\n\n        function createTextTrackFromMediaInfo(captionData, mediaInfo) {\n            var textTrackInfo = new TextTrackInfo();\n            var trackKindMap = { subtitle: 'subtitles', caption: 'captions' }; //Dash Spec has no \"s\" on end of KIND but HTML needs plural.\n            var getKind = function () {\n                var kind = (mediaInfo.roles.length > 0) ? trackKindMap[mediaInfo.roles[0]] : trackKindMap.caption;\n                kind = (kind === trackKindMap.caption || kind === trackKindMap.subtitle) ? kind : trackKindMap.caption;\n                return kind;\n            };\n\n            var checkTTML = function () {\n                var ttml = false;\n                if (mediaInfo.codec && mediaInfo.codec.search('stpp') >= 0) {\n                    ttml = true;\n                }\n                if (mediaInfo.mimeType && mediaInfo.mimeType.search('ttml') >= 0) {\n                    ttml = true;\n                }\n                return ttml;\n            };\n\n            textTrackInfo.captionData = captionData;\n            textTrackInfo.lang = mediaInfo.lang;\n            textTrackInfo.label = mediaInfo.id; // AdaptationSet id (an unsigned int)\n            textTrackInfo.index = mediaInfo.index; // AdaptationSet index in manifest\n            textTrackInfo.isTTML = checkTTML();\n            textTrackInfo.video = videoModel.getElement();\n            textTrackInfo.defaultTrack = getIsDefault(mediaInfo);\n            textTrackInfo.isFragmented = isFragmented;\n            textTrackInfo.isEmbedded = mediaInfo.isEmbedded ? true : false;\n            textTrackInfo.kind = getKind();\n            var totalNrTracks = (mediaInfos ? mediaInfos.length : 0) + embeddedTracks.length;\n            textTracks.addTextTrack(textTrackInfo, totalNrTracks);\n        }\n\n        if (mediaType === 'fragmentedText') {\n            if (!initializationSegmentReceived) {\n                initializationSegmentReceived = true;\n                for (i = 0; i < mediaInfos.length; i++) {\n                    createTextTrackFromMediaInfo(null, mediaInfos[i]);\n                }\n                timescale = fragmentedTextBoxParser.getMediaTimescaleFromMoov(bytes);\n            } else {\n                samplesInfo = fragmentedTextBoxParser.getSamplesInfo(bytes);\n                sampleList = samplesInfo.sampleList;\n                if (!firstSubtitleStart && sampleList.length > 0) {\n                    firstSubtitleStart = sampleList[0].cts - chunk.start * timescale;\n                }\n                if (codecType.search('stpp') >= 0) {\n                    parser = parser !== null ? parser : getParser(codecType);\n                    for (i = 0; i < sampleList.length; i++) {\n                        let sample = sampleList[i];\n                        let sampleStart = sample.cts;\n                        let sampleRelStart = sampleStart - firstSubtitleStart;\n                        this.buffered.add(sampleRelStart / timescale, (sampleRelStart + sample.duration) / timescale);\n                        let dataView = new DataView(bytes, sample.offset, sample.subSizes[0]);\n                        ccContent = ISOBoxer.Utils.dataViewToString(dataView, 'utf-8');\n                        let images = [];\n                        let subOffset = sample.offset + sample.subSizes[0];\n                        for (j = 1; j < sample.subSizes.length; j++) {\n                            let inData = new Uint8Array(bytes, subOffset, sample.subSizes[j]);\n                            let raw = String.fromCharCode.apply(null, inData);\n                            images.push(raw);\n                            subOffset += sample.subSizes[j];\n                        }\n                        try {\n                            result = parser.parse(ccContent, sampleStart / timescale, (sampleStart + sample.duration) / timescale, images);\n                            textTracks.addCaptions(currFragmentedTrackIdx, firstSubtitleStart / timescale, result);\n                        } catch (e) {\n                            log('TTML parser error: ' + e.message);\n                        }\n                    }\n                } else {\n                    // WebVTT case\n                    var captionArray = [];\n                    for (i = 0 ; i < sampleList.length; i++) {\n                        var sample = sampleList[i];\n                        sample.cts -= firstSubtitleStart;\n                        this.buffered.add(sample.cts / timescale, (sample.cts + sample.duration) / timescale);\n                        var sampleData = bytes.slice(sample.offset, sample.offset + sample.size);\n                        // There are boxes inside the sampleData, so we need a ISOBoxer to get at it.\n                        var sampleBoxes = ISOBoxer.parseBuffer(sampleData);\n\n                        for (j = 0 ; j < sampleBoxes.boxes.length; j++) {\n                            var box1 = sampleBoxes.boxes[j];\n                            log('VTT box1: ' + box1.type);\n                            if (box1.type === 'vtte') {\n                                continue; //Empty box\n                            }\n                            if (box1.type === 'vttc') {\n                                log('VTT vttc boxes.length = ' + box1.boxes.length);\n                                for (k = 0 ; k < box1.boxes.length; k++) {\n                                    var box2 = box1.boxes[k];\n                                    log('VTT box2: ' + box2.type);\n                                    if (box2.type === 'payl') {\n                                        var cue_text = box2.cue_text;\n                                        log('VTT cue_text = ' + cue_text);\n                                        var start_time = sample.cts / timescale;\n                                        var end_time = (sample.cts + sample.duration) / timescale;\n                                        captionArray.push({\n                                            start: start_time,\n                                            end: end_time,\n                                            data: cue_text,\n                                            styles: {}\n                                        });\n                                        log('VTT ' + start_time + '-' + end_time + ' : ' + cue_text);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (captionArray.length > 0) {\n                        textTracks.addCaptions(currFragmentedTrackIdx, 0, captionArray);\n                    }\n                }\n            }\n        } else if (mediaType === 'text') {\n            let dataView = new DataView(bytes, 0, bytes.byteLength);\n            ccContent = ISOBoxer.Utils.dataViewToString(dataView, 'utf-8');\n\n            try {\n                result = getParser(codecType).parse(ccContent);\n                createTextTrackFromMediaInfo(result, mediaInfo);\n            } catch (e) {\n                errHandler.timedTextError(e, 'parse', ccContent);\n            }\n        } else if (mediaType === 'video') { //embedded text\n            if (chunk.segmentType === 'InitializationSegment') {\n                if (embeddedTimescale === 0) {\n                    embeddedTimescale = fragmentedTextBoxParser.getMediaTimescaleFromMoov(bytes);\n                    for (i = 0; i < embeddedTracks.length; i++) {\n                        createTextTrackFromMediaInfo(null, embeddedTracks[i]);\n                    }\n                }\n            } else { // MediaSegment\n                if (embeddedTimescale === 0) {\n                    log('CEA-608: No timescale for embeddedTextTrack yet');\n                    return;\n                }\n                var makeCueAdderForIndex = function (self, trackIndex) {\n                    function newCue(startTime, endTime, captionScreen) {\n                        var captionsArray = null;\n                        if (videoModel.getTTMLRenderingDiv()) {\n                            captionsArray = createHTMLCaptionsFromScreen(videoModel.getElement(), startTime, endTime, captionScreen);\n                        } else {\n                            var text = captionScreen.getDisplayText();\n                            //log(\"CEA text: \" + startTime + \"-\" + endTime + \"  '\" + text + \"'\");\n                            captionsArray = [{ start: startTime, end: endTime, data: text, styles: {} }];\n                        }\n                        if (captionsArray) {\n                            textTracks.addCaptions(trackIndex, 0, captionsArray);\n                        }\n                    }\n                    return newCue;\n                };\n\n\n                samplesInfo = fragmentedTextBoxParser.getSamplesInfo(bytes);\n                var sequenceNumber = samplesInfo.sequenceNumber;\n\n                if (!embeddedCea608FieldParsers[0] && !embeddedCea608FieldParsers[1]) {\n                    // Time to setup the CEA-608 parsing\n                    let field, handler, trackIdx;\n                    for (i = 0; i < embeddedTracks.length; i++) {\n                        if (embeddedTracks[i].id === 'CC1') {\n                            field = 0;\n                            trackIdx = textTracks.getTrackIdxForId('CC1');\n                        } else if (embeddedTracks[i].id === 'CC3') {\n                            field = 1;\n                            trackIdx = textTracks.getTrackIdxForId('CC3');\n                        }\n                        if (trackIdx === -1) {\n                            log('CEA-608: data before track is ready.');\n                            return;\n                        }\n                        handler = makeCueAdderForIndex(this, trackIdx);\n                        embeddedCea608FieldParsers[i] = new cea608parser.Cea608Parser(i, { 'newCue': handler }, null);\n                    }\n                }\n\n                if (embeddedTimescale && embeddedSequenceNumbers.indexOf(sequenceNumber) == -1) {\n                    if (embeddedLastSequenceNumber !== null && sequenceNumber !== embeddedLastSequenceNumber + 1) {\n                        for (i = 0; i < embeddedCea608FieldParsers.length; i++) {\n                            if (embeddedCea608FieldParsers[i]) {\n                                embeddedCea608FieldParsers[i].reset();\n                            }\n                        }\n                    }\n                    var allCcData = extractCea608Data(bytes);\n\n                    for (var fieldNr = 0; fieldNr < embeddedCea608FieldParsers.length; fieldNr++) {\n                        var ccData = allCcData.fields[fieldNr];\n                        var fieldParser = embeddedCea608FieldParsers[fieldNr];\n                        if (fieldParser) {\n                            /*if (ccData.length > 0 ) {\n                                log(\"CEA-608 adding Data to field \" + fieldNr + \" \" + ccData.length + \"bytes\");\n                            }*/\n                            for (i = 0; i < ccData.length; i++) {\n                                fieldParser.addData(ccData[i][0] / embeddedTimescale, ccData[i][1]);\n                            }\n                            if (allCcData.endTime) {\n                                fieldParser.cueSplitAtTime(allCcData.endTime / embeddedTimescale);\n                            }\n                        }\n                    }\n                    embeddedLastSequenceNumber = sequenceNumber;\n                    embeddedSequenceNumbers.push(sequenceNumber);\n                }\n            }\n        }\n    }\n    /**\n     * Extract CEA-608 data from a buffer of data.\n     * @param {ArrayBuffer} data\n     * @returns {Object|null} ccData corresponding to one segment.\n    */\n    function extractCea608Data(data) {\n\n        /* Insert [time, data] pairs in order into array. */\n        var insertInOrder = function (arr, time, data) {\n            var len = arr.length;\n            if (len > 0) {\n                if (time >= arr[len - 1][0]) {\n                    arr.push([time, data]);\n                } else {\n                    for (var pos = len - 1; pos >= 0; pos--) {\n                        if (time < arr[pos][0]) {\n                            arr.splice(pos, 0, [time, data]);\n                            break;\n                        }\n                    }\n                }\n            } else {\n                arr.push([time, data]);\n            }\n        };\n\n        var isoFile = boxParser.parse(data);\n        var moof = isoFile.getBox('moof');\n        var tfdt = isoFile.getBox('tfdt');\n        var tfhd = isoFile.getBox('tfhd'); //Can have a base_data_offset and other default values\n        //log(\"tfhd: \" + tfhd);\n        //var saio = isoFile.getBox('saio'); // Offset possibly\n        //var saiz = isoFile.getBox('saiz'); // Possible sizes\n        var truns = isoFile.getBoxes('trun'); //\n        var trun = null;\n\n        if (truns.length === 0) {\n            return null;\n        }\n        trun = truns[0];\n        if (truns.length > 1) {\n            log('Warning: Too many truns');\n        }\n        var baseOffset = moof.offset + trun.data_offset;\n        //Doublecheck that trun.offset == moof.size + 8\n        var sampleCount = trun.sample_count;\n        var startPos = baseOffset;\n        var baseSampleTime = tfdt.baseMediaDecodeTime;\n        var raw = new DataView(data);\n        var allCcData = { 'startTime': null, 'endTime': null, fields: [[], []] };\n        var accDuration = 0;\n        for (var i = 0; i < sampleCount; i++) {\n            var sample = trun.samples[i];\n            if (sample.sample_duration === undefined) {\n                sample.sample_duration = tfhd.default_sample_duration;\n            }\n            if (sample.sample_size === undefined) {\n                sample.sample_size = tfhd.default_sample_size;\n            }\n            if (sample.sample_composition_time_offset === undefined) {\n                sample.sample_composition_time_offset = 0;\n            }\n            var sampleTime = baseSampleTime + accDuration + sample.sample_composition_time_offset;\n            var cea608Ranges = cea608parser.findCea608Nalus(raw, startPos, sample.sample_size);\n            for (var j = 0; j < cea608Ranges.length; j++) {\n                var ccData = cea608parser.extractCea608DataFromRange(raw, cea608Ranges[j]);\n                for (var k = 0; k < 2; k++) {\n                    if (ccData[k].length > 0) {\n                        insertInOrder(allCcData.fields[k], sampleTime, ccData[k]);\n                    }\n                }\n            }\n\n            accDuration += sample.sample_duration;\n            startPos += sample.sample_size;\n        }\n        var endSampleTime = baseSampleTime + accDuration;\n        allCcData.startTime = baseSampleTime;\n        allCcData.endTime = endSampleTime;\n        return allCcData;\n    }\n\n    /* HTML Rendering functions */\n    function checkIndent(chars) {\n        var line = '';\n\n        for (var c = 0; c < chars.length; ++c) {\n            var uc = chars[c];\n            line += uc.uchar;\n        }\n\n        var l = line.length;\n        var ll = line.replace(/^\\s+/,'').length;\n        return l - ll;\n    }\n\n    function getRegionProperties(region) {\n        return 'left: ' + (region.x * 3.125) + '%; top: ' + (region.y1 * 6.66) + '%; width: ' + (100 - (region.x * 3.125)) + '%; height: ' + (Math.max((region.y2 - 1) - region.y1, 1) * 6.66) + '%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;';\n    }\n\n    function createRGB(color) {\n        if (color == 'red') {\n            return 'rgb(255, 0, 0)';\n        } else if (color == 'green') {\n            return 'rgb(0, 255, 0)';\n        } else if (color == 'blue') {\n            return 'rgb(0, 0, 255)';\n        } else if (color == 'cyan') {\n            return 'rgb(0, 255, 255)';\n        } else if (color == 'magenta') {\n            return 'rgb(255, 0, 255)';\n        } else if (color == 'yellow') {\n            return 'rgb(255, 255, 0)';\n        } else if (color == 'white') {\n            return 'rgb(255, 255, 255)';\n        } else if (color == 'black') {\n            return 'rgb(0, 0, 0)';\n        }\n        return color;\n    }\n\n    function getStyle(videoElement, style) {\n        var fontSize = videoElement.videoHeight / 15.0;\n        if (style) {\n            return 'font-size: ' + fontSize + 'px; font-family: Menlo, Consolas, \\'Cutive Mono\\', monospace; color: ' + ((style.foreground) ? createRGB(style.foreground) : 'rgb(255, 255, 255)') + '; font-style: ' + (style.italics ? 'italic' : 'normal') + '; text-decoration: ' + (style.underline ? 'underline' : 'none') + '; white-space: pre; background-color: ' + ((style.background) ? createRGB(style.background) : 'transparent') + ';';\n        } else {\n            return 'font-size: ' + fontSize + 'px; font-family: Menlo, Consolas, \\'Cutive Mono\\', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;';\n        }\n    }\n\n    function ltrim(s) {\n        var trimmed = s.replace(/^\\s+/g, '');\n        return trimmed;\n    }\n    function rtrim(s) {\n        var trimmed = s.replace(/\\s+$/g, '');\n        return trimmed;\n    }\n\n\n    function createHTMLCaptionsFromScreen(videoElement, startTime, endTime, captionScreen) {\n\n        let currRegion = null;\n        let existingRegion = null;\n        let lastRowHasText = false;\n        let lastRowIndentL = -1;\n        let currP = { start: startTime, end: endTime, spans: [] };\n        let currentStyle = 'style_cea608_white_black';\n        let seenRegions = { };\n        let styleStates = { };\n        let regions = [];\n        let r, s;\n\n        for (r = 0; r < 15; ++r) {\n            let row = captionScreen.rows[r];\n            let line = '';\n            let prevPenState = null;\n\n            if (false === row.isEmpty()) {\n                /* Row is not empty */\n\n                /* Get indentation of this row */\n                let rowIndent = checkIndent(row.chars);\n\n                /* Create a new region is there is none */\n                if (currRegion === null) {\n                    currRegion = { x: rowIndent, y1: r, y2: (r + 1), p: [] };\n                }\n\n                /* Check if indentation has changed and we had text of last row */\n                if ((rowIndent !== lastRowIndentL) && lastRowHasText) {\n                    currRegion.p.push(currP);\n                    currP = { start: startTime, end: endTime, spans: [] };\n                    currRegion.y2 = r;\n                    currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\n                    if (false === seenRegions.hasOwnProperty(currRegion.name)) {\n                        regions.push(currRegion);\n                        seenRegions[currRegion.name] = currRegion;\n                    } else {\n                        existingRegion = seenRegions[currRegion.name];\n                        existingRegion.p.contat(currRegion.p);\n                    }\n\n                    currRegion = { x: rowIndent, y1: r, y2: (r + 1), p: [] };\n                }\n\n                for (let c = 0; c < row.chars.length; ++c) {\n                    let uc = row.chars[c];\n                    let currPenState = uc.penState;\n                    if ((prevPenState === null) || (!currPenState.equals(prevPenState))) {\n                        if (line.trim().length > 0) {\n                            currP.spans.push({ name: currentStyle, line: line, row: r });\n                            line = '';\n                        }\n\n                        let currPenStateString = 'style_cea608_' + currPenState.foreground + '_' + currPenState.background;\n                        if (currPenState.underline) {\n                            currPenStateString += '_underline';\n                        }\n                        if (currPenState.italics) {\n                            currPenStateString += '_italics';\n                        }\n\n                        if (!styleStates.hasOwnProperty(currPenStateString)) {\n                            styleStates[currPenStateString] = JSON.parse(JSON.stringify(currPenState));\n                        }\n\n                        prevPenState = currPenState;\n\n                        currentStyle = currPenStateString;\n                    }\n\n                    line += uc.uchar;\n                }\n\n                if (line.trim().length > 0) {\n                    currP.spans.push({ name: currentStyle, line: line, row: r });\n                }\n\n                lastRowHasText = true;\n                lastRowIndentL = rowIndent;\n            } else {\n                /* Row is empty */\n                lastRowHasText = false;\n                lastRowIndentL = -1;\n\n                if (currRegion) {\n                    currRegion.p.push(currP);\n                    currP = { start: startTime, end: endTime, spans: [] };\n                    currRegion.y2 = r;\n                    currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\n                    if (false === seenRegions.hasOwnProperty(currRegion.name)) {\n                        regions.push(currRegion);\n                        seenRegions[currRegion.name] = currRegion;\n                    } else {\n                        existingRegion = seenRegions[currRegion.name];\n                        existingRegion.p.contat(currRegion.p);\n                    }\n\n                    currRegion = null;\n                }\n\n            }\n        }\n\n        if (currRegion) {\n            currRegion.p.push(currP);\n            currRegion.y2 = r + 1;\n            currRegion.name = 'region_' + currRegion.x + '_' + currRegion.y1 + '_' + currRegion.y2;\n            if (false === seenRegions.hasOwnProperty(currRegion.name)) {\n                regions.push(currRegion);\n                seenRegions[currRegion.name] = currRegion;\n            } else {\n                existingRegion = seenRegions[currRegion.name];\n                existingRegion.p.contat(currRegion.p);\n            }\n\n            currRegion = null;\n        }\n\n        //log(styleStates);\n        //log(regions);\n\n        let captionsArray = [];\n\n        /* Loop thru regions */\n        for (r = 0; r < regions.length; ++r) {\n            let region = regions[r];\n\n            let cueID = 'sub_cea608_' + (captionId++);\n            let finalDiv = document.createElement('div');\n            finalDiv.id = cueID;\n            let cueRegionProperties = getRegionProperties(region);\n            finalDiv.style.cssText = 'position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;' + cueRegionProperties;\n\n            let bodyDiv = document.createElement('div');\n            bodyDiv.className = 'paragraph bodyStyle';\n            bodyDiv.style.cssText = getStyle(videoElement);\n\n            let cueUniWrapper = document.createElement('div');\n            cueUniWrapper.className = 'cueUniWrapper';\n            cueUniWrapper.style.cssText = 'unicode-bidi: normal; direction: ltr;';\n\n            for (let p = 0; p < region.p.length; ++p) {\n                let ptag = region.p[p];\n                let lastSpanRow = 0;\n                for (s = 0; s < ptag.spans.length; ++s) {\n                    let span = ptag.spans[s];\n                    if (span.line.length > 0) {\n                        if ((s !== 0) && lastSpanRow != span.row) {\n                            let brElement = document.createElement('br');\n                            brElement.className = 'lineBreak';\n                            cueUniWrapper.appendChild(brElement);\n                        }\n                        let sameRow = false;\n                        if (lastSpanRow === span.row) {\n                            sameRow = true;\n                        }\n                        lastSpanRow = span.row;\n                        let spanStyle = styleStates[span.name];\n                        let spanElement = document.createElement('span');\n                        spanElement.className = 'spanPadding ' + span.name + ' customSpanColor';\n                        spanElement.style.cssText = getStyle(videoElement, spanStyle);\n                        if ((s !== 0) && sameRow) {\n                            if (s === ptag.spans.length - 1) {\n                                spanElement.textContent = rtrim(span.line);\n                            } else {\n                                spanElement.textContent = span.line;\n                            }\n                        } else {\n                            if (s === 0) {\n                                if (ptag.spans.length > 1) {\n                                    /* Check if next text is on same row */\n                                    if (span.row === ptag.spans[1].row) {\n                                        /* Next element on same row, trim start */\n                                        spanElement.textContent = ltrim(span.line);\n                                    } else {\n                                        /* Different rows, trim */\n                                        spanElement.textContent = span.line.trim();\n                                    }\n                                } else {\n                                    spanElement.textContent = span.line.trim();\n                                }\n                            } else {\n                                spanElement.textContent = span.line.trim();\n                            }\n                        }\n                        cueUniWrapper.appendChild(spanElement);\n                    }\n                }\n            }\n\n            bodyDiv.appendChild(cueUniWrapper);\n\n            finalDiv.appendChild(bodyDiv);\n\n            let fontSize = { 'bodyStyle': ['%', 90] };\n            for (s in styleStates) {\n                if (styleStates.hasOwnProperty(s)) {\n                    fontSize[s] = ['%', 90];\n                }\n            }\n\n            captionsArray.push({ type: 'html',\n                                 start: startTime,\n                                 end: endTime,\n                                 cueHTMLElement: finalDiv,\n                                 cueID: cueID,\n                                 cellResolution: [32, 15],\n                                 isFromCEA608: true,\n                                 regions: regions,\n                                 regionID: region.name,\n                                 videoHeight: videoElement.videoHeight,\n                                 videoWidth: videoElement.videoWidth,\n                                 fontSize: fontSize,\n                                 lineHeight: {},\n                                 linePadding: {},\n                               });\n        }\n        return captionsArray;\n    }\n\n    function abort() {\n        textTracks.deleteAllTextTracks();\n        allTracksAreDisabled = false;\n        parser = null;\n        fragmentedTextBoxParser = null;\n        mediaInfos = null;\n        textTracks = null;\n        isFragmented = false;\n        fragmentModel = null;\n        initializationSegmentReceived = false;\n        timescale = NaN;\n        fragmentedTracks = [];\n        videoModel = null;\n        streamController = null;\n        embeddedInitialized = false;\n        embeddedTracks = null;\n    }\n\n    function addEmbeddedTrack(mediaInfo) {\n        if (!embeddedInitialized) {\n            initEmbedded();\n        }\n        if (mediaInfo.id === 'CC1' || mediaInfo.id === 'CC3') {\n            embeddedTracks.push(mediaInfo);\n        } else {\n            log('Warning: Embedded track ' + mediaInfo.id + ' not supported!');\n        }\n    }\n\n    function resetEmbedded() {\n        embeddedInitialized = false;\n        embeddedTracks = [];\n        embeddedCea608FieldParsers = [null, null];\n        embeddedSequenceNumbers = [];\n        embeddedLastSequenceNumber = null;\n    }\n\n    function getAllTracksAreDisabled() {\n        return allTracksAreDisabled;\n    }\n\n    function setConfig(config) {\n        if (!config) return;\n\n        if (config.errHandler) {\n            errHandler = config.errHandler;\n        }\n        if (config.dashManifestModel) {\n            dashManifestModel = config.dashManifestModel;\n        }\n        if (config.mediaController) {\n            mediaController = config.mediaController;\n        }\n        if (config.videoModel) {\n            videoModel = config.videoModel;\n        }\n        if (config.streamController) {\n            streamController = config.streamController;\n        }\n        if (config.textTracks) {\n            textTracks = config.textTracks;\n        }\n        if (config.VTTParser) {\n            VTTParser = config.VTTParser;\n        }\n        if (config.TTMLParser) {\n            TTMLParser = config.TTMLParser;\n        }\n    }\n\n    function setTextTrack() {\n\n        var el = videoModel.getElement();\n        var tracks = el.textTracks;\n        var ln = tracks.length;\n        var nrNonEmbeddedTracks = ln - embeddedTracks.length;\n        var oldTrackIdx = textTracks.getCurrentTrackIdx();\n\n        for (var i = 0; i < ln; i++ ) {\n            var track = tracks[i];\n            allTracksAreDisabled = track.mode !== 'showing';\n            if (track.mode === 'showing') {\n                if (oldTrackIdx !== i) { // do not reset track if already the current track.  This happens when all captions get turned off via UI and then turned on again and with videojs.\n                    textTracks.setCurrentTrackIdx(i);\n                    textTracks.addCaptions(i, 0, null); // Make sure that previously queued captions are added as cues\n                    if (isFragmented && i < nrNonEmbeddedTracks) {\n                        var currentFragTrack = mediaController.getCurrentTrackFor('fragmentedText', streamController.getActiveStreamInfo());\n                        var newFragTrack = fragmentedTracks[i];\n                        if (newFragTrack !== currentFragTrack) {\n                            fragmentModel.abortRequests();\n                            textTracks.deleteTrackCues(currentFragTrack);\n                            mediaController.setTrack(newFragTrack);\n                            currFragmentedTrackIdx = i;\n                        }\n                    }\n                }\n                break;\n            }\n        }\n\n        if (allTracksAreDisabled) {\n            textTracks.setCurrentTrackIdx(-1);\n        }\n    }\n\n    function getIsDefault(mediaInfo) {\n        //TODO How to tag default. currently same order as listed in manifest.\n        // Is there a way to mark a text adaptation set as the default one? DASHIF meeting talk about using role which is being used for track KIND\n        // Eg subtitles etc. You can have multiple role tags per adaptation Not defined in the spec yet.\n        var isDefault = false;\n        if (embeddedTracks.length > 1 && mediaInfo.isEmbedded) {\n            isDefault = (mediaInfo.id && mediaInfo.id === 'CC1'); // CC1 if both CC1 and CC3 exist\n        } else if (embeddedTracks.length === 1) {\n            if (mediaInfo.id && mediaInfo.id.substring(0, 2) === 'CC') {// Either CC1 or CC3\n                isDefault = true;\n            }\n        } else if (embeddedTracks.length === 0) {\n            isDefault = (mediaInfo.index === mediaInfos[0].index);\n        }\n        return isDefault;\n    }\n\n    function getParser(codecType) {\n        var parser;\n        if (codecType.search('vtt') >= 0) {\n            parser = VTTParser;\n        } else if (codecType.search('ttml') >= 0 || codecType.search('stpp') >= 0) {\n            parser = TTMLParser;\n            parser.setConfig({videoModel: videoModel});\n        }\n        return parser;\n    }\n\n    function getCurrentTrackIdx() {\n        return textTracks.getCurrentTrackIdx();\n    }\n\n    instance = {\n        initialize: initialize,\n        append: append,\n        abort: abort,\n        getCurrentTrackIdx: getCurrentTrackIdx,\n        getAllTracksAreDisabled: getAllTracksAreDisabled,\n        setTextTrack: setTextTrack,\n        setConfig: setConfig,\n        addEmbeddedTrack: addEmbeddedTrack,\n        resetEmbedded: resetEmbedded\n    };\n\n    return instance;\n}\n\nTextSourceBuffer.__dashjs_factory_name = 'TextSourceBuffer';\nexport default FactoryMaker.getSingletonFactory(TextSourceBuffer);\n"]}