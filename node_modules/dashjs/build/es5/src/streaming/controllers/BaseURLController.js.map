{"version":3,"sources":["../../../../../src/streaming/controllers/BaseURLController.js"],"names":[],"mappings":"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","file":"BaseURLController.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport BaseURLTreeModel from '../models/BaseURLTreeModel';\nimport BaseURLSelector from '../utils/BaseURLSelector';\nimport URLUtils from '../utils/URLUtils';\nimport BaseURL from '../../dash/vo/BaseURL';\nimport FactoryMaker from '../../core/FactoryMaker';\nimport EventBus from '../../core/EventBus';\nimport Events from '../../core/events/Events';\n\nfunction BaseURLController() {\n\n    let instance;\n    let dashManifestModel;\n\n    const context = this.context;\n    const eventBus = EventBus(context).getInstance();\n    const urlUtils = URLUtils(context).getInstance();\n\n    let baseURLTreeModel,\n        baseURLSelector;\n\n    function onBlackListChanged(e) {\n        baseURLTreeModel.invalidateSelectedIndexes(e.entry);\n    }\n\n    function setup() {\n        baseURLTreeModel = BaseURLTreeModel(context).create();\n        baseURLSelector = BaseURLSelector(context).create();\n\n        eventBus.on(Events.SERVICE_LOCATION_BLACKLIST_CHANGED, onBlackListChanged, instance);\n    }\n\n    function setConfig(config) {\n        if (config.baseURLTreeModel) {\n            baseURLTreeModel = config.baseURLTreeModel;\n        }\n\n        if (config.baseURLSelector) {\n            baseURLSelector = config.baseURLSelector;\n        }\n\n        if (config.dashManifestModel) {\n            dashManifestModel = config.dashManifestModel;\n        }\n    }\n\n    function update(manifest) {\n        baseURLTreeModel.update(manifest);\n        baseURLSelector.chooseSelectorFromManifest(manifest);\n    }\n\n    function resolve(path) {\n        const baseUrls = baseURLTreeModel.getForPath(path);\n\n        const baseUrl = baseUrls.reduce((p, c) => {\n            const b = baseURLSelector.select(c);\n\n            if (b) {\n                if (!urlUtils.isRelative(b.url)) {\n                    p.url = b.url;\n                    p.serviceLocation = b.serviceLocation;\n                } else {\n                    p.url = urlUtils.resolve(b.url, p.url);\n                }\n            } else {\n                return new BaseURL();\n            }\n\n            return p;\n        }, new BaseURL());\n\n        if (!urlUtils.isRelative(baseUrl.url)) {\n            return baseUrl;\n        }\n    }\n\n    function reset() {\n        baseURLTreeModel.reset();\n        baseURLSelector.reset();\n    }\n\n    function initialize(data) {\n\n        // report config to baseURLTreeModel and baseURLSelector\n        baseURLTreeModel.setConfig({\n            dashManifestModel: dashManifestModel\n        });\n        baseURLSelector.setConfig({\n            dashManifestModel: dashManifestModel\n        });\n\n        update(data);\n    }\n\n    instance = {\n        reset: reset,\n        initialize: initialize,\n        resolve: resolve,\n        setConfig: setConfig\n    };\n\n    setup();\n\n    return instance;\n}\n\nBaseURLController.__dashjs_factory_name = 'BaseURLController';\nexport default FactoryMaker.getSingletonFactory(BaseURLController);\n"]}