var L=Object.defineProperty,v=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var h=(e,t,s)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,d=(e,t)=>{for(var s in t||(t={}))I.call(t,s)&&h(e,s,t[s]);if(u)for(var s of u(t))R.call(t,s)&&h(e,s,t[s]);return e},g=(e,t)=>v(e,w(t));import l from"path";import{promises as $}from"fs";import D from"less";import y from"fs";import c from"path";var C=/@import(?:\s+\((.*)\))?\s+['"](.*)['"]/,E=/@import(?:\s+\((.*)\))?\s+['"](.*)['"]/g,O=/(?:\/\*(?:[\s\S]*?)\*\/)|(\/\/(?:.*)$)/gm,P=[".css",".less"],m=e=>{try{let t=c.dirname(e),o=(y.readFileSync(e).toString("utf8").replace(O,"").match(E)||[]).map(r=>r.match(C)[2]).filter(r=>!!r).map(r=>c.resolve(t,c.extname(r)?r:`${r}.less`));return o.reduce((r,f)=>[...r,...m(f)],o).filter(r=>P.includes(c.extname(r).toLowerCase()))}catch(t){return[]}},x=e=>{let t=e.extract.filter(a=>a),s=t.length===3?t[1]:t[0];return{text:e.message,location:{namespace:"file",file:e.filename,line:e.line,column:e.column,lineText:s}}};var q=(e={},t={})=>({name:"less-loader",setup:s=>{let a=t.filter;s.onResolve({filter:a||/\.less$/,namespace:"file"},n=>{let o=l.resolve(process.cwd(),l.relative(process.cwd(),n.resolveDir),n.path);return{path:o,watchFiles:s.initialOptions.watch?[o,...m(o)]:void 0}}),s.onLoad({filter:a||/\.less$/,namespace:"file"},async n=>{let o=await $.readFile(n.path,"utf-8"),i=l.dirname(n.path),p=l.basename(n.path);try{return{contents:(await D.render(o,g(d({filename:p,rootpath:i},e),{paths:[...e.paths||[],i]}))).css,loader:"css",resolveDir:i}}catch(r){return{errors:[x(r)],resolveDir:i}}})}});export{q as lessLoader};
