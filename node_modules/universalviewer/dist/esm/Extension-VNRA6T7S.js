import{a as O}from"./chunk-IHLUYVK5.js";import{a as L}from"./chunk-P2DQWREQ.js";import"./chunk-C5ARL3TG.js";import{b as y}from"./chunk-WGGMCHJZ.js";import{b as C,c as I,e as S,f as H,g as T}from"./chunk-65UCAMSN.js";import{h as E,l as w}from"./chunk-VUSGURX2.js";import{a as B,c as l,o as c,q as s,r as N,t as D}from"./chunk-J7R3MGAK.js";import{c as A}from"./chunk-YAXTLTJC.js";var m=class extends y{constructor(e){super(e)}create(){this.setConfig("downloadDialogue"),super.create()}open(e){super.open(e),this.addEntireFileDownloadOptions(),this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show(),this.resize()}isDownloadOptionAvailable(e){return super.isDownloadOptionAvailable(e)}};var u=class{},i=u;i.namespace="pdfExtension.",i.PDF_LOADED=u.namespace+"pdfLoaded",i.PAGE_INDEX_CHANGE=u.namespace+"pageIndexChange",i.SEARCH=u.namespace+"search";var r=B(),b=class extends E{constructor(e){super(e);this._maxScale=5;this._minScale=.7;this._nextButtonEnabled=!1;this._pageIndex=1;this._pageIndexPending=null;this._pageRendering=!1;this._pdfDoc=null;this._prevButtonEnabled=!1;this._scale=.7}create(){this.setConfig("pdfCenterPanel"),super.create(),this._$pdfContainer=r('<div class="pdfContainer"></div>'),this._$canvas=r("<canvas></canvas>"),this._$spinner=r('<div class="spinner"></div>'),this._canvas=this._$canvas[0],this._ctx=this._canvas.getContext("2d"),this._$prevButton=r('<div class="btn prev" tabindex="0"></div>'),this._$nextButton=r('<div class="btn next" tabindex="0"></div>'),this._$zoomInButton=r('<div class="btn zoomIn" tabindex="0"></div>'),this._$zoomOutButton=r('<div class="btn zoomOut" tabindex="0"></div>'),l.getBool(this.extension.data.config.options.usePdfJs,!1)&&(this.$content.append(this._$spinner),this.$content.append(this._$prevButton),this.$content.append(this._$nextButton),this.$content.append(this._$zoomInButton),this.$content.append(this._$zoomOutButton)),this._$pdfContainer.append(this._$canvas),this.$content.prepend(this._$pdfContainer),this.extensionHost.subscribe(s.OPEN_EXTERNAL_RESOURCE,e=>{this.openMedia(e)}),this.extensionHost.subscribe(s.FIRST,()=>{!this._pdfDoc||(this._pageIndex=1,this._queueRenderPage(this._pageIndex))}),this.extensionHost.subscribe(s.PREV,()=>{!this._pdfDoc||this._pageIndex<=1||(this._pageIndex--,this._queueRenderPage(this._pageIndex))}),this.extensionHost.subscribe(s.NEXT,()=>{!this._pdfDoc||this._pageIndex>=this._pdfDoc.numPages||(this._pageIndex++,this._queueRenderPage(this._pageIndex))}),this.extensionHost.subscribe(s.LAST,()=>{!this._pdfDoc||(this._pageIndex=this._pdfDoc.numPages,this._queueRenderPage(this._pageIndex))}),this.extensionHost.subscribe(s.CANVAS_INDEX_CHANGE,()=>{!this._pdfDoc||(this._pageIndex=1,this._queueRenderPage(this._pageIndex))}),this.extensionHost.subscribe(i.SEARCH,e=>{!this._pdfDoc||e<1||e>this._pdfDoc.numPages||(this._pageIndex=e,this._queueRenderPage(this._pageIndex))}),this._$prevButton.onPressed(e=>{e.preventDefault(),!!this._prevButtonEnabled&&this.extensionHost.publish(s.PREV)}),this.disablePrevButton(),this._$nextButton.onPressed(e=>{e.preventDefault(),!!this._nextButtonEnabled&&this.extensionHost.publish(s.NEXT)}),this.disableNextButton(),this._$zoomInButton.onPressed(e=>{e.preventDefault();let t=this._scale+.5;t<this._maxScale?this._scale=t:this._scale=this._maxScale,this._render(this._pageIndex)}),this._$zoomOutButton.onPressed(e=>{e.preventDefault();let t=this._scale-.5;t>this._minScale?this._scale=t:this._scale=this._minScale,this._render(this._pageIndex)})}disablePrevButton(){this._prevButtonEnabled=!1,this._$prevButton.addClass("disabled")}enablePrevButton(){this._prevButtonEnabled=!0,this._$prevButton.removeClass("disabled")}hidePrevButton(){this.disablePrevButton(),this._$prevButton.hide()}showPrevButton(){this.enablePrevButton(),this._$prevButton.show()}disableNextButton(){this._nextButtonEnabled=!1,this._$nextButton.addClass("disabled")}enableNextButton(){this._nextButtonEnabled=!0,this._$nextButton.removeClass("disabled")}hideNextButton(){this.disableNextButton(),this._$nextButton.hide()}showNextButton(){this.enableNextButton(),this._$nextButton.show()}async openMedia(e){this._$spinner.show(),await this.extension.getExternalResources(e);let t=null,o=this.extension.helper.getCurrentCanvas(),a=this.extension.getMediaFormats(o),d=o.id;if(a&&a.length?t=a[0].id:t=o.id,!l.getBool(this.extension.data.config.options.usePdfJs,!1))window.PDFObject=await import("./pdfobject-RVTYN2PB.js"),window.PDFObject.embed(d,".pdfContainer",{id:"PDF"});else{PDFJS=await import("./pdf-AAP6T5H7.js"),PDFJS.disableWorker=!0;let g={url:t,withCredentials:o.externalResource.isAccessControlled()},P=await PDFJS.getDocument(g);this._pdfDoc=P,this._render(this._pageIndex),this.extensionHost.publish(i.PDF_LOADED,P),this._$spinner.hide()}this.extensionHost.publish(s.EXTERNAL_RESOURCE_OPENED),this.extensionHost.publish(s.LOAD)}_render(e){if(!l.getBool(this.extension.data.config.options.usePdfJs,!1))return;this._pageRendering=!0,this._$zoomOutButton.enable(),this._$zoomInButton.enable();let t=this._scale-.5,o=this._scale+.5;t<this._minScale&&this._$zoomOutButton.disable(),o>this._maxScale&&this._$zoomInButton.disable(),this._pdfDoc.getPage(e).then(a=>{this._renderTask&&this._renderTask.cancel(),this._viewport=a.getViewport(this._scale),this._canvas.height=this._viewport.height,this._canvas.width=this._viewport.width;let d={canvasContext:this._ctx,viewport:this._viewport};this._renderTask=a.render(d),this._renderTask.promise.then(()=>{this.extensionHost.publish(i.PAGE_INDEX_CHANGE,this._pageIndex),this._pageRendering=!1,this._pageIndexPending!==null&&(this._render(this._pageIndexPending),this._pageIndexPending=null),this._pageIndex===1?this.disablePrevButton():this.enablePrevButton(),this._pageIndex===this._pdfDoc.numPages?this.disableNextButton():this.enableNextButton()}).catch(g=>{})})}_queueRenderPage(e){this._pageRendering?this._pageIndexPending=e:this._render(e)}resize(){super.resize(),this._$pdfContainer.width(this.$content.width()),this._$pdfContainer.height(this.$content.height()),this._$spinner.css("top",this.$content.height()/2-this._$spinner.height()/2),this._$spinner.css("left",this.$content.width()/2-this._$spinner.width()/2),this._$prevButton.css({top:(this.$content.height()-this._$prevButton.height())/2,left:this._$prevButton.horizontalMargins()}),this._$nextButton.css({top:(this.$content.height()-this._$nextButton.height())/2,left:this.$content.width()-(this._$nextButton.width()+this._$nextButton.horizontalMargins())}),!!this._viewport&&this._render(this._pageIndex)}};var n=B(),f=class extends I{constructor(e){super(e);this.firstButtonEnabled=!1;this.lastButtonEnabled=!1;this.nextButtonEnabled=!1;this.prevButtonEnabled=!1;this._pageIndex=0;this._pdfDoc=null}create(){this.setConfig("pdfHeaderPanel"),super.create(),this.extensionHost.subscribe(i.PAGE_INDEX_CHANGE,e=>{this._pageIndex=e,this.render()}),this.extensionHost.subscribe(i.PDF_LOADED,e=>{this._pdfDoc=e}),this.$prevOptions=n('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=n(`
          <button class="btn imageBtn first" tabindex="0" title="${this.content.first}">
            <i class="uv-icon-first" aria-hidden="true"></i>
            <span class="sr-only">${this.content.first}</span>
          </button>
        `),this.$prevOptions.append(this.$firstButton),this.$firstButton.disable(),this.$prevButton=n(`
          <button class="btn imageBtn prev" tabindex="0" title="${this.content.previous}">
            <i class="uv-icon-prev" aria-hidden="true"></i>
            <span class="sr-only">${this.content.previous}</span>
          </button>
        `),this.$prevOptions.append(this.$prevButton),this.$prevButton.disable(),this.$search=n('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=n('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),this.$total=n('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=n('<a class="go btn btn-primary" tabindex="0">'+this.content.go+"</a>"),this.$search.append(this.$searchButton),this.$searchButton.disable(),this.$nextOptions=n('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=n(`
          <button class="btn imageBtn next" tabindex="0" title="${this.content.next}">
            <i class="uv-icon-next" aria-hidden="true"></i>
            <span class="sr-only">${this.content.next}</span>
          </button>
        `),this.$nextOptions.append(this.$nextButton),this.$nextButton.disable(),this.$lastButton=n(`
          <button class="btn imageBtn last" tabindex="0" title="${this.content.last}">
            <i class="uv-icon-last" aria-hidden="true"></i>
            <span class="sr-only">${this.content.last}</span>
          </button>
        `),this.$nextOptions.append(this.$lastButton),this.$lastButton.disable(),this.$firstButton.onPressed(()=>{this.extensionHost.publish(s.FIRST)}),this.$prevButton.onPressed(()=>{this.extensionHost.publish(s.PREV)}),this.$nextButton.onPressed(()=>{this.extensionHost.publish(s.NEXT)}),this.$lastButton.onPressed(()=>{this.extensionHost.publish(s.LAST)}),this.$searchText.onEnter(()=>{this.$searchText.blur(),this.search(this.$searchText.val())}),this.$searchText.click(function(){n(this).select()}),this.$searchButton.onPressed(()=>{this.search(this.$searchText.val())})}render(){this._pdfDoc.numPages===1?this.$centerOptions.hide():this.$centerOptions.show(),this.$searchText.val(this._pageIndex);let e=this.content.of;this.$total.html(c.format(e,this._pdfDoc.numPages.toString())),this.$searchButton.enable(),this._pageIndex===1?(this.$firstButton.disable(),this.$prevButton.disable()):(this.$firstButton.enable(),this.$prevButton.enable()),this._pageIndex===this._pdfDoc.numPages?(this.$lastButton.disable(),this.$nextButton.disable()):(this.$lastButton.enable(),this.$nextButton.enable())}search(e){if(!e){this.extension.showMessage(this.content.emptyValue);return}let t=parseInt(this.$searchText.val(),10);if(isNaN(t)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber);return}this.extensionHost.publish(i.SEARCH,t)}resize(){super.resize()}};var v=class extends H{constructor(e){super(e)}create(){this.setConfig("settingsDialogue"),super.create()}};var x=class extends T{constructor(e){super(e)}create(){this.setConfig("shareDialogue"),super.create()}update(){super.update(),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)}resize(){super.resize()}};var R=A(N());var k={authAPIVersion:1,bookmarkThumbHeight:150,bookmarkThumbWidth:90,dropEnabled:!0,footerPanelEnabled:!0,headerPanelEnabled:!0,limitLocales:!1,openTemplate:"http://universalviewer.io?manifest={0}",pessimisticAccessControl:!1,rightPanelEnabled:!0,theme:"uv-en-GB-theme",usePdfJs:!0},J={shareDialogue:{options:{embedTemplate:'<iframe src="{0}" width="{1}" height="{2}" allowfullscreen frameborder="0"></iframe>'},content:{customSize:"custom",embed:"Embed",embedInstructions:"To embed this item in your own website, copy and paste the code below.",height:"Height",iiif:"IIIF Manifest",share:"Share",shareInstructions:"To share this item, copy the URL below.",size:"Size:",width:"Width"}},footerPanel:{options:{bookmarkEnabled:!1,embedEnabled:!1,feedbackEnabled:!1,minimiseButtons:!0,openEnabled:!1,shareEnabled:!0},content:{bookmark:"Add to bookmarks",download:"Download",embed:"Embed",exitFullScreen:"Exit Full Screen",feedback:"Feedback",fullScreen:"Full Screen",moreInfo:"More Information",open:"Open",share:"Share"}},genericDialogue:{content:{ok:"OK"}},headerPanel:{content:{close:"Close",help:"Help"}},helpDialogue:{content:{text:"placeholder text",title:"Help"}},moreInfoRightPanel:{options:{canvasDisplayOrder:"",canvasExclude:"",copyToClipboardEnabled:!1,manifestDisplayOrder:"",manifestExclude:"",panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!1,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",showAllLanguages:!1,textLimit:4,textLimitType:"lines"},content:{attribution:"Attribution",collapse:"Collapse Information",collapseFull:"Collapse Gallery",description:"Description",expand:"Expand Information",expandFull:"Expand Gallery",holdingText:"Your module goes here!",less:"less",license:"License",logo:"Logo",more:"more",noData:"No data to display",page:"Page",title:"More Information",manifestHeader:"About the item",canvasHeader:"About the image",copyToClipboard:"Copy to clipboard",copiedToClipboard:"Copied to clipboard"}},pdfCenterPanel:{options:{titleEnabled:!1},content:{attribution:"Attribution"}},resourcesLeftPanel:{options:{elideCount:40,galleryThumbHeight:320,galleryThumbWidth:200,oneColThumbHeight:320,oneColThumbWidth:200,pageModeEnabled:!0,panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!0,thumbsEnabled:!0,thumbsExtraHeight:8,thumbsImageFadeInDuration:300,thumbsLoadRange:15,treeEnabled:!0,twoColThumbHeight:150,twoColThumbWidth:90}},dialogue:{content:{close:"Close"}},downloadDialogue:{content:{download:"Download",entireFileAsOriginal:"Entire file",noneAvailable:"No download options are available.",preview:"Preview",title:"Download"}},pdfHeaderPanel:{content:{emptyValue:"Please enter a value",first:"First",go:"Go",last:"Last",next:"Next",of:"of {0}",previous:"Previous"}},loginDialogue:{content:{login:"Login",cancel:"Cancel"}},settingsDialogue:{content:{locale:"Locale",pagingEnabled:"Two Page View",reducedMotion:"Reduce motion (disables animations)",preserveViewport:"Preserve Zoom",title:"Settings",website:"<a href='https://github.com/universalviewer/universalviewer'>more info</a>"}},contentLeftPanel:{}},z={label:"English (GB)",locales:[{name:"cy-GB",label:"Cymraeg"},{name:"en-GB",label:"English (GB)"},{name:"fr-FR",label:"Fran\xE7ais (FR)"},{name:"pl-PL",label:"Polski"},{name:"sv-SE",label:"Svenska"}]},M={authCORSError:"Your browser does not support CORS, please upgrade to view this content.",authorisationFailedMessage:"Your log-in attempt did not appear to be successful. Please try again.",degradedResourceMessage:"Please log in to view at full quality.",degradedResourceLogin:"log in",forbiddenResourceMessage:"Your current access rights are insufficient to view this image",mediaViewer:"Media Viewer",skipToDownload:"Skip to downloads and alternative formats"},_={options:k,modules:J,localisation:z,content:M};var F=class extends w{constructor(){super(...arguments);this.defaultConfig=_;this.locales={"en-GB":_,"cy-GB":()=>import("./cy-GB-RNSYK7O6.js"),"fr-FR":()=>import("./fr-FR-FVQYU7GD.js"),"pl-PL":()=>import("./pl-PL-WWVWUGRI.js"),"sv-SE":()=>import("./sv-SE-TKUK2LDX.js")}}create(){super.create(),this.extensionHost.subscribe(s.CANVAS_INDEX_CHANGE,e=>{this.viewCanvas(e)}),this.extensionHost.subscribe(s.THUMB_SELECTED,e=>{this.extensionHost.publish(s.CANVAS_INDEX_CHANGE,e.index)}),this.extensionHost.subscribe(s.LEFTPANEL_EXPAND_FULL_START,()=>{this.shell.$centerPanel.hide(),this.shell.$rightPanel.hide()}),this.extensionHost.subscribe(s.LEFTPANEL_COLLAPSE_FULL_FINISH,()=>{this.shell.$centerPanel.show(),this.shell.$rightPanel.show(),this.resize()}),this.extensionHost.subscribe(s.EXIT_FULLSCREEN,()=>{setTimeout(()=>{this.resize()},10)})}render(){super.render()}isHeaderPanelEnabled(){return super.isHeaderPanelEnabled()&&l.getBool(this.data.config.options.usePdfJs,!0)}createModules(){super.createModules(),this.isHeaderPanelEnabled()?this.headerPanel=new f(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new L(this.shell.$leftPanel)),this.centerPanel=new b(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new S(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new C(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new m(this.$downloadDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new x(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new v(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()}bookmark(){super.bookmark();let e=this.helper.getCurrentCanvas(),t=new O;t.index=this.helper.canvasIndex,t.label=D.getValue(e.getLabel()),t.thumb=e.getProperty("thumbnail"),t.title=this.helper.getLabel(),t.trackingLabel=window.trackingLabel,t.type=R.ExternalResourceType.DOCUMENT,this.fire(s.BOOKMARK,t)}dependencyLoaded(e,t){e===0&&(window.PDFObject=t)}getEmbedScript(e,t,o){let d=`${this.getAppUri()}#?manifest=${this.helper.manifestUri}&c=${this.helper.collectionIndex}&m=${this.helper.manifestIndex}&cv=${this.helper.canvasIndex}`;return c.format(e,d,t.toString(),o.toString())}};export{F as default};
