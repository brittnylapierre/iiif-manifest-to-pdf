import{a as qt}from"./chunk-3UUJB7QR.js";import{a as Zt}from"./chunk-B66MLICX.js";import{a as Jt}from"./chunk-CHPN5XCG.js";import{a as jt}from"./chunk-T534AGEN.js";import{a as Ft,b as ye,c as B,d as kt}from"./chunk-HJ7IGBRP.js";import"./chunk-6SFHGM7D.js";import{a as U,b as zt}from"./chunk-TMMEXZ6Q.js";import{c as Lt,d as Xe,e as Te,f as Mt,h as Qe,i as Gt,k as Vt,l as Ut,m as Wt}from"./chunk-2L4OXGGL.js";import{a as dt,b as pt,c as Re,d as Ge,e as Ve,f as He}from"./chunk-MDDFNWUW.js";import{a as ke,b as ie,e as ut,f as At,g as Bt,h as ct,i as Ht,n as ue,p as b}from"./chunk-OEMHC5TT.js";import{a as Se,b as Oe,c as Nt,d as Dt}from"./chunk-2OYNMPAF.js";import{a as ze}from"./chunk-RPOSMM7Q.js";import{b as It,c as Fe}from"./chunk-YAXTLTJC.js";var Ke=It((exports,module)=>{function OpenSeadragon(t){return new OpenSeadragon.Viewer(t)}(function(t){t.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;t.isFunction=function(s){return t.type(s)==="function"},t.isArray=Array.isArray||function(s){return t.type(s)==="array"},t.isWindow=function(s){return s&&typeof s=="object"&&"setInterval"in s},t.type=function(s){return s==null?String(s):e[i.call(s)]||"object"},t.isPlainObject=function(s){if(!s||OpenSeadragon.type(s)!=="object"||s.nodeType||t.isWindow(s)||s.constructor&&!n.call(s,"constructor")&&!n.call(s.constructor.prototype,"isPrototypeOf"))return!1;var o;for(var a in s)o=a;return o===void 0||n.call(s,o)},t.isEmptyObject=function(s){for(var o in s)return!1;return!0},t.freezeObject=function(s){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(o){return o},t.freezeObject(s)},t.supportsCanvas=function(){var s=document.createElement("canvas");return!!(t.isFunction(s.getContext)&&s.getContext("2d"))}(),t.isCanvasTainted=function(s){var o=!1;try{s.getContext("2d").getImageData(0,0,1,1)}catch{o=!0}return o},t.pixelDensityRatio=function(){if(t.supportsCanvas){var s=document.createElement("canvas").getContext("2d"),o=window.devicePixelRatio||1,a=s.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1;return Math.max(o,1)/a}else return 1}()})(OpenSeadragon);(function($){$.extend=function(){var t,e,i,n,s,o,a=arguments[0]||{},r=arguments.length,c=!1,u=1;for(typeof a=="boolean"&&(c=a,a=arguments[1]||{},u=2),typeof a!="object"&&!OpenSeadragon.isFunction(a)&&(a={}),r===u&&(a=this,--u);u<r;u++)if(t=arguments[u],t!==null||t!==void 0)for(e in t)i=a[e],n=t[e],a!==n&&(c&&n&&(OpenSeadragon.isPlainObject(n)||(s=OpenSeadragon.isArray(n)))?(s?(s=!1,o=i&&OpenSeadragon.isArray(i)?i:[]):o=i&&OpenSeadragon.isPlainObject(i)?i:{},a[e]=OpenSeadragon.extend(c,o,n)):n!==void 0&&(a[e]=n));return a};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var t=navigator.userAgent;return typeof t!="string"?!1:t.indexOf("iPhone")!==-1||t.indexOf("iPad")!==-1||t.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(t,e){return function(){var i=arguments;return i===void 0&&(i=[]),e.apply(t,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(t){return typeof t=="string"&&(t=document.getElementById(t)),t},getElementPosition:function(t){var e=new $.Point,i,n;for(t=$.getElement(t),i=$.getElementStyle(t).position=="fixed",n=getOffsetParent(t,i);n;)e.x+=t.offsetLeft,e.y+=t.offsetTop,i&&(e=e.plus($.getPageScroll())),t=n,i=$.getElementStyle(t).position=="fixed",n=getOffsetParent(t,i);return e},getElementOffset:function(t){t=$.getElement(t);var e=t&&t.ownerDocument,i,n,s={top:0,left:0};return e?(i=e.documentElement,typeof t.getBoundingClientRect!="undefined"&&(s=t.getBoundingClientRect()),n=e==e.window?e:e.nodeType===9?e.defaultView||e.parentWindow:!1,new $.Point(s.left+(n.pageXOffset||i.scrollLeft)-(i.clientLeft||0),s.top+(n.pageYOffset||i.scrollTop)-(i.clientTop||0))):new $.Point},getElementSize:function(t){return t=$.getElement(t),new $.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=$.getElement(t),t.currentStyle}:function(t){return t=$.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var e={};return $.getCssPropertyWithVendorPrefix=function(i){if(e[i]!==void 0)return e[i];var n=document.createElement("div").style,s=null;if(n[i]!==void 0)s=i;else for(var o=["Webkit","Moz","MS","O","webkit","moz","ms","o"],a=$.capitalizeFirstLetter(i),r=0;r<o.length;r++){var c=o[r]+a;if(n[c]!==void 0){s=c;break}}return e[i]=s,s},$.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},positiveModulo:function(t,e){var i=t%e;return i<0&&(i+=e),i},pointInElement:function(t,e){t=$.getElement(t);var i=$.getElementOffset(t),n=$.getElementSize(t);return e.x>=i.x&&e.x<i.x+n.x&&e.y<i.y+n.y&&e.y>=i.y},getEvent:function(t){return t?$.getEvent=function(e){return e}:$.getEvent=function(){return window.event},$.getEvent(t)},getMousePosition:function(t){if(typeof t.pageX=="number")$.getMousePosition=function(e){var i=new $.Point;return e=$.getEvent(e),i.x=e.pageX,i.y=e.pageY,i};else if(typeof t.clientX=="number")$.getMousePosition=function(e){var i=new $.Point;return e=$.getEvent(e),i.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,i};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},e=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(e.scrollLeft||e.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(t){if(typeof window.scrollTo!="undefined")$.setPageScroll=function(n){window.scrollTo(n.x,n.y)};else{var e=$.getPageScroll();if(e.x===t.x&&e.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;var i=$.getPageScroll();if(i.x!==e.x&&i.y!==e.y){$.setPageScroll=function(n){document.body.scrollLeft=n.x,document.body.scrollTop=n.y};return}if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,i=$.getPageScroll(),i.x!==e.x&&i.y!==e.y){$.setPageScroll=function(n){document.documentElement.scrollLeft=n.x,document.documentElement.scrollTop=n.y};return}$.setPageScroll=function(n){}}return $.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},e=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(t){t=$.getElement(t);var e=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(e[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(e[1].style,{display:"table-row"}),$.extend(e[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),e[0].appendChild(e[1]),e[1].appendChild(e[2]),e[2].appendChild(t),e[0]},makeNeutralElement:function(t){var e=document.createElement(t),i=e.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",e},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(t){return $.makeTransparentImage=function(e){var i=$.makeNeutralElement("img");return i.src=e,i},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var i=$.makeNeutralElement("img"),n=null;return n=$.makeNeutralElement("span"),n.style.display="inline-block",i.onload=function(){n.style.width=n.style.width||i.width+"px",n.style.height=n.style.height||i.height+"px",i.onload=null,i=null},i.src=e,n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",n}),$.makeTransparentImage(t)},setElementOpacity:function(t,e,i){var n,s;t=$.getElement(t),i&&!$.Browser.alpha&&(e=Math.round(e)),$.Browser.opacity?t.style.opacity=e<1?e:"":e<1?(n=Math.round(100*e),s="alpha(opacity="+n+")",t.style.filter=s):t.style.filter=""},setElementTouchActionNone:function(t){t=$.getElement(t),typeof t.style.touchAction!="undefined"?t.style.touchAction="none":typeof t.style.msTouchAction!="undefined"&&(t.style.msTouchAction="none")},addClass:function(t,e){t=$.getElement(t),t.className?(" "+t.className+" ").indexOf(" "+e+" ")===-1&&(t.className+=" "+e):t.className=e},indexOf:function(t,e,i){return Array.prototype.indexOf?this.indexOf=function(n,s,o){return n.indexOf(s,o)}:this.indexOf=function(n,s,o){var a,r=o||0,c;if(!n)throw new TypeError;if(c=n.length,c===0||r>=c)return-1;for(r<0&&(r=c-Math.abs(r)),a=r;a<c;a++)if(n[a]===s)return a;return-1},this.indexOf(t,e,i)},removeClass:function(t,e){var i,n=[],s;for(t=$.getElement(t),i=t.className.split(/\s+/),s=0;s<i.length;s++)i[s]&&i[s]!==e&&n.push(i[s]);t.className=n.join(" ")},addEvent:function(){if(window.addEventListener)return function(t,e,i,n){t=$.getElement(t),t.addEventListener(e,i,n)};if(window.attachEvent)return function(t,e,i,n){t=$.getElement(t),t.attachEvent("on"+e,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(t,e,i,n){t=$.getElement(t),t.removeEventListener(e,i,n)};if(window.detachEvent)return function(t,e,i,n){t=$.getElement(t),t.detachEvent("on"+e,i)};throw new Error("No known event model.")}(),cancelEvent:function(t){t=$.getEvent(t),t.preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){e=$.getEvent(e),e.cancel=!0,e.returnValue=!1},$.cancelEvent(t)},stopEvent:function(t){t=$.getEvent(t),t.stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){e=$.getEvent(e),e.cancelBubble=!0},$.stopEvent(t)},createCallback:function(t,e){var i=[],n;for(n=2;n<arguments.length;n++)i.push(arguments[n]);return function(){var s=i.concat([]),o;for(o=0;o<arguments.length;o++)s.push(arguments[o]);return e.apply(t,s)}},getUrlParameter:function(t){var e=URLPARAMS[t];return e||null},getUrlProtocol:function(t){var e=t.match(/^([a-z]+:)\/\//i);return e===null?window.location.protocol:e[1].toLowerCase()},createAjaxRequest:function(t){var e;try{e=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{e=!1}if(e)window.XMLHttpRequest?$.createAjaxRequest=function(i){return i?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(t)},makeAjaxRequest:function(t,e,i){var n,s,o;$.isPlainObject(t)&&(e=t.success,i=t.error,n=t.withCredentials,s=t.headers,o=t.responseType||null,t=t.url);var a=$.getUrlProtocol(t),r=$.createAjaxRequest(a==="file:");if(!$.isFunction(e))throw new Error("makeAjaxRequest requires a success callback");r.onreadystatechange=function(){r.readyState==4&&(r.onreadystatechange=function(){},r.status>=200&&r.status<300||r.status===0&&a!=="http:"&&a!=="https:"?e(r):($.console.log("AJAX request returned %d: %s",r.status,t),$.isFunction(i)&&i(r)))};try{if(r.open("GET",t,!0),o&&(r.responseType=o),s)for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&s[c]&&r.setRequestHeader(c,s[c]);n&&(r.withCredentials=!0),r.send(null)}catch(x){var u=x.message,g=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(g&&typeof x.number!="undefined"&&x.number==-2147024891&&(u+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",x.name,u),r.onreadystatechange=function(){},window.XDomainRequest){var m=new window.XDomainRequest;if(m){m.onload=function(S){$.isFunction(e)&&e({responseText:m.responseText,status:200,statusText:"OK"})},m.onerror=function(S){$.isFunction(i)&&i({responseText:m.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{m.open("GET",t),m.send()}catch{$.isFunction(i)&&i(r,x)}}}else $.isFunction(i)&&i(r,x)}return r},jsonp:function(t){var e,i=t.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=t.callbackName||"openseadragon"+$.now(),o=window[s],a="$1"+s+"$2",r=t.param||"callback",c=t.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,a),i+=(/\?/.test(i)?"&":"?")+r+"="+s,window[s]=function(u){if(o)window[s]=o;else try{delete window[s]}catch{}c&&$.isFunction(c)&&c(u)},e=document.createElement("script"),(t.async!==void 0||t.async!==!1)&&(e.async="async"),t.scriptCharset&&(e.charset=t.scriptCharset),e.src=i,e.onload=e.onreadystatechange=function(u,g){(g||!e.readyState||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,n&&e.parentNode&&n.removeChild(e),e=void 0)},n.insertBefore(e,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)$.parseXml=function(e){var i=null,n;return n=new DOMParser,i=n.parseFromString(e,"text/xml"),i};else if(window.ActiveXObject)$.parseXml=function(e){var i=null;return i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(e),i};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(t)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(t){return t=t||"",!!FILEFORMATS[t.toLowerCase()]}});var nullfunction=function(t){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var t=navigator.appVersion,e=navigator.userAgent,i;switch(navigator.appName){case"Microsoft Internet Explorer":!!window.attachEvent&&!!window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(e.substring(e.indexOf("MSIE")+5,e.indexOf(";",e.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(e.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(e.substring(e.indexOf("Firefox")+8))):e.indexOf("Safari")>=0?($.Browser.vendor=e.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(e.substring(e.substring(0,e.indexOf("Safari")).lastIndexOf("/")+1,e.indexOf("Safari")))):(i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),i.exec(e)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(t);break}var n=window.location.search.substring(1),s=n.split("&"),o,a,r;for(r=0;r<s.length;r++)if(o=s[r],a=o.indexOf("="),a>0){var c=o.substring(0,a),u=o.substring(a+1);try{URLPARAMS[c]=decodeURIComponent(u)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",c,u)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(t){var e=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,i=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(e&&i)$.requestAnimationFrame=function(){return e.apply(t,arguments)},$.cancelAnimationFrame=function(){return i.apply(t,arguments)};else{var n=[],s=[],o=0,a;$.requestAnimationFrame=function(r){return n.push([++o,r]),a||(a=setInterval(function(){if(n.length){var c=$.now(),u=s;for(s=n,n=u;s.length;)s.shift()[1](c)}else clearInterval(a),a=void 0},1e3/50)),o},$.cancelAnimationFrame=function(r){var c,u;for(c=0,u=n.length;c<u;c+=1)if(n[c][0]===r){n.splice(c,1);return}for(c=0,u=s.length;c<u;c+=1)if(s[c][0]===r){s.splice(c,1);return}}}}(window);function getOffsetParent(t,e){return e&&t!=document.body?document.body:t.offsetParent}})(OpenSeadragon);(function(t,e){typeof define=="function"&&define.amd?define([],e):typeof module=="object"&&module.exports?module.exports=e():t.OpenSeadragon=e()})(exports,function(){return OpenSeadragon});(function(t){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.fullscreenElement},e.requestFullScreen=function(i){return i.requestFullscreen()},e.exitFullScreen=function(){document.exitFullscreen()},e.fullScreenEventName="fullscreenchange",e.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.msFullscreenElement},e.requestFullScreen=function(i){return i.msRequestFullscreen()},e.exitFullScreen=function(){document.msExitFullscreen()},e.fullScreenEventName="MSFullscreenChange",e.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitFullscreenElement},e.requestFullScreen=function(i){return i.webkitRequestFullscreen()},e.exitFullScreen=function(){document.webkitExitFullscreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},e.requestFullScreen=function(i){return i.webkitRequestFullScreen()},e.exitFullScreen=function(){document.webkitCancelFullScreen()},e.fullScreenEventName="webkitfullscreenchange",e.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(e.supportsFullScreen=!0,e.getFullScreenElement=function(){return document.mozFullScreenElement},e.requestFullScreen=function(i){return i.mozRequestFullScreen()},e.exitFullScreen=function(){document.mozCancelFullScreen()},e.fullScreenEventName="mozfullscreenchange",e.fullScreenErrorEventName="mozfullscreenerror"),e.isFullScreen=function(){return e.getFullScreenElement()!==null},e.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),e.exitFullScreen()},t.extend(t,e)})(OpenSeadragon);(function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(e,i,n,s){var o=this;s=s||1;var a=0,r=function(c){a++,a===s&&o.removeHandler(e,r),i(c)};this.addHandler(e,r,n)},addHandler:function(e,i,n){var s=this.events[e];s||(this.events[e]=s=[]),i&&t.isFunction(i)&&(s[s.length]={handler:i,userData:n||null})},removeHandler:function(e,i){var n=this.events[e],s=[],o;if(!!n&&t.isArray(n)){for(o=0;o<n.length;o++)n[o].handler!==i&&s.push(n[o]);this.events[e]=s}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var i in this.events)this.events[i]=[]},getHandler:function(e){var i=this.events[e];return!i||!i.length?null:(i=i.length===1?[i[0]]:Array.apply(null,i),function(n,s){var o,a=i.length;for(o=0;o<a;o++)i[o]&&(s.eventSource=n,s.userData=i[o].userData,i[o].handler(s))})},raiseEvent:function(e,i){var n=this.getHandler(e);n&&(i||(i={}),n(this,i))}}})(OpenSeadragon);(function(t){var e=[],i={};t.MouseTracker=function(p){e.push(this);var d=arguments;t.isPlainObject(p)||(p={element:d[0],clickTimeThreshold:d[1],clickDistThreshold:d[2]}),this.hash=Math.random(),this.element=t.getElement(p.element),this.clickTimeThreshold=p.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=p.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=p.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=p.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=p.userData||null,this.stopDelay=p.stopDelay||50,this.enterHandler=p.enterHandler||null,this.exitHandler=p.exitHandler||null,this.pressHandler=p.pressHandler||null,this.nonPrimaryPressHandler=p.nonPrimaryPressHandler||null,this.releaseHandler=p.releaseHandler||null,this.nonPrimaryReleaseHandler=p.nonPrimaryReleaseHandler||null,this.moveHandler=p.moveHandler||null,this.scrollHandler=p.scrollHandler||null,this.clickHandler=p.clickHandler||null,this.dblClickHandler=p.dblClickHandler||null,this.dragHandler=p.dragHandler||null,this.dragEndHandler=p.dragEndHandler||null,this.pinchHandler=p.pinchHandler||null,this.stopHandler=p.stopHandler||null,this.keyDownHandler=p.keyDownHandler||null,this.keyUpHandler=p.keyUpHandler||null,this.keyHandler=p.keyHandler||null,this.focusHandler=p.focusHandler||null,this.blurHandler=p.blurHandler||null;var v=this;i[this.hash]={click:function(w){E(v,w)},dblclick:function(w){H(v,w)},keydown:function(w){h(v,w)},keyup:function(w){y(v,w)},keypress:function(w){T(v,w)},focus:function(w){R(v,w)},blur:function(w){_(v,w)},wheel:function(w){P(v,w)},mousewheel:function(w){L(v,w)},DOMMouseScroll:function(w){L(v,w)},MozMousePixelScroll:function(w){L(v,w)},mouseenter:function(w){J(v,w)},mouseleave:function(w){j(v,w)},mouseover:function(w){z(v,w)},mouseout:function(w){re(v,w)},mousedown:function(w){le(v,w)},mouseup:function(w){G(v,w)},mouseupcaptured:function(w){ge(v,w)},mousemove:function(w){$e(v,w)},mousemovecaptured:function(w){Ne(v,w)},touchstart:function(w){et(v,w)},touchend:function(w){tt(v,w)},touchendcaptured:function(w){it(v,w)},touchmove:function(w){nt(v,w)},touchmovecaptured:function(w){st(v,w)},touchcancel:function(w){ot(v,w)},gesturestart:function(w){rt(v,w)},gesturechange:function(w){l(v,w)},pointerover:function(w){f(v,w)},MSPointerOver:function(w){f(v,w)},pointerout:function(w){C(v,w)},MSPointerOut:function(w){C(v,w)},pointerdown:function(w){O(v,w)},MSPointerDown:function(w){O(v,w)},pointerup:function(w){A(v,w)},MSPointerUp:function(w){A(v,w)},pointermove:function(w){ne(v,w)},MSPointerMove:function(w){ne(v,w)},pointercancel:function(w){Z(v,w)},MSPointerCancel:function(w){Z(v,w)},pointerupcaptured:function(w){X(v,w)},pointermovecaptured:function(w){se(v,w)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},p.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){var p;for(o(this),this.element=null,p=0;p<e.length;p++)if(e[p]===this){e.splice(p,1);break}i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(p){return p?s(this):o(this),this},getActivePointersListsExceptType:function(p){for(var d=i[this.hash],v=[],w=0;w<d.activePointersLists.length;++w)d.activePointersLists[w].type!==p&&v.push(d.activePointersLists[w]);return v},getActivePointersListByType:function(p){var d=i[this.hash],v,w=d.activePointersLists.length,I;for(v=0;v<w;v++)if(d.activePointersLists[v].type===p)return d.activePointersLists[v];return I=new t.MouseTracker.GesturePointList(p),d.activePointersLists.push(I),I},getActivePointerCount:function(){var p=i[this.hash],d,v=p.activePointersLists.length,w=0;for(d=0;d<v;d++)w+=p.activePointersLists[d].getLength();return w},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},t.MouseTracker.resetAllMouseTrackers=function(){for(var p=0;p<e.length;p++)e[p].isTracking()&&(e[p].setTracking(!1),e[p].setTracking(!0))},t.MouseTracker.gesturePointVelocityTracker=function(){var p=[],d=0,v=0,w=function(D,W){return D.hash.toString()+W.type+W.id.toString()},I=function(){var D,W=p.length,K,Y,he=t.now(),q,Le,Me;for(q=he-v,v=he,D=0;D<W;D++)K=p[D],Y=K.gPoint,Y.direction=Math.atan2(Y.currentPos.y-K.lastPos.y,Y.currentPos.x-K.lastPos.x),Le=K.lastPos.distanceTo(Y.currentPos),K.lastPos=Y.currentPos,Me=1e3*Le/(q+1),Y.speed=.75*Me+.25*Y.speed},k=function(D,W){var K=w(D,W);p.push({guid:K,gPoint:W,lastPos:W.currentPos}),p.length===1&&(v=t.now(),d=window.setInterval(I,50))},M=function(D,W){var K=w(D,W),Y,he=p.length;for(Y=0;Y<he;Y++)if(p[Y].guid===K){p.splice(Y,1),he--,he===0&&window.clearInterval(d);break}};return{addPoint:k,removePoint:M}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor==t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",t.MouseTracker.supportsMouseCapture=function(){var p=document.createElement("div");return t.isFunction(p.setCapture)&&t.isFunction(p.releaseCapture)}(),t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",t.MouseTracker.wheelEventName],t.MouseTracker.wheelEventName=="DOMMouseScroll"&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||t.Browser.vendor!==t.BROWSERS.IE)?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),t.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?t.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:t.MouseTracker.maxTouchPoints=0,t.MouseTracker.haveMouseEnter=!1):(t.MouseTracker.havePointerEvents=!1,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?(t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),t.MouseTracker.haveMouseEnter=!0):(t.MouseTracker.subscribeEvents.push("mouseover","mouseout"),t.MouseTracker.haveMouseEnter=!1),t.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.maxTouchPoints=10),t.MouseTracker.GesturePointList=function(p){this._gPoints=[],this.type=p,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(p){return this._gPoints.push(p)},removeById:function(p){var d,v=this._gPoints.length;for(d=0;d<v;d++)if(this._gPoints[d].id===p){this._gPoints.splice(d,1);break}return this._gPoints.length},getByIndex:function(p){return p<this._gPoints.length?this._gPoints[p]:null},getById:function(p){var d,v=this._gPoints.length;for(d=0;d<v;d++)if(this._gPoints[d].id===p)return this._gPoints[d];return null},getPrimary:function(p){var d,v=this._gPoints.length;for(d=0;d<v;d++)if(this._gPoints[d].isPrimary)return this._gPoints[d];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function n(p){var d=i[p.hash],v,w=d.activePointersLists.length;for(v=0;v<w;v++)d.activePointersLists[v].captureCount>0&&(t.removeEvent(t.MouseTracker.captureElement,"mousemove",d.mousemovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"mouseup",d.mouseupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",d.pointermovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",d.pointerupcaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchmove",d.touchmovecaptured,!0),t.removeEvent(t.MouseTracker.captureElement,"touchend",d.touchendcaptured,!0),d.activePointersLists[v].captureCount=0);for(v=0;v<w;v++)d.activePointersLists.pop()}function s(p){var d=i[p.hash],v,w;if(!d.tracking){for(w=0;w<t.MouseTracker.subscribeEvents.length;w++)v=t.MouseTracker.subscribeEvents[w],t.addEvent(p.element,v,d[v],!1);n(p),d.tracking=!0}}function o(p){var d=i[p.hash],v,w;if(d.tracking){for(w=0;w<t.MouseTracker.subscribeEvents.length;w++)v=t.MouseTracker.subscribeEvents[w],t.removeEvent(p.element,v,d[v],!1);n(p),d.tracking=!1}}function a(p,d){var v=i[p.hash];if(d==="pointerevent")return{upName:t.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:v.pointerupcaptured,moveName:t.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:v.pointermovecaptured};if(d==="mouse")return{upName:"mouseup",upHandler:v.mouseupcaptured,moveName:"mousemove",moveHandler:v.mousemovecaptured};if(d==="touch")return{upName:"touchend",upHandler:v.touchendcaptured,moveName:"touchmove",moveHandler:v.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function r(p,d,v){var w=p.getActivePointersListByType(d),I;w.captureCount+=v||1,w.captureCount===1&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?p.element.setCapture(!0):(I=a(p,t.MouseTracker.havePointerEvents?"pointerevent":d),Pt&&Ot(window.top)&&t.addEvent(window.top,I.upName,I.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,I.upName,I.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,I.moveName,I.moveHandler,!0)))}function c(p,d,v){var w=p.getActivePointersListByType(d),I;w.captureCount-=v||1,w.captureCount===0&&(t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?p.element.releaseCapture():(I=a(p,t.MouseTracker.havePointerEvents?"pointerevent":d),Pt&&Ot(window.top)&&t.removeEvent(window.top,I.upName,I.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,I.moveName,I.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,I.upName,I.upHandler,!0)))}function u(p){var d;if(t.MouseTracker.unprefixedPointerEvents)d=p.pointerType;else switch(p.pointerType){case 2:d="touch";break;case 3:d="pen";break;case 4:d="mouse";break;default:d=""}return d}function g(p){return t.getMousePosition(p)}function m(p,d){return x(g(p),d)}function x(p,d){var v=t.getElementOffset(d);return p.minus(v)}function S(p,d){return new t.Point((p.x+d.x)/2,(p.y+d.y)/2)}function E(p,d){p.clickHandler&&t.cancelEvent(d)}function H(p,d){p.dblClickHandler&&t.cancelEvent(d)}function h(p,d){var v;p.keyDownHandler&&(d=t.getEvent(d),v=p.keyDownHandler({eventSource:p,keyCode:d.keyCode?d.keyCode:d.charCode,ctrl:d.ctrlKey,shift:d.shiftKey,alt:d.altKey,meta:d.metaKey,originalEvent:d,preventDefaultAction:!1,userData:p.userData}),v||t.cancelEvent(d))}function y(p,d){var v;p.keyUpHandler&&(d=t.getEvent(d),v=p.keyUpHandler({eventSource:p,keyCode:d.keyCode?d.keyCode:d.charCode,ctrl:d.ctrlKey,shift:d.shiftKey,alt:d.altKey,meta:d.metaKey,originalEvent:d,preventDefaultAction:!1,userData:p.userData}),v||t.cancelEvent(d))}function T(p,d){var v;p.keyHandler&&(d=t.getEvent(d),v=p.keyHandler({eventSource:p,keyCode:d.keyCode?d.keyCode:d.charCode,ctrl:d.ctrlKey,shift:d.shiftKey,alt:d.altKey,meta:d.metaKey,originalEvent:d,preventDefaultAction:!1,userData:p.userData}),v||t.cancelEvent(d))}function R(p,d){var v;p.focusHandler&&(d=t.getEvent(d),v=p.focusHandler({eventSource:p,originalEvent:d,preventDefaultAction:!1,userData:p.userData}),v===!1&&t.cancelEvent(d))}function _(p,d){var v;p.blurHandler&&(d=t.getEvent(d),v=p.blurHandler({eventSource:p,originalEvent:d,preventDefaultAction:!1,userData:p.userData}),v===!1&&t.cancelEvent(d))}function P(p,d){N(p,d,d)}function L(p,d){d=t.getEvent(d);var v={target:d.target||d.srcElement,type:"wheel",shiftKey:d.shiftKey||!1,clientX:d.clientX,clientY:d.clientY,pageX:d.pageX?d.pageX:d.clientX,pageY:d.pageY?d.pageY:d.clientY,deltaMode:d.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};t.MouseTracker.wheelEventName=="mousewheel"?v.deltaY=-d.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:v.deltaY=d.detail,N(p,v,d)}function N(p,d,v){var w=0,I;w=d.deltaY<0?1:-1,p.scrollHandler&&(I=p.scrollHandler({eventSource:p,pointerType:"mouse",position:m(d,p.element),scroll:w,shift:d.shiftKey,isTouchEvent:!1,originalEvent:v,preventDefaultAction:!1,userData:p.userData}),I===!1&&t.cancelEvent(v))}function V(p,d){if(p===d)return!1;for(;d&&d!==p;)d=d.parentNode;return d===p}function J(p,d){d=t.getEvent(d),Q(p,d)}function z(p,d){d=t.getEvent(d),!(d.currentTarget===d.relatedTarget||V(d.currentTarget,d.relatedTarget))&&Q(p,d)}function Q(p,d){var v={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(d),currentTime:t.now()};we(p,d,[v])}function j(p,d){d=t.getEvent(d),ae(p,d)}function re(p,d){d=t.getEvent(d),!(d.currentTarget===d.relatedTarget||V(d.currentTarget,d.relatedTarget))&&ae(p,d)}function ae(p,d){var v={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(d),currentTime:t.now()};xe(p,d,[v])}function ce(p){return t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?p===1?0:p===2?2:p===4?1:-1:p}function le(p,d){var v;d=t.getEvent(d),v={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(d),currentTime:t.now()},at(p,d,[v],ce(d.button))&&(t.stopEvent(d),r(p,"mouse")),(p.clickHandler||p.dblClickHandler||p.pressHandler||p.dragHandler||p.dragEndHandler)&&t.cancelEvent(d)}function G(p,d){Pe(p,d)}function ge(p,d){Pe(p,d),t.stopEvent(d)}function Pe(p,d){var v;d=t.getEvent(d),v={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(d),currentTime:t.now()},De(p,d,[v],ce(d.button))&&c(p,"mouse")}function $e(p,d){Ze(p,d)}function Ne(p,d){Ze(p,d),t.stopEvent(d)}function Ze(p,d){var v;d=t.getEvent(d),v={id:t.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:g(d),currentTime:t.now()},lt(p,d,[v])}function Be(p,d,v){var w,I=v.getLength(),k=[];if(v.type==="touch"||v.contacts>0){for(w=0;w<I;w++)k.push(v.getByIndex(w));k.length>0&&(De(p,d,k,0),v.captureCount=1,c(p,v.type),xe(p,d,k))}}function et(p,d){var v,w,I,k=d.changedTouches.length,M=[],D,W=p.getActivePointersListByType("touch");for(v=t.now(),W.getLength()>d.touches.length-k&&(t.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Be(p,d,W)),w=0;w<k;w++)M.push({id:d.changedTouches[w].identifier,type:"touch",currentPos:g(d.changedTouches[w]),currentTime:v});for(we(p,d,M),w=0;w<e.length;w++)if(e[w]!==p&&e[w].isTracking()&&V(e[w].element,p.element)){for(D=[],I=0;I<k;I++)D.push({id:d.changedTouches[I].identifier,type:"touch",currentPos:g(d.changedTouches[I]),currentTime:v});we(e[w],d,D)}at(p,d,M,0)&&(t.stopEvent(d),r(p,"touch",k)),t.cancelEvent(d)}function tt(p,d){Je(p,d)}function it(p,d){Je(p,d),t.stopEvent(d)}function Je(p,d){var v,w,I,k=d.changedTouches.length,M=[],D;for(v=t.now(),w=0;w<k;w++)M.push({id:d.changedTouches[w].identifier,type:"touch",currentPos:g(d.changedTouches[w]),currentTime:v});for(De(p,d,M,0)&&c(p,"touch",k),xe(p,d,M),w=0;w<e.length;w++)if(e[w]!==p&&e[w].isTracking()&&V(e[w].element,p.element)){for(D=[],I=0;I<k;I++)D.push({id:d.changedTouches[I].identifier,type:"touch",currentPos:g(d.changedTouches[I]),currentTime:v});xe(e[w],d,D)}t.cancelEvent(d)}function nt(p,d){qe(p,d)}function st(p,d){qe(p,d),t.stopEvent(d)}function qe(p,d){var v,w=d.changedTouches.length,I=[];for(v=0;v<w;v++)I.push({id:d.changedTouches[v].identifier,type:"touch",currentPos:g(d.changedTouches[v]),currentTime:t.now()});lt(p,d,I),t.cancelEvent(d)}function ot(p,d){var v=p.getActivePointersListByType("touch");Be(p,d,v)}function rt(p,d){return d.stopPropagation(),d.preventDefault(),!1}function l(p,d){return d.stopPropagation(),d.preventDefault(),!1}function f(p,d){var v;d.currentTarget===d.relatedTarget||V(d.currentTarget,d.relatedTarget)||(v={id:d.pointerId,type:u(d),isPrimary:d.isPrimary,currentPos:g(d),currentTime:t.now()},we(p,d,[v]))}function C(p,d){var v;d.currentTarget===d.relatedTarget||V(d.currentTarget,d.relatedTarget)||(v={id:d.pointerId,type:u(d),isPrimary:d.isPrimary,currentPos:g(d),currentTime:t.now()},xe(p,d,[v]))}function O(p,d){var v;v={id:d.pointerId,type:u(d),isPrimary:d.isPrimary,currentPos:g(d),currentTime:t.now()},at(p,d,[v],d.button)&&(t.stopEvent(d),r(p,v.type)),(p.clickHandler||p.dblClickHandler||p.pressHandler||p.dragHandler||p.dragEndHandler||p.pinchHandler)&&t.cancelEvent(d)}function A(p,d){F(p,d)}function X(p,d){var v=p.getActivePointersListByType(u(d));v.getById(d.pointerId)&&F(p,d),t.stopEvent(d)}function F(p,d){var v;v={id:d.pointerId,type:u(d),isPrimary:d.isPrimary,currentPos:g(d),currentTime:t.now()},De(p,d,[v],d.button)&&c(p,v.type)}function ne(p,d){te(p,d)}function se(p,d){var v=p.getActivePointersListByType(u(d));v.getById(d.pointerId)&&te(p,d),t.stopEvent(d)}function te(p,d){var v;v={id:d.pointerId,type:u(d),isPrimary:d.isPrimary,currentPos:g(d),currentTime:t.now()},lt(p,d,[v])}function Z(p,d){var v;v={id:d.pointerId,type:u(d)},ai(p,d,[v])}function de(p,d){return Object.prototype.hasOwnProperty.call(d,"isPrimary")||(p.getLength()===0?d.isPrimary=!0:d.isPrimary=!1),d.speed=0,d.direction=0,d.contactPos=d.currentPos,d.contactTime=d.currentTime,d.lastPos=d.currentPos,d.lastTime=d.currentTime,p.add(d)}function ee(p,d){var v,w;return p.getById(d.id)?(v=p.removeById(d.id),Object.prototype.hasOwnProperty.call(d,"isPrimary")||(w=p.getPrimary(),w||(w=p.getByIndex(0),w&&(w.isPrimary=!0)))):v=p.getLength(),v}function we(p,d,v){var w=p.getActivePointersListByType(v[0].type),I,k=v.length,M,D,W;for(I=0;I<k;I++)M=v[I],D=w.getById(M.id),D?(D.insideElement=!0,D.lastPos=D.currentPos,D.lastTime=D.currentTime,D.currentPos=M.currentPos,D.currentTime=M.currentTime,M=D):(M.captured=!1,M.insideElementPressed=!1,M.insideElement=!0,de(w,M)),p.enterHandler&&(W=p.enterHandler({eventSource:p,pointerType:M.type,position:x(M.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:M.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:M.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),W===!1&&t.cancelEvent(d))}function xe(p,d,v){var w=p.getActivePointersListByType(v[0].type),I,k=v.length,M,D,W;for(I=0;I<k;I++)M=v[I],D=w.getById(M.id),D&&(D.captured?(D.insideElement=!1,D.lastPos=D.currentPos,D.lastTime=D.currentTime,D.currentPos=M.currentPos,D.currentTime=M.currentTime):ee(w,D),M=D),p.exitHandler&&(W=p.exitHandler({eventSource:p,pointerType:M.type,position:M.currentPos&&x(M.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:D?D.insideElementPressed:!1,buttonDownAny:w.buttons!==0,isTouchEvent:M.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),W===!1&&t.cancelEvent(d))}function at(p,d,v,w){var I=i[p.hash],k,M=p.getActivePointersListByType(v[0].type),D,W=v.length,K,Y;typeof d.buttons!="undefined"?M.buttons=d.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?w===0?M.buttons+=1:w===1?M.buttons+=4:w===2?M.buttons+=2:w===3?M.buttons+=8:w===4?M.buttons+=16:w===5&&(M.buttons+=32):w===0?M.buttons|=1:w===1?M.buttons|=4:w===2?M.buttons|=2:w===3?M.buttons|=8:w===4?M.buttons|=16:w===5&&(M.buttons|=32);var he=p.getActivePointersListsExceptType(v[0].type);for(D=0;D<he.length;D++)Be(p,d,he[D]);if(w!==0)return p.nonPrimaryPressHandler&&(k=p.nonPrimaryPressHandler({eventSource:p,pointerType:v[0].type,position:x(v[0].currentPos,p.element),button:w,buttons:M.buttons,isTouchEvent:v[0].type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),k===!1&&t.cancelEvent(d)),!1;for(D=0;D<W;D++)K=v[D],Y=M.getById(K.id),Y?(Y.captured=!0,Y.insideElementPressed=!0,Y.insideElement=!0,Y.contactPos=K.currentPos,Y.contactTime=K.currentTime,Y.lastPos=Y.currentPos,Y.lastTime=Y.currentTime,Y.currentPos=K.currentPos,Y.currentTime=K.currentTime,K=Y):(K.captured=!0,K.insideElementPressed=!0,K.insideElement=!0,de(M,K)),M.addContact(),(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(p,K),M.contacts===1?p.pressHandler&&(k=p.pressHandler({eventSource:p,pointerType:K.type,position:x(K.contactPos,p.element),buttons:M.buttons,isTouchEvent:K.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),k===!1&&t.cancelEvent(d)):M.contacts===2&&p.pinchHandler&&K.type==="touch"&&(I.pinchGPoints=M.asArray(),I.lastPinchDist=I.currentPinchDist=I.pinchGPoints[0].currentPos.distanceTo(I.pinchGPoints[1].currentPos),I.lastPinchCenter=I.currentPinchCenter=S(I.pinchGPoints[0].currentPos,I.pinchGPoints[1].currentPos));return!0}function De(p,d,v,w){var I=i[p.hash],k=p.getActivePointersListByType(v[0].type),M,D,W,K,Y=v.length,he,q,Le=!1,Me=!1,ht;if(typeof d.buttons!="undefined"?k.buttons=d.buttons:t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<9?w===0?k.buttons-=1:w===1?k.buttons-=4:w===2?k.buttons-=2:w===3?k.buttons-=8:w===4?k.buttons-=16:w===5&&(k.buttons-=32):w===0?k.buttons^=~1:w===1?k.buttons^=~4:w===2?k.buttons^=~2:w===3?k.buttons^=~8:w===4?k.buttons^=~16:w===5&&(k.buttons^=~32),w!==0){p.nonPrimaryReleaseHandler&&(M=p.nonPrimaryReleaseHandler({eventSource:p,pointerType:v[0].type,position:x(v[0].currentPos,p.element),button:w,buttons:k.buttons,isTouchEvent:v[0].type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),M===!1&&t.cancelEvent(d));var hi=p.getActivePointersListByType("mouse");return Be(p,d,hi),!1}if(typeof v[0].currentPos=="undefined")return Be(p,d,k),!1;for(K=0;K<Y;K++)he=v[K],q=k.getById(he.id),q&&(q.captured&&(q.captured=!1,Le=!0,Me=!0),q.lastPos=q.currentPos,q.lastTime=q.currentTime,q.currentPos=he.currentPos,q.currentTime=he.currentTime,q.insideElement||ee(k,q),D=q.currentPos,W=q.currentTime,Me?(k.removeContact(),(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(p,q),k.contacts===0?(p.releaseHandler&&(M=p.releaseHandler({eventSource:p,pointerType:q.type,position:x(D,p.element),buttons:k.buttons,insideElementPressed:q.insideElementPressed,insideElementReleased:q.insideElement,isTouchEvent:q.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),M===!1&&t.cancelEvent(d)),p.dragEndHandler&&!q.currentPos.equals(q.contactPos)&&(M=p.dragEndHandler({eventSource:p,pointerType:q.type,position:x(q.currentPos,p.element),speed:q.speed,direction:q.direction,shift:d.shiftKey,isTouchEvent:q.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),M===!1&&t.cancelEvent(d)),(p.clickHandler||p.dblClickHandler)&&q.insideElement&&(ht=W-q.contactTime<=p.clickTimeThreshold&&q.contactPos.distanceTo(D)<=p.clickDistThreshold,p.clickHandler&&(M=p.clickHandler({eventSource:p,pointerType:q.type,position:x(q.currentPos,p.element),quick:ht,shift:d.shiftKey,isTouchEvent:q.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),M===!1&&t.cancelEvent(d)),p.dblClickHandler&&ht&&(k.clicks++,k.clicks===1?(I.lastClickPos=D,I.dblClickTimeOut=setTimeout(function(){k.clicks=0},p.dblClickTimeThreshold)):k.clicks===2&&(clearTimeout(I.dblClickTimeOut),k.clicks=0,I.lastClickPos.distanceTo(D)<=p.dblClickDistThreshold&&(M=p.dblClickHandler({eventSource:p,pointerType:q.type,position:x(q.currentPos,p.element),shift:d.shiftKey,isTouchEvent:q.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),M===!1&&t.cancelEvent(d)),I.lastClickPos=null)))):k.contacts===2&&p.pinchHandler&&q.type==="touch"&&(I.pinchGPoints=k.asArray(),I.lastPinchDist=I.currentPinchDist=I.pinchGPoints[0].currentPos.distanceTo(I.pinchGPoints[1].currentPos),I.lastPinchCenter=I.currentPinchCenter=S(I.pinchGPoints[0].currentPos,I.pinchGPoints[1].currentPos))):p.releaseHandler&&(M=p.releaseHandler({eventSource:p,pointerType:q.type,position:x(D,p.element),buttons:k.buttons,insideElementPressed:q.insideElementPressed,insideElementReleased:q.insideElement,isTouchEvent:q.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),M===!1&&t.cancelEvent(d)));return Le}function lt(p,d,v){var w=i[p.hash],I=p.getActivePointersListByType(v[0].type),k,M=v.length,D,W,K,Y,he;for(typeof d.buttons!="undefined"&&(I.buttons=d.buttons),k=0;k<M;k++)D=v[k],W=I.getById(D.id),W?(Object.prototype.hasOwnProperty.call(D,"isPrimary")&&(W.isPrimary=D.isPrimary),W.lastPos=W.currentPos,W.lastTime=W.currentTime,W.currentPos=D.currentPos,W.currentTime=D.currentTime):(D.captured=!1,D.insideElementPressed=!1,D.insideElement=!0,de(I,D));p.stopHandler&&v[0].type==="mouse"&&(clearTimeout(p.stopTimeOut),p.stopTimeOut=setTimeout(function(){li(p,d,v[0].type)},p.stopDelay)),I.contacts===0?p.moveHandler&&(he=p.moveHandler({eventSource:p,pointerType:v[0].type,position:x(v[0].currentPos,p.element),buttons:I.buttons,isTouchEvent:v[0].type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),he===!1&&t.cancelEvent(d)):I.contacts===1?(p.moveHandler&&(W=I.asArray()[0],he=p.moveHandler({eventSource:p,pointerType:W.type,position:x(W.currentPos,p.element),buttons:I.buttons,isTouchEvent:W.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),he===!1&&t.cancelEvent(d)),p.dragHandler&&(W=I.asArray()[0],Y=W.currentPos.minus(W.lastPos),he=p.dragHandler({eventSource:p,pointerType:W.type,position:x(W.currentPos,p.element),buttons:I.buttons,delta:Y,speed:W.speed,direction:W.direction,shift:d.shiftKey,isTouchEvent:W.type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),he===!1&&t.cancelEvent(d))):I.contacts===2&&(p.moveHandler&&(K=I.asArray(),he=p.moveHandler({eventSource:p,pointerType:K[0].type,position:x(S(K[0].currentPos,K[1].currentPos),p.element),buttons:I.buttons,isTouchEvent:K[0].type==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData}),he===!1&&t.cancelEvent(d)),p.pinchHandler&&v[0].type==="touch"&&(Y=w.pinchGPoints[0].currentPos.distanceTo(w.pinchGPoints[1].currentPos),Y!=w.currentPinchDist&&(w.lastPinchDist=w.currentPinchDist,w.currentPinchDist=Y,w.lastPinchCenter=w.currentPinchCenter,w.currentPinchCenter=S(w.pinchGPoints[0].currentPos,w.pinchGPoints[1].currentPos),he=p.pinchHandler({eventSource:p,pointerType:"touch",gesturePoints:w.pinchGPoints,lastCenter:x(w.lastPinchCenter,p.element),center:x(w.currentPinchCenter,p.element),lastDistance:w.lastPinchDist,distance:w.currentPinchDist,shift:d.shiftKey,originalEvent:d,preventDefaultAction:!1,userData:p.userData}),he===!1&&t.cancelEvent(d))))}function ai(p,d,v){De(p,d,v,0),xe(p,d,v)}function li(p,d,v){p.stopHandler&&p.stopHandler({eventSource:p,pointerType:v,position:m(d,p.element),buttons:p.getActivePointersListByType(v).buttons,isTouchEvent:v==="touch",originalEvent:d,preventDefaultAction:!1,userData:p.userData})}var Pt=function(){try{return window.self!==window.top}catch{return!0}}();function Ot(p){try{return p.addEventListener&&p.removeEventListener}catch{return!1}}})(OpenSeadragon);(function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(e,i,n){var s=e.parentNode;typeof i=="number"&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=typeof i.attachToViewer=="undefined"?!0:i.attachToViewer,this.autoFade=typeof i.autoFade=="undefined"?!0:i.autoFade,this.element=e,this.anchor=i.anchor,this.container=n,this.anchor==t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof i.top=="number"?i.top+"px":i.top,this.wrapper.style.left=typeof i.left=="number"?i.left+"px":i.left,this.wrapper.style.height=typeof i.height=="number"?i.height+"px":i.height,this.wrapper.style.width=typeof i.width=="number"?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==t.ControlAnchor.TOP_RIGHT||this.anchor==t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):s.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(e){this.wrapper.style.display=e?this.anchor==t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[t.SIGNAL]&&t.Browser.vendor==t.BROWSERS.IE?t.setElementOpacity(this.element,e,!0):t.setElementOpacity(this.wrapper,e,!0)}}})(OpenSeadragon);(function(t){t.ControlDock=function(i){var n=["topleft","topright","bottomright","bottomleft"],s,o;for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(Math.random()*1e6),container:t.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),o=0;o<n.length;o++)s=n[o],this.controls[s]=t.makeNeutralElement("div"),this.controls[s].style.position="absolute",s.match("left")&&(this.controls[s].style.left="0px"),s.match("right")&&(this.controls[s].style.right="0px"),s.match("top")&&(this.controls[s].style.top="0px"),s.match("bottom")&&(this.controls[s].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(i,n){i=t.getElement(i);var s=null;if(!(e(this,i)>=0)){switch(n.anchor){case t.ControlAnchor.TOP_RIGHT:s=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:s=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:s=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:s=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:s=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case t.ControlAnchor.NONE:s=this.container,i.style.margin="0px",i.style.padding="0px";break}this.controls.push(new t.Control(i,n,s)),i.style.display="inline-block"}},removeControl:function(i){i=t.getElement(i);var n=e(this,i);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;i>=0;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(i){var n;for(n=this.controls.length-1;n>=0;n--)this.controls[n].setVisible(i);return this}};function e(i,n){var s=i.controls,o;for(o=s.length-1;o>=0;o--)if(s[o].element==n)return o;return-1}})(OpenSeadragon);(function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})})(OpenSeadragon);(function(t){var e={},i=1;t.Viewer=function(l){var f=arguments,C=this,O;if(t.isPlainObject(l)||(l={id:f[0],xmlPath:f.length>1?f[1]:void 0,prefixUrl:f.length>2?f[2]:void 0,controls:f.length>3?f[3]:void 0,overlays:f.length>4?f[4]:void 0}),l.config&&(t.extend(!0,l,l.config),delete l.config),t.extend(!0,this,{id:l.id,hash:l.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},t.DEFAULT_SETTINGS,l),typeof this.hash=="undefined")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof e[this.hash]!="undefined"&&t.console.warn("Hash "+this.hash+" has already been used."),e[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(A){var X=t.getString("Errors.OpenFailed",A.eventSource,A.message);C._showMessage(X)}),t.ControlDock.call(this,l),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(A){A.width="100%",A.height="100%",A.overflow="hidden",A.position="absolute",A.top="0px",A.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),l.tabIndex!==""&&(this.canvas.tabIndex=l.tabIndex===void 0?0:l.tabIndex),this.container.className="openseadragon-container",function(A){A.width="100%",A.height="100%",A.position="relative",A.overflow="hidden",A.left="0px",A.top="0px",A.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:t.delegate(this,E),keyHandler:t.delegate(this,H),clickHandler:t.delegate(this,h),dblClickHandler:t.delegate(this,y),dragHandler:t.delegate(this,T),dragEndHandler:t.delegate(this,R),enterHandler:t.delegate(this,_),exitHandler:t.delegate(this,P),pressHandler:t.delegate(this,L),releaseHandler:t.delegate(this,N),nonPrimaryPressHandler:t.delegate(this,V),nonPrimaryReleaseHandler:t.delegate(this,J),scrollHandler:t.delegate(this,Q),pinchHandler:t.delegate(this,z)}),this.outerTracker=new t.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,j),exitHandler:t.delegate(this,re)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),e[this.hash].prevContainerSize=n(this.container),this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(A){C.source=C.world.getItemAt(0).source,e[C.hash].forceRedraw=!0,C._updateRequestId||(C._updateRequestId=r(C,ae))}),this.world.addHandler("remove-item",function(A){C.world.getItemCount()?C.source=C.world.getItemAt(0).source:C.source=null,e[C.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(A){C.viewport&&C.viewport._setContentBounds(C.world.getHomeBounds(),C.world.getContentFactor())}),this.world.addHandler("item-index-change",function(A){C.source=C.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:e[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:l.timeout}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(O=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(O,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(O=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(O,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new t.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),O=0;O<this.customControls.length;O++)this.addControl(this.customControls[O].id,{anchor:this.customControls[O].anchor});t.requestAnimationFrame(function(){u(C)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(l){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(l)},openTileSource:function(l){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(l)},open:function(l,f){var C=this;if(this.close(),!!l){if(this.sequenceMode&&t.isArray(l)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof f!="undefined"&&!isNaN(f)&&(this.initialPage=f),this.tileSources=l,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(t.isArray(l)||(l=[l]),!!l.length){this._opening=!0;for(var O=l.length,A=0,X=0,F,ne=function(){if(A+X===O)if(A){(C._firstOpen||!C.preserveViewport)&&(C.viewport.goHome(!0),C.viewport.update()),C._firstOpen=!1;var Z=l[0];if(Z.tileSource&&(Z=Z.tileSource),C.overlays&&!C.preserveOverlays)for(var de=0;de<C.overlays.length;de++)C.currentOverlays[de]=o(C,C.overlays[de]);C._drawOverlays(),C._opening=!1,C.raiseEvent("open",{source:Z})}else C._opening=!1,C.raiseEvent("open-failed",F)},se=function(Z){(!t.isPlainObject(Z)||!Z.tileSource)&&(Z={tileSource:Z}),Z.index!==void 0&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Z.index),Z.collectionImmediately===void 0&&(Z.collectionImmediately=!0);var de=Z.success;Z.success=function(we){if(A++,Z.tileSource.overlays)for(var xe=0;xe<Z.tileSource.overlays.length;xe++)C.addOverlay(Z.tileSource.overlays[xe]);de&&de(we),ne()};var ee=Z.error;Z.error=function(we){X++,F||(F=we),ee&&ee(we),ne()},C.addTiledImage(Z)},te=0;te<l.length;te++)se(l[te]);return this}}},close:function(){return e[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),e[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(!!e[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),e[this.hash]=null,delete e[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(l){return this.innerTracker.setTracking(l),this.outerTracker.setTracking(l),this.raiseEvent("mouse-enabled",{enabled:l}),this},areControlsEnabled:function(){var l=this.controls.length,f;for(f=0;f<this.controls.length;f++)l=l&&this.controls[f].isVisible();return l},setControlsEnabled:function(l){return l?m(this):u(this),this.raiseEvent("controls-enabled",{enabled:l}),this},setDebugMode:function(l){for(var f=0;f<this.world.getItemCount();f++)this.world.getItemAt(f).debugMode=l;this.debugMode=l,this.forceRedraw()},isFullPage:function(){return e[this.hash].fullPage},setFullPage:function(l){var f=document.body,C=f.style,O=document.documentElement.style,A=this,X,F;if(l==this.isFullPage())return this;var ne={fullPage:l,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",ne),ne.preventDefaultAction)return this;if(l){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=C.margin,this.docMargin=O.margin,C.margin="0",O.margin="0",this.bodyPadding=C.padding,this.docPadding=O.padding,C.padding="0",O.padding="0",this.bodyWidth=C.width,this.docWidth=O.width,C.width="100%",O.width="100%",this.bodyHeight=C.height,this.docHeight=O.height,C.height="100%",O.height="100%",this.previousBody=[],e[this.hash].prevElementParent=this.element.parentNode,e[this.hash].prevNextSibling=this.element.nextSibling,e[this.hash].prevElementWidth=this.element.style.width,e[this.hash].prevElementHeight=this.element.style.height,X=f.childNodes.length,F=0;F<X;F++)this.previousBody.push(f.childNodes[0]),f.removeChild(f.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,f.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),f.appendChild(this.element),this.element.style.height=t.getWindowSize().y+"px",this.element.style.width=t.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),e[this.hash].fullPage=!0,t.delegate(this,j)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,C.margin=this.bodyMargin,O.margin=this.docMargin,C.padding=this.bodyPadding,O.padding=this.docPadding,C.width=this.bodyWidth,O.width=this.docWidth,C.height=this.bodyHeight,O.height=this.docHeight,f.removeChild(this.element),X=this.previousBody.length,F=0;F<X;F++)f.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),e[this.hash].prevElementParent.insertBefore(this.element,e[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(f.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=e[this.hash].prevElementWidth,this.element.style.height=e[this.hash].prevElementHeight;var se=0,te=function(){t.setPageScroll(A.pageScroll);var Z=t.getPageScroll();se++,se<10&&(Z.x!==A.pageScroll.x||Z.y!==A.pageScroll.y)&&t.requestAnimationFrame(te)};t.requestAnimationFrame(te),e[this.hash].fullPage=!1,t.delegate(this,re)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:l}),this},setFullScreen:function(l){var f=this;if(!t.supportsFullScreen)return this.setFullPage(l);if(t.isFullScreen()===l)return this;var C={fullScreen:l,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",C),C.preventDefaultAction)return this;if(l){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var O=function(){var A=t.isFullScreen();A||(t.removeEvent(document,t.fullScreenEventName,O),t.removeEvent(document,t.fullScreenErrorEventName,O),f.setFullPage(!1),f.isFullPage()&&(f.element.style.width=f.fullPageStyleWidth,f.element.style.height=f.fullPageStyleHeight)),f.navigator&&f.viewport&&setTimeout(function(){f.navigator.update(f.viewport)}),f.raiseEvent("full-screen",{fullScreen:A})};t.addEvent(document,t.fullScreenEventName,O),t.addEvent(document,t.fullScreenErrorEventName,O),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(l){return this.container.style.visibility=l?"":"hidden",this.raiseEvent("visible",{visible:l}),this},addTiledImage:function(l){t.console.assert(l,"[Viewer.addTiledImage] options is required"),t.console.assert(l.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!l.replace||l.index>-1&&l.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var f=this;l.replace&&(l.replaceItem=f.world.getItemAt(l.index)),this._hideMessage(),l.placeholderFillStyle===void 0&&(l.placeholderFillStyle=this.placeholderFillStyle),l.opacity===void 0&&(l.opacity=this.opacity),l.preload===void 0&&(l.preload=this.preload),l.compositeOperation===void 0&&(l.compositeOperation=this.compositeOperation),l.crossOriginPolicy===void 0&&(l.crossOriginPolicy=l.tileSource.crossOriginPolicy!==void 0?l.tileSource.crossOriginPolicy:this.crossOriginPolicy),l.ajaxWithCredentials===void 0&&(l.ajaxWithCredentials=this.ajaxWithCredentials),l.loadTilesWithAjax===void 0&&(l.loadTilesWithAjax=this.loadTilesWithAjax),l.ajaxHeaders===void 0||l.ajaxHeaders===null?l.ajaxHeaders=this.ajaxHeaders:t.isPlainObject(l.ajaxHeaders)&&t.isPlainObject(this.ajaxHeaders)&&(l.ajaxHeaders=t.extend({},this.ajaxHeaders,l.ajaxHeaders));var C={options:l};function O(F){for(var ne=0;ne<f._loadQueue.length;ne++)if(f._loadQueue[ne]===C){f._loadQueue.splice(ne,1);break}f._loadQueue.length===0&&A(C),f.raiseEvent("add-item-failed",F),l.error&&l.error(F)}function A(F){f.collectionMode&&(f.world.arrange({immediately:F.options.collectionImmediately,rows:f.collectionRows,columns:f.collectionColumns,layout:f.collectionLayout,tileSize:f.collectionTileSize,tileMargin:f.collectionTileMargin}),f.world.setAutoRefigureSizes(!0))}if(t.isArray(l.tileSource)){setTimeout(function(){O({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:l.tileSource,options:l})});return}this._loadQueue.push(C);function X(){for(var F,ne,se;f._loadQueue.length&&(F=f._loadQueue[0],!!F.tileSource);){if(f._loadQueue.splice(0,1),F.options.replace){var te=f.world.getIndexOfItem(F.options.replaceItem);te!=-1&&(F.options.index=te),f.world.removeItem(F.options.replaceItem)}ne=new t.TiledImage({viewer:f,source:F.tileSource,viewport:f.viewport,drawer:f.drawer,tileCache:f.tileCache,imageLoader:f.imageLoader,x:F.options.x,y:F.options.y,width:F.options.width,height:F.options.height,fitBounds:F.options.fitBounds,fitBoundsPlacement:F.options.fitBoundsPlacement,clip:F.options.clip,placeholderFillStyle:F.options.placeholderFillStyle,opacity:F.options.opacity,preload:F.options.preload,degrees:F.options.degrees,compositeOperation:F.options.compositeOperation,springStiffness:f.springStiffness,animationTime:f.animationTime,minZoomImageRatio:f.minZoomImageRatio,wrapHorizontal:f.wrapHorizontal,wrapVertical:f.wrapVertical,immediateRender:f.immediateRender,blendTime:f.blendTime,alwaysBlend:f.alwaysBlend,minPixelRatio:f.minPixelRatio,smoothTileEdgesMinZoom:f.smoothTileEdgesMinZoom,iOSDevice:f.iOSDevice,crossOriginPolicy:F.options.crossOriginPolicy,ajaxWithCredentials:F.options.ajaxWithCredentials,loadTilesWithAjax:F.options.loadTilesWithAjax,ajaxHeaders:F.options.ajaxHeaders,debugMode:f.debugMode}),f.collectionMode&&f.world.setAutoRefigureSizes(!1),f.world.addItem(ne,{index:F.options.index}),f._loadQueue.length===0&&A(F),f.world.getItemCount()===1&&!f.preserveViewport&&f.viewport.goHome(!0),f.navigator&&(se=t.extend({},F.options,{replace:!1,originalTiledImage:ne,tileSource:F.tileSource}),f.navigator.addTiledImage(se)),F.options.success&&F.options.success({item:ne})}}s(this,l.tileSource,l,function(F){C.tileSource=F,X()},function(F){F.options=l,O(F),X()})},addSimpleImage:function(l){t.console.assert(l,"[Viewer.addSimpleImage] options is required"),t.console.assert(l.url,"[Viewer.addSimpleImage] options.url is required");var f=t.extend({},l,{tileSource:{type:"image",url:l.url}});delete f.url,this.addTiledImage(f)},addLayer:function(l){var f=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var C=t.extend({},l,{success:function(O){f.raiseEvent("add-layer",{options:l,drawer:O.item})},error:function(O){f.raiseEvent("add-layer-failed",O)}});return this.addTiledImage(C),this},getLayerAtLevel:function(l){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(l)},getLevelOfLayer:function(l){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(l)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(l,f){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(l,f)},removeLayer:function(l){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(l)},forceRedraw:function(){return e[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var l=t.delegate(this,x),f=t.delegate(this,S),C=t.delegate(this,rt),O=t.delegate(this,ot),A=this.navImages,X=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(X=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:G(this.prefixUrl,A.previous.REST),srcGroup:G(this.prefixUrl,A.previous.GROUP),srcHover:G(this.prefixUrl,A.previous.HOVER),srcDown:G(this.prefixUrl,A.previous.DOWN),onRelease:O,onFocus:l,onBlur:f}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:G(this.prefixUrl,A.next.REST),srcGroup:G(this.prefixUrl,A.next.GROUP),srcHover:G(this.prefixUrl,A.next.HOVER),srcDown:G(this.prefixUrl,A.next.DOWN),onRelease:C,onFocus:l,onBlur:f}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),X&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var l=t.delegate(this,ge),f=t.delegate(this,$e),C=t.delegate(this,Be),O=t.delegate(this,Pe),A=t.delegate(this,et),X=t.delegate(this,it),F=t.delegate(this,Je),ne=t.delegate(this,nt),se=t.delegate(this,st),te=t.delegate(this,qe),Z=t.delegate(this,x),de=t.delegate(this,S),ee=this.navImages,we=[],xe=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(xe=!1),this.showZoomControl&&(we.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:G(this.prefixUrl,ee.zoomIn.REST),srcGroup:G(this.prefixUrl,ee.zoomIn.GROUP),srcHover:G(this.prefixUrl,ee.zoomIn.HOVER),srcDown:G(this.prefixUrl,ee.zoomIn.DOWN),onPress:l,onRelease:f,onClick:C,onEnter:l,onExit:f,onFocus:Z,onBlur:de})),we.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:G(this.prefixUrl,ee.zoomOut.REST),srcGroup:G(this.prefixUrl,ee.zoomOut.GROUP),srcHover:G(this.prefixUrl,ee.zoomOut.HOVER),srcDown:G(this.prefixUrl,ee.zoomOut.DOWN),onPress:O,onRelease:f,onClick:A,onEnter:O,onExit:f,onFocus:Z,onBlur:de}))),this.showHomeControl&&we.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:G(this.prefixUrl,ee.home.REST),srcGroup:G(this.prefixUrl,ee.home.GROUP),srcHover:G(this.prefixUrl,ee.home.HOVER),srcDown:G(this.prefixUrl,ee.home.DOWN),onRelease:X,onFocus:Z,onBlur:de})),this.showFullPageControl&&we.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:G(this.prefixUrl,ee.fullpage.REST),srcGroup:G(this.prefixUrl,ee.fullpage.GROUP),srcHover:G(this.prefixUrl,ee.fullpage.HOVER),srcDown:G(this.prefixUrl,ee.fullpage.DOWN),onRelease:F,onFocus:Z,onBlur:de})),this.showRotationControl&&(we.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:G(this.prefixUrl,ee.rotateleft.REST),srcGroup:G(this.prefixUrl,ee.rotateleft.GROUP),srcHover:G(this.prefixUrl,ee.rotateleft.HOVER),srcDown:G(this.prefixUrl,ee.rotateleft.DOWN),onRelease:ne,onFocus:Z,onBlur:de})),we.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:G(this.prefixUrl,ee.rotateright.REST),srcGroup:G(this.prefixUrl,ee.rotateright.GROUP),srcHover:G(this.prefixUrl,ee.rotateright.HOVER),srcDown:G(this.prefixUrl,ee.rotateright.DOWN),onRelease:se,onFocus:Z,onBlur:de}))),this.showFlipControl&&we.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:G(this.prefixUrl,ee.flip.REST),srcGroup:G(this.prefixUrl,ee.flip.GROUP),srcHover:G(this.prefixUrl,ee.flip.HOVER),srcDown:G(this.prefixUrl,ee.flip.DOWN),onRelease:te,onFocus:Z,onBlur:de})),xe&&(this.buttons=new t.ButtonGroup({buttons:we,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",t.delegate(this,tt)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(l){return this.tileSources&&l>=0&&l<this.tileSources.length&&(this._sequenceIndex=l,this._updateSequenceButtons(l),this.open(this.tileSources[l]),this.referenceStrip&&this.referenceStrip.setFocus(l),this.raiseEvent("page",{page:l})),this},addOverlay:function(l,f,C,O){var A;if(t.isPlainObject(l)?A=l:A={element:l,location:f,placement:C,onDraw:O},l=t.getElement(A.element),a(this.currentOverlays,l)>=0)return this;var X=o(this,A);return this.currentOverlays.push(X),X.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:l,location:A.location,placement:A.placement}),this},updateOverlay:function(l,f,C){var O;return l=t.getElement(l),O=a(this.currentOverlays,l),O>=0&&(this.currentOverlays[O].update(f,C),e[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:l,location:f,placement:C})),this},removeOverlay:function(l){var f;return l=t.getElement(l),f=a(this.currentOverlays,l),f>=0&&(this.currentOverlays[f].destroy(),this.currentOverlays.splice(f,1),e[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:l})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return e[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(l){var f;return l=t.getElement(l),f=a(this.currentOverlays,l),f>=0?this.currentOverlays[f]:null},_updateSequenceButtons:function(l){this.nextButton&&(!this.tileSources||this.tileSources.length-1===l?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(l>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(l){this._hideMessage();var f=t.makeNeutralElement("div");f.appendChild(document.createTextNode(l)),this.messageDiv=t.makeCenteredNode(f),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var l=this.messageDiv;l&&(l.parentNode.removeChild(l),delete this.messageDiv)},gestureSettingsByDeviceType:function(l){switch(l){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var l,f=this.currentOverlays.length;for(l=0;l<f;l++)this.currentOverlays[l].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function n(l){return l=t.getElement(l),new t.Point(l.clientWidth===0?1:l.clientWidth,l.clientHeight===0?1:l.clientHeight)}function s(l,f,C,O,A){var X=l;if(t.type(f)=="string"){if(f.match(/^\s*<.*>\s*$/))f=t.parseXml(f);else if(f.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var F=t.parseJSON(f);f=F}catch{}}function ne(se,te){se.ready?O(se):(se.addHandler("ready",function(){O(se)}),se.addHandler("open-failed",function(Z){A({message:Z.message,source:te})}))}setTimeout(function(){if(t.type(f)=="string")f=new t.TileSource({url:f,crossOriginPolicy:C.crossOriginPolicy!==void 0?C.crossOriginPolicy:l.crossOriginPolicy,ajaxWithCredentials:l.ajaxWithCredentials,ajaxHeaders:l.ajaxHeaders,useCanvas:l.useCanvas,success:function(de){O(de.tileSource)}}),f.addHandler("open-failed",function(de){A(de)});else if(t.isPlainObject(f)||f.nodeType)if(f.crossOriginPolicy===void 0&&(C.crossOriginPolicy!==void 0||l.crossOriginPolicy!==void 0)&&(f.crossOriginPolicy=C.crossOriginPolicy!==void 0?C.crossOriginPolicy:l.crossOriginPolicy),f.ajaxWithCredentials===void 0&&(f.ajaxWithCredentials=l.ajaxWithCredentials),f.useCanvas===void 0&&(f.useCanvas=l.useCanvas),t.isFunction(f.getTileUrl)){var se=new t.TileSource(f);se.getTileUrl=f.getTileUrl,O(se)}else{var te=t.TileSource.determineType(X,f);if(!te){A({message:"Unable to load TileSource",source:f});return}var Z=te.prototype.configure.apply(X,[f]);ne(new te(Z),f)}else ne(f,f)})}function o(l,f){if(f instanceof t.Overlay)return f;var C=null;if(f.element)C=t.getElement(f.element);else{var O=f.id?f.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);C=t.getElement(f.id),C||(C=document.createElement("a"),C.href="#/overlay/"+O),C.id=O,t.addClass(C,f.className?f.className:"openseadragon-overlay")}var A=f.location,X=f.width,F=f.height;if(!A){var ne=f.x,se=f.y;if(f.px!==void 0){var te=l.viewport.imageToViewportRectangle(new t.Rect(f.px,f.py,X||0,F||0));ne=te.x,se=te.y,X=X!==void 0?te.width:void 0,F=F!==void 0?te.height:void 0}A=new t.Point(ne,se)}var Z=f.placement;return Z&&t.type(Z)==="string"&&(Z=t.Placement[f.placement.toUpperCase()]),new t.Overlay({element:C,location:A,placement:Z,onDraw:f.onDraw,checkResize:f.checkResize,width:X,height:F,rotationMode:f.rotationMode})}function a(l,f){var C;for(C=l.length-1;C>=0;C--)if(l[C].element===f)return C;return-1}function r(l,f){return t.requestAnimationFrame(function(){f(l)})}function c(l){t.requestAnimationFrame(function(){g(l)})}function u(l){!l.autoHideControls||(l.controlsShouldFade=!0,l.controlsFadeBeginTime=t.now()+l.controlsFadeDelay,window.setTimeout(function(){c(l)},l.controlsFadeDelay))}function g(l){var f,C,O,A;if(l.controlsShouldFade){for(f=t.now(),C=f-l.controlsFadeBeginTime,O=1-C/l.controlsFadeLength,O=Math.min(1,O),O=Math.max(0,O),A=l.controls.length-1;A>=0;A--)l.controls[A].autoFade&&l.controls[A].setOpacity(O);O>0&&c(l)}}function m(l){var f;for(l.controlsShouldFade=!1,f=l.controls.length-1;f>=0;f--)l.controls[f].setOpacity(1)}function x(){m(this)}function S(){u(this)}function E(l){var f={originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction,preventVerticalPan:l.preventVerticalPan,preventHorizontalPan:l.preventHorizontalPan};if(this.raiseEvent("canvas-key",f),!f.preventDefaultAction&&!l.ctrl&&!l.alt&&!l.meta)switch(l.keyCode){case 38:return f.preventVerticalPan||(l.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return f.preventVerticalPan||(l.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return f.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return f.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function H(l){var f={originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction,preventVerticalPan:l.preventVerticalPan,preventHorizontalPan:l.preventHorizontalPan};if(this.raiseEvent("canvas-key",f),!f.preventDefaultAction&&!l.ctrl&&!l.alt&&!l.meta)switch(l.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return f.preventVerticalPan||(l.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return f.preventVerticalPan||(l.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return f.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return f.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(t.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(t.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(t.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(t.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function h(l){var f,C=document.activeElement==this.canvas;C||this.canvas.focus(),this.viewport.flipped&&(l.position.x=this.viewport.getContainerSize().x-l.position.x);var O={tracker:l.eventSource,position:l.position,quick:l.quick,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction};this.raiseEvent("canvas-click",O),!O.preventDefaultAction&&this.viewport&&l.quick&&(f=this.gestureSettingsByDeviceType(l.pointerType),f.clickToZoom&&(this.viewport.zoomBy(l.shift?1/this.zoomPerClick:this.zoomPerClick,f.zoomToRefPoint?this.viewport.pointFromPixel(l.position,!0):null),this.viewport.applyConstraints()))}function y(l){var f,C={tracker:l.eventSource,position:l.position,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction};this.raiseEvent("canvas-double-click",C),!C.preventDefaultAction&&this.viewport&&(f=this.gestureSettingsByDeviceType(l.pointerType),f.dblClickToZoom&&(this.viewport.zoomBy(l.shift?1/this.zoomPerClick:this.zoomPerClick,f.zoomToRefPoint?this.viewport.pointFromPixel(l.position,!0):null),this.viewport.applyConstraints()))}function T(l){var f,C={tracker:l.eventSource,position:l.position,delta:l.delta,speed:l.speed,direction:l.direction,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:l.preventDefaultAction};if(this.raiseEvent("canvas-drag",C),!C.preventDefaultAction&&this.viewport){if(f=this.gestureSettingsByDeviceType(l.pointerType),this.panHorizontal||(l.delta.x=0),this.panVertical||(l.delta.y=0),this.viewport.flipped&&(l.delta.x=-l.delta.x),this.constrainDuringPan){var O=this.viewport.deltaPointsFromPixels(l.delta.negate());this.viewport.centerSpringX.target.value+=O.x,this.viewport.centerSpringY.target.value+=O.y;var A=this.viewport.getBounds(),X=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=O.x,this.viewport.centerSpringY.target.value-=O.y,A.x!=X.x&&(l.delta.x=0),A.y!=X.y&&(l.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(l.delta.negate()),f.flickEnabled&&!this.constrainDuringPan)}}function R(l){if(!l.preventDefaultAction&&this.viewport){var f=this.gestureSettingsByDeviceType(l.pointerType);if(f.flickEnabled&&l.speed>=f.flickMinSpeed){var C=0;this.panHorizontal&&(C=f.flickMomentum*l.speed*Math.cos(l.direction));var O=0;this.panVertical&&(O=f.flickMomentum*l.speed*Math.sin(l.direction));var A=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),X=this.viewport.pointFromPixel(new t.Point(A.x-C,A.y-O));this.viewport.panTo(X,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:l.eventSource,position:l.position,speed:l.speed,direction:l.direction,shift:l.shift,originalEvent:l.originalEvent})}function _(l){this.raiseEvent("canvas-enter",{tracker:l.eventSource,pointerType:l.pointerType,position:l.position,buttons:l.buttons,pointers:l.pointers,insideElementPressed:l.insideElementPressed,buttonDownAny:l.buttonDownAny,originalEvent:l.originalEvent})}function P(l){window.location!=window.parent.location&&t.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:l.eventSource,pointerType:l.pointerType,position:l.position,buttons:l.buttons,pointers:l.pointers,insideElementPressed:l.insideElementPressed,buttonDownAny:l.buttonDownAny,originalEvent:l.originalEvent})}function L(l){this.raiseEvent("canvas-press",{tracker:l.eventSource,pointerType:l.pointerType,position:l.position,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElementReleased,originalEvent:l.originalEvent})}function N(l){this.raiseEvent("canvas-release",{tracker:l.eventSource,pointerType:l.pointerType,position:l.position,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElementReleased,originalEvent:l.originalEvent})}function V(l){this.raiseEvent("canvas-nonprimary-press",{tracker:l.eventSource,position:l.position,pointerType:l.pointerType,button:l.button,buttons:l.buttons,originalEvent:l.originalEvent})}function J(l){this.raiseEvent("canvas-nonprimary-release",{tracker:l.eventSource,position:l.position,pointerType:l.pointerType,button:l.button,buttons:l.buttons,originalEvent:l.originalEvent})}function z(l){var f,C,O,A;if(!l.preventDefaultAction&&this.viewport&&(f=this.gestureSettingsByDeviceType(l.pointerType),f.pinchToZoom&&(C=this.viewport.pointFromPixel(l.center,!0),O=this.viewport.pointFromPixel(l.lastCenter,!0),A=O.minus(C),this.panHorizontal||(A.x=0),this.panVertical||(A.y=0),this.viewport.zoomBy(l.distance/l.lastDistance,C,!0),f.zoomToRefPoint&&this.viewport.panBy(A,!0),this.viewport.applyConstraints()),f.pinchRotate)){var X=Math.atan2(l.gesturePoints[0].currentPos.y-l.gesturePoints[1].currentPos.y,l.gesturePoints[0].currentPos.x-l.gesturePoints[1].currentPos.x),F=Math.atan2(l.gesturePoints[0].lastPos.y-l.gesturePoints[1].lastPos.y,l.gesturePoints[0].lastPos.x-l.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(X-F)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:l.eventSource,gesturePoints:l.gesturePoints,lastCenter:l.lastCenter,center:l.center,lastDistance:l.lastDistance,distance:l.distance,shift:l.shift,originalEvent:l.originalEvent}),!1}function Q(l){var f,C,O,A;if(O=t.now(),A=O-this._lastScrollTime,A>this.minScrollDeltaTime){if(this._lastScrollTime=O,this.viewport.flipped&&(l.position.x=this.viewport.getContainerSize().x-l.position.x),!l.preventDefaultAction&&this.viewport&&(f=this.gestureSettingsByDeviceType(l.pointerType),f.scrollToZoom&&(C=Math.pow(this.zoomPerScroll,l.scroll),this.viewport.zoomBy(C,f.zoomToRefPoint?this.viewport.pointFromPixel(l.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:l.eventSource,position:l.position,scroll:l.scroll,shift:l.shift,originalEvent:l.originalEvent}),f&&f.scrollToZoom)return!1}else if(f=this.gestureSettingsByDeviceType(l.pointerType),f&&f.scrollToZoom)return!1}function j(l){e[this.hash].mouseInside=!0,m(this),this.raiseEvent("container-enter",{tracker:l.eventSource,position:l.position,buttons:l.buttons,pointers:l.pointers,insideElementPressed:l.insideElementPressed,buttonDownAny:l.buttonDownAny,originalEvent:l.originalEvent})}function re(l){l.pointers<1&&(e[this.hash].mouseInside=!1,e[this.hash].animating||u(this)),this.raiseEvent("container-exit",{tracker:l.eventSource,position:l.position,buttons:l.buttons,pointers:l.pointers,insideElementPressed:l.insideElementPressed,buttonDownAny:l.buttonDownAny,originalEvent:l.originalEvent})}function ae(l){ce(l),l.isOpen()?l._updateRequestId=r(l,ae):l._updateRequestId=!1}function ce(l){if(!l._opening){if(l.autoResize){var f=n(l.container),C=e[l.hash].prevContainerSize;if(!f.equals(C)){var O=l.viewport;if(l.preserveImageSizeOnResize){var A=C.x/f.x,X=O.getZoom()*A,F=O.getCenter();O.resize(f,!1),O.zoomTo(X,null,!0),O.panTo(F,!0)}else{var ne=O.getBounds();O.resize(f,!0),O.fitBoundsWithConstraints(ne,!0)}e[l.hash].prevContainerSize=f,e[l.hash].forceRedraw=!0}}var se=l.viewport.update(),te=l.world.update()||se;se&&l.raiseEvent("viewport-change"),l.referenceStrip&&(te=l.referenceStrip.update(l.viewport)||te),!e[l.hash].animating&&te&&(l.raiseEvent("animation-start"),m(l)),(te||e[l.hash].forceRedraw||l.world.needsDraw())&&(le(l),l._drawOverlays(),l.navigator&&l.navigator.update(l.viewport),e[l.hash].forceRedraw=!1,te&&l.raiseEvent("animation")),e[l.hash].animating&&!te&&(l.raiseEvent("animation-finish"),e[l.hash].mouseInside||u(l)),e[l.hash].animating=te}}function le(l){l.imageLoader.clear(),l.drawer.clear(),l.world.draw(),l.raiseEvent("update-viewport",{})}function G(l,f){return l?l+f:f}function ge(){e[this.hash].lastZoomTime=t.now(),e[this.hash].zoomFactor=this.zoomPerSecond,e[this.hash].zooming=!0,Ne(this)}function Pe(){e[this.hash].lastZoomTime=t.now(),e[this.hash].zoomFactor=1/this.zoomPerSecond,e[this.hash].zooming=!0,Ne(this)}function $e(){e[this.hash].zooming=!1}function Ne(l){t.requestAnimationFrame(t.delegate(l,Ze))}function Ze(){var l,f,C;e[this.hash].zooming&&this.viewport&&(l=t.now(),f=l-e[this.hash].lastZoomTime,C=Math.pow(e[this.hash].zoomFactor,f/1e3),this.viewport.zoomBy(C),this.viewport.applyConstraints(),e[this.hash].lastZoomTime=l,Ne(this))}function Be(){this.viewport&&(e[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function et(){this.viewport&&(e[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function tt(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function it(){this.viewport&&this.viewport.goHome()}function Je(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function nt(){if(this.viewport){var l=this.viewport.getRotation();this.viewport.flipped?l=t.positiveModulo(l+this.rotationIncrement,360):l=t.positiveModulo(l-this.rotationIncrement,360),this.viewport.setRotation(l)}}function st(){if(this.viewport){var l=this.viewport.getRotation();this.viewport.flipped?l=t.positiveModulo(l-this.rotationIncrement,360):l=t.positiveModulo(l+this.rotationIncrement,360),this.viewport.setRotation(l)}}function qe(){this.viewport.toggleFlip()}function ot(){var l=this._sequenceIndex-1;this.navPrevNextWrap&&l<0&&(l+=this.tileSources.length),this.goToPage(l)}function rt(){var l=this._sequenceIndex+1;this.navPrevNextWrap&&l>=this.tileSources.length&&(l=0),this.goToPage(l)}})(OpenSeadragon);(function(t){t.Navigator=function(r){var c=r.viewer,u=this,g,m;r.id?(this.element=document.getElementById(r.id),r.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(r.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),r.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:r.autoFade},r.position&&(r.position=="BOTTOM_RIGHT"?r.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:r.position=="BOTTOM_LEFT"?r.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:r.position=="TOP_RIGHT"?r.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:r.position=="TOP_LEFT"?r.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:r.position=="ABSOLUTE"&&(r.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,r.controlOptions.top=r.top,r.controlOptions.left=r.left,r.controlOptions.height=r.height,r.controlOptions.width=r.width))),this.element.id=r.id,this.element.className+=" navigator",r=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},r,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:r.autoResize,minZoomImageRatio:1,background:r.background,opacity:r.opacity,borderColor:r.borderColor,displayRegionColor:r.displayRegionColor}),r.minPixelRatio=this.minPixelRatio=c.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),r.controlOptions.anchor!=t.ControlAnchor.NONE&&function(E,H){E.margin="0px",E.border=H+"px solid "+r.borderColor,E.padding="0px",E.background=r.background,E.opacity=r.opacity,E.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(E,H){E.position="relative",E.top="0px",E.left="0px",E.fontSize="0px",E.overflow="hidden",E.border=H+"px solid "+r.displayRegionColor,E.margin="0px",E.padding="0px",E.background="transparent",E.float="left",E.cssFloat="left",E.styleFloat="left",E.zIndex=999999999,E.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",c.addControl(this.element,r.controlOptions),this._resizeWithViewer=r.controlOptions.anchor!=t.ControlAnchor.ABSOLUTE&&r.controlOptions.anchor!=t.ControlAnchor.NONE,r.width&&r.height?(this.setWidth(r.width),this.setHeight(r.height)):this._resizeWithViewer&&(g=t.getElementSize(c.element),this.element.style.height=Math.round(g.y*r.sizeRatio)+"px",this.element.style.width=Math.round(g.x*r.sizeRatio)+"px",this.oldViewerSize=g,m=t.getElementSize(this.element),this.elementArea=m.x*m.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[r]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function x(E){o(u.displayRegionContainer,E),o(u.displayRegion,-E),u.viewport.setRotation(E)}if(r.navigatorRotate){var S=r.viewer.viewport?r.viewer.viewport.getRotation():r.viewer.degrees||0;x(S),r.viewer.addHandler("rotate",function(E){x(E.degrees)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,i),clickHandler:t.delegate(this,e),releaseHandler:t.delegate(this,n),scrollHandler:t.delegate(this,s)}),this.addHandler("reset-size",function(){u.viewport&&u.viewport.goHome(!0)}),c.world.addHandler("item-index-change",function(E){window.setTimeout(function(){var H=u.world.getItemAt(E.previousIndex);u.world.setItemIndex(H,E.newIndex)},1)}),c.world.addHandler("remove-item",function(E){var H=E.item,h=u._getMatchingItem(H);h&&u.world.removeItem(h)}),this.update(c.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var r=new t.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);r.equals(this.oldContainerSize)||(this.viewport.resize(r,!0),this.viewport.goHome(!0),this.oldContainerSize=r,this.drawer.clear(),this.world.draw())}},setWidth:function(r){this.width=r,this.element.style.width=typeof r=="number"?r+"px":r,this._resizeWithViewer=!1},setHeight:function(r){this.height=r,this.element.style.height=typeof r=="number"?r+"px":r,this._resizeWithViewer=!1},setFlip:function(r){return this.viewport.setFlip(r),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(r){a(this.displayRegion,r),a(this.canvas,r),a(this.element,r)},update:function(r){var c,u,g,m,x,S;if(c=t.getElementSize(this.viewer.element),this._resizeWithViewer&&c.x&&c.y&&!c.equals(this.oldViewerSize)&&(this.oldViewerSize=c,this.maintainSizeRatio||!this.elementArea?(u=c.x*this.sizeRatio,g=c.y*this.sizeRatio):(u=Math.sqrt(this.elementArea*(c.x/c.y)),g=this.elementArea/u),this.element.style.width=Math.round(u)+"px",this.element.style.height=Math.round(g)+"px",this.elementArea||(this.elementArea=u*g),this.updateSize()),r&&this.viewport){m=r.getBoundsNoRotate(!0),x=this.viewport.pixelFromPointNoRotate(m.getTopLeft(),!1),S=this.viewport.pixelFromPointNoRotate(m.getBottomRight(),!1).minus(this.totalBorderWidths);var E=this.displayRegion.style;E.display=this.world.getItemCount()?"block":"none",E.top=Math.round(x.y)+"px",E.left=Math.round(x.x)+"px";var H=Math.abs(x.x-S.x),h=Math.abs(x.y-S.y);E.width=Math.round(Math.max(H,0))+"px",E.height=Math.round(Math.max(h,0))+"px"}},addTiledImage:function(r){var c=this,u=r.originalTiledImage;delete r.original;var g=t.extend({},r,{success:function(m){var x=m.item;x._originalForNavigator=u,c._matchBounds(x,u,!0);function S(){c._matchBounds(x,u)}function E(){c._matchOpacity(x,u)}function H(){c._matchCompositeOperation(x,u)}u.addHandler("bounds-change",S),u.addHandler("clip-change",S),u.addHandler("opacity-change",E),u.addHandler("composite-operation-change",H)}});return t.Viewer.prototype.addTiledImage.apply(this,[g])},_getMatchingItem:function(r){for(var c=this.world.getItemCount(),u,g=0;g<c;g++)if(u=this.world.getItemAt(g),u._originalForNavigator===r)return u;return null},_matchBounds:function(r,c,u){var g=c.getBoundsNoRotate();r.setPosition(g.getTopLeft(),u),r.setWidth(g.width,u),r.setRotation(c.getRotation(),u),r.setClip(c.getClip())},_matchOpacity:function(r,c){r.setOpacity(c.opacity)},_matchCompositeOperation:function(r,c){r.setCompositeOperation(c.compositeOperation)}});function e(r){var c={tracker:r.eventSource,position:r.position,quick:r.quick,shift:r.shift,originalEvent:r.originalEvent,preventDefaultAction:r.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",c),!c.preventDefaultAction&&r.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(r.position.x=this.viewport.getContainerSize().x-r.position.x);var u=this.viewport.pointFromPixel(r.position);this.panVertical?this.panHorizontal||(u.x=this.viewer.viewport.getCenter(!0).x):u.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(u),this.viewer.viewport.applyConstraints()}}function i(r){var c={tracker:r.eventSource,position:r.position,delta:r.delta,speed:r.speed,direction:r.direction,shift:r.shift,originalEvent:r.originalEvent,preventDefaultAction:r.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",c),!c.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(r.delta.x=0),this.panVertical||(r.delta.y=0),this.viewer.viewport.flipped&&(r.delta.x=-r.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(r.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(r){r.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function s(r){return this.viewer.raiseEvent("navigator-scroll",{tracker:r.eventSource,position:r.position,scroll:r.scroll,shift:r.shift,originalEvent:r.originalEvent}),!1}function o(r,c){a(r,"rotate("+c+"deg)")}function a(r,c){r.style.webkitTransform=c,r.style.mozTransform=c,r.style.msTransform=c,r.style.oTransform=c,r.style.transform=c}})(OpenSeadragon);(function(t){var e={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(i){var n=i.split("."),s=null,o=arguments,a=e,r;for(r=0;r<n.length-1;r++)a=a[n[r]]||{};return s=a[n[r]],typeof s!="string"&&(t.console.log("Untranslated source string:",i),s=""),s.replace(/\{\d+\}/g,function(c){var u=parseInt(c.match(/\d+/),10)+1;return u<o.length?o[u]:""})},setString:function(i,n){var s=i.split("."),o=e,a;for(a=0;a<s.length-1;a++)o[s[a]]||(o[s[a]]={}),o=o[s[a]];o[s[a]]=n}})})(OpenSeadragon);(function(t){t.Point=function(e,i){this.x=typeof e=="number"?e:0,this.y=typeof i=="number"?i:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(e){return new t.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new t.Point(this.x-e.x,this.y-e.y)},times:function(e){return new t.Point(this.x*e,this.y*e)},divide:function(e){return new t.Point(this.x/e,this.y/e)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(e){return new t.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof t.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,i){i=i||new t.Point(0,0);var n,s;if(e%90==0){var o=t.positiveModulo(e,360);switch(o){case 0:n=1,s=0;break;case 90:n=0,s=1;break;case 180:n=-1,s=0;break;case 270:n=0,s=-1;break}}else{var a=e*Math.PI/180;n=Math.cos(a),s=Math.sin(a)}var r=n*(this.x-i.x)-s*(this.y-i.y)+i.x,c=s*(this.x-i.x)+n*(this.y-i.y)+i.y;return new t.Point(r,c)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}})(OpenSeadragon);(function(t){t.TileSource=function(i,n,s,o,a,r){var c=this,u=arguments,g,m;if(t.isPlainObject(i)?g=i:g={width:u[0],height:u[1],tileSize:u[2],tileOverlap:u[3],minLevel:u[4],maxLevel:u[5]},t.EventSource.call(this),t.extend(!0,this,g),!this.success){for(m=0;m<arguments.length;m++)if(t.isFunction(arguments[m])){this.success=arguments[m];break}}this.success&&this.addHandler("ready",function(x){c.success(x)}),t.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=g.width&&g.height?g.width/g.height:1,this.dimensions=new t.Point(g.width,g.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=g.tileOverlap?g.tileOverlap:0,this.minLevel=g.minLevel?g.minLevel:0,this.maxLevel=g.maxLevel!==void 0&&g.maxLevel!==null?g.maxLevel:g.width&&g.height?Math.ceil(Math.log(Math.max(g.width,g.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(i){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(i){return this._tileWidth?this._tileWidth:this.getTileSize(i)},getTileHeight:function(i){return this._tileHeight?this._tileHeight:this.getTileSize(i)},getLevelScale:function(i){var n={},s;for(s=0;s<=this.maxLevel;s++)n[s]=1/Math.pow(2,this.maxLevel-s);return this.getLevelScale=function(o){return n[o]},this.getLevelScale(i)},getNumTiles:function(i){var n=this.getLevelScale(i),s=Math.ceil(n*this.dimensions.x/this.getTileWidth(i)),o=Math.ceil(n*this.dimensions.y/this.getTileHeight(i));return new t.Point(s,o)},getPixelRatio:function(i){var n=this.dimensions.times(this.getLevelScale(i)),s=1/n.x,o=1/n.y;return new t.Point(s,o)},getClosestLevel:function(){var i,n;for(i=this.minLevel+1;i<=this.maxLevel&&(n=this.getNumTiles(i),!(n.x>1||n.y>1));i++);return i-1},getTileAtPoint:function(i,n){var s=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;t.console.assert(s,"[TileSource.getTileAtPoint] must be called with a valid point.");var o=this.dimensions.x*this.getLevelScale(i),a=n.x*o,r=n.y*o,c=Math.floor(a/this.getTileWidth(i)),u=Math.floor(r/this.getTileHeight(i));n.x>=1&&(c=this.getNumTiles(i).x-1);var g=1e-15;return n.y>=1/this.aspectRatio-g&&(u=this.getNumTiles(i).y-1),new t.Point(c,u)},getTileBounds:function(i,n,s,o){var a=this.dimensions.times(this.getLevelScale(i)),r=this.getTileWidth(i),c=this.getTileHeight(i),u=n===0?0:r*n-this.tileOverlap,g=s===0?0:c*s-this.tileOverlap,m=r+(n===0?1:2)*this.tileOverlap,x=c+(s===0?1:2)*this.tileOverlap,S=1/a.x;return m=Math.min(m,a.x-u),x=Math.min(x,a.y-g),o?new t.Rect(0,0,m,x):new t.Rect(u*S,g*S,m*S,x*S)},getImageInfo:function(i){var n=this,s,o,a,r,c,u,g;i&&(c=i.split("/"),u=c[c.length-1],g=u.lastIndexOf("."),g>-1&&(c[c.length-1]=u.slice(0,g))),o=function(m){typeof m=="string"&&(m=t.parseXml(m));var x=t.TileSource.determineType(n,m,i);if(!x){n.raiseEvent("open-failed",{message:"Unable to load TileSource",source:i});return}r=x.prototype.configure.apply(n,[m,i]),r.ajaxWithCredentials===void 0&&(r.ajaxWithCredentials=n.ajaxWithCredentials),a=new x(r),n.ready=!0,n.raiseEvent("ready",{tileSource:a})},i.match(/\.js$/)?(s=i.split("/").pop().replace(".js",""),t.jsonp({url:i,async:!1,callbackName:s,callback:o})):t.makeAjaxRequest({url:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(m){var x=e(m);o(x)},error:function(m,x){var S;try{S="HTTP "+m.status+" attempting to load TileSource"}catch{var E;typeof x=="undefined"||!x.toString?E="Unknown error":E=x.toString(),S=E+" attempting to load TileSource"}n.raiseEvent("open-failed",{message:S,source:i})}})},supports:function(i,n){return!1},configure:function(i,n){throw new Error("Method not implemented.")},getTileUrl:function(i,n,s){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(i,n,s){return{}},tileExists:function(i,n,s){var o=this.getNumTiles(i);return i>=this.minLevel&&i<=this.maxLevel&&n>=0&&s>=0&&n<o.x&&s<o.y}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype);function e(i){var n=i.responseText,s=i.status,o,a;if(i){if(i.status!==200&&i.status!==0)throw s=i.status,o=s==404?"Not Found":i.statusText,new Error(t.getString("Errors.Status",s,o))}else throw new Error(t.getString("Errors.Security"));if(n.match(/\s*<.*/))try{a=i.responseXML&&i.responseXML.documentElement?i.responseXML:t.parseXml(n)}catch{a=i.responseText}else if(n.match(/\s*[\{\[].*/))try{a=t.parseJSON(n)}catch{a=n}else a=n;return a}t.TileSource.determineType=function(i,n,s){var o;for(o in OpenSeadragon)if(o.match(/.+TileSource$/)&&t.isFunction(OpenSeadragon[o])&&t.isFunction(OpenSeadragon[o].prototype.supports)&&OpenSeadragon[o].prototype.supports.call(i,n,s))return OpenSeadragon[o];t.console.error("No TileSource was able to open %s %s",s,n)}})(OpenSeadragon);(function(t){t.DziTileSource=function(n,s,o,a,r,c,u,g,m){var x,S,E,H;if(t.isPlainObject(n)?H=n:H={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=H.tilesUrl,this.fileFormat=H.fileFormat,this.displayRects=H.displayRects,this.displayRects)for(x=this.displayRects.length-1;x>=0;x--)for(S=this.displayRects[x],E=S.minLevel;E<=S.maxLevel;E++)this._levelRects[E]||(this._levelRects[E]=[]),this._levelRects[E].push(S);t.TileSource.apply(this,[H])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(n,s){var o;return n.Image?o=n.Image.xmlns:n.documentElement&&(n.documentElement.localName=="Image"||n.documentElement.tagName=="Image")&&(o=n.documentElement.namespaceURI),o=(o||"").toLowerCase(),o.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||o.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(n,s){var o;return t.isPlainObject(n)?o=i(this,n):o=e(this,n),s&&!o.tilesUrl&&(o.tilesUrl=s.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),s.search(/\.(dzi|xml|js)\?/)!=-1?o.queryParams=s.match(/\?.*/):o.queryParams=""),o},getTileUrl:function(n,s,o){return[this.tilesUrl,n,"/",s,"_",o,".",this.fileFormat,this.queryParams].join("")},tileExists:function(n,s,o){var a=this._levelRects[n],r,c,u,g,m,x,S;if(this.minLevel&&n<this.minLevel||this.maxLevel&&n>this.maxLevel)return!1;if(!a||!a.length)return!0;for(S=a.length-1;S>=0;S--)if(r=a[S],!(n<r.minLevel||n>r.maxLevel)&&(c=this.getLevelScale(n),u=r.x*c,g=r.y*c,m=u+r.width*c,x=g+r.height*c,u=Math.floor(u/this._tileWidth),g=Math.floor(g/this._tileWidth),m=Math.ceil(m/this._tileWidth),x=Math.ceil(x/this._tileWidth),u<=s&&s<m&&g<=o&&o<x))return!0;return!1}});function e(n,s){if(!s||!s.documentElement)throw new Error(t.getString("Errors.Xml"));var o=s.documentElement,a=o.localName||o.tagName,r=s.documentElement.namespaceURI,c=null,u=[],g,m,x,S,E;if(a=="Image")try{if(S=o.getElementsByTagName("Size")[0],S===void 0&&(S=o.getElementsByTagNameNS(r,"Size")[0]),c={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:o.getAttribute("Url"),Format:o.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(o.getAttribute("Overlap"),10),TileSize:parseInt(o.getAttribute("TileSize"),10),Size:{Height:parseInt(S.getAttribute("Height"),10),Width:parseInt(S.getAttribute("Width"),10)}}},!t.imageFormatSupported(c.Image.Format))throw new Error(t.getString("Errors.ImageFormat",c.Image.Format.toUpperCase()));for(g=o.getElementsByTagName("DisplayRect"),g===void 0&&(g=o.getElementsByTagNameNS(r,"DisplayRect")[0]),E=0;E<g.length;E++)m=g[E],x=m.getElementsByTagName("Rect")[0],x===void 0&&(x=m.getElementsByTagNameNS(r,"Rect")[0]),u.push({Rect:{X:parseInt(x.getAttribute("X"),10),Y:parseInt(x.getAttribute("Y"),10),Width:parseInt(x.getAttribute("Width"),10),Height:parseInt(x.getAttribute("Height"),10),MinLevel:parseInt(m.getAttribute("MinLevel"),10),MaxLevel:parseInt(m.getAttribute("MaxLevel"),10)}});return u.length&&(c.Image.DisplayRect=u),i(n,c)}catch(y){throw y instanceof Error?y:new Error(t.getString("Errors.Dzi"))}else{if(a=="Collection")throw new Error(t.getString("Errors.Dzc"));if(a=="Error"){var H=o.getElementsByTagName("Message")[0],h=H.firstChild.nodeValue;throw new Error(h)}}throw new Error(t.getString("Errors.Dzi"))}function i(n,s){var o=s.Image,a=o.Url,r=o.Format,c=o.Size,u=o.DisplayRect||[],g=parseInt(c.Width,10),m=parseInt(c.Height,10),x=parseInt(o.TileSize,10),S=parseInt(o.Overlap,10),E=[],H,h;for(h=0;h<u.length;h++)H=u[h].Rect,E.push(new t.DisplayRect(parseInt(H.X,10),parseInt(H.Y,10),parseInt(H.Width,10),parseInt(H.Height,10),parseInt(H.MinLevel,10),parseInt(H.MaxLevel,10)));return t.extend(!0,{width:g,height:m,tileSize:x,tileOverlap:S,minLevel:null,maxLevel:null,tilesUrl:a,fileFormat:r,displayRects:E},s)}})(OpenSeadragon);(function(t){t.IIIFTileSource=function(o){if(t.extend(!0,this,o),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(o.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=o.version,this.tile_width&&this.tile_height)o.tileWidth=this.tile_width,o.tileHeight=this.tile_height;else if(this.tile_width)o.tileSize=this.tile_width;else if(this.tile_height)o.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)o.tileWidth=this.tiles[0].width,o.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var a=0;a<this.tiles.length;a++)for(var r=0;r<this.tiles[a].scaleFactors.length;r++){var c=this.tiles[a].scaleFactors[r];this.scale_factors.push(c),o.tileSizePerScaleFactor[c]={width:this.tiles[a].width,height:this.tiles[a].height||this.tiles[a].width}}}else if(e(o)){for(var u=Math.min(this.height,this.width),g=[256,512,1024],m=[],x=0;x<g.length;x++)g[x]<=u&&m.push(g[x]);m.length>0?o.tileSize=Math.max.apply(null,m):o.tileSize=u}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,o.levels=i(this),t.extend(!0,o,{width:o.levels[o.levels.length-1].width,height:o.levels[o.levels.length-1].height,tileSize:Math.max(o.height,o.width),tileOverlap:0,minLevel:0,maxLevel:o.levels.length-1}),this.levels=o.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!o.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)o.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var S=Math.max.apply(null,this.scale_factors);o.maxLevel=Math.round(Math.log(S)*Math.LOG2E)}t.TileSource.apply(this,[o])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(o,a){return o.protocol&&o.protocol=="http://iiif.io/api/image"||o["@context"]&&(o["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||o["@context"]=="http://iiif.io/api/image/1/context.json")||o.profile&&o.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||o.identifier&&o.width&&o.height?!0:!!(o.documentElement&&o.documentElement.tagName=="info"&&o.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(o,a){if(t.isPlainObject(o)){if(!o["@context"])o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=a.replace("/info.json",""),o.version=1;else{var c=o["@context"];if(Array.isArray(c)){for(var u=0;u<c.length;u++)if(typeof c[u]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(c[u])||c[u]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){c=c[u];break}}switch(c){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":o.version=1;break;case"http://iiif.io/api/image/2/context.json":o.version=2;break;case"http://iiif.io/api/image/3/context.json":o.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!o["@id"]&&o.id&&(o["@id"]=o.id),o.preferredFormats){for(var g=0;g<o.preferredFormats.length;g++)if(OpenSeadragon.imageFormatSupported(o.preferredFormats[g])){o.tileFormat=o.preferredFormats[g];break}}return o}else{var r=n(o);return r["@context"]="http://iiif.io/api/image/1.0/context.json",r["@id"]=a.replace("/info.xml",""),r.version=1,r}},getTileWidth:function(o){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,o);var a=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].width:this._tileWidth},getTileHeight:function(o){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,o);var a=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].height:this._tileHeight},getLevelScale:function(o){if(this.emulateLegacyImagePyramid){var a=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(a=this.levels[o].width/this.levels[this.maxLevel].width),a}return t.TileSource.prototype.getLevelScale.call(this,o)},getNumTiles:function(o){if(this.emulateLegacyImagePyramid){var a=this.getLevelScale(o);return a?new t.Point(1,1):new t.Point(0,0)}return t.TileSource.prototype.getNumTiles.call(this,o)},getTileAtPoint:function(o,a){return this.emulateLegacyImagePyramid?new t.Point(0,0):t.TileSource.prototype.getTileAtPoint.call(this,o,a)},getTileUrl:function(o,a,r){if(this.emulateLegacyImagePyramid){var c=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(c=this.levels[o].url),c}var u="0",g=Math.pow(.5,this.maxLevel-o),m=Math.ceil(this.width*g),x=Math.ceil(this.height*g),S,E,H,h,y,T,R,_,P,L,N,V,J,z;return S=this.getTileWidth(o),E=this.getTileHeight(o),H=Math.ceil(S/g),h=Math.ceil(E/g),this.version===1?J="native."+this.tileFormat:J="default."+this.tileFormat,m<S&&x<E?(this.version===2&&m===this.width||this.version===3&&m===this.width&&x===this.height?L="max":this.version===3?L=m+","+x:L=m+",",y="full"):(T=a*H,R=r*h,_=Math.min(H,this.width-T),P=Math.min(h,this.height-R),a===0&&r===0&&_===this.width&&P===this.height?y="full":y=[T,R,_,P].join(","),N=Math.ceil(_*g),V=Math.ceil(P*g),this.version===2&&N===this.width||this.version===3&&N===this.width&&V===this.height?L="max":this.version===3?L=N+","+V:L=N+","),z=[this["@id"],y,L,u,J].join("/"),z},__testonly__:{canBeTiled:e,constructLevels:i}});function e(o){var a=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],r=Array.isArray(o.profile)?o.profile[0]:o.profile,c=a.indexOf(r)!==-1,u=!1;return o.version===2&&o.profile.length>1&&o.profile[1].supports&&(u=o.profile[1].supports.indexOf("sizeByW")!==-1),o.version===3&&o.extraFeatures&&(u=o.extraFeatures.indexOf("sizeByWh")!==-1),!c||u}function i(o){for(var a=[],r=0;r<o.sizes.length;r++)a.push({url:o["@id"]+"/full/"+o.sizes[r].width+","+(o.version===3?o.sizes[r].height:"")+"/0/default."+o.tileFormat,width:o.sizes[r].width,height:o.sizes[r].height});return a.sort(function(c,u){return c.width-u.width})}function n(o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var a=o.documentElement,r=a.tagName,c=null;if(r=="info")try{return c={},s(a,c),c}catch(u){throw u instanceof Error?u:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function s(o,a,r){var c,u;if(o.nodeType==3&&r)u=o.nodeValue.trim(),u.match(/^\d*$/)&&(u=Number(u)),a[r]?(t.isArray(a[r])||(a[r]=[a[r]]),a[r].push(u)):a[r]=u;else if(o.nodeType==1)for(c=0;c<o.childNodes.length;c++)s(o.childNodes[c],a,o.nodeName)}})(OpenSeadragon);(function(t){t.OsmTileSource=function(e,i,n,s,o){var a;t.isPlainObject(e)?a=e:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!a.width||!a.height)&&(a.width=65572864,a.height=65572864),a.tileSize||(a.tileSize=256,a.tileOverlap=0),a.tilesUrl||(a.tilesUrl="http://tile.openstreetmap.org/"),a.minLevel=8,t.TileSource.apply(this,[a])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&e.type=="openstreetmaps"},configure:function(e,i){return e},getTileUrl:function(e,i,n){return this.tilesUrl+(e-8)+"/"+i+"/"+n+".png"}})})(OpenSeadragon);(function(t){t.TmsTileSource=function(e,i,n,s,o){var a;t.isPlainObject(e)?a=e:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var r=Math.ceil(a.width/256)*256,c=Math.ceil(a.height/256)*256,u;r>c?u=r/256:u=c/256,a.maxLevel=Math.ceil(Math.log(u)/Math.log(2))-1,a.tileSize=256,a.width=r,a.height=c,t.TileSource.apply(this,[a])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&e.type=="tiledmapservice"},configure:function(e,i){return e},getTileUrl:function(e,i,n){var s=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+i+"/"+(s-n)+".png"}})})(OpenSeadragon);(function(t){t.ZoomifyTileSource=function(e){e.tileSize=256;var i={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(i.x,10)>e.tileSize||parseInt(i.y,10)>e.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),e.imageSizes.push({x:i.x,y:i.y}),e.gridSize.push(this._getGridSize(i.x,i.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(e,i,n){return{x:Math.ceil(e/n),y:Math.ceil(i/n)}},_calculateAbsoluteTileNumber:function(e,i,n){for(var s=0,o={},a=0;a<e;a++)o=this.gridSize[a],s+=o.x*o.y;return o=this.gridSize[e],s+=o.x*n+i,s},supports:function(e,i){return e.type&&e.type=="zoomifytileservice"},configure:function(e,i){return e},getTileUrl:function(e,i,n){var s=0,o=this._calculateAbsoluteTileNumber(e,i,n);return s=Math.floor(o/256),this.tilesUrl+"TileGroup"+s+"/"+e+"-"+i+"-"+n+".jpg"}})})(OpenSeadragon);(function(t){t.LegacyTileSource=function(s){var o,a,r;t.isArray(s)&&(o={type:"legacy-image-pyramid",levels:s}),o.levels=e(o.levels),o.levels.length>0?(a=o.levels[o.levels.length-1].width,r=o.levels[o.levels.length-1].height):(a=0,r=0,t.console.error("No supported image formats found")),t.extend(!0,o,{width:a,height:r,tileSize:Math.max(r,a),tileOverlap:0,minLevel:0,maxLevel:o.levels.length>0?o.levels.length-1:0}),t.TileSource.apply(this,[o]),this.levels=o.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(s,o){return s.type&&s.type=="legacy-image-pyramid"||s.documentElement&&s.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(s,o){var a;return t.isPlainObject(s)?a=n(this,s):a=i(this,s),a},getLevelScale:function(s){var o=NaN;return this.levels.length>0&&s>=this.minLevel&&s<=this.maxLevel&&(o=this.levels[s].width/this.levels[this.maxLevel].width),o},getNumTiles:function(s){var o=this.getLevelScale(s);return o?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(s,o,a){var r=null;return this.levels.length>0&&s>=this.minLevel&&s<=this.maxLevel&&(r=this.levels[s].url),r}});function e(s){var o=[],a,r;for(r=0;r<s.length;r++)a=s[r],a.height&&a.width&&a.url?o.push({url:a.url,width:Number(a.width),height:Number(a.height)}):t.console.error("Unsupported image format: %s",a.url?a.url:"<no URL>");return o.sort(function(c,u){return c.height-u.height})}function i(s,o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var a=o.documentElement,r=a.tagName,c=null,u=[],g,m;if(r=="image")try{for(c={type:a.getAttribute("type"),levels:[]},u=a.getElementsByTagName("level"),m=0;m<u.length;m++)g=u[m],c.levels.push({url:g.getAttribute("url"),width:parseInt(g.getAttribute("width"),10),height:parseInt(g.getAttribute("height"),10)});return n(s,c)}catch(x){throw x instanceof Error?x:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(r=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(r=="error")throw new Error("Error: "+o)}throw new Error("Unknown element "+r)}function n(s,o){return o.levels}})(OpenSeadragon);(function(t){t.ImageTileSource=function(e){e=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),t.TileSource.apply(this,[e])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(e,i){return e.type&&e.type==="image"},configure:function(e,i){return e},getImageInfo:function(e){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),t.addEvent(i,"load",function(){n.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,n.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,n.aspectRatio=n.width/n.height,n.dimensions=new t.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),t.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),i.src=e},getLevelScale:function(e){var i=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].width/this.levels[this.maxLevel].width),i},getNumTiles:function(e){var i=this.getLevelScale(e);return i?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(e,i,n){var s=null;return e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].url),s},getContext2D:function(e,i,n){var s=null;return e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].context2D),s},_buildLevels:function(){var e=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,e;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,s=document.createElement("canvas"),o=s.getContext("2d");if(s.width=i,s.height=n,o.drawImage(this._image,0,0,i,n),e[0].context2D=o,delete this._image,t.isCanvasTainted(s))return e;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var a=document.createElement("canvas"),r=a.getContext("2d");a.width=i,a.height=n,r.drawImage(s,0,0,i,n),e.splice(0,0,{context2D:r,width:i,height:n}),s=a,o=r}return e}})})(OpenSeadragon);(function(t){t.TileSourceCollection=function(e,i,n,s){t.console.error("TileSourceCollection is deprecated; use World instead")}})(OpenSeadragon);(function(t){t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(r){var c=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},r),this.element=r.element||t.makeNeutralElement("div"),r.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor==t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(u){u.insideElementPressed?(o(c,t.ButtonState.DOWN),c.raiseEvent("enter",{originalEvent:u.originalEvent})):u.buttonDownAny||o(c,t.ButtonState.HOVER)},focusHandler:function(u){this.enterHandler(u),c.raiseEvent("focus",{originalEvent:u.originalEvent})},exitHandler:function(u){a(c,t.ButtonState.GROUP),u.insideElementPressed&&c.raiseEvent("exit",{originalEvent:u.originalEvent})},blurHandler:function(u){this.exitHandler(u),c.raiseEvent("blur",{originalEvent:u.originalEvent})},pressHandler:function(u){o(c,t.ButtonState.DOWN),c.raiseEvent("press",{originalEvent:u.originalEvent})},releaseHandler:function(u){u.insideElementPressed&&u.insideElementReleased?(a(c,t.ButtonState.HOVER),c.raiseEvent("release",{originalEvent:u.originalEvent})):u.insideElementPressed?a(c,t.ButtonState.GROUP):o(c,t.ButtonState.HOVER)},clickHandler:function(u){u.quick&&c.raiseEvent("click",{originalEvent:u.originalEvent})},keyHandler:function(u){return u.keyCode===13?(c.raiseEvent("click",{originalEvent:u.originalEvent}),c.raiseEvent("release",{originalEvent:u.originalEvent}),!1):!0}}),a(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){o(this,t.ButtonState.GROUP)},notifyGroupExit:function(){a(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function e(r){t.requestAnimationFrame(function(){i(r)})}function i(r){var c,u,g;r.shouldFade&&(c=t.now(),u=c-r.fadeBeginTime,g=1-u/r.fadeLength,g=Math.min(1,g),g=Math.max(0,g),r.imgGroup&&t.setElementOpacity(r.imgGroup,g,!0),g>0&&e(r))}function n(r){r.shouldFade=!0,r.fadeBeginTime=t.now()+r.fadeDelay,window.setTimeout(function(){e(r)},r.fadeDelay)}function s(r){r.shouldFade=!1,r.imgGroup&&t.setElementOpacity(r.imgGroup,1,!0)}function o(r,c){r.element.disabled||(c>=t.ButtonState.GROUP&&r.currentState==t.ButtonState.REST&&(s(r),r.currentState=t.ButtonState.GROUP),c>=t.ButtonState.HOVER&&r.currentState==t.ButtonState.GROUP&&(r.imgHover&&(r.imgHover.style.visibility=""),r.currentState=t.ButtonState.HOVER),c>=t.ButtonState.DOWN&&r.currentState==t.ButtonState.HOVER&&(r.imgDown&&(r.imgDown.style.visibility=""),r.currentState=t.ButtonState.DOWN))}function a(r,c){r.element.disabled||(c<=t.ButtonState.HOVER&&r.currentState==t.ButtonState.DOWN&&(r.imgDown&&(r.imgDown.style.visibility="hidden"),r.currentState=t.ButtonState.HOVER),c<=t.ButtonState.GROUP&&r.currentState==t.ButtonState.HOVER&&(r.imgHover&&(r.imgHover.style.visibility="hidden"),r.currentState=t.ButtonState.GROUP),c<=t.ButtonState.REST&&r.currentState==t.ButtonState.GROUP&&(n(r),r.currentState=t.ButtonState.REST))}})(OpenSeadragon);(function(t){t.ButtonGroup=function(e){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var i=this.buttons.concat([]),n=this,s;if(this.element=e.element||t.makeNeutralElement("div"),!e.group)for(this.element.style.display="inline-block",s=0;s<i.length;s++)this.element.appendChild(i[s].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(o){var a;for(a=0;a<n.buttons.length;a++)n.buttons[a].notifyGroupEnter()},exitHandler:function(o){var a;if(!o.insideElementPressed)for(a=0;a<n.buttons.length;a++)n.buttons[a].notifyGroupExit()}})},t.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}})(OpenSeadragon);(function(t){t.Rect=function(e,i,n,s,o){this.x=typeof e=="number"?e:0,this.y=typeof i=="number"?i:0,this.width=typeof n=="number"?n:0,this.height=typeof s=="number"?s:0,this.degrees=typeof o=="number"?o:0,this.degrees=t.positiveModulo(this.degrees,360);var a,r;this.degrees>=270?(a=this.getTopRight(),this.x=a.x,this.y=a.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=270):this.degrees>=180?(a=this.getBottomRight(),this.x=a.x,this.y=a.y,this.degrees-=180):this.degrees>=90&&(a=this.getBottomLeft(),this.x=a.x,this.y=a.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=90)},t.Rect.fromSummits=function(e,i,n){var s=e.distanceTo(i),o=e.distanceTo(n),a=i.minus(e),r=Math.atan(a.y/a.x);return a.x<0?r+=Math.PI:a.y<0&&(r+=2*Math.PI),new t.Rect(e.x,e.y,s,o,r/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(e){return e instanceof t.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new t.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new t.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var i=this.getBoundingBox(),n=e.getBoundingBox(),s=Math.min(i.x,n.x),o=Math.min(i.y,n.y),a=Math.max(i.x+i.width,n.x+n.width),r=Math.max(i.y+i.height,n.y+n.height);return new t.Rect(s,o,a-s,r-o)},intersection:function(e){var i=1e-10,n=[],s=this.getTopLeft();e.containsPoint(s,i)&&n.push(s);var o=this.getTopRight();e.containsPoint(o,i)&&n.push(o);var a=this.getBottomLeft();e.containsPoint(a,i)&&n.push(a);var r=this.getBottomRight();e.containsPoint(r,i)&&n.push(r);var c=e.getTopLeft();this.containsPoint(c,i)&&n.push(c);var u=e.getTopRight();this.containsPoint(u,i)&&n.push(u);var g=e.getBottomLeft();this.containsPoint(g,i)&&n.push(g);var m=e.getBottomRight();this.containsPoint(m,i)&&n.push(m);for(var x=this._getSegments(),S=e._getSegments(),E=0;E<x.length;E++)for(var H=x[E],h=0;h<S.length;h++){var y=S[h],T=R(H[0],H[1],y[0],y[1]);T&&n.push(T)}function R(z,Q,j,re){var ae=Q.minus(z),ce=re.minus(j),le=-ce.x*ae.y+ae.x*ce.y;if(le===0)return null;var G=(ae.x*(z.y-j.y)-ae.y*(z.x-j.x))/le,ge=(ce.x*(z.y-j.y)-ce.y*(z.x-j.x))/le;return-i<=G&&G<=1-i&&-i<=ge&&ge<=1-i?new t.Point(z.x+ge*ae.x,z.y+ge*ae.y):null}if(n.length===0)return null;for(var _=n[0].x,P=n[0].x,L=n[0].y,N=n[0].y,V=1;V<n.length;V++){var J=n[V];J.x<_&&(_=J.x),J.x>P&&(P=J.x),J.y<L&&(L=J.y),J.y>N&&(N=J.y)}return new t.Rect(_,L,P-_,N-L)},_getSegments:function(){var e=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight();return[[e,i],[i,s],[s,n],[n,e]]},rotate:function(e,i){if(e=t.positiveModulo(e,360),e===0)return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(e,i),s=this.getTopRight().rotate(e,i),o=s.minus(n);o=o.apply(function(r){var c=1e-15;return Math.abs(r)<c?0:r});var a=Math.atan(o.y/o.x);return o.x<0?a+=Math.PI:o.y<0&&(a+=2*Math.PI),new t.Rect(n.x,n.y,this.width,this.height,a/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var e=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight(),o=Math.min(e.x,i.x,n.x,s.x),a=Math.max(e.x,i.x,n.x,s.x),r=Math.min(e.y,i.y,n.y,s.y),c=Math.max(e.y,i.y,n.y,s.y);return new t.Rect(o,r,a-o,c-r)},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),i=Math.floor(e.x),n=Math.floor(e.y),s=Math.ceil(e.width+e.x-i),o=Math.ceil(e.height+e.y-n);return new t.Rect(i,n,s,o)},containsPoint:function(e,i){i=i||0;var n=this.getTopLeft(),s=this.getTopRight(),o=this.getBottomLeft(),a=s.minus(n),r=o.minus(n);return(e.x-n.x)*a.x+(e.y-n.y)*a.y>=-i&&(e.x-s.x)*a.x+(e.y-s.y)*a.y<=i&&(e.x-n.x)*r.x+(e.y-n.y)*r.y>=-i&&(e.x-o.x)*r.x+(e.y-o.y)*r.y<=i},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}})(OpenSeadragon);(function(t){var e={};t.ReferenceStrip=function(u){var g=this,m=u.viewer,x=t.getElementSize(m.element),S,E,H;for(u.id||(u.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=u.id,this.element.className="referencestrip"),u=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},u,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),t.extend(this,u),e[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,E=this.element.style,E.marginTop="0px",E.marginRight="0px",E.marginBottom="0px",E.marginLeft="0px",E.left="0px",E.bottom="0px",E.border="0px",E.background="#000",E.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=m,this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,i),scrollHandler:t.delegate(this,n),enterHandler:t.delegate(this,o),exitHandler:t.delegate(this,a),keyDownHandler:t.delegate(this,r),keyHandler:t.delegate(this,c)}),u.width&&u.height?(this.element.style.width=u.width+"px",this.element.style.height=u.height+"px",m.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):u.scroll=="horizontal"?(this.element.style.width=x.x*u.sizeRatio*m.tileSources.length+12*m.tileSources.length+"px",this.element.style.height=x.y*u.sizeRatio+"px",m.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=x.y*u.sizeRatio*m.tileSources.length+12*m.tileSources.length+"px",this.element.style.width=x.x*u.sizeRatio+"px",m.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=x.x*this.sizeRatio+8,this.panelHeight=x.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},H=0;H<m.tileSources.length;H++)S=t.makeNeutralElement("div"),S.id=this.element.id+"-"+H,S.style.width=g.panelWidth+"px",S.style.height=g.panelHeight+"px",S.style.display="inline",S.style.float="left",S.style.cssFloat="left",S.style.styleFloat="left",S.style.padding="2px",t.setElementTouchActionNone(S),S.innerTracker=new t.MouseTracker({element:S,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(h){h.eventSource.dragging=t.now()},releaseHandler:function(h){var y=h.eventSource,T=y.element.id,R=Number(T.split("-")[2]),_=t.now();h.insideElementPressed&&h.insideElementReleased&&y.dragging&&_-y.dragging<y.clickTimeThreshold&&(y.dragging=null,m.goToPage(R))}}),this.element.appendChild(S),S.activePanel=!1,this.panels.push(S);s(this,this.scroll=="vertical"?x.y:x.x,0),this.setFocus(0)},t.extend(t.ReferenceStrip.prototype,t.EventSource.prototype,t.Viewer.prototype,{setFocus:function(u){var g=this.element.querySelector("#"+this.element.id+"-"+u),m=t.getElementSize(this.viewer.canvas),x=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),E=-Number(this.element.style.marginLeft.replace("px","")),H=-Number(this.element.style.marginTop.replace("px","")),h;this.currentSelected!==g&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=g,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(h=Number(u)*(this.panelWidth+3),h>E+m.x-this.panelWidth?(h=Math.min(h,x-m.x),this.element.style.marginLeft=-h+"px",s(this,m.x,-h)):h<E&&(h=Math.max(0,h-m.x/2),this.element.style.marginLeft=-h+"px",s(this,m.x,-h))):(h=Number(u)*(this.panelHeight+3),h>H+m.y-this.panelHeight?(h=Math.min(h,S-m.y),this.element.style.marginTop=-h+"px",s(this,m.y,-h)):h<H&&(h=Math.max(0,h-m.y/2),this.element.style.marginTop=-h+"px",s(this,m.y,-h))),this.currentPage=u,o.call(this,{eventSource:this.innerTracker}))},update:function(){return e[this.id].animating?(t.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var u in this.miniViewers)this.miniViewers[u].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function i(u){var g=Number(this.element.style.marginLeft.replace("px","")),m=Number(this.element.style.marginTop.replace("px","")),x=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),E=t.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-u.delta.x>0?g>-(x-E.x)&&(this.element.style.marginLeft=g+u.delta.x*2+"px",s(this,E.x,g+u.delta.x*2)):-u.delta.x<0&&g<0&&(this.element.style.marginLeft=g+u.delta.x*2+"px",s(this,E.x,g+u.delta.x*2)):-u.delta.y>0?m>-(S-E.y)&&(this.element.style.marginTop=m+u.delta.y*2+"px",s(this,E.y,m+u.delta.y*2)):-u.delta.y<0&&m<0&&(this.element.style.marginTop=m+u.delta.y*2+"px",s(this,E.y,m+u.delta.y*2))),!1}function n(u){var g=Number(this.element.style.marginLeft.replace("px","")),m=Number(this.element.style.marginTop.replace("px","")),x=Number(this.element.style.width.replace("px","")),S=Number(this.element.style.height.replace("px","")),E=t.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?u.scroll>0?g>-(x-E.x)&&(this.element.style.marginLeft=g-u.scroll*60+"px",s(this,E.x,g-u.scroll*60)):u.scroll<0&&g<0&&(this.element.style.marginLeft=g-u.scroll*60+"px",s(this,E.x,g-u.scroll*60)):u.scroll<0?m>E.y-S&&(this.element.style.marginTop=m+u.scroll*60+"px",s(this,E.y,m+u.scroll*60)):u.scroll>0&&m<0&&(this.element.style.marginTop=m+u.scroll*60+"px",s(this,E.y,m+u.scroll*60))),!1}function s(u,g,m){var x,S,E,H,h,y,T;for(u.scroll=="horizontal"?x=u.panelWidth:x=u.panelHeight,S=Math.ceil(g/x)+5,E=Math.ceil((Math.abs(m)+g)/x)+1,S=E-S,S=S<0?0:S,y=S;y<E&&y<u.panels.length;y++)if(T=u.panels[y],!T.activePanel){var R,_=u.viewer.tileSources[y];_.referenceStripThumbnailUrl?R={type:"image",url:_.referenceStripThumbnailUrl}:R=_,H=new t.Viewer({id:T.id,tileSources:[R],element:T,navigatorSizeRatio:u.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:u.viewer.loadTilesWithAjax,ajaxHeaders:u.viewer.ajaxHeaders,useCanvas:u.useCanvas}),H.displayRegion=t.makeNeutralElement("div"),H.displayRegion.id=T.id+"-displayregion",H.displayRegion.className="displayregion",h=H.displayRegion.style,h.position="relative",h.top="0px",h.left="0px",h.fontSize="0px",h.overflow="hidden",h.float="left",h.cssFloat="left",h.styleFloat="left",h.zIndex=999999999,h.cursor="default",h.width=u.panelWidth-4+"px",h.height=u.panelHeight-4+"px",H.displayRegion.innerTracker=new t.MouseTracker({element:H.displayRegion,startDisabled:!0}),T.getElementsByTagName("div")[0].appendChild(H.displayRegion),u.miniViewers[T.id]=H,T.activePanel=!0}}function o(u){var g=u.eventSource.element;return this.scroll=="horizontal"?g.style.marginBottom="0px":g.style.marginLeft="0px",!1}function a(u){var g=u.eventSource.element;return this.scroll=="horizontal"?g.style.marginBottom="-"+t.getElementSize(g).y/2+"px":g.style.marginLeft="-"+t.getElementSize(g).x/2+"px",!1}function r(u){if(!u.preventDefaultAction&&!u.ctrl&&!u.alt&&!u.meta)switch(u.keyCode){case 38:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function c(u){if(!u.preventDefaultAction&&!u.ctrl&&!u.alt&&!u.meta)switch(u.keyCode){case 61:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}})(OpenSeadragon);(function(t){t.DisplayRect=function(e,i,n,s,o,a){t.Rect.apply(this,[e,i,n,s]),this.minLevel=o,this.maxLevel=a},t.extend(t.DisplayRect.prototype,t.Rect.prototype)})(OpenSeadragon);(function(t){t.Spring=function(i){var n=arguments;typeof i!="object"&&(i={initial:n.length&&typeof n[0]=="number"?n[0]:void 0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),t.console.assert(typeof i.springStiffness=="number"&&i.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert(typeof i.animationTime=="number"&&i.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),i.exponential&&(this._exponential=!0,delete i.exponential),t.extend(!0,this,i),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(i){t.console.assert(!this._exponential||i!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=i,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(i){t.console.assert(!this._exponential||i!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=i,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(i){this.start.value+=i,this.target.value+=i,this._exponential&&(t.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(i){this._exponential=i,this._exponential&&(t.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();var i,n;this._exponential?(i=this.start._logValue,n=this.target._logValue):(i=this.start.value,n=this.target.value);var s=this.current.time>=this.target.time?n:i+(n-i)*e(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),o=this.current.value;return this._exponential?this.current.value=Math.exp(s):this.current.value=s,o!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function e(i,n){return(1-Math.exp(i*-n))/(1-Math.exp(-i))}})(OpenSeadragon);(function(t){function e(n){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null},n),this.image=null}e.prototype={errorMsg:null,start:function(){var n=this,s=this.abort;this.image=new Image,this.image.onload=function(){n.finish(!0)},this.image.onabort=this.image.onerror=function(){n.errorMsg="Image load aborted",n.finish(!1)},this.jobId=window.setTimeout(function(){n.errorMsg="Image load exceeded timeout ("+n.timeout+" ms)",n.finish(!1)},this.timeout),this.loadWithAjax?(this.request=t.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(o){var a;try{a=new window.Blob([o.response])}catch(g){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(g.name==="TypeError"&&r){var c=new r;c.append(o.response),a=c.getBlob()}}a.size===0&&(n.errorMsg="Empty image response.",n.finish(!1));var u=(window.URL||window.webkitURL).createObjectURL(a);n.image.src=u},error:function(o){n.errorMsg="Image load aborted - XHR error",n.finish(!1)}}),this.abort=function(){n.request.abort(),typeof s=="function"&&s()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(n){this.image.onload=this.image.onerror=this.image.onabort=null,n||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(n){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},n)},t.ImageLoader.prototype={addJob:function(n){var s=this,o=function(c){i(s,c,n.callback)},a={src:n.src,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,callback:o,abort:n.abort,timeout:this.timeout},r=new e(a);!this.jobLimit||this.jobsInProgress<this.jobLimit?(r.start(),this.jobsInProgress++):this.jobQueue.push(r)},clear:function(){for(var n=0;n<this.jobQueue.length;n++){var s=this.jobQueue[n];typeof s.abort=="function"&&s.abort()}this.jobQueue=[]}};function i(n,s,o){var a;n.jobsInProgress--,(!n.jobLimit||n.jobsInProgress<n.jobLimit)&&n.jobQueue.length>0&&(a=n.jobQueue.shift(),a.start(),n.jobsInProgress++),o(s.image,s.errorMsg,s.request)}})(OpenSeadragon);(function(t){t.Tile=function(e,i,n,s,o,a,r,c,u,g){this.level=e,this.x=i,this.y=n,this.bounds=s,this.sourceBounds=g,this.exists=o,this.url=a,this.context2D=r,this.loadWithAjax=c,this.ajaxHeaders=u,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){if(!this.cacheImageRecord){t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=t.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=e&&e.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",t.setElementOpacity(this.element,this.opacity)},drawCanvas:function(e,i,n,s){var o=this.position.times(t.pixelDensityRatio),a=this.size.times(t.pixelDensityRatio),r;if(!this.context2D&&!this.cacheImageRecord){t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(r=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!r){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}e.save(),e.globalAlpha=this.opacity,typeof n=="number"&&n!==1&&(o=o.times(n),a=a.times(n)),s instanceof t.Point&&(o=o.plus(s)),e.globalAlpha===1&&this._hasTransparencyChannel()&&e.clearRect(o.x,o.y,a.x,a.y),i({context:e,tile:this,rendered:r});var c,u;this.sourceBounds?(c=Math.min(this.sourceBounds.width,r.canvas.width),u=Math.min(this.sourceBounds.height,r.canvas.height)):(c=r.canvas.width,u=r.canvas.height),e.drawImage(r.canvas,0,0,c,u,o.x,o.y,a.x,a.y),e.restore()},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else if(this.context2D)e=this.context2D;else return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return e.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,i,n){var s=Math.max(1,Math.ceil((n.x-i.x)/2)),o=Math.max(1,Math.ceil((n.y-i.y)/2));return new t.Point(s,o).minus(this.position.times(t.pixelDensityRatio).times(e||1).apply(function(a){return a%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}})(OpenSeadragon);(function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(e,i,n){var s;t.isPlainObject(e)?s=e:s={element:e,location:i,placement:n},this.element=s.element,this.style=s.element.style,this._init(s)},t.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=e.placement===void 0?t.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=e.checkResize===void 0?!0:e.checkResize,this.width=e.width===void 0?null:e.width,this.height=e.height===void 0?null:e.height,this.rotationMode=e.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,i){var n=t.Placement.properties[this.placement];!n||(n.isHorizontallyCentered?e.x-=i.x/2:n.isRight&&(e.x-=i.x),n.isVerticallyCentered?e.y-=i.y/2:n.isBottom&&(e.y-=i.y))},destroy:function(){var e=this.element,i=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(i.display="none",document.body.appendChild(e))),this.onDraw=null,i.top="",i.left="",i.position="",this.width!==null&&(i.width=""),this.height!==null&&(i.height="");var n=t.getCssPropertyWithVendorPrefix("transformOrigin"),s=t.getCssPropertyWithVendorPrefix("transform");n&&s&&(i[n]="",i[s]="")},drawHTML:function(e,i){var n=this.element;n.parentNode!==e&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,e.appendChild(n),this.style.position="absolute",this.size=t.getElementSize(n));var s=this._getOverlayPositionAndSize(i),o=s.position,a=this.size=s.size,r=s.rotate;if(this.onDraw)this.onDraw(o,a,this.element);else{var c=this.style;c.left=o.x+"px",c.top=o.y+"px",this.width!==null&&(c.width=a.x+"px"),this.height!==null&&(c.height=a.y+"px");var u=t.getCssPropertyWithVendorPrefix("transformOrigin"),g=t.getCssPropertyWithVendorPrefix("transform");u&&g&&(r?(c[u]=this._getTransformOrigin(),c[g]="rotate("+r+"deg)"):(c[u]="",c[g]="")),c.display!=="none"&&(c.display="block")}},_getOverlayPositionAndSize:function(e){var i=e.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(e);this.adjust(i,n);var s=0;if(e.degrees&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var o=new t.Rect(i.x,i.y,n.x,n.y),a=this._getBoundingBox(o,e.degrees);i=a.getTopLeft(),n=a.getSize()}else s=e.degrees;return{position:i,size:n,rotate:s}},_getSizeInPixels:function(e){var i=this.size.x,n=this.size.y;if(this.width!==null||this.height!==null){var s=e.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);this.width!==null&&(i=s.x),this.height!==null&&(n=s.y)}if(this.checkResize&&(this.width===null||this.height===null)){var o=this.size=t.getElementSize(this.element);this.width===null&&(i=o.x),this.height===null&&(n=o.y)}return new t.Point(i,n)},_getBoundingBox:function(e,i){var n=this._getPlacementPoint(e);return e.rotate(i,n).getBoundingBox()},_getPlacementPoint:function(e){var i=new t.Point(e.x,e.y),n=t.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=e.width/2:n.isRight&&(i.x+=e.width),n.isVerticallyCentered?i.y+=e.height/2:n.isBottom&&(i.y+=e.height)),i},_getTransformOrigin:function(){var e="",i=t.Placement.properties[this.placement];return i&&(i.isLeft?e="left":i.isRight&&(e="right"),i.isTop?e+=" top":i.isBottom&&(e+=" bottom")),e},update:function(e,i){var n=t.isPlainObject(e)?e:{location:e,placement:i};this._init({location:n.location||this.location,placement:n.placement!==void 0?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:n.width!==void 0?n.width:this.width,height:n.height!==void 0?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(e){t.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(i===null||n===null){var s=e.deltaPointsFromPixelsNoRotate(this.size,!0);i===null&&(i=s.x),n===null&&(n=s.y)}var o=this.location.clone();return this.adjust(o,new t.Point(i,n)),this._adjustBoundsForRotation(e,new t.Rect(o.x,o.y,i,n))},_adjustBoundsForRotation:function(e,i){if(!e||e.degrees===0||this.rotationMode===t.OverlayRotationMode.EXACT)return i;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return i;var n=this._getOverlayPositionAndSize(e);return e.viewerElementToViewportRectangle(new t.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-e.degrees,this._getPlacementPoint(i))}}})(OpenSeadragon);(function(t){t.Drawer=function(e){t.console.assert(e.viewer,"[Drawer] options.viewer is required");var i=arguments;if(t.isPlainObject(e)||(e={source:i[0],viewport:i[1],element:i[2]}),t.console.assert(e.viewport,"[Drawer] options.viewport is required"),t.console.assert(e.element,"[Drawer] options.element is required"),e.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor=typeof e.debugGridColor=="string"?[e.debugGridColor]:e.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,e.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=t.getElement(e.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},t.Drawer.prototype={addOverlay:function(e,i,n,s){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(e,i,n,s),this},updateOverlay:function(e,i,n){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,i,n),this},removeOverlay:function(e){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(e){var i=this.viewport.pixelFromPointNoRotate(e,!0);return new t.Point(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio)},clipWithPolygons:function(e,i){if(!!this.useCanvas){var n=this._getContext(i);n.beginPath(),e.forEach(function(s){s.forEach(function(o,a){n[a===0?"moveTo":"lineTo"](o.x,o.y)})}),n.clip()}},setOpacity:function(e){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(e);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,i=0,n=0;n<e.getItemCount();n++){var s=e.getItemAt(n).getOpacity();s>i&&(i=s)}return i},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var i=this._calculateSketchCanvasSize();this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(e,i){if(!!this.useCanvas){var n=this._getContext(e);if(i)n.clearRect(i.x,i.y,i.width,i.height);else{var s=n.canvas;n.clearRect(0,0,s.width,s.height)}}},viewportToDrawerRectangle:function(e){var i=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0);return new t.Rect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,n.x*t.pixelDensityRatio,n.y*t.pixelDensityRatio)},drawTile:function(e,i,n,s,o){if(t.console.assert(e,"[Drawer.drawTile] tile is required"),t.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var a=this._getContext(n);s=s||1,e.drawCanvas(a,i,s,o)}else e.drawHTML(this.canvas)},_getContext:function(e){var i=this.context;if(e){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var n=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var s=this;this.viewer.addHandler("rotate",function o(){if(s.viewport.getRotation()!==0){s.viewer.removeHandler("rotate",o);var a=s._calculateSketchCanvasSize();s.sketchCanvas.width=a.x,s.sketchCanvas.height=a.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}i=this.sketchContext}return i},saveContext:function(e){!this.useCanvas||this._getContext(e).save()},restoreContext:function(e){!this.useCanvas||this._getContext(e).restore()},setClip:function(e,i){if(!!this.useCanvas){var n=this._getContext(i);n.beginPath(),n.rect(e.x,e.y,e.width,e.height),n.clip()}},drawRectangle:function(e,i,n){if(!!this.useCanvas){var s=this._getContext(n);s.save(),s.fillStyle=i,s.fillRect(e.x,e.y,e.width,e.height),s.restore()}},blendSketch:function(e,i,n,s){var o=e;if(t.isPlainObject(o)||(o={opacity:e,scale:i,translate:n,compositeOperation:s}),!(!this.useCanvas||!this.sketchCanvas)){e=o.opacity,s=o.compositeOperation;var a=o.bounds;if(this.context.save(),this.context.globalAlpha=e,s&&(this.context.globalCompositeOperation=s),a)a.x<0&&(a.width+=a.x,a.x=0),a.x+a.width>this.canvas.width&&(a.width=this.canvas.width-a.x),a.y<0&&(a.height+=a.y,a.y=0),a.y+a.height>this.canvas.height&&(a.height=this.canvas.height-a.y),this.context.drawImage(this.sketchCanvas,a.x,a.y,a.width,a.height,a.x,a.y,a.width,a.height);else{i=o.scale||1,n=o.translate;var r=n instanceof t.Point?n:new t.Point(0,0),c=0,u=0;if(n){var g=this.sketchCanvas.width-this.canvas.width,m=this.sketchCanvas.height-this.canvas.height;c=Math.round(g/2),u=Math.round(m/2)}this.context.drawImage(this.sketchCanvas,r.x-c*i,r.y-u*i,(this.canvas.width+2*c)*i,(this.canvas.height+2*u)*i,-c,-u,this.canvas.width+2*c,this.canvas.height+2*u)}this.context.restore()}},drawDebugInfo:function(e,i,n,s){if(!!this.useCanvas){var o=this.viewer.world.getIndexOfItem(s)%this.debugGridColor.length,a=this.context;a.save(),a.lineWidth=2*t.pixelDensityRatio,a.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",a.strokeStyle=this.debugGridColor[o],a.fillStyle=this.debugGridColor[o],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),s.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:s.getRotation(!0),point:s.viewport.pixelFromPointNoRotate(s._getRotationPoint(!0),!0)}),s.viewport.degrees===0&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),a.strokeRect(e.position.x*t.pixelDensityRatio,e.position.y*t.pixelDensityRatio,e.size.x*t.pixelDensityRatio,e.size.y*t.pixelDensityRatio);var r=(e.position.x+e.size.x/2)*t.pixelDensityRatio,c=(e.position.y+e.size.y/2)*t.pixelDensityRatio;a.translate(r,c),a.rotate(Math.PI/180*-this.viewport.degrees),a.translate(-r,-c),e.x===0&&e.y===0&&(a.fillText("Zoom: "+this.viewport.getZoom(),e.position.x*t.pixelDensityRatio,(e.position.y-30)*t.pixelDensityRatio),a.fillText("Pan: "+this.viewport.getBounds().toString(),e.position.x*t.pixelDensityRatio,(e.position.y-20)*t.pixelDensityRatio)),a.fillText("Level: "+e.level,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+20)*t.pixelDensityRatio),a.fillText("Column: "+e.x,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+30)*t.pixelDensityRatio),a.fillText("Row: "+e.y,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+40)*t.pixelDensityRatio),a.fillText("Order: "+n+" of "+i,(e.position.x+10)*t.pixelDensityRatio,(e.position.y+50)*t.pixelDensityRatio),a.fillText("Size: "+e.size.toString(),(e.position.x+10)*t.pixelDensityRatio,(e.position.y+60)*t.pixelDensityRatio),a.fillText("Position: "+e.position.toString(),(e.position.x+10)*t.pixelDensityRatio,(e.position.y+70)*t.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),s.getRotation(!0)%360!=0&&this._restoreRotationChanges(),s.viewport.degrees===0&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),a.restore()}},debugRect:function(e){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*t.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(e.x*t.pixelDensityRatio,e.y*t.pixelDensityRatio,e.width*t.pixelDensityRatio,e.height*t.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(e){var i=this._getContext(e).canvas;return new t.Point(i.width,i.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(e){var i=e.point?e.point.times(t.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(e.useSketch);n.save(),n.translate(i.x,i.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-e.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*e.degrees),n.translate(-i.x,-i.y)},_flip:function(e){e=e||{};var i=e.point?e.point.times(t.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(e.useSketch);n.translate(i.x,0),n.scale(-1,1),n.translate(-i.x,0)},_restoreRotationChanges:function(e){var i=this._getContext(e);i.restore()},_calculateCanvasSize:function(){var e=t.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*e),y:Math.round(i.y*e)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return e;var i=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:i,y:i}}}})(OpenSeadragon);(function(t){t.Viewport=function(e){var i=arguments;i.length&&i[0]instanceof t.Point&&(e={containerSize:i[0],contentSize:i[1],config:i[2]}),e.config&&(t.extend(!0,e,e.config),delete e.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,degrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer},e),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={resetContentSize:function(e){return t.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(e instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(e.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(e.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,i){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,i)},_setContentBounds:function(e,i){t.console.assert(e,"[Viewport._setContentBounds] bounds is required"),t.console.assert(e instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(e.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(e.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio(),i;return this.homeFillsViewer?i=e>=1?e:1:i=e>=1?1:e,i/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new t.Rect(e.x-i/2,e.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),i=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return i},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(e){t.console.assert(t.type(e)==="object","[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var i=this.getCenter(e),n=1/this.getZoom(e),s=n/this.getAspectRatio();return new t.Rect(i.x-n/2,i.y-s/2,n,s)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var i=this.getBoundsNoRotate(e),n=this._containerInnerSize.x*this.getZoom(e);return i.x-=this._margins.left/n,i.y-=this._margins.top/n,i.width+=(this._margins.left+this._margins.right)/n,i.height+=(this._margins.top+this._margins.bottom)/n,i},getCenter:function(e){var i=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),s,o,a,r,c,u,g,m;return e?i:this.zoomPoint?(s=this.pixelFromPoint(this.zoomPoint,!0),o=this.getZoom(),a=1/o,r=a/this.getAspectRatio(),c=new t.Rect(i.x-a/2,i.y-r/2,a,r),u=this._pixelFromPoint(this.zoomPoint,c),g=u.minus(s),m=g.divide(this._containerInnerSize.x*o),n.plus(m)):n},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var i=new t.Rect(e.x,e.y,e.width,e.height);if(!this.wrapHorizontal){var n=this.visibilityRatio*i.width,s=i.x+i.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,a=this._contentBoundsNoRotate.x-s+n,r=o-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(a+r)/2:r<0?i.x+=r:a>0&&(i.x+=a)}if(!this.wrapVertical){var c=this.visibilityRatio*i.height,u=i.y+i.height,g=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,m=this._contentBoundsNoRotate.y-u+c,x=g-i.y-c;c>this._contentBoundsNoRotate.height?i.y+=(m+x)/2:x<0?i.y+=x:m>0&&(i.y+=m)}return i},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var i=this.getZoom(),n=this._applyZoomConstraints(i);i!==n&&this.zoomTo(n,this.zoomPoint,e);var s=this.getBoundsNoRotate(),o=this._applyBoundaryConstraints(s);return this._raiseConstraintsEvent(e),(s.x!==o.x||s.y!==o.y||e)&&this.fitBounds(o.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(e,i){i=i||{};var n=i.immediately||!1,s=i.constraints||!1,o=this.getAspectRatio(),a=e.getCenter(),r=new t.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox();r.getAspectRatio()>=o?r.height=r.width/o:r.width=r.height*o,r.x=a.x-r.width/2,r.y=a.y-r.height/2;var c=1/r.width;if(s){var u=r.getAspectRatio(),g=this._applyZoomConstraints(c);c!==g&&(c=g,r.width=1/c,r.x=a.x-r.width/2,r.height=r.width/u,r.y=a.y-r.height/2),r=this._applyBoundaryConstraints(r),a=r.getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(a,!0),this.zoomTo(c,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var m=this.getBounds(),x=this.getZoom();if(x===0||Math.abs(c/x-1)<1e-8)return this.zoomTo(c,!0),this.panTo(a,n);r=r.rotate(-this.getRotation());var S=r.getTopLeft().times(c).minus(m.getTopLeft().times(x)).divide(c-x);return this.zoomTo(c,S,n)},fitBounds:function(e,i){return this._fitBounds(e,{immediately:i,constraints:!1})},fitBoundsWithConstraints:function(e,i){return this._fitBounds(e,{immediately:i,constraints:!0})},fitVertically:function(e){var i=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,e)},fitHorizontally:function(e){var i=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,e)},getConstrainedBounds:function(e){var i,n;return i=this.getBounds(e),n=this._applyBoundaryConstraints(i),n},panBy:function(e,i){var n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(e),i)},panTo:function(e,i){return i?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:i}),this},zoomBy:function(e,i,n){return this.zoomTo(this.zoomSpring.target.value*e,i,n)},zoomTo:function(e,i,n){var s=this;return this.zoomPoint=i instanceof t.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint(function(){s.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:i,immediately:n}),this},setRotation:function(e){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=t.positiveModulo(e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e}),this)},getRotation:function(){return this.degrees},resize:function(e,i){var n=this.getBoundsNoRotate(),s=n,o;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),i&&(o=e.x/this.containerSize.x,s.width=n.width*o,s.height=s.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:i}),this.fitBounds(s,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var i=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,i},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var i=this.pixelFromPoint(this.zoomPoint,!0);e();var n=this.pixelFromPoint(this.zoomPoint,!0),s=n.minus(i),o=this.deltaPointsFromPixels(s,!0);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,i){return e.times(this._containerInnerSize.x*this.getZoom(i))},deltaPixelsFromPoints:function(e,i){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),i)},deltaPointsFromPixelsNoRotate:function(e,i){return e.divide(this._containerInnerSize.x*this.getZoom(i))},deltaPointsFromPixels:function(e,i){return this.deltaPointsFromPixelsNoRotate(e,i).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,i){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(i))},pixelFromPoint:function(e,i){return this._pixelFromPoint(e,this.getBoundsNoRotate(i))},_pixelFromPointNoRotate:function(e,i){return e.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,i){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),i)},pointFromPixelNoRotate:function(e,i){var n=this.getBoundsNoRotate(i);return e.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(e,i){return this.pointFromPixelNoRotate(e,i).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(e,i){if(e instanceof t.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageCoordinates(e,i,!0)}}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(e,i){if(e instanceof t.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportCoordinates(e,i,!0)}}var o=this._imageToViewportDelta(e,i);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(e,i,n,s){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,s)),this.viewer){var a=this.viewer.world.getItemCount();if(a>1)t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(a===1){var r=this.viewer.world.getItemAt(0);return r.imageToViewportRectangle(e,i,n,s,!0)}}var c=this.imageToViewportCoordinates(o.x,o.y),u=this._imageToViewportDelta(o.width,o.height);return new t.Rect(c.x,c.y,u.x,u.y,o.degrees)},viewportToImageRectangle:function(e,i,n,s){var o=e;if(o instanceof t.Rect||(o=new t.Rect(e,i,n,s)),this.viewer){var a=this.viewer.world.getItemCount();if(a>1)t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(a===1){var r=this.viewer.world.getItemAt(0);return r.viewportToImageRectangle(e,i,n,s,!0)}}var c=this.viewportToImageCoordinates(o.x,o.y),u=this._viewportToImageDelta(o.width,o.height);return new t.Rect(c.x,c.y,u.x,u.y,o.degrees)},viewerElementToImageCoordinates:function(e){var i=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(i)},imageToViewerElementCoordinates:function(e){var i=this.imageToViewportCoordinates(e);return this.pixelFromPoint(i,!0)},windowToImageCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var i=this.imageToViewerElementCoordinates(e);return i.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(e){return t.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return t.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var i=this.viewportToViewerElementCoordinates(e);return i.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(i===1){var n=this.viewer.world.getItemAt(0);return n.viewportToImageZoom(e)}}var s=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,r=o/s*a;return e*r},imageToViewportZoom:function(e){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(i===1){var n=this.viewer.world.getItemAt(0);return n.imageToViewportZoom(e)}}var s=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,r=s/o/a;return e*r},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e?this:(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e}),this)}}})(OpenSeadragon);(function(t){t.TiledImage=function(h){var y=this;t.console.assert(h.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(h.drawer,"[TiledImage] options.drawer is required"),t.console.assert(h.viewer,"[TiledImage] options.viewer is required"),t.console.assert(h.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(h.source,"[TiledImage] options.source is required"),t.console.assert(!h.clip||h.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=h.tileCache,delete h.tileCache,this._drawer=h.drawer,delete h.drawer,this._imageLoader=h.imageLoader,delete h.imageLoader,h.clip instanceof t.Rect&&(this._clip=h.clip.clone()),delete h.clip;var T=h.x||0;delete h.x;var R=h.y||0;delete h.y,this.normHeight=h.source.dimensions.y/h.source.dimensions.x,this.contentAspectX=h.source.dimensions.x/h.source.dimensions.y;var _=1;h.width?(_=h.width,delete h.width,h.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete h.height)):h.height&&(_=h.height/this.normHeight,delete h.height);var P=h.fitBounds;delete h.fitBounds;var L=h.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete h.fitBoundsPlacement;var N=h.degrees||0;delete h.degrees,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation},h),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:T,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:R,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:_,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:N,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),P&&this.fitBounds(P,L,!0),this._drawingHandler=function(V){y.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:y},V))}},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(h){h!==this._fullyLoaded&&(this._fullyLoaded=h,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var h=this._xSpring.update(),y=this._ySpring.update(),T=this._scaleSpring.update(),R=this._degreesSpring.update();return h||y||T||R?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(h){return this.getBoundsNoRotate(h).rotate(this.getRotation(h),this._getRotationPoint(h))},getBoundsNoRotate:function(h){return h?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(h){var y=this.getBoundsNoRotate(h);if(this._clip){var T=h?this._worldWidthCurrent:this._worldWidthTarget,R=T/this.source.dimensions.x,_=this._clip.times(R);y=new t.Rect(y.x+_.x,y.y+_.y,_.width,_.height)}return y.rotate(this.getRotation(h),this._getRotationPoint(h))},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(h,y,T){var R=T?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(h*(this.source.dimensions.x/R),y*(this.source.dimensions.y*this.contentAspectX/R))},viewportToImageCoordinates:function(h,y,T){var R;return h instanceof t.Point?(T=y,R=h):R=new t.Point(h,y),R=R.rotate(-this.getRotation(T),this._getRotationPoint(T)),T?this._viewportToImageDelta(R.x-this._xSpring.current.value,R.y-this._ySpring.current.value):this._viewportToImageDelta(R.x-this._xSpring.target.value,R.y-this._ySpring.target.value)},_imageToViewportDelta:function(h,y,T){var R=T?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(h/this.source.dimensions.x*R,y/this.source.dimensions.y/this.contentAspectX*R)},imageToViewportCoordinates:function(h,y,T){h instanceof t.Point&&(T=y,y=h.y,h=h.x);var R=this._imageToViewportDelta(h,y);return T?(R.x+=this._xSpring.current.value,R.y+=this._ySpring.current.value):(R.x+=this._xSpring.target.value,R.y+=this._ySpring.target.value),R.rotate(this.getRotation(T),this._getRotationPoint(T))},imageToViewportRectangle:function(h,y,T,R,_){var P=h;P instanceof t.Rect?_=y:P=new t.Rect(h,y,T,R);var L=this.imageToViewportCoordinates(P.getTopLeft(),_),N=this._imageToViewportDelta(P.width,P.height,_);return new t.Rect(L.x,L.y,N.x,N.y,P.degrees+this.getRotation(_))},viewportToImageRectangle:function(h,y,T,R,_){var P=h;h instanceof t.Rect?_=y:P=new t.Rect(h,y,T,R);var L=this.viewportToImageCoordinates(P.getTopLeft(),_),N=this._viewportToImageDelta(P.width,P.height,_);return new t.Rect(L.x,L.y,N.x,N.y,P.degrees-this.getRotation(_))},viewerElementToImageCoordinates:function(h){var y=this.viewport.pointFromPixel(h,!0);return this.viewportToImageCoordinates(y)},imageToViewerElementCoordinates:function(h){var y=this.imageToViewportCoordinates(h);return this.viewport.pixelFromPoint(y,!0)},windowToImageCoordinates:function(h){var y=h.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(y)},imageToWindowCoordinates:function(h){var y=this.imageToViewerElementCoordinates(h);return y.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(h){var y=this._scaleSpring.current.value;return h=h.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((h.x-this._xSpring.current.value)/y,(h.y-this._ySpring.current.value)/y,h.width/y,h.height/y,h.degrees)},viewportToImageZoom:function(h){var y=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return y*h},imageToViewportZoom:function(h){var y=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return h/y},setPosition:function(h,y){var T=this._xSpring.target.value===h.x&&this._ySpring.target.value===h.y;if(y){if(T&&this._xSpring.current.value===h.x&&this._ySpring.current.value===h.y)return;this._xSpring.resetTo(h.x),this._ySpring.resetTo(h.y),this._needsDraw=!0}else{if(T)return;this._xSpring.springTo(h.x),this._ySpring.springTo(h.y),this._needsDraw=!0}T||this._raiseBoundsChange()},setWidth:function(h,y){this._setScale(h,y)},setHeight:function(h,y){this._setScale(h/this.normHeight,y)},setCroppingPolygons:function(h){var y=function(R){return R instanceof t.Point||typeof R.x=="number"&&typeof R.y=="number"},T=function(R){return R.map(function(_){try{if(y(_))return{x:_.x,y:_.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!t.isArray(h))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=h.map(function(R){return T(R)})}catch(R){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(R),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(h,y,T){y=y||t.Placement.CENTER;var R=t.Placement.properties[y],_=this.contentAspectX,P=0,L=0,N=1,V=1;if(this._clip&&(_=this._clip.getAspectRatio(),N=this._clip.width/this.source.dimensions.x,V=this._clip.height/this.source.dimensions.y,h.getAspectRatio()>_?(P=this._clip.x/this._clip.height*h.height,L=this._clip.y/this._clip.height*h.height):(P=this._clip.x/this._clip.width*h.width,L=this._clip.y/this._clip.width*h.width)),h.getAspectRatio()>_){var J=h.height/V,z=0;R.isHorizontallyCentered?z=(h.width-h.height*_)/2:R.isRight&&(z=h.width-h.height*_),this.setPosition(new t.Point(h.x-P+z,h.y-L),T),this.setHeight(J,T)}else{var Q=h.width/N,j=0;R.isVerticallyCentered?j=(h.height-h.width/_)/2:R.isBottom&&(j=h.height-h.width/_),this.setPosition(new t.Point(h.x-P,h.y-L+j),T),this.setWidth(Q,T)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(h){t.console.assert(!h||h instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),h instanceof t.Rect?this._clip=h.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(h){h!==this.opacity&&(this.opacity=h,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(h){this._preload=!!h,this._needsDraw=!0},getRotation:function(h){return h?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(h,y){this._degreesSpring.target.value===h&&this._degreesSpring.isAtTargetValue()||(y?this._degreesSpring.resetTo(h):this._degreesSpring.springTo(h),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(h){return this.getBoundsNoRotate(h).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(h){h!==this.compositeOperation&&(this.compositeOperation=h,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(h,y){var T=this._scaleSpring.target.value===h;if(y){if(T&&this._scaleSpring.current.value===h)return;this._scaleSpring.resetTo(h),this._updateForScale(),this._needsDraw=!0}else{if(T)return;this._scaleSpring.springTo(h),this._updateForScale(),this._needsDraw=!0}T||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var h=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),y=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,T=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(y/this.minPixelRatio)/Math.log(2))));return T=Math.max(T,this.source.minLevel||0),h=Math.min(h,T),{lowestLevel:h,highestLevel:T}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var h=this.lastDrawn.pop();h.beingDrawn=!1}var y=this.viewport,T=this._viewportToTiledImageRectangle(y.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var R=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(T=T.intersection(R),T===null)return}for(var _=this._getLevelsInterval(),P=_.lowestLevel,L=_.highestLevel,N=null,V=!1,J=t.now(),z=L;z>=P;z--){var Q=!1,j=y.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(z),!0).x*this._scaleSpring.current.value;if(z===P||!V&&j>=this.minPixelRatio)Q=!0,V=!0;else if(!V)continue;var re=y.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(z),!1).x*this._scaleSpring.current.value,ae=y.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,ce=this.immediateRender?1:ae,le=Math.min(1,(j-.5)/.5),G=ce/Math.abs(ce-re);if(N=e(this,V,Q,z,le,G,T,J,N),u(this.coverage,z))break}E(this,this.lastDrawn),N&&!N.context2D?(s(this,N,J),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(h,y,T){var R,_;this.wrapHorizontal?(R=t.positiveModulo(y.x,1),_=t.positiveModulo(T.x,1)):(R=Math.max(0,y.x),_=Math.min(1,T.x));var P,L,N=1/this.source.aspectRatio;this.wrapVertical?(P=t.positiveModulo(y.y,N),L=t.positiveModulo(T.y,N)):(P=Math.max(0,y.y),L=Math.min(N,T.y));var V=this.source.getTileAtPoint(h,new t.Point(R,P)),J=this.source.getTileAtPoint(h,new t.Point(_,L)),z=this.source.getNumTiles(h);return this.wrapHorizontal&&(V.x+=z.x*Math.floor(y.x),J.x+=z.x*Math.floor(T.x)),this.wrapVertical&&(V.y+=z.y*Math.floor(y.y/N),J.y+=z.y*Math.floor(T.y/N)),{topLeft:V,bottomRight:J}}});function e(h,y,T,R,_,P,L,N,V){var J=L.getBoundingBox().getTopLeft(),z=L.getBoundingBox().getBottomRight();h.viewer&&h.viewer.raiseEvent("update-level",{tiledImage:h,havedrawn:y,level:R,opacity:_,visibility:P,drawArea:L,topleft:J,bottomright:z,currenttime:N,best:V}),x(h.coverage,R),x(h.loadingCoverage,R);for(var Q=h._getCornerTiles(R,J,z),j=Q.topLeft,re=Q.bottomRight,ae=h.source.getNumTiles(R),ce=h.viewport.pixelFromPoint(h.viewport.getCenter()),le=j.x;le<=re.x;le++)for(var G=j.y;G<=re.y;G++){if(!h.wrapHorizontal&&!h.wrapVertical){var ge=h.source.getTileBounds(R,le,G);if(L.intersection(ge)===null)continue}V=i(h,T,y,le,G,R,_,P,ce,ae,N,V)}return V}function i(h,y,T,R,_,P,L,N,V,J,z,Q){var j=n(R,_,P,h,h.source,h.tilesMatrix,z,J,h._worldWidthCurrent,h._worldHeightCurrent),re=T;h.viewer&&h.viewer.raiseEvent("update-tile",{tiledImage:h,tile:j}),m(h.coverage,P,R,_,!1);var ae=j.loaded||j.loading||g(h.loadingCoverage,P,R,_);if(m(h.loadingCoverage,P,R,_,ae),!j.exists||(y&&!re&&(g(h.coverage,P,R,_)?m(h.coverage,P,R,_,!0):re=!0),!re))return Q;if(r(j,h.source.tileOverlap,h.viewport,V,N,h),!j.loaded)if(j.context2D)a(h,j);else{var ce=h._tileCache.getImageRecord(j.cacheKey);if(ce){var le=ce.getImage();a(h,j,le)}}if(j.loaded){var G=c(h,j,R,_,P,L,z);G&&(h._needsDraw=!0)}else j.loading?h._tilesLoading++:ae||(Q=S(Q,j));return Q}function n(h,y,T,R,_,P,L,N,V,J){var z,Q,j,re,ae,ce,le,G,ge;return P[T]||(P[T]={}),P[T][h]||(P[T][h]={}),P[T][h][y]||(z=(N.x+h%N.x)%N.x,Q=(N.y+y%N.y)%N.y,j=_.getTileBounds(T,z,Q),re=_.getTileBounds(T,z,Q,!0),ae=_.tileExists(T,z,Q),ce=_.getTileUrl(T,z,Q),R.loadTilesWithAjax?(le=_.getTileAjaxHeaders(T,z,Q),t.isPlainObject(R.ajaxHeaders)&&(le=t.extend({},R.ajaxHeaders,le))):le=null,G=_.getContext2D?_.getContext2D(T,z,Q):void 0,j.x+=(h-z)/N.x,j.y+=J/V*((y-Q)/N.y),ge=new t.Tile(T,h,y,j,ae,ce,G,R.loadTilesWithAjax,le,re),z===N.x-1&&(ge.isRightMost=!0),Q===N.y-1&&(ge.isBottomMost=!0),P[T][h][y]=ge),ge=P[T][h][y],ge.lastTouchTime=L,ge}function s(h,y,T){y.loading=!0,h._imageLoader.addJob({src:y.url,loadWithAjax:y.loadWithAjax,ajaxHeaders:y.ajaxHeaders,crossOriginPolicy:h.crossOriginPolicy,ajaxWithCredentials:h.ajaxWithCredentials,callback:function(R,_,P){o(h,y,T,R,_,P)},abort:function(){y.loading=!1}})}function o(h,y,T,R,_,P){if(!R){t.console.log("Tile %s failed to load: %s - error: %s",y,y.url,_),h.viewer.raiseEvent("tile-load-failed",{tile:y,tiledImage:h,time:T,message:_,tileRequest:P}),y.loading=!1,y.exists=!1;return}if(T<h.lastResetTime){t.console.log("Ignoring tile %s loaded before reset: %s",y,y.url),y.loading=!1;return}var L=function(){var N=h.source.getClosestLevel();a(h,y,R,N,P)};h._midDraw?window.setTimeout(L,1):L()}function a(h,y,T,R,_){var P=0;function L(){return P++,N}function N(){P--,P===0&&(y.loading=!1,y.loaded=!0,y.context2D||h._tileCache.cacheTile({image:T,tile:y,cutoff:R,tiledImage:h}),h._needsDraw=!0)}h.viewer.raiseEvent("tile-loaded",{tile:y,tiledImage:h,tileRequest:_,image:T,getCompletionCallback:L}),L()()}function r(h,y,T,R,_,P){var L=h.bounds.getTopLeft();L.x*=P._scaleSpring.current.value,L.y*=P._scaleSpring.current.value,L.x+=P._xSpring.current.value,L.y+=P._ySpring.current.value;var N=h.bounds.getSize();N.x*=P._scaleSpring.current.value,N.y*=P._scaleSpring.current.value;var V=T.pixelFromPointNoRotate(L,!0),J=T.pixelFromPointNoRotate(L,!1),z=T.deltaPixelsFromPointsNoRotate(N,!0),Q=T.deltaPixelsFromPointsNoRotate(N,!1),j=J.plus(Q.divide(2)),re=R.squaredDistanceTo(j);y||(z=z.plus(new t.Point(1,1))),h.isRightMost&&P.wrapHorizontal&&(z.x+=.75),h.isBottomMost&&P.wrapVertical&&(z.y+=.75),h.position=V,h.size=z,h.squaredDistance=re,h.visibility=_}function c(h,y,T,R,_,P,L){var N=1e3*h.blendTime,V,J;if(y.blendStart||(y.blendStart=L),V=L-y.blendStart,J=N?Math.min(1,V/N):1,h.alwaysBlend&&(J*=P),y.opacity=J,h.lastDrawn.push(y),J===1)m(h.coverage,_,T,R,!0),h._hasOpaqueTile=!0;else if(V<N)return!0;return!1}function u(h,y,T,R){var _,P,L,N;if(!h[y])return!1;if(T===void 0||R===void 0){_=h[y];for(L in _)if(Object.prototype.hasOwnProperty.call(_,L)){P=_[L];for(N in P)if(Object.prototype.hasOwnProperty.call(P,N)&&!P[N])return!1}return!0}return h[y][T]===void 0||h[y][T][R]===void 0||h[y][T][R]===!0}function g(h,y,T,R){return T===void 0||R===void 0?u(h,y+1):u(h,y+1,2*T,2*R)&&u(h,y+1,2*T,2*R+1)&&u(h,y+1,2*T+1,2*R)&&u(h,y+1,2*T+1,2*R+1)}function m(h,y,T,R,_){if(!h[y]){t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",y);return}h[y][T]||(h[y][T]={}),h[y][T][R]=_}function x(h,y){h[y]={}}function S(h,y){return!h||y.visibility>h.visibility||y.visibility==h.visibility&&y.squaredDistance<h.squaredDistance?y:h}function E(h,y){if(!(h.opacity===0||y.length===0&&!h.placeholderFillStyle)){var T=y[0],R;T&&(R=h.opacity<1||h.compositeOperation&&h.compositeOperation!=="source-over"||!h._isBottomItem()&&T._hasTransparencyChannel());var _,P,L=h.viewport.getZoom(!0),N=h.viewportToImageZoom(L);y.length>1&&N>h.smoothTileEdgesMinZoom&&!h.iOSDevice&&h.getRotation(!0)%360==0&&t.supportsCanvas&&(R=!0,_=T.getScaleForEdgeSmoothing(),P=T.getTranslationForEdgeSmoothing(_,h._drawer.getCanvasSize(!1),h._drawer.getCanvasSize(!0)));var V;R&&(_||(V=h.viewport.viewportToViewerElementRectangle(h.getClippedBounds(!0)).getIntegerBoundingBox(),h._drawer.viewer.viewport.getFlip()&&(h.viewport.degrees!==0||h.getRotation(!0)%360!=0)&&(V.x=h._drawer.viewer.container.clientWidth-(V.x+V.width)),V=V.times(t.pixelDensityRatio)),h._drawer._clear(!0,V)),_||(h.viewport.degrees!==0&&h._drawer._offsetForRotation({degrees:h.viewport.degrees,useSketch:R}),h.getRotation(!0)%360!=0&&h._drawer._offsetForRotation({degrees:h.getRotation(!0),point:h.viewport.pixelFromPointNoRotate(h._getRotationPoint(!0),!0),useSketch:R}),h.viewport.degrees===0&&h.getRotation(!0)%360==0&&h._drawer.viewer.viewport.getFlip()&&h._drawer._flip());var J=!1;if(h._clip){h._drawer.saveContext(R);var z=h.imageToViewportRectangle(h._clip,!0);z=z.rotate(-h.getRotation(!0),h._getRotationPoint(!0));var Q=h._drawer.viewportToDrawerRectangle(z);_&&(Q=Q.times(_)),P&&(Q=Q.translate(P)),h._drawer.setClip(Q,R),J=!0}if(h._croppingPolygons){h._drawer.saveContext(R);try{var j=h._croppingPolygons.map(function(le){return le.map(function(G){var ge=h.imageToViewportCoordinates(G.x,G.y,!0).rotate(-h.getRotation(!0),h._getRotationPoint(!0)),Pe=h._drawer.viewportCoordToDrawerCoord(ge);return _&&(Pe=Pe.times(_)),Pe})});h._drawer.clipWithPolygons(j,R)}catch(le){t.console.error(le)}J=!0}if(h.placeholderFillStyle&&h._hasOpaqueTile===!1){var re=h._drawer.viewportToDrawerRectangle(h.getBounds(!0));_&&(re=re.times(_)),P&&(re=re.translate(P));var ae=null;typeof h.placeholderFillStyle=="function"?ae=h.placeholderFillStyle(h,h._drawer.context):ae=h.placeholderFillStyle,h._drawer.drawRectangle(re,ae,R)}for(var ce=y.length-1;ce>=0;ce--)T=y[ce],h._drawer.drawTile(T,h._drawingHandler,R,_,P),T.beingDrawn=!0,h.viewer&&h.viewer.raiseEvent("tile-drawn",{tiledImage:h,tile:T});J&&h._drawer.restoreContext(R),_||(h.getRotation(!0)%360!=0&&h._drawer._restoreRotationChanges(R),h.viewport.degrees!==0&&h._drawer._restoreRotationChanges(R)),R&&(_&&(h.viewport.degrees!==0&&h._drawer._offsetForRotation({degrees:h.viewport.degrees,useSketch:!1}),h.getRotation(!0)%360!=0&&h._drawer._offsetForRotation({degrees:h.getRotation(!0),point:h.viewport.pixelFromPointNoRotate(h._getRotationPoint(!0),!0),useSketch:!1})),h._drawer.blendSketch({opacity:h.opacity,scale:_,translate:P,compositeOperation:h.compositeOperation,bounds:V}),_&&(h.getRotation(!0)%360!=0&&h._drawer._restoreRotationChanges(!1),h.viewport.degrees!==0&&h._drawer._restoreRotationChanges(!1))),_||h.viewport.degrees===0&&h.getRotation(!0)%360==0&&h._drawer.viewer.viewport.getFlip()&&h._drawer._flip(),H(h,y)}}function H(h,y){if(h.debugMode)for(var T=y.length-1;T>=0;T--){var R=y[T];try{h._drawer.drawDebugInfo(R,y.length,T,h)}catch(_){t.console.error(_)}}}})(OpenSeadragon);(function(t){var e=function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=n.tile,this.tiledImage=n.tiledImage},i=function(n){t.console.assert(n,"[ImageRecord] options is required"),t.console.assert(n.image,"[ImageRecord] options.image is required"),this._image=n.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var n=document.createElement("canvas");n.width=this._image.width,n.height=this._image.height,this._renderedContext=n.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(n){t.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=n},addTile:function(n){t.console.assert(n,"[ImageRecord.addTile] tile is required"),this._tiles.push(n)},removeTile:function(n){for(var s=0;s<this._tiles.length;s++)if(this._tiles[s]===n){this._tiles.splice(s,1);return}t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",n)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(n){n=n||{},this._maxImageCacheCount=n.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var s=n.cutoff||0,o=this._tilesLoaded.length,a=this._imagesLoaded[n.tile.cacheKey];if(a||(t.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),a=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),a.addTile(n.tile),n.tile.cacheImageRecord=a,this._imagesLoadedCount>this._maxImageCacheCount){for(var r=null,c=-1,u=null,g,m,x,S,E,H,h=this._tilesLoaded.length-1;h>=0;h--)if(H=this._tilesLoaded[h],g=H.tile,!(g.level<=s||g.beingDrawn)){if(!r){r=g,c=h,u=H;continue}S=g.lastTouchTime,m=r.lastTouchTime,E=g.level,x=r.level,(S<m||S==m&&E>x)&&(r=g,c=h,u=H)}r&&c>=0&&(this._unloadTile(u),o=c)}this._tilesLoaded[o]=new e({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(n){t.console.assert(n,"[TileCache.clearTilesFor] tiledImage is required");for(var s,o=0;o<this._tilesLoaded.length;++o)s=this._tilesLoaded[o],s.tiledImage===n&&(this._unloadTile(s),this._tilesLoaded.splice(o,1),o--)},getImageRecord:function(n){return t.console.assert(n,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[n]},_unloadTile:function(n){t.console.assert(n,"[TileCache._unloadTile] tileRecord is required");var s=n.tile,o=n.tiledImage;s.unload(),s.cacheImageRecord=null;var a=this._imagesLoaded[s.cacheKey];a.removeTile(s),a.getTileCount()||(a.destroy(),delete this._imagesLoaded[s.cacheKey],this._imagesLoadedCount--),o.viewer.raiseEvent("tile-unloaded",{tile:s,tiledImage:o})}}})(OpenSeadragon);(function(t){t.World=function(e){var i=this;t.console.assert(e.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(n){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(e,i){if(t.console.assert(e,"[World.addItem] item is required"),t.console.assert(e instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),i=i||{},i.index!==void 0){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,e)}else this._items.push(e);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return t.console.assert(e!==void 0,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return t.console.assert(e,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,i){t.console.assert(e,"[World.setItemIndex] item is required"),t.console.assert(i!==void 0,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(e);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i===n||n===-1||(this._items.splice(n,1),this._items.splice(i,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:n,newIndex:i}))},removeItem:function(e){t.console.assert(e,"[World.removeItem] item is required");var i=t.indexOf(this._items,e);i!==-1&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){this.viewer._cancelPendingImages();var e,i;for(i=0;i<this._items.length;i++)e=this._items[i],e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<n.length;i++)e=n[i],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,i=0;i<this._items.length;i++)e=this._items[i].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){e=e||{};var i=e.immediately||!1,n=e.layout||t.DEFAULT_SETTINGS.collectionLayout,s=e.rows||t.DEFAULT_SETTINGS.collectionRows,o=e.columns||t.DEFAULT_SETTINGS.collectionColumns,a=e.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,r=e.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,c=a+r,u;!e.rows&&o?u=o:u=Math.ceil(this._items.length/s);var g=0,m=0,x,S,E,H,h;this.setAutoRefigureSizes(!1);for(var y=0;y<this._items.length;y++)y&&y%u==0&&(n==="horizontal"?(m+=c,g=0):(g+=c,m=0)),x=this._items[y],S=x.getBounds(),S.width>S.height?E=a:E=a*(S.width/S.height),H=E*(S.height/S.width),h=new t.Point(g+(a-E)/2,m+(a-H)/2),x.setPosition(h,i),x.setWidth(E,i),n==="horizontal"?g+=c:m+=c;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(!this._items.length)this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;else{var s=this._items[0],o=s.getBounds();this._contentFactor=s.getContentSize().x/o.width;for(var a=s.getClippedBounds().getBoundingBox(),r=a.x,c=a.y,u=a.x+a.width,g=a.y+a.height,m=1;m<this._items.length;m++)s=this._items[m],o=s.getBounds(),this._contentFactor=Math.max(this._contentFactor,s.getContentSize().x/o.width),a=s.getClippedBounds().getBoundingBox(),r=Math.min(r,a.x),c=Math.min(c,a.y),u=Math.max(u,a.x+a.width),g=Math.max(g,a.y+a.height);this._homeBounds=new t.Rect(r,c,u-r,g-c),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==n||!this._homeBounds.equals(e)||!this._contentSize.equals(i))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})})(OpenSeadragon)});var si=It((Ye,bt)=>{(function(t,e){typeof Ye=="object"&&typeof bt=="object"?bt.exports=e(Ke()):typeof define=="function"&&define.amd?define(["openseadragon"],e):typeof Ye=="object"?Ye["openseadragon-viewerinputhook"]=e(Ke()):t["openseadragon-viewerinputhook"]=e(t.openseadragon)})(window,function(t){return function(e){function i(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}var n={};return i.m=e,i.c=n,i.d=function(s,o,a){i.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:a})},i.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,o){if(1&o&&(s=i(s)),8&o||4&o&&typeof s=="object"&&s&&s.__esModule)return s;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:s}),2&o&&typeof s!="string")for(var r in s)i.d(a,r,function(c){return s[c]}.bind(null,r));return a},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=1)}([function(e){e.exports=t},function(e,i,n){"use strict";n.r(i);var s=n(0),o=n.n(s);i.default=function(a,r){if(!a.version||1>a.version.major)throw new Error("OpenSeadragonViewerInputHook requires OpenSeadragon version 1.0.0+");return a.Viewer.prototype.addViewerInputHook=function(c){return(c=c||{}).viewer=this,new r.ViewerInputHook(c)},r.ViewerInputHook=function(c){var u,g;for((c=c||{}).hooks=c.hooks||[],this.viewer=c.viewer||null,this.viewerTrackers={},this.hooks=[],this.viewer&&(this.viewerTrackers.viewer=this.viewer.innerTracker,this.viewerTrackers.viewer_outer=this.viewer.outerTracker),u=0;u<c.hooks.length;u++){if(typeof c.hooks[u].tracker=="string"){if(!this.viewer)throw new Error("A viewer must be specified.");if((g=this.viewerTrackers[c.hooks[u].tracker])===void 0)throw new Error("Unknown tracker specified: "+c.hooks[u].tracker)}else g=c.hooks[u].tracker;this.hooks.push({tracker:g,handlerName:c.hooks[u].handler,origHandler:g[c.hooks[u].handler],hookHandler:c.hooks[u].hookHandler}),function(m,x,S,E){var H=x[S];x[S]=function(h){return m._callHandlers(E,H,h)}}(this,g,c.hooks[u].handler,c.hooks[u].hookHandler)}},r.ViewerInputHook.version={versionStr:"2.2.1",major:2,minor:2,revision:1},r.ViewerInputHook.prototype._callHandlers=function(c,u,g){var m=c(g);return u&&!g.stopHandlers&&(m=u(g)),!g.stopBubbling&&m},r.ViewerInputHook.prototype.destroy=function(){for(;0<this.hooks.length;){var c=this.hooks.pop();c.tracker[c.handlerName]=c.origHandler}this.viewer&&(delete this.viewerTrackers.viewer,delete this.viewerTrackers.viewer_outer,this.viewer=null)},r.ViewerInputHook}(o.a||window.OpenSeadragon,window.OpenSeadragonImaging=window.OpenSeadragonImaging||{})}]).default})});var be=class{constructor(e,i,n,s){this.x=e,this.y=i,this.w=n,this.h=s}toString(){return`${this.x},${this.y},${this.w},${this.h}`}static fromString(e){e=e.replace("xywh=","");let i=e.split(",");return new be(Number(i[0]),Number(i[1]),Number(i[2]),Number(i[3]))}};var Ue=class{constructor(e,i){this.x=e,this.y=i}};var gt=class{constructor(){this.region=new ct(0,0);this.regionPos=new Ue(0,0);this.size=new ct(0,0)}};var fe=Se(),ft=class extends zt{constructor(e){super(e)}create(){this.setConfig("downloadDialogue"),super.create(),this.$settingsButton=fe('<a class="settings" href="#">'+this.content.editSettings+"</a>"),this.$pagingNote=fe('<div class="pagingNote">'+this.content.pagingNote+" </div>"),this.$pagingNote.append(this.$settingsButton),this.$content.append(this.$pagingNote),this.$imageOptionsContainer=fe('<li class="group image"></li>'),this.$downloadOptions.append(this.$imageOptionsContainer),this.$imageOptions=fe("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$currentViewAsJpgButton=fe('<li class="option single"><input id="'+U.CURRENT_VIEW+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+U.CURRENT_VIEW+'"></label></li>'),this.$imageOptions.append(this.$currentViewAsJpgButton),this.$currentViewAsJpgButton.hide(),this.$wholeImageHighResButton=fe('<li class="option single"><input id="'+U.WHOLE_IMAGE_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+U.WHOLE_IMAGE_HIGH_RES+'label" for="'+U.WHOLE_IMAGE_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImageHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImagesHighResButton=fe('<li class="option multiple"><input id="'+U.WHOLE_IMAGES_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+U.WHOLE_IMAGES_HIGH_RES+'label" for="'+U.WHOLE_IMAGES_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImagesHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImageLowResAsJpgButton=fe('<li class="option single"><input id="'+U.WHOLE_IMAGE_LOW_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+U.WHOLE_IMAGE_LOW_RES+'">'+this.content.wholeImageLowResAsJpg+"</label></li>"),this.$imageOptions.append(this.$wholeImageLowResAsJpgButton),this.$wholeImageLowResAsJpgButton.hide(),this.$canvasOptionsContainer=fe('<li class="group canvas"></li>'),this.$downloadOptions.append(this.$canvasOptionsContainer),this.$canvasOptions=fe("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$manifestOptionsContainer=fe('<li class="group manifest"></li>'),this.$downloadOptions.append(this.$manifestOptionsContainer),this.$manifestOptions=fe("<ul></ul>"),this.$manifestOptionsContainer.append(this.$manifestOptions),this.$selectionButton=fe('<li class="option"><input id="'+U.SELECTION+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+U.SELECTION+'label" for="'+U.SELECTION+'"></label></li>'),this.$manifestOptions.append(this.$selectionButton),this.$selectionButton.hide(),this.$downloadButton=fe('<a class="btn btn-primary" href="#" tabindex="0">'+this.content.download+"</a>"),this.$buttons.prepend(this.$downloadButton),this.$explanatoryTextTemplate=fe('<span class="explanatory"></span>');let e=this;this.$downloadButton.on("click",i=>{i.preventDefault();let n=e.getSelectedOption(),s=n.attr("id"),o=n.attr("title"),a=n.data("mime"),r=U.UNKNOWN,c=this.extension.helper.getCurrentCanvas();if(this.renderingUrls[s])a&&(a.toLowerCase().indexOf("pdf")!==-1?r=U.ENTIRE_DOCUMENT_AS_PDF:a.toLowerCase().indexOf("txt")!==-1&&(r=U.ENTIRE_DOCUMENT_AS_TEXT)),(r=U.ENTIRE_DOCUMENT_AS_PDF)&&window.open(this.renderingUrls[s]);else switch(r=s,r){case U.CURRENT_VIEW:let u=e.extension.getViewer();window.open(e.extension.getCroppedImageUri(c,u));break;case U.SELECTION:ke.waitFor(()=>!this.isActive,()=>{this.extensionHost.publish(b.SHOW_MULTISELECT_DIALOGUE)});break;case U.WHOLE_IMAGE_HIGH_RES:window.open(this.getCanvasHighResImageUri(this.extension.helper.getCurrentCanvas()));break;case U.WHOLE_IMAGES_HIGH_RES:let g=this.extension.getPagedIndices();for(let x=0;x<g.length;x++)window.open(this.getCanvasHighResImageUri(this.extension.helper.getCanvasByIndex(g[x])));break;case U.WHOLE_IMAGE_LOW_RES:let m=e.extension.getConfinedImageUri(c,e.options.confinedImageSize);m&&window.open(m);break}this.extensionHost.publish(b.DOWNLOAD,{type:r,label:o}),this.close()}),this.$settingsButton.onPressed(()=>{this.extensionHost.publish(b.HIDE_DOWNLOAD_DIALOGUE),this.extensionHost.publish(b.SHOW_SETTINGS_DIALOGUE)})}open(e){super.open(e);let i=this.extension.helper.getCurrentCanvas(),s=this.extension.getViewerRotation()%180==0;if(this.isDownloadOptionAvailable(U.CURRENT_VIEW)){let r=this.$currentViewAsJpgButton.find("input"),c=this.$currentViewAsJpgButton.find("label"),u=this.content.currentViewAsJpg,g=this.extension.getViewer(),m=this.extension.getCroppedImageDimensions(i,g);if(m?(u=s?ue.format(u,m.size.width.toString(),m.size.height.toString()):ue.format(u,m.size.height.toString(),m.size.width.toString()),c.text(u),r.prop("title",u),this.$currentViewAsJpgButton.data("width",m.size.width),this.$currentViewAsJpgButton.data("height",m.size.height),this.$currentViewAsJpgButton.show()):this.$currentViewAsJpgButton.hide(),ie.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let x=this.content.currentViewAsJpgExplanation;if(x){let S=this.$explanatoryTextTemplate.clone();S.text(x),c.append(S)}}}else this.$currentViewAsJpgButton.hide();if(this.isDownloadOptionAvailable(U.WHOLE_IMAGE_HIGH_RES)){let r=this.$wholeImageHighResButton.find("input"),c=this.$wholeImageHighResButton.find("label"),u=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());u?u=ut.simplifyMimeType(u):u="?";let g=this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas());if(g){let m=s?ue.format(this.content.wholeImageHighRes,g.width.toString(),g.height.toString(),u):ue.format(this.content.wholeImageHighRes,g.height.toString(),g.width.toString(),u);c.text(m),r.prop("title",m),this.$wholeImageHighResButton.data("width",g.width),this.$wholeImageHighResButton.data("height",g.height),this.$wholeImageHighResButton.show()}else if(i.externalResource&&!i.externalResource.hasServiceDescriptor()){let m=ue.format(this.content.wholeImageHighRes,"?","?",u);c.text(m),r.prop("title",m),this.$wholeImageHighResButton.show()}else this.$wholeImageHighResButton.hide();if(ie.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let m=this.content.wholeImageHighResExplanation;if(m){let x=this.$explanatoryTextTemplate.clone();x.text(m),c.append(x)}}}else this.$wholeImageHighResButton.hide();if(this.isDownloadOptionAvailable(U.WHOLE_IMAGES_HIGH_RES)){let r=this.$wholeImagesHighResButton.find("input"),c=this.$wholeImagesHighResButton.find("label"),u=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());u?u=ut.simplifyMimeType(u):u="?";let g=ue.format(this.content.wholeImagesHighRes,u);if(c.text(g),r.prop("title",g),this.$wholeImagesHighResButton.show(),ie.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let m=this.content.wholeImagesHighResExplanation;if(m){let x=this.$explanatoryTextTemplate.clone();x.text(m),c.append(x)}}}else this.$wholeImagesHighResButton.hide();if(this.isDownloadOptionAvailable(U.WHOLE_IMAGE_LOW_RES)){let r=this.$wholeImageLowResAsJpgButton.find("input"),c=this.$wholeImageLowResAsJpgButton.find("label"),u=this.extension.getConfinedImageDimensions(i,this.options.confinedImageSize),g=s?ue.format(this.content.wholeImageLowResAsJpg,u.width.toString(),u.height.toString()):ue.format(this.content.wholeImageLowResAsJpg,u.height.toString(),u.width.toString());if(c.text(g),r.prop("title",g),this.$wholeImageLowResAsJpgButton.data("width",u.width),this.$wholeImageLowResAsJpgButton.data("height",u.height),this.$wholeImageLowResAsJpgButton.show(),ie.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let m=this.content.wholeImageLowResAsJpgExplanation;if(m){let x=this.$explanatoryTextTemplate.clone();x.text(m),c.append(x)}}}else this.$wholeImageLowResAsJpgButton.hide();if(this.isDownloadOptionAvailable(U.SELECTION)){let r=this.$selectionButton.find("input"),c=this.$selectionButton.find("label");if(c.text(this.content.downloadSelection),r.prop("title",this.content.downloadSelection),this.$selectionButton.show(),ie.getBool(this.options.optionsExplanatoryTextEnabled,!1)){let u=this.content.selectionExplanation;if(u){let g=this.$explanatoryTextTemplate.clone();g.text(u),c.append(g)}}}else this.$selectionButton.hide();if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(U.RANGE_RENDERINGS)&&i.ranges&&i.ranges.length)for(let r=0;r<i.ranges.length;r++){let c=i.ranges[r],u=this.getDownloadOptionsForRenderings(c,this.content.entireFileAsOriginal,U.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(u)}if(this.isDownloadOptionAvailable(U.IMAGE_RENDERINGS)){let r=i.getImages();for(let c=0;c<r.length;c++){let u=this.getDownloadOptionsForRenderings(r[c].getResource(),this.content.entireFileAsOriginal,U.IMAGE_RENDERINGS);this.addDownloadOptionsForRenderings(u)}}if(this.isDownloadOptionAvailable(U.CANVAS_RENDERINGS)){let r=this.getDownloadOptionsForRenderings(i,this.content.entireFileAsOriginal,U.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(r)}if(this.isDownloadOptionAvailable(U.MANIFEST_RENDERINGS)){let r=this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(),this.content.entireDocument,U.MANIFEST_RENDERINGS);!r.length&&this.extension.helper.manifest&&(r=this.getDownloadOptionsForRenderings(this.extension.helper.manifest,this.content.entireDocument,U.MANIFEST_RENDERINGS)),this.addDownloadOptionsForRenderings(r)}if(this.isDownloadOptionAvailable(U.CURRENT_VIEW)){let r=parseInt(this.$currentViewAsJpgButton.data("width").toString()),c=parseInt(this.$currentViewAsJpgButton.data("height").toString()),u=parseInt(this.$wholeImageHighResButton.data("width").toString()),g=parseInt(this.$wholeImageHighResButton.data("height").toString()),m=r/u*100,x=c/g*100,S=this.options.currentViewDisabledPercentage;m>=S&&x>=S?this.$currentViewAsJpgButton.hide():this.$currentViewAsJpgButton.show()}let o=this.$imageOptions.find("li.single");o=o.sort((r,c)=>{let u=fe(r).data("width");u&&(u=parseInt(u.toString()));let g=fe(r).data("height");g&&(g=parseInt(g.toString()));let m=fe(c).data("width");m&&(m=parseInt(m.toString()));let x=fe(c).data("height");x&&(x=parseInt(x.toString()));let S=u*g,E=m*x;return S<E?-1:S>E?1:0}),o.detach().appendTo(this.$imageOptions),this.$downloadOptions.find("li.group").each((r,c)=>{let u=fe(c);u.show(),u.find("li.option:hidden").length===u.find("li.option").length&&u.hide()}),this.$downloadOptions.find("li.group:visible").last().addClass("lastVisible"),this.extension.isPagingSettingEnabled()&&this.config.options.downloadPagingNoteEnabled?this.$pagingNote.show():this.$pagingNote.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()}addDownloadOptionsForRenderings(e){e.forEach(i=>{switch(i.type){case U.IMAGE_RENDERINGS:this.$imageOptions.append(i.button);break;case U.CANVAS_RENDERINGS:this.$canvasOptions.append(i.button);break;case U.MANIFEST_RENDERINGS:this.$manifestOptions.append(i.button);break}})}getCanvasImageResource(e){let i=e.getImages();return i[0]?i[0].getResource():null}getCanvasHighResImageUri(e){let i=this.getCanvasComputedDimensions(e);if(i){let n=i.width,s=e.getCanonicalImageUri(n);if(e.externalResource&&e.externalResource.hasServiceDescriptor()){let o=s.split("/"),a=this.extension.getViewerRotation();o[o.length-2]=String(a),s=o.join("/")}return s}else if(e.externalResource&&!e.externalResource.hasServiceDescriptor())return e.externalResource.dataUri;return""}getCanvasMimeType(e){let i=this.getCanvasImageResource(e);if(i){let n=i.getFormat();if(n)return n.toString()}return null}getCanvasDimensions(e){if(e.externalResource.data){let i=e.externalResource.data.width,n=e.externalResource.data.height;if(i&&n)return new He(i,n)}return null}getCanvasComputedDimensions(e){let i=this.getCanvasDimensions(e),n=e.getMaxDimensions();if(!i)return null;if(!n||i.width<=n.width&&i.height<=n.height)return i;let s=n.width/i.width,o=n.height/i.height,a=Math.min(s,o);return new He(Math.floor(i.width*a),Math.floor(i.height*a))}_isLevel0(e){return!e||!e.length?!1:Ge.isLevel0ImageProfile(e[0])}isDownloadOptionAvailable(e){if(!this.extension.resources)return!1;let i=this.extension.helper.getCurrentCanvas();if(!i.externalResource.hasServiceDescriptor()||this._isLevel0(i.externalResource.data.profile))return!!(e===U.WHOLE_IMAGE_HIGH_RES&&(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length===1));switch(e){case U.CURRENT_VIEW:case U.CANVAS_RENDERINGS:case U.IMAGE_RENDERINGS:case U.WHOLE_IMAGE_HIGH_RES:if(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length===1){let s=i.getMaxDimensions();return s?s.width<=this.options.maxImageWidth:!0}return!1;case U.WHOLE_IMAGES_HIGH_RES:return!!(this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length>1);case U.WHOLE_IMAGE_LOW_RES:let n=this.getCanvasComputedDimensions(i);return n?!this.extension.isPagingSettingEnabled()&&n.width>this.options.confinedImageSize:!1;case U.SELECTION:return this.options.selectionEnabled;case U.RANGE_RENDERINGS:return i.ranges&&i.ranges.length?i.ranges[0].getRenderings().length>0:!1;default:return super.isDownloadOptionAvailable(e)}}};var ui=Se(),mt=class extends Xe{constructor(e){super(e)}create(){this.setConfig("externalContentDialogue"),super.create(),this.openCommand=b.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=b.HIDE_EXTERNALCONTENT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,e=>{this.open(),this.$iframe.prop("src",e.uri)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$iframe=ui("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()}resize(){super.resize(),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())}};var vt=Se(),wt=class extends Qe{constructor(e){super(e)}create(){this.setConfig("mobileFooterPanel"),super.create(),this.$rotateButton=vt(`
            <button class="btn imageBtn rotate" title="${this.content.rotateRight}">
                <i class="uv-icon-rotate" aria-hidden="true"></i>${this.content.rotateRight}
            </button>
        `),this.$options.prepend(this.$rotateButton),this.$zoomOutButton=vt(`
            <button class="btn imageBtn zoomOut" title="${this.content.zoomOut}">
                <i class="uv-icon-zoom-out" aria-hidden="true"></i>${this.content.zoomOut}
            </button>
        `),this.$options.prepend(this.$zoomOutButton),this.$zoomInButton=vt(`
            <button class="btn imageBtn zoomIn" title="${this.content.zoomIn}">
                <i class="uv-icon-zoom-in" aria-hidden="true"></i>${this.content.zoomIn}
            </button>
        `),this.$options.prepend(this.$zoomInButton),this.$zoomInButton.onPressed(()=>{this.extensionHost.publish(B.ZOOM_IN)}),this.$zoomOutButton.onPressed(()=>{this.extensionHost.publish(B.ZOOM_OUT)}),this.$rotateButton.onPressed(()=>{this.extensionHost.publish(B.ROTATE)})}resize(){super.resize(),setTimeout(()=>{this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},1)}};var Ce=Se(),We=class{constructor(e,i,n,s,o=300,a=2,r=!1,c=!1){this._$element=e,this._autoCompleteFunc=i,this._delay=o,this._minChars=a,this._onSelect=s,this._parseResultsFunc=n,this._positionAbove=r,this._allowWords=c,this._$searchResultsList=Ce('<ul class="autocomplete"></ul>'),this._positionAbove?this._$element.parent().prepend(this._$searchResultsList):this._$element.parent().append(this._$searchResultsList),this._$searchResultTemplate=Ce('<li class="result"><a href="#" tabindex="-1"></a></li>');let u=function(){let m=0;return function(x,S){clearTimeout(m),m=setTimeout(x,S)}}(),g=this;this._$element.on("keydown",function(m){let x=m.originalEvent,S=At.getCharCode(x),E=!1;(S===Te.LeftArrow||S===Te.RightArrow)&&(E=!0),E&&(x.cancelBubble=!0,x.stopPropagation&&x.stopPropagation())}),this._$element.on("keyup",function(m){if(!g._getSelectedListItem().length&&m.keyCode===Te.Enter){g._onSelect(g._getTerms());return}if(m.keyCode!==Te.Tab){if(Dt(g._$searchResultsList)&&g._results.length){if(m.keyCode===Te.Enter)g._searchForItem(g._getSelectedListItem());else if(m.keyCode===Te.DownArrow){g._setSelectedResultIndex(1);return}else if(m.keyCode===Te.UpArrow){g._setSelectedResultIndex(-1);return}}m.keyCode!==Te.Enter&&u(()=>{let x=g._getTerms();x&&x.length>g._minChars&&g._searchForWords(x)?g._search(x):(g._clearResults(),g._hideResults())},g._delay)}}),Ce(document).on("mouseup",m=>{this._$searchResultsList.parent().has(Ce(m.target)[0]).length===0&&(this._clearResults(),this._hideResults())}),Ce(document).on("focusin",m=>{this._$searchResultsList.has(Ce(m.target)[0]).length===0&&!this._$element.is(Ce(m.target)[0])&&(this._clearResults(),this._hideResults())}),this._hideResults()}_searchForWords(e){return!!(this._allowWords||!e.includes(" "))}_getTerms(){return this._$element.val().trim()}_setSelectedResultIndex(e){let i;e===1?i=this._selectedResultIndex+1:i=this._selectedResultIndex-1;let n=this._$searchResultsList.find("li");i<0?i=n.length-1:i>n.length-1&&(i=0),this._selectedResultIndex=i,n.removeClass("selected");let s=n.eq(this._selectedResultIndex);s.addClass("selected");let o=s.outerHeight(!0)*this._selectedResultIndex;this._$searchResultsList.scrollTop(o)}_search(e){this._results=[],this._clearResults(),this._showResults(),this._$searchResultsList.append('<li class="loading"></li>'),this._updateListPosition();let i=this;this._autoCompleteFunc(e,n=>{i._listResults(n)})}_clearResults(){this._$searchResultsList.empty()}_hideResults(){this._$searchResultsList.hide()}_showResults(){this._selectedResultIndex=-1,this._$searchResultsList.show()}_updateListPosition(){this._positionAbove?this._$searchResultsList.css({top:this._$searchResultsList.outerHeight(!0)*-1}):this._$searchResultsList.css({top:this._$element.outerHeight(!0)})}_listResults(e){if(this._results=this._parseResultsFunc(e),this._clearResults(),!this._results.length){this._hideResults();return}for(let s=0;s<this._results.length;s++){let o=this._results[s],a=this._$searchResultTemplate.clone();a.find("a").text(o),this._$searchResultsList.append(a)}this._updateListPosition();let i=this;this._$searchResultsList.find("li").each((s,o)=>{Ce(o).on("click",function(a){a.preventDefault(),i._searchForItem(Ce(this))})})}_searchForItem(e){let i=e.find("a").text();this._$element.val(i),this._hideResults(),this._onSelect(i),this._clearResults(),this._hideResults()}_getSelectedListItem(){return this._$searchResultsList.find("li.selected")}};var oe=Se(),xt=class extends Qe{constructor(e){super(e);this.placemarkerTouched=!1}create(){this.setConfig("searchFooterPanel"),super.create(),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,()=>{this.canvasIndexChanged(),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton()}),this.extensionHost.subscribe(b.CLEAR_ANNOTATIONS,()=>{this.clearSearchResults()}),this.extensionHost.subscribe(B.MODE_CHANGE,()=>{this.settingsChanged()}),this.extensionHost.subscribe(B.SEARCH,s=>{this.terms=s}),this.extensionHost.subscribe(b.ANNOTATIONS,s=>{s.annotations.length&&(this.displaySearchResults(s.annotations,s.terms),this.setCurrentSearchResultPlacemarker(),this.updatePrevButton(),this.updateNextButton())}),this.extensionHost.subscribe(b.ANNOTATIONS_EMPTY,()=>{this.hideSearchSpinner()}),this.extensionHost.subscribe(b.ANNOTATION_CHANGE,()=>{this.updatePrevButton(),this.updateNextButton()}),this.$printButton=oe(`
          <button class="print btn imageBtn" title="${this.content.print}" tabindex="0">
            <i class="uv-icon uv-icon-print" aria-hidden="true"></i>${this.content.print}
          </button>
        `),this.$options.prepend(this.$printButton),this.$searchContainer=oe('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=oe('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=oe('<label class="label" for="searchWithinInput">'+this.content.searchWithin+"</label>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=oe('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=oe('<input class="searchText" id="searchWithinInput" autocomplete="off" type="text" maxlength="100" value="'+this.content.enterKeyword+'" aria-label="'+this.content.searchWithin+'"/>'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=oe('<button class="imageButton searchButton"></button>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=oe('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=oe('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=oe('<button class="previousResult">'+this.content.previousResult+"</button>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=oe(`<div class="searchResultsInfo"><span class="info"><span class="number">x</span> <span class="foundFor"></span> '<span class="terms">y</span>'</span></div>`),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=oe('<button class="clearSearch">'+this.content.clearSearch+"</button>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=oe('<button class="nextResult">'+this.content.nextResult+"</button>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=oe('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=oe('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=oe('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=oe('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=oe('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=oe('<div role="heading" class="heading"></div>'),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=oe("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var e=this;this.$searchButton.on("click",s=>{s.preventDefault(),this.search(this.$searchText.val())}),this.$searchText.on("focus",()=>{this.$searchText.val()===this.content.enterKeyword&&this.$searchText.val("")}),this.$placemarkerDetails.on("mouseover",()=>{e.extensionHost.publish(B.SEARCH_PREVIEW_START,this.currentPlacemarkerIndex)}),this.$placemarkerDetails.on("mouseleave",function(){oe(this).hide(),e.extensionHost.publish(B.SEARCH_PREVIEW_FINISH);var s=e.getSearchResultPlacemarkers();s.removeClass("hover")}),this.onAccessibleClick(this.$placemarkerDetails,()=>{e.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex)}),this.$previousResultButton.on("click",s=>{s.preventDefault(),this.isPreviousButtonEnabled()&&e.extensionHost.publish(B.PREV_SEARCH_RESULT)}),this.$nextResultButton.on("click",s=>{s.preventDefault(),this.isNextButtonEnabled()&&e.extensionHost.publish(B.NEXT_SEARCH_RESULT)}),this.$clearSearchResultsButton.on("click",s=>{s.preventDefault(),e.extensionHost.publish(b.CLEAR_ANNOTATIONS)}),this.isSearchEnabled()||(this.$searchContainer.hide(),this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min")),this.extension.helper.getTotalCanvases()===1&&this.$searchResultsContainer.hide();let i=this.extension.getAutoCompleteUri();i?new We(this.$searchText,(s,o)=>{fetch(ue.format(i,s)).then(a=>a.json()).then(a=>{o(a)})},s=>oe.map(s.terms,o=>o.match),s=>{this.search(s)},300,2,!0,ie.getBool(this.options.autocompleteAllowWords,!1)):this.$searchText.on("keyup",s=>{s.keyCode===Te.Enter&&e.search(e.$searchText.val())}),this.$printButton.onPressed(()=>{e.extensionHost.publish(B.PRINT)}),this.updatePrintButton();var n=ie.getBool(this.config.options.positionMarkerEnabled,!0);n||(this.$pagePositionMarker.hide(),this.$pagePositionLabel.hide())}isSearchEnabled(){return this.extension.isSearchEnabled()}isZoomToSearchResultEnabled(){return ie.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}isPreviousButtonEnabled(){let e=this.extension.helper.canvasIndex,i=this.getFirstSearchResultCanvasIndex(),n=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?e<i?!1:!(e===i&&n===0):e>i}isNextButtonEnabled(){let e=this.extension.helper.canvasIndex,i=this.getLastSearchResultCanvasIndex(),n=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?e>i?!1:!(e===i&&n===this.getLastSearchResultRectIndex()):e<i}getSearchResults(){return this.extension.annotations}getCurrentSearchResultRectIndex(){return this.extension.getCurrentAnnotationRectIndex()}getFirstSearchResultCanvasIndex(){let e=this.getSearchResults();return!e||!e.length?-1:e[0].canvasIndex}getLastSearchResultCanvasIndex(){let e=this.getSearchResults();return!e||!e.length?-1:e[e.length-1].canvasIndex}getLastSearchResultRectIndex(){return this.extension.getLastAnnotationRectIndex()}updateNextButton(){let e=this.getSearchResults();e&&e.length&&(this.isNextButtonEnabled()?this.$nextResultButton.removeClass("disabled"):this.$nextResultButton.addClass("disabled"))}updatePrevButton(){let e=this.getSearchResults();e&&e.length&&(this.isPreviousButtonEnabled()?this.$previousResultButton.removeClass("disabled"):this.$previousResultButton.addClass("disabled"))}updatePrintButton(){ie.getBool(this.options.printEnabled,!1)?this.$printButton.show():this.$printButton.hide()}search(e){if(this.terms=e,this.terms===""||this.terms===this.content.enterKeyword){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue,function(){this.$searchText.focus()});return}this.$searchText.blur(),this.showSearchSpinner(),this.extensionHost.publish(B.SEARCH,this.terms)}getSearchResultPlacemarkers(){return this.$searchResultsContainer.find(".searchResultPlacemarker")}setCurrentSearchResultPlacemarker(){this.getSearchResultPlacemarkers().parent().find(".current").removeClass("current"),oe('.searchResultPlacemarker[data-index="'+this.extension.helper.canvasIndex+'"]').addClass("current")}positionSearchResultPlacemarkers(){let e=this.getSearchResults();if(!e||!e.length)return;let i=this.getSearchResultPlacemarkers(),n=i.length===0;i.remove();let s=this.getPageLineRatio(),o=this.$line.position().top,a=this.$line.position().left,r=this;for(let c=0;c<e.length;c++){let u=e[c],g=u.canvasIndex*s,m=oe('<div class="searchResultPlacemarker" tabindex="0" data-index="'+u.canvasIndex+'"></div>');m[0].ontouchstart=function(E){r.onPlacemarkerTouchStart.call(this,r)},m.click(function(E){r.onPlacemarkerClick.call(this,r)}),m.mouseenter(function(E){r.onPlacemarkerMouseEnter.call(this,r)}),this.onAccessibleClick(m,E=>{r.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.currentPlacemarkerIndex),r.onPlacemarkerMouseLeave.call(this,E,r)},!1),m.mouseleave(function(E){r.onPlacemarkerMouseLeave.call(this,E,r)}),m.blur(function(E){r.onPlacemarkerMouseLeave.call(this,E,r)}),this.$searchResultsContainer.append(m);let x=o-m.height(),S=a+g-m.width()/2;m.css({top:x,left:S}),c===0&&n&&m.focus()}}onPlacemarkerTouchStart(e){e.placemarkerTouched=!0}onPlacemarkerClick(e){e.placemarkerTouched||(e.placemarkerTouched=!1)}onPlacemarkerMouseEnter(e){if(e.placemarkerTouched)return;let i=oe(this);i.addClass("hover");let n=parseInt(i.attr("data-index"));e.extensionHost.publish(B.SEARCH_PREVIEW_START,n);let o=e.getSearchResultPlacemarkers().index(i[0]);e.currentPlacemarkerIndex=n,e.$placemarkerDetails.show();let a="{0} {1}";if(e.isPageModeEnabled()){let m=e.extension.helper.getCanvasByIndex(n),x=Re.getValue(m.getLabel());!x&&this.extension.helper.manifest&&(x=this.extension.helper.manifest.options.defaultLabel),x&&(a=ue.format(a,e.content.pageCaps,x))}else a=ue.format(a,e.content.imageCaps,String(n+1));e.$placemarkerDetailsTop.html(a);let r=e.getSearchResults();if(r){let m=r[o],x="";e.terms&&(x=ue.ellipsis(e.terms,e.options.elideDetailsTermsCount));let S=e.content.instanceFound,E=e.content.instancesFound,H="";m.rects.length===1?(H=ue.format(S,x),e.$placemarkerDetailsBottom.html(H)):(H=ue.format(E,String(m.rects.length),x),e.$placemarkerDetailsBottom.html(H))}let c=i.position(),u=c.top-e.$placemarkerDetails.height(),g=c.left;g<e.$placemarkerDetails.width()/2?g=0-i.width()/2:g>e.$line.width()-e.$placemarkerDetails.width()/2?g=e.$line.width()-e.$placemarkerDetails.width()+i.width()/2:g-=e.$placemarkerDetails.width()/2,e.$placemarkerDetails.css({top:u,left:g})}onPlacemarkerMouseLeave(e,i){i.extensionHost.publish(B.SEARCH_PREVIEW_FINISH);let n=oe(this),s=e.toElement||e.relatedTarget,o=oe(s).closest(i.$placemarkerDetails).length;s!=i.$placemarkerDetails.get(0)&&o===0&&(i.$placemarkerDetails.hide(),n.removeClass("hover"))}setPageMarkerPosition(){if(this.extension.helper.canvasIndex===null)return;let e=this.getPageLineRatio(),i=this.$line.position().top,n=this.$line.position().left,s=this.extension.helper.canvasIndex*e,o=i,a=n+s;this.$pagePositionMarker.css({top:o,left:a});let r=this.$line.width();a+this.$pagePositionLabel.outerWidth(!0)>r?(a-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:o,left:a})}clearSearchResults(){if(!this.isSearchEnabled())return;this.getSearchResultPlacemarkers().remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus()}getPageLineRatio(){let e=this.$line.width();return this.extension.helper.getTotalCanvases()===1?0:e/(this.extension.helper.getTotalCanvases()-1)}canvasIndexChanged(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()}settingsChanged(){this.setPlacemarkerLabel()}setPlacemarkerLabel(){let e=this.content.displaying,i=this.extension.helper.canvasIndex;if(this.isPageModeEnabled()){let n=this.extension.helper.getCanvasByIndex(i),s=Re.getValue(n.getLabel());s||(s=this.content.defaultLabel);let o=this.extension.helper.getLastCanvasLabel(!0);o&&this.$pagePositionLabel.html(ue.format(e,this.content.page,Oe(s),Oe(o)))}else this.$pagePositionLabel.html(ue.format(e,this.content.image,String(i+1),this.extension.helper.getTotalCanvases().toString()))}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===ye.page.toString()&&!ie.getBool(this.config.options.forceImageMode,!1)}showSearchSpinner(){this.$searchText.addClass("searching")}hideSearchSpinner(){this.$searchText.removeClass("searching")}displaySearchResults(e,i){if(!this.isSearchEnabled())return;this.hideSearchSpinner(),this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});let n=this.$searchResultsInfo.find(".info"),s=n.find(".number"),o=n.find(".foundFor"),a=n.find(".terms");i?(n.show(),s.text(this.extension.getTotalAnnotationRects()),e.length===1?o.html(this.content.resultFoundFor):o.html(this.content.resultsFoundFor),a.html(ue.ellipsis(i,this.options.elideResultsTermsCount)),a.prop("title",i)):n.hide(),this.$searchPagerContainer.show(),this.resize()}resize(){super.resize();let e=this.getSearchResults();e&&e.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());let i=this.$element.width()/2;this.$searchPagerControls.css({left:i-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:i-this.$searchOptions.outerWidth()/2})}};var Xt=Se(),yt=class extends Xe{constructor(e){super(e)}create(){this.setConfig("multiSelectDialogue"),super.create();let e=this;this.openCommand=b.SHOW_MULTISELECT_DIALOGUE,this.closeCommand=b.HIDE_MULTISELECT_DIALOGUE,this.extensionHost.subscribe(this.openCommand,()=>{this.open(),this.extension.helper.getMultiSelectState().setEnabled(!0),this.galleryComponent.set(this.data)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close(),this.extension.helper.getMultiSelectState().setEnabled(!1)}),this.$title=Xt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$title.text(this.content.title),this.$gallery=Xt('<div class="iiif-gallery-component"></div>'),this.$content.append(this.$gallery),this.data={helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:4,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),searchResults:[],scrollStopDuration:100,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.extension.helper.getViewingDirection()},this.galleryComponent=new Ft({target:this.$gallery[0]}),this.$gallery.find("a.select").addClass("btn btn-primary"),this.galleryComponent.on("multiSelectionMade",n=>{this.extensionHost.publish(b.MULTISELECTION_MADE,n),e.close()},!1),this.$element.hide()}isPageModeEnabled(){return ie.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===ye.page.toString()}open(){super.open()}close(){super.close()}resize(){super.resize();let e=this.$gallery.find(".main"),i=this.$gallery.find(".header");e.height(this.$content.height()-this.$title.outerHeight()-this.$title.verticalMargins()-i.height())}};var Et=class{};var me=Fe(dt());var pe=Se(),Tt=class extends Gt{constructor(e){super(e);this.firstButtonEnabled=!1;this.lastButtonEnabled=!1;this.nextButtonEnabled=!1;this.prevButtonEnabled=!1}create(){if(this.setConfig("pagingHeaderPanel"),super.create(),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,i=>{this.canvasIndexChanged(i)}),this.extensionHost.subscribe(b.SETTINGS_CHANGE,()=>{this.modeChanged(),this.updatePagingToggle()}),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE_FAILED,()=>{this.setSearchFieldValue(this.extension.helper.canvasIndex)}),this.extensionHost.subscribe(b.LEFTPANEL_EXPAND_FULL_START,()=>{this.openGallery()}),this.extensionHost.subscribe(b.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.closeGallery()}),this.$prevOptions=pe('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=pe(`
          <button class="btn imageBtn first" tabindex="0" title="${this.content.first}">
            <i class="uv-icon-first" aria-hidden="true"></i>
            <span class="sr-only">${this.content.first}</span>
          </button>
        `),this.$prevOptions.append(this.$firstButton),this.$prevButton=pe(`
          <button class="btn imageBtn prev" tabindex="0" title="${this.content.previous}">
            <i class="uv-icon-prev" aria-hidden="true"></i>
            <span class="sr-only">${this.content.previous}</span>
          </button>
        `),this.$prevOptions.append(this.$prevButton),this.$modeOptions=pe('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=pe('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=pe('<input type="radio" id="image" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=pe('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=pe('<input type="radio" id="page" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=pe('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=pe('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),ie.getBool(this.options.autoCompleteBoxEnabled,!0))this.$searchText.hide(),this.$autoCompleteBox=pe('<input class="autocompleteText" type="text" maxlength="100" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$autoCompleteBox),new We(this.$autoCompleteBox,(i,n)=>{let s=[],o=this.extension.helper.getCanvases();if(this.isPageModeEnabled())for(let a=0;a<o.length;a++){let r=o[a],c=Re.getValue(r.getLabel());c&&c.startsWith(i)&&s.push(c)}else for(let a=0;a<o.length;a++){let r=o[a];r.index.toString().startsWith(i)&&s.push(r.index.toString())}n(s)},i=>i,i=>{this.search(i)},300,0,ie.getBool(this.options.autocompleteAllowWords,!1));else if(ie.getBool(this.options.imageSelectionBoxEnabled,!0)){this.$selectionBoxOptions=pe('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=pe('<select class="image-selectionbox" name="image-select" tabindex="0" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(let i=0;i<this.extension.helper.getTotalCanvases();i++){let n=this.extension.helper.getCanvasByIndex(i),s=Oe(Re.getValue(n.getLabel(),this.extension.helper.options.locale));this.$imageSelectionBox.append("<option value="+i+">"+s+"</option>")}this.$imageSelectionBox.change(()=>{let i=parseInt(this.$imageSelectionBox.val());this.extensionHost.publish(B.IMAGE_SEARCH,i)})}this.$total=pe('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=pe(`<a class="go btn btn-primary" tabindex="0">${this.content.go}</a>`),this.$search.append(this.$searchButton),this.$nextOptions=pe('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=pe(`
          <button class="btn imageBtn next" tabindex="0" title="${this.content.next}">
            <i class="uv-icon-next" aria-hidden="true"></i>
            <span class="sr-only">${this.content.next}</span>
          </button>
        `),this.$nextOptions.append(this.$nextButton),this.$lastButton=pe(`
          <button class="btn imageBtn last" tabindex="0" title="${this.content.last}">
            <i class="uv-icon-last" aria-hidden="true"></i>
            <span class="sr-only">${this.content.last}</span>
          </button>
        `),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.extension.helper.getManifestType()===Ve.MANUSCRIPT?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$galleryButton=pe(`
          <button class="btn imageBtn gallery" title="${this.content.gallery}">
            <i class="uv-icon-gallery" aria-hidden="true"></i>
            <span class="sr-only">${this.content.gallery}</span>
          </button>
        `),this.$rightOptions.prepend(this.$galleryButton),this.$pagingToggleButtons=pe('<div class="pagingToggleButtons"></div>'),this.$rightOptions.prepend(this.$pagingToggleButtons),this.$oneUpButton=pe(`
          <button class="btn imageBtn one-up" title="${this.content.oneUp}">
            <i class="uv-icon-one-up" aria-hidden="true"></i>
            <span class="sr-only">${this.content.oneUp}</span>
          </button>`),this.$pagingToggleButtons.append(this.$oneUpButton),this.$twoUpButton=pe(`
          <button class="btn imageBtn two-up" title="${this.content.twoUp}">
            <i class="uv-icon-two-up" aria-hidden="true"></i>
            <span class="sr-only">${this.content.twoUp}</span>
          </button>
        `),this.$pagingToggleButtons.append(this.$twoUpButton),this.updatePagingToggle(),this.updateGalleryButton(),this.$oneUpButton.onPressed(()=>{let i=!1;this.updateSettings({pagingEnabled:i}),this.extensionHost.publish(B.PAGING_TOGGLED,i)}),this.$twoUpButton.onPressed(()=>{let i=!0;this.updateSettings({pagingEnabled:i}),this.extensionHost.publish(B.PAGING_TOGGLED,i)}),this.$galleryButton.onPressed(()=>{this.extensionHost.publish(b.TOGGLE_EXPAND_LEFT_PANEL)}),this.setNavigationTitles(),this.setTotal();let e=this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT;this.extension.helper.getTotalCanvases()===1&&this.$centerOptions.hide(),this.$firstButton.onPressed(()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(b.FIRST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(b.LAST);break}}),this.$prevButton.onPressed(()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(b.PREV);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(b.NEXT);break}}),this.$nextButton.onPressed(()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.BOTTOM_TO_TOP:case me.ViewingDirection.TOP_TO_BOTTOM:this.extensionHost.publish(b.NEXT);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(b.PREV);break}}),this.$lastButton.onPressed(()=>{switch(e.toString()){case me.ViewingDirection.LEFT_TO_RIGHT:case me.ViewingDirection.TOP_TO_BOTTOM:case me.ViewingDirection.BOTTOM_TO_TOP:this.extensionHost.publish(b.LAST);break;case me.ViewingDirection.RIGHT_TO_LEFT:this.extensionHost.publish(b.FIRST);break}}),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",()=>{this.extensionHost.publish(B.MODE_CHANGE,ye.image.toString())}),this.$pageModeOption.on("click",()=>{this.extensionHost.publish(B.MODE_CHANGE,ye.page.toString())})):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter(()=>{this.$searchText.blur(),this.search(this.$searchText.val())}),this.$searchText.click(function(){pe(this).select()}),this.$searchButton.onPressed(()=>{this.options.autoCompleteBoxEnabled?this.search(this.$autoCompleteBox.val()):this.search(this.$searchText.val())}),this.options.modeOptionsEnabled===!1&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$search.hide(),this.options.helpEnabled===!1&&this.$helpButton.hide(),ie.getBool(this.options.pagingToggleEnabled,!0)||this.$pagingToggleButtons.hide()}openGallery(){this.$oneUpButton.removeClass("on"),this.$twoUpButton.removeClass("on"),this.$galleryButton.addClass("on")}closeGallery(){this.updatePagingToggle(),this.$galleryButton.removeClass("on")}isPageModeEnabled(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===ye.page.toString()}setNavigationTitles(){this.isPageModeEnabled()?this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastPage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextPage),this.$prevButton.find("span").text(this.content.nextPage),this.$nextButton.prop("title",this.content.previousPage),this.$nextButton.find("span").text(this.content.previousPage),this.$lastButton.prop("title",this.content.firstPage),this.$lastButton.find("span").text(this.content.firstPage)):(this.$firstButton.prop("title",this.content.firstPage),this.$firstButton.find("span").text(this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$prevButton.find("span").text(this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$nextButton.find("span").text(this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage),this.$lastButton.find("span").text(this.content.lastPage)):this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastImage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextImage),this.$prevButton.find("span").text(this.content.nextImage),this.$nextButton.prop("title",this.content.previousImage),this.$nextButton.find("span").text(this.content.previousImage),this.$lastButton.prop("title",this.content.firstImage),this.$lastButton.find("span").text(this.content.firstImage)):(this.$firstButton.prop("title",this.content.firstImage),this.$firstButton.find("span").text(this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$prevButton.find("span").text(this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$nextButton.find("span").text(this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage),this.$lastButton.find("span").text(this.content.lastImage))}updatePagingToggle(){if(!this.pagingToggleIsVisible()){this.$pagingToggleButtons.hide();return}this.extension.isPagingSettingEnabled()?(this.$oneUpButton.removeClass("on"),this.$twoUpButton.addClass("on")):(this.$twoUpButton.removeClass("on"),this.$oneUpButton.addClass("on"))}pagingToggleIsVisible(){return ie.getBool(this.options.pagingToggleEnabled,!0)&&this.extension.helper.isPagingAvailable()}updateGalleryButton(){this.galleryIsVisible()||this.$galleryButton.hide()}galleryIsVisible(){return ie.getBool(this.options.galleryButtonEnabled,!0)&&this.extension.isLeftPanelEnabled()}setTotal(){let e=this.content.of;this.isPageModeEnabled()?this.$total.html(ue.format(e,this.extension.helper.getLastCanvasLabel(!0))):this.$total.html(ue.format(e,this.extension.helper.getTotalCanvases().toString()))}setSearchFieldValue(e){let i=this.extension.helper.getCanvasByIndex(e),n=null;if(this.isPageModeEnabled()){let s=Re.getValue(i.getLabel());s==="-"?n="":n=s}else e+=1,n=e.toString();this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(n):this.$searchText.val(n)}search(e){if(!e){this.extension.showMessage(this.content.emptyValue),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE_FAILED);return}if(this.isPageModeEnabled())this.extensionHost.publish(B.PAGE_SEARCH,e);else{let i;if(this.options.autoCompleteBoxEnabled?i=parseInt(this.$autoCompleteBox.val(),10):i=parseInt(this.$searchText.val(),10),i-=1,isNaN(i)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE_FAILED);return}if(!this.extension.helper.getCanvasByIndex(i)){this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE_FAILED);return}this.extensionHost.publish(B.IMAGE_SEARCH,i)}}canvasIndexChanged(e){this.setSearchFieldValue(e),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$imageSelectionBox.val(e),(this.extension.helper.getViewingDirection()||me.ViewingDirection.LEFT_TO_RIGHT)===me.ViewingDirection.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()),this.extension.helper.isLastCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton())):(this.extension.helper.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.extension.helper.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()))}disableFirstButton(){this.firstButtonEnabled=!1,this.$firstButton.disable()}enableFirstButton(){this.firstButtonEnabled=!0,this.$firstButton.enable()}disableLastButton(){this.lastButtonEnabled=!1,this.$lastButton.disable()}enableLastButton(){this.lastButtonEnabled=!0,this.$lastButton.enable()}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.disable()}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.enable()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.disable()}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.enable()}modeChanged(){this.setSearchFieldValue(this.extension.helper.canvasIndex),this.setNavigationTitles(),this.setTotal()}resize(){super.resize(),this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.hide(),this.galleryIsVisible()&&this.$galleryButton.hide()):(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.show(),this.galleryIsVisible()&&this.$galleryButton.show())}};var Qt;(function(t){t.BOOKMARKING="oa:bookmarking",t.CLASSIFYING="oa:classifying",t.COMMENTING="oa:commenting",t.DESCRIBING="oa:describing",t.EDITING="oa:editing",t.HIGHLIGHTING="oa:highlighting",t.IDENTIFYING="oa:identifying",t.LINKING="oa:linking",t.MODERATING="oa:moderating",t.PAINTING="sc:painting",t.QUESTIONING="oa:questioning",t.REPLYING="oa:replying",t.TAGGING="oa:tagging",t.TRANSCRIBING="oad:transcribing"})(Qt||(Qt={}));var Kt;(function(t){t.AUTO_ADVANCE="auto-advance",t.CONTINUOUS="continuous",t.FACING_PAGES="facing-pages",t.HIDDEN="hidden",t.INDIVIDUALS="individuals",t.MULTI_PART="multi-part",t.NO_NAV="no-nav",t.NON_PAGED="non-paged",t.PAGED="paged",t.REPEAT="repeat",t.SEQUENCE="sequence",t.THUMBNAIL_NAV="thumbnail-nav",t.TOGETHER="together",t.UNORDERED="unordered"})(Kt||(Kt={}));var Yt;(function(t){t.CANVAS="canvas",t.CHOICE="choice",t.OA_CHOICE="oa:choice",t.CONTENT_AS_TEXT="contentastext",t.DATASET="dataset",t.DOCUMENT="document",t.IMAGE="image",t.MODEL="model",t.MOVING_IMAGE="movingimage",t.PDF="pdf",t.PHYSICAL_OBJECT="physicalobject",t.SOUND="sound",t.TEXT="text",t.TEXTUALBODY="textualbody",t.VIDEO="video"})(Yt||(Yt={}));var $t;(function(t){t.ANNOTATION="annotation",t.CANVAS="canvas",t.COLLECTION="collection",t.MANIFEST="manifest",t.RANGE="range",t.SEQUENCE="sequence"})($t||($t={}));var ei;(function(t){t.AUDIO_MP4="audio/mp4",t.CORTO="application/corto",t.DICOM="application/dicom",t.DRACO="application/draco",t.EPUB="application/epub+zip",t.GIRDER="image/vnd.kitware.girder",t.GLB="model/gltf-binary",t.GLTF="model/gltf+json",t.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',t.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',t.JPG="image/jpeg",t.M3U8="application/vnd.apple.mpegurl",t.MP3="audio/mp3",t.MPEG_DASH="application/dash+xml",t.OBJ="text/plain",t.OPF="application/oebps-package+xml",t.PDF="application/pdf",t.PLY="application/ply",t.THREEJS="application/vnd.threejs+json",t.USDZ="model/vnd.usd+zip",t.VIDEO_MP4="video/mp4",t.WEBM="video/webm"})(ei||(ei={}));var ti;(function(t){t.DOC="application/msword",t.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",t.PDF="application/pdf"})(ti||(ti={}));var ii;(function(t){t.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",t.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",t.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",t.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",t.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",t.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",t.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",t.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",t.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",t.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",t.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",t.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",t.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",t.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",t.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",t.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",t.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",t.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",t.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",t.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",t.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",t.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",t.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",t.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",t.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",t.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",t.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",t.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",t.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",t.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",t.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",t.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",t.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",t.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",t.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",t.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",t.SEARCH_0="http://iiif.io/api/search/0/search",t.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",t.SEARCH_1="http://iiif.io/api/search/1/search",t.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",t.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",t.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",t.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",t.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",t.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",t.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"})(ii||(ii={}));var ve;(function(t){t.BOTTOM_TO_TOP="bottom-to-top",t.LEFT_TO_RIGHT="left-to-right",t.RIGHT_TO_LEFT="right-to-left",t.TOP_TO_BOTTOM="top-to-bottom"})(ve||(ve={}));var ni;(function(t){t.CONTINUOUS="continuous",t.INDIVIDUALS="individuals",t.NON_PAGED="non-paged",t.PAGED="paged",t.TOP="top"})(ni||(ni={}));var Ie=Fe(Ke()),Sn=Fe(si()),oi=Fe(dt());var _e=Se(),St=class extends Lt{constructor(e){super(e);this.controlsVisible=!1;this.isCreated=!1;this.isLoaded=!1;this.isFirstLoad=!0;this.navigatedFromSearch=!1;this.nextButtonEnabled=!1;this.prevButtonEnabled=!1}create(){this.setConfig("openSeadragonCenterPanel"),super.create(),this.viewerId="osd"+new Date().getTime(),this.$viewer=_e('<div id="'+this.viewerId+'" class="viewer"></div>'),this.$content.prepend(this.$viewer),this.extensionHost.subscribe(b.ANNOTATIONS,e=>{this.overlayAnnotations()}),this.extensionHost.subscribe(b.SETTINGS_CHANGE,e=>{this.viewer.gestureSettingsMouse.clickToZoom=e.clickToZoomEnabled}),this.extensionHost.subscribe(b.OPEN_EXTERNAL_RESOURCE,e=>{this.whenResized(async()=>{this.isCreated||this.createUI(),this.isLoaded=!1,await this.openMedia(e),this.isLoaded=!0,this.extensionHost.publish(ze.EXTERNAL_RESOURCE_OPENED),this.extensionHost.publish(ze.LOAD)})}),this.extensionHost.subscribe(b.CLEAR_ANNOTATIONS,()=>{this.whenCreated(()=>{this.extension.currentAnnotationRect=null,this.clearAnnotations()})}),this.extensionHost.subscribe(B.NEXT_SEARCH_RESULT,()=>{this.whenCreated(()=>{this.nextAnnotation()})}),this.extensionHost.subscribe(B.PREV_SEARCH_RESULT,()=>{this.whenCreated(()=>{this.prevAnnotation()})}),this.extensionHost.subscribe(B.ZOOM_IN,()=>{this.whenCreated(()=>{this.zoomIn()})}),this.extensionHost.subscribe(B.ZOOM_OUT,()=>{this.whenCreated(()=>{this.zoomOut()})}),this.extensionHost.subscribe(B.ROTATE,()=>{this.whenCreated(()=>{this.rotateRight()})}),this.extensionHost.subscribe(b.METRIC_CHANGE,()=>{this.whenCreated(()=>{this.updateResponsiveView()})}),this.extensionHost.subscribe(b.SET_TARGET,e=>{this.whenLoaded(()=>{this.fitToBounds(e,!1)})}),this.extensionHost.subscribe(b.SET_ROTATION,e=>{this.whenLoaded(()=>{this.viewer.viewport.setRotation(e)})})}whenCreated(e){ke.waitFor(()=>this.isCreated,e)}whenLoaded(e){ke.waitFor(()=>this.isLoaded,e)}zoomIn(){this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(!0)*2)}zoomOut(){this.viewer.viewport.zoomTo(this.viewer.viewport.getZoom(!0)*.5)}rotateRight(){this.viewer.viewport.setRotation(this.viewer.viewport.getRotation()+90)}updateResponsiveView(){this.setNavigatorVisible(),this.extension.isDesktopMetric()?this.viewer.autoHideControls=!0:this.viewer.autoHideControls=!1}async createUI(){this.$spinner=_e('<div class="spinner"></div>'),this.$content.append(this.$spinner);let e="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";this.viewer=(0,Ie.default)({element:this.$viewer[0],crossOriginPolicy:"Anonymous",showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:ie.getBool(this.config.options.showHomeControl,!1),showFullPageControl:!1,defaultZoomLevel:this.config.options.defaultZoomLevel||0,maxZoomPixelRatio:this.config.options.maxZoomPixelRatio||2,controlsFadeDelay:this.config.options.controlsFadeDelay||250,controlsFadeLength:this.config.options.controlsFadeLength||250,navigatorPosition:this.config.options.navigatorPosition||"BOTTOM_RIGHT",navigatorHeight:"100px",navigatorWidth:"100px",animationTime:this.config.options.animationTime||1.2,visibilityRatio:this.config.options.visibilityRatio||.5,constrainDuringPan:ie.getBool(this.config.options.constrainDuringPan,!1),immediateRender:ie.getBool(this.config.options.immediateRender,!1),blendTime:this.config.options.blendTime||0,autoHideControls:ie.getBool(this.config.options.autoHideControls,!0),prefixUrl:null,gestureSettingsMouse:{clickToZoom:ie.getBool(this.extension.data.config.options.clickToZoomEnabled,!0)},navImages:{zoomIn:{REST:e,GROUP:e,HOVER:e,DOWN:e},zoomOut:{REST:e,GROUP:e,HOVER:e,DOWN:e},home:{REST:e,GROUP:e,HOVER:e,DOWN:e},rotateright:{REST:e,GROUP:e,HOVER:e,DOWN:e},rotateleft:{REST:e,GROUP:e,HOVER:e,DOWN:e},next:{REST:e,GROUP:e,HOVER:e,DOWN:e},previous:{REST:e,GROUP:e,HOVER:e,DOWN:e}}});let i=this,n=Nt(s=>{let o=i.extension.helper.getCurrentCanvas();var a=i.viewer.viewport.pointFromPixel(s.position),r=i.viewer.viewport.viewportToImageCoordinates(a.x,a.y);this.extensionHost.publish(B.DOUBLECLICK,{target:`${o.id}#xywh=${Math.round(r.x)},${Math.round(r.y)},1,1`})},100);this.viewer.addViewerInputHook({hooks:[{tracker:"viewer",handler:"dblClickHandler",hookHandler:s=>{let o=this.extension.getSettings(),a=this.extension.helper.isPagingAvailable();(a&&!o.pagingEnabled||!a)&&this.config.options.doubleClickAnnotationEnabled&&n(s)}}]}),this.$zoomInButton=this.$viewer.find('div[title="Zoom in"]'),this.$zoomInButton.attr("tabindex",0),this.$zoomInButton.prop("title",this.content.zoomIn),this.$zoomInButton.prop("aria-label",this.content.zoomIn),this.$zoomInButton.addClass("zoomIn viewportNavButton"),this.$zoomOutButton=this.$viewer.find('div[title="Zoom out"]'),this.$zoomOutButton.attr("tabindex",0),this.$zoomOutButton.prop("title",this.content.zoomOut),this.$zoomOutButton.prop("aria-label",this.content.zoomOut),this.$zoomOutButton.addClass("zoomOut viewportNavButton"),this.$goHomeButton=this.$viewer.find('div[title="Go home"]'),this.$goHomeButton.attr("tabindex",0),this.$goHomeButton.prop("title",this.content.goHome),this.$goHomeButton.prop("aria-label",this.content.goHome),this.$goHomeButton.addClass("goHome viewportNavButton"),this.$rotateButton=this.$viewer.find('div[title="Rotate right"]'),this.$rotateButton.attr("tabindex",0),this.$rotateButton.prop("title",this.content.rotateRight),this.$rotateButton.prop("aria-label",this.content.rotateRight),this.$rotateButton.addClass("rotate viewportNavButton"),this.$viewportNavButtonsContainer=this.$viewer.find(".openseadragon-container > div:not(.openseadragon-canvas):first"),this.$viewportNavButtons=this.$viewportNavButtonsContainer.find(".viewportNavButton"),this.$canvas=_e(this.viewer.canvas),this.$canvas.on("contextmenu",()=>!1),this.$navigator=this.$viewer.find(".navigator"),this.setNavigatorVisible(),this.$element.on("mousemove",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}),this.$element.on("mouseleave",()=>{!this.controlsVisible||(this.controlsVisible=!1,this.viewer.setControlsEnabled(!1))}),this.$element.on("mousemove",()=>{if(!this.$prevButton.ismouseover()&&!this.$nextButton.ismouseover()&&!this.$viewer.find(".navigator").ismouseover()){if(!this.controlsVisible)return;this.controlsVisible=!1,this.viewer.setControlsEnabled(!1)}},this.config.options.controlsFadeAfterInactive),this.viewer.addHandler("tile-drawn",()=>{this.$spinner.hide()}),this.viewer.addHandler("resize",s=>{this.extensionHost.publish(B.OPENSEADRAGON_RESIZE,s),this.viewerResize(s)}),this.viewer.addHandler("animation-start",s=>{this.extensionHost.publish(B.OPENSEADRAGON_ANIMATION_START,s)}),this.viewer.addHandler("animation",s=>{this.extensionHost.publish(B.OPENSEADRAGON_ANIMATION,s)}),this.viewer.addHandler("animation-finish",s=>{this.currentBounds=this.getViewportBounds(),this.updateVisibleAnnotationRects(),this.extensionHost.publish(B.OPENSEADRAGON_ANIMATION_FINISH,s)}),this.viewer.addHandler("rotate",s=>{this.extensionHost.publish(B.OPENSEADRAGON_ROTATION,s.degrees)}),this.title=this.extension.helper.getLabel(),this.createNavigationButtons(),this.hidePrevButton(),this.hideNextButton(),this.isCreated=!0}createNavigationButtons(){let e=this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT;switch(this.$prevButton=_e('<div class="paging btn prev" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$prevButton.prop("title",this.content.next):this.$prevButton.prop("title",this.content.previous),this.$nextButton=_e('<div class="paging btn next" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$nextButton.prop("title",this.content.previous):this.$nextButton.prop("title",this.content.next),this.viewer.addControl(this.$prevButton[0],{anchor:Ie.default.ControlAnchor.TOP_LEFT}),this.viewer.addControl(this.$nextButton[0],{anchor:Ie.default.ControlAnchor.TOP_RIGHT}),e){case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.$prevButton.addClass("vertical"),this.$nextButton.addClass("vertical");break}let i=this;this.onAccessibleClick(this.$prevButton,n=>{if(n.preventDefault(),Ie.default.cancelEvent(n),!!i.prevButtonEnabled)switch(e){case ve.LEFT_TO_RIGHT:case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.extensionHost.publish(b.PREV);break;case ve.RIGHT_TO_LEFT:this.extensionHost.publish(b.NEXT);break}}),this.onAccessibleClick(this.$nextButton,n=>{if(n.preventDefault(),Ie.default.cancelEvent(n),!!i.nextButtonEnabled)switch(e){case ve.LEFT_TO_RIGHT:case ve.BOTTOM_TO_TOP:case ve.TOP_TO_BOTTOM:this.extensionHost.publish(b.NEXT);break;case ve.RIGHT_TO_LEFT:this.extensionHost.publish(b.PREV);break}}),this.$prevButton.on("focus",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))}),this.$nextButton.on("focus",()=>{this.controlsVisible||(this.controlsVisible=!0,this.viewer.setControlsEnabled(!0))})}async getGirderTileSource(){return new Promise(e=>{let n=this.extension.helper.getCurrentCanvas().getContent();if(n.length){let o=n[0].getBody();if(o.length){let a=o[0].getServices();if(a.length){let r=a[0].id,c=r;c.endsWith("/")||(c+="/"),c+="tiles",r.endsWith("/")&&(r=r.substr(0,r.length-1)),fetch(c).then(u=>u.json()).then(u=>{let g={height:u.sizeY,width:u.sizeX,tileWidth:u.tileWidth,tileHeight:u.tileHeight,minLevel:0,maxLevel:u.levels-1,units:"mm",spacing:[u.mm_x,u.mm_y],getTileUrl:function(m,x,S,E){var H=c+"/zxy/"+m+"/"+x+"/"+S;return E&&(H+="?"+_e.param(E)),H}};u.mm_x||(g.units="pixels",g.spacing=[1,1]),e(g)})}}}})}async openMedia(e){if(!this.viewer)return;this.$spinner.show(),this.items=[];let i=await this.extension.getExternalResources(e),n=this.extension.format===oi.MediaType.GIRDER;try{this.viewer.close(),i=this.getPagePositions(i);for(let s=0;s<i.length;s++){let o=i[s],a;o.hasServiceDescriptor?a=o:n?a=await this.getGirderTileSource():a={type:"image",url:o.id,buildPyramid:!1},this.viewer.addTiledImage({tileSource:a,x:o.x,y:o.y,width:o.width,success:r=>{this.items.push(r),this.items.length===i.length&&this.openPagesHandler(),this.resize(),this.goHome()}})}}catch{}}getPagePositions(e){let i,n,s,o,a,r;if(e.length>1)if(e.length===2)this.extension.helper.isVerticallyAligned()?(s=e[0],s.y=0,o=e[1],o.y=s.height+this.config.options.pageGap):(i=e[0],i.x=0,n=e[1],n.x=i.width+this.config.options.pageGap);else if(this.extension.helper.isVerticallyAligned())if(this.extension.helper.isTopToBottom())for(let c=0;c<e.length-1;c++)a=e[c],r=e[c+1],r.y=(a.y||0)+a.height;else for(let c=e.length;c>0;c--)a=e[c],r=e[c-1],r.y=(a.y||0)-a.height;else if(this.extension.helper.isLeftToRight())for(let c=0;c<e.length-1;c++)a=e[c],r=e[c+1],r.x=(a.x||0)+a.width;else for(let c=e.length-1;c>0;c--)a=e[c],r=e[c-1],r.x=(a.x||0)-a.width;return e}openPagesHandler(){this.extensionHost.publish(B.OPENSEADRAGON_OPEN),this.extension.helper.isMultiCanvas()&&!this.extension.helper.isContinuous()&&(this.showPrevButton(),this.showNextButton(),_e(".navigator").addClass("extraMargin"),(this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT)===ve.RIGHT_TO_LEFT?(this.extension.helper.isFirstCanvas()?this.disableNextButton():this.enableNextButton(),this.extension.helper.isLastCanvas()?this.disablePrevButton():this.enablePrevButton()):(this.extension.helper.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.extension.helper.isLastCanvas()?this.disableNextButton():this.enableNextButton())),this.setNavigatorVisible(),this.overlayAnnotations(),this.updateBounds(),this.navigatedFromSearch&&(this.navigatedFromSearch=!1,this.zoomToInitialAnnotation()),this.isFirstLoad=!1}zoomToInitialAnnotation(){let e=this.getInitialAnnotationRect();this.extension.previousAnnotationRect=null,this.extension.currentAnnotationRect=null,e&&this.isZoomToSearchResultEnabled()&&this.zoomToAnnotation(e)}overlayAnnotations(){let e=this.getAnnotationsForCurrentImages();this.clearAnnotations();for(let i=0;i<e.length;i++){let n=e[i],s=this.getAnnotationOverlayRects(n);for(let o=0;o<s.length;o++){let a=s[o],r=document.createElement("DIV");if(r.id="annotation-"+a.canvasIndex+"-"+a.resultIndex,r.title=Oe(a.chars),a.width===1&&a.height===1){r.className="annotationPin",r.onclick=u=>{u.preventDefault(),this.extensionHost.publish(b.PINPOINT_ANNOTATION_CLICKED,o)};let c=document.createElement("SPAN");c.innerText=String(o+1),r.appendChild(c)}else r.className="annotationRect";this.viewer.addOverlay(r,a)}}}updateBounds(){let e=this.extension.getSettings();if(this.isFirstLoad){this.initialRotation=this.extension.data.rotation,this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation));let i=this.extension.data.xywh;i&&(this.initialBounds=be.fromString(i),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds))}else e.preserveViewport&&this.currentBounds?this.fitToBounds(this.currentBounds):this.goHome()}goHome(){this.viewer.viewport.goHome(!0)}disablePrevButton(){this.prevButtonEnabled=!1,this.$prevButton.addClass("disabled")}enablePrevButton(){this.prevButtonEnabled=!0,this.$prevButton.removeClass("disabled")}hidePrevButton(){this.disablePrevButton(),this.$prevButton.hide()}showPrevButton(){this.enablePrevButton(),this.$prevButton.show()}disableNextButton(){this.nextButtonEnabled=!1,this.$nextButton.addClass("disabled")}enableNextButton(){this.nextButtonEnabled=!0,this.$nextButton.removeClass("disabled")}hideNextButton(){this.disableNextButton(),this.$nextButton.hide()}showNextButton(){this.enableNextButton(),this.$nextButton.show()}fitToBounds(e,i=!0){let n=new Ie.default.Rect;n.x=Number(e.x),n.y=Number(e.y),n.width=Number(e.w),n.height=Number(e.h),setTimeout(()=>{this.viewer.viewport.fitBoundsWithConstraints(n,i)},100)}getCroppedImageBounds(){if(!this.viewer||!this.viewer.viewport)return null;let e=this.extension.helper.getCurrentCanvas(),i=this.extension.getCroppedImageDimensions(e,this.viewer);return i?new be(i.regionPos.x,i.regionPos.y,i.region.width,i.region.height).toString():null}getViewportBounds(){if(!this.viewer||!this.viewer.viewport)return null;let e=this.viewer.viewport.getBounds(!0);return new be(Math.floor(e.x),Math.floor(e.y),Math.floor(e.width),Math.floor(e.height))}viewerResize(e){if(!e.viewport)return;let i=e.viewport.getCenter(!0);!i||setTimeout(function(){e.viewport.panTo(i,!0)},1)}clearAnnotations(){this.viewer.clearOverlays()}getAnnotationsForCurrentImages(){let e=[],i=this.extension.annotations;if(!i||!i.length)return e;let n=this.extension.getPagedIndices();for(let s=0;s<n.length;s++){let o=n[s];for(let a=0;a<i.length;a++)if(i[a].canvasIndex===o){e.push(i[a]);break}}return e}getAnnotationRectsForCurrentImages(){let e=this.getAnnotationsForCurrentImages();return e.length?e.map(i=>i.rects).reduce((i,n)=>i.concat(n)):[]}updateVisibleAnnotationRects(){let e=this.getAnnotationRectsForCurrentImages();for(let i=0;i<e.length;i++){let n=e[i],s=this.viewer.viewport.getBounds();n.isVisible=Ht.hitRect(s.x,s.y,s.width,s.height,n.viewportX,n.viewportY)}}getAnnotationRectIndex(e){return this.getAnnotationRectsForCurrentImages().indexOf(e)}isZoomToSearchResultEnabled(){return ie.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)}prevAnnotation(){let e=this.getAnnotationRectsForCurrentImages(),i=this.extension.currentAnnotationRect,n=i?this.getAnnotationRectIndex(i):e.length,s=null;for(let o=n-1;o>=0;o--){s=e[o];break}s&&this.isZoomToSearchResultEnabled()?s.canvasIndex<this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=s,this.navigatedFromSearch=!0,this.extensionHost.publish(b.ANNOTATION_CANVAS_CHANGE,[s])):this.zoomToAnnotation(s):(this.navigatedFromSearch=!0,this.extensionHost.publish(B.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE))}nextAnnotation(){let e=this.getAnnotationRectsForCurrentImages(),i=this.extension.currentAnnotationRect,n=i?this.getAnnotationRectIndex(i):-1,s=null;for(let o=n+1;o<e.length;o++){s=e[o];break}s&&this.isZoomToSearchResultEnabled()?s.canvasIndex>this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=s,this.navigatedFromSearch=!0,this.extensionHost.publish(b.ANNOTATION_CANVAS_CHANGE,[s])):this.zoomToAnnotation(s):(this.navigatedFromSearch=!0,this.extensionHost.publish(B.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE))}getAnnotationRectByIndex(e){let i=this.getAnnotationRectsForCurrentImages();return i.length?i[e]:null}getInitialAnnotationRect(){let e=this.getAnnotationRectsForCurrentImages();if(!e.length)return null;if(!this.extension.previousAnnotationRect&&this.extension.lastCanvasIndex>this.extension.helper.canvasIndex){let n=e.filter(s=>s.canvasIndex===this.extension.helper.canvasIndex);return n[n.length-1]}return e.filter(n=>n.canvasIndex===this.extension.helper.canvasIndex)[0]}zoomToAnnotation(e){if(this.extension.previousAnnotationRect=this.extension.currentAnnotationRect||e,this.extension.currentAnnotationRect=e,ie.getBool(this.extension.data.config.options.zoomToBoundsEnabled,!1))this.fitToBounds(new be(e.viewportX,e.viewportY,e.width,e.height),!1);else if(this.currentBounds){let i=e.viewportX-(this.currentBounds.w*.5-e.width*.5),n=e.viewportY-(this.currentBounds.h*.5-e.height*.5),s=this.currentBounds.w,o=this.currentBounds.h,a=new be(i,n,s,o);this.fitToBounds(a)}this.highlightAnnotationRect(e),this.extensionHost.publish(b.ANNOTATION_CHANGE)}highlightAnnotationRect(e){let i=_e("#annotation-"+e.canvasIndex+"-"+e.index);i.addClass("current"),_e(".annotationRect").not(i).removeClass("current")}getAnnotationOverlayRects(e){let i=[];if(!this.extension.resources)return i;let n=this.extension.resources.filter(a=>a.index===e.canvasIndex)[0],s=this.extension.resources.indexOf(n),o=0;s>0&&(o=this.extension.resources[s-1].width);for(let a=0;a<e.rects.length;a++){let r=e.rects[a],c=r.x+o+(s>0?this.config.options.pageGap:0),u=r.y,g=r.width,m=r.height,x=new Ie.default.Rect(c,u,g,m);r.viewportX=c,r.viewportY=u,x.canvasIndex=r.canvasIndex,x.resultIndex=r.index,x.chars=r.chars,i.push(x)}return i}resize(){if(super.resize(),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),!this.isCreated)return;this.title&&this.$title.text(Oe(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2);let e=this.extension.helper.getViewingDirection()||ve.LEFT_TO_RIGHT;if(this.extension.helper.isMultiCanvas()&&this.$prevButton&&this.$nextButton){let i=Math.floor(this.$content.width()/2);switch(e){case ve.BOTTOM_TO_TOP:this.$prevButton.addClass("down"),this.$nextButton.addClass("up"),this.$prevButton.css("left",i-this.$prevButton.outerWidth()/2),this.$prevButton.css("top",this.$content.height()-this.$prevButton.height()),this.$nextButton.css("left",i*-1-this.$nextButton.outerWidth()/2);break;case ve.TOP_TO_BOTTOM:this.$prevButton.css("left",i-this.$prevButton.outerWidth()/2),this.$nextButton.css("left",i*-1-this.$nextButton.outerWidth()/2),this.$nextButton.css("top",this.$content.height()-this.$nextButton.height());break;default:this.$prevButton.css("top",(this.$content.height()-this.$prevButton.height())/2),this.$nextButton.css("top",(this.$content.height()-this.$nextButton.height())/2);break}}setTimeout(()=>{if(this.extension.helper.isContinuous())if(this.extension.helper.isHorizontallyAligned()){let i=this.$viewer.width()-this.$viewer.rightMargin();this.$navigator.width(i)}else this.$navigator.height(this.$viewer.height())},100)}setFocus(){this.$canvas&&!this.$canvas.is(":focus")&&this.extension.data.config.options.allowStealFocus&&this.$canvas.focus()}setNavigatorVisible(){let e=ie.getBool(this.extension.getSettings().navigatorEnabled,!0)&&this.extension.isDesktopMetric();this.viewer&&this.viewer.navigator&&(this.viewer.navigator.setVisible(e),e?this.$navigator.show():this.$navigator.hide())}};var Ee=Se(),Rt=class extends Ut{constructor(e){super(e)}create(){this.setConfig("settingsDialogue"),super.create(),this.$navigatorEnabled=Ee('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=Ee('<input id="navigatorEnabled" type="checkbox" tabindex="0" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=Ee('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=Ee('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=Ee('<input id="pagingEnabled" type="checkbox" tabindex="0" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=Ee('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$clickToZoomEnabled=Ee('<div class="setting clickToZoom"></div>'),this.$scroll.append(this.$clickToZoomEnabled),this.$clickToZoomEnabledCheckbox=Ee('<input id="clickToZoomEnabled" type="checkbox" />'),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox),this.$clickToZoomEnabledLabel=Ee('<label for="clickToZoomEnabled">'+this.content.clickToZoomEnabled+"</label>"),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel),this.$preserveViewport=Ee('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=Ee('<input id="preserveViewport" type="checkbox" tabindex="0" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=Ee('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change(()=>{let e={};this.$navigatorEnabledCheckbox.is(":checked")?e.navigatorEnabled=!0:e.navigatorEnabled=!1,this.updateSettings(e)}),this.$clickToZoomEnabledCheckbox.change(()=>{let e={};this.$clickToZoomEnabledCheckbox.is(":checked")?e.clickToZoomEnabled=!0:e.clickToZoomEnabled=!1,this.updateSettings(e)}),this.$pagingEnabledCheckbox.change(()=>{let e={};this.$pagingEnabledCheckbox.is(":checked")?e.pagingEnabled=!0:e.pagingEnabled=!1,this.updateSettings(e)}),this.$preserveViewportCheckbox.change(()=>{let e={};this.$preserveViewportCheckbox.is(":checked")?e.preserveViewport=!0:e.preserveViewport=!1,this.updateSettings(e)})}open(){super.open();let e=this.getSettings();e.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),e.clickToZoomEnabled?this.$clickToZoomEnabledCheckbox.prop("checked",!0):this.$clickToZoomEnabledCheckbox.removeAttr("checked"),this.extension.helper.isPagingAvailable()?e.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),e.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")}};var Ct=class extends Wt{constructor(e){super(e);this.extensionHost.subscribe(B.OPENSEADRAGON_OPEN,()=>{this.update()}),this.extensionHost.subscribe(B.OPENSEADRAGON_ANIMATION_FINISH,()=>{this.update()})}create(){this.setConfig("shareDialogue"),super.create()}update(){super.update();let e=this.extension.getViewportBounds(),i=this.extension.getViewerRotation();this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,e,i),this.$code.val(this.code)}resize(){super.resize()}};var Ae=Fe(dt());var ci={allowStealFocus:!1,authAPIVersion:1,bookmarkThumbHeight:150,bookmarkThumbWidth:90,dropEnabled:!0,footerPanelEnabled:!0,headerPanelEnabled:!0,leftPanelEnabled:!0,limitLocales:!1,doubleClickAnnotationEnabled:!1,metrics:[{type:"sm",minWidth:0},{type:"md",minWidth:768},{type:"lg",minWidth:1024},{type:"xl",minWidth:1280}],multiSelectionMimeType:"application/zip",navigatorEnabled:!0,openTemplate:"http://universalviewer.io?manifest={0}",overrideFullScreen:!1,pagingEnabled:!0,pagingOptionEnabled:!0,pessimisticAccessControl:!1,preserveViewport:!1,rightPanelEnabled:!0,saveUserSettings:!1,clickToZoomEnabled:!0,searchWithinEnabled:!0,termsOfUseEnabled:!0,theme:"uv-en-GB-theme",tokenStorage:"session",useArrowKeysToNavigate:!1,zoomToSearchResultEnabled:!0,zoomToBoundsEnabled:!0},di={contentLeftPanel:{options:{autoExpandTreeEnabled:!1,autoExpandTreeIfFewerThan:20,branchNodesExpandOnClick:!0,branchNodesSelectable:!1,defaultToTreeEnabled:!1,defaultToTreeIfGreaterThan:0,elideCount:40,expandFullEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,oneColThumbHeight:320,oneColThumbWidth:200,pageModeEnabled:!0,panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!0,tabOrder:"",thumbsCacheInvalidation:{enabled:!0,paramType:"?"},thumbsEnabled:!0,thumbsExtraHeight:8,thumbsImageFadeInDuration:300,thumbsLoadRange:15,treeEnabled:!0,twoColThumbHeight:150,twoColThumbWidth:90},content:{collapse:"Collapse Contents",collapseFull:"Collapse Gallery",date:"date",expand:"Expand Contents",expandFull:"Expand Gallery",index:"Index",manifestRanges:"Manifest Ranges",searchResult:"{0} search result",searchResults:"{0} search results",sortBy:"Sort By:",thumbnails:"Thumbnails",title:"Contents",volume:"volume"}},dialogue:{topCloseButtonEnabled:!1,content:{close:"Close"}},downloadDialogue:{options:{confinedImageSize:1e3,currentViewDisabledPercentage:90,maxImageWidth:5e3,optionsExplanatoryTextEnabled:!1,selectionEnabled:!1},content:{currentViewAsJpg:"Current view {0} x {1}px (jpg)",currentViewAsJpgExplanation:"Opens in a new window",download:"Download",downloadSelection:"Download Selection",downloadSelectionExplanation:"Opens a dialogue to select which pages to download.",editSettings:"Edit Settings",entireDocument:"Entire document ({0})",entireFileAsOriginal:"Entire file",noneAvailable:"No download options are available.",pagingNote:"Please turn off Two Page View for additional options.",preview:"Preview",title:"Download",wholeImageHighRes:"Whole image {0} x {1}px ({2})",wholeImageHighResExplanation:"Opens in a new window.",wholeImagesHighRes:"Whole images ({0})",wholeImagesHighResExplanation:"Opens in two new windows.",wholeImageLowResAsJpg:"Whole image {0} x {1}px (jpg)",wholeImageLowResAsJpgExplanation:"Opens in a new window."}},footerPanel:{options:{autocompleteAllowWords:!1,bookmarkEnabled:!1,downloadEnabled:!0,embedEnabled:!1,feedbackEnabled:!1,fullscreenEnabled:!0,minimiseButtons:!0,moreInfoEnabled:!0,openEnabled:!1,printEnabled:!1,shareEnabled:!0},content:{bookmark:"Add to bookmarks",download:"Download",embed:"Embed",exitFullScreen:"Exit Full Screen",feedback:"Feedback",fullScreen:"Full Screen",moreInfo:"More Information",open:"Open",share:"Share"}},genericDialogue:{content:{emptyValue:"please enter a value.",invalidNumber:"Please enter a valid number.",noMatches:"No matches were found.",ok:"OK",pageNotFound:"This item does not contain a page with the number you entered. Try switching the numbering mode to 'image'.",refresh:"Refresh"}},headerPanel:{options:{centerOptionsEnabled:!0,localeToggleEnabled:!1,settingsButtonEnabled:!0}},helpDialogue:{content:{text:"placeholder text",title:"Help"}},moreInfoRightPanel:{options:{canvasDisplayOrder:"",canvasExclude:"",copyToClipboardEnabled:!1,manifestDisplayOrder:"",manifestExclude:"",panelAnimationDuration:250,panelCollapsedWidth:30,panelExpandedWidth:255,panelOpen:!1,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",showAllLanguages:!1,textLimit:4,textLimitType:"lines"},content:{attribution:"Attribution",canvasHeader:"About the image",collapse:"Collapse Information",collapseFull:"Collapse Gallery",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",expand:"Expand Information",expandFull:"Expand Gallery",holdingText:"Your module goes here!",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",page:"Page",rangeHeader:"About this section",title:"More Information"}},multiSelectDialogue:{options:{galleryThumbChunkedResizingEnabled:!0,galleryThumbChunkedResizingThreshold:400,galleryThumbHeight:320,galleryThumbLoadPadding:3,galleryThumbWidth:200,pageModeEnabled:!0},content:{select:"Download",selectAll:"Select All",title:"Select Pages for Download"}},pagingHeaderPanel:{options:{autoCompleteBoxEnabled:!0,autocompleteAllowWords:!1,galleryButtonEnabled:!0,imageSelectionBoxEnabled:!1,pageModeEnabled:!1,pagingToggleEnabled:!0},content:{close:"Close",emptyValue:"Please enter a value",first:"First",firstImage:"First Image",firstPage:"First Page",folio:"Folio",gallery:"Gallery",go:"Go",help:"Help",image:"Image",last:"Last",lastImage:"Last Image",lastPage:"Last Page",next:"Next",nextImage:"Next Image",nextPage:"Next Page",of:"of {0}",oneUp:"Single page view",page:"Page",pageSearchLabel:"Search by Page Number",previous:"Previous",previousImage:"Previous Image",previousPage:"Previous Page",settings:"Settings",twoUp:"Two page view"}},openSeadragonCenterPanel:{options:{animationTime:.15,autoHideControls:!0,requiredStatementEnabled:!0,blendTime:0,constrainDuringPan:!1,controlsFadeAfterInactive:1500,controlsFadeDelay:250,controlsFadeLength:250,defaultZoomLevel:0,immediateRender:!1,maxZoomPixelRatio:1.25,navigatorPosition:"BOTTOM_RIGHT",pageGap:50,showHomeControl:!1,trimAttributionCount:150,visibilityRatio:.5},content:{attribution:"Attribution",goHome:"Go Home",imageUnavailable:"Image Unavailable",next:"Next",previous:"Previous",rotateRight:"Rotate Right",zoomIn:"Zoom In",zoomOut:"Zoom Out"}},searchFooterPanel:{options:{elideDetailsTermsCount:20,elideResultsTermsCount:10,forceImageMode:!1,pageModeEnabled:!0,positionMarkerEnabled:!0},content:{clearSearch:"Clear",defaultLabel:"-",displaying:"{0} {1} of {2}",enterKeyword:"Enter Keyword",image:"image",imageCaps:"Image",instanceFound:"1 instance of '{0}' found",instancesFound:"{0} instances of '{1}' found",nextResult:"Next Result",page:"page",pageCaps:"Page",previousResult:"Previous Result",print:"Print",resultFoundFor:"result found for",resultsFoundFor:"results found for",searchWithin:"Search within this item:"}},settingsDialogue:{content:{locale:"Locale",navigatorEnabled:"Navigator Enabled",clickToZoomEnabled:"Mouse Click To Zoom",pagingEnabled:"Two Page View",reducedMotion:"Reduce motion (disables animations)",preserveViewport:"Preserve Zoom",title:"Settings",website:"<a href='https://github.com/universalviewer/universalviewer#contributors'>more info</a>"}},shareDialogue:{options:{embedTemplate:'<iframe src="{0}" width="{1}" height="{2}" allowfullscreen frameborder="0"></iframe>',instructionsEnabled:!1,shareFrameEnabled:!0,shareManifestsEnabled:!0},content:{customSize:"custom",embed:"Embed",embedInstructions:"To embed this item in your own website, copy and paste the code below.",height:"Height",iiif:"IIIF Manifest",share:"Share",shareInstructions:"To share this item, copy the URL below.",size:"Size:",width:"Width"}},authDialogue:{content:{cancel:"Cancel",confirm:"Confirm"}},clickThroughDialogue:{content:{viewTerms:"Read Full Terms and Conditions"}},loginDialogue:{content:{login:"Login",logout:"Logout",cancel:"Cancel"}},mobileFooterPanel:{content:{rotateRight:"Rotate Right",moreInfo:"More Information",zoomIn:"Zoom In",zoomOut:"Zoom Out"}},restrictedDialogue:{content:{cancel:"Cancel"}}},pi={label:"English (GB)",locales:[{name:"cy-GB",label:"Cymraeg"},{name:"en-GB",label:"English (GB)"},{name:"fr-FR",label:"Fran\xE7ais (FR)"},{name:"pl-PL",label:"Polski"},{name:"sv-SE",label:"Svenska"}]},gi={authCORSError:"Your browser does not support CORS, please upgrade to view this content.",authorisationFailedMessage:"Your log-in attempt did not appear to be successful. Please try again.",canvasIndexOutOfRange:"Canvas index out of range.",fallbackDegradedLabel:"Login",fallbackDegradedMessage:"Please log in to view this content at full resolution.",forbiddenResourceMessage:"Your current access rights are insufficient to view this image",mediaViewer:"Media Viewer",skipToDownload:"Skip to downloads and alternative formats",termsOfUse:"Terms of Use"},_t={options:ci,modules:di,localisation:pi,content:gi};var ri=class extends Mt{constructor(){super(...arguments);this.currentRotation=0;this.isAnnotating=!1;this.defaultConfig=_t;this.locales={"en-GB":_t,"cy-GB":()=>import("./cy-GB-I34VTGO4.js"),"fr-FR":()=>import("./fr-FR-ZJUT377C.js"),"pl-PL":()=>import("./pl-PL-HBH3J3FL.js"),"sv-SE":()=>import("./sv-SE-FBZMG7HD.js")}}create(){super.create(),this.extensionHost.subscribe(b.METRIC_CHANGE,()=>{if(!this.isDesktopMetric()){let e={};e.pagingEnabled=!1,this.updateSettings(e),this.extensionHost.publish(b.UPDATE_SETTINGS)}}),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,e=>{this.previousAnnotationRect=null,this.currentAnnotationRect=null,this.changeCanvas(e)}),this.extensionHost.subscribe(b.CLEAR_ANNOTATIONS,()=>{this.clearAnnotations(),this.extensionHost.publish(b.ANNOTATIONS_CLEARED),this.fire(b.CLEAR_ANNOTATIONS)}),this.extensionHost.subscribe(b.DOWN_ARROW,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()}),this.extensionHost.subscribe(b.END,()=>{this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())}),this.extensionHost.subscribe(b.FIRST,()=>{this.fire(b.FIRST),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())}),this.extensionHost.subscribe(b.GALLERY_DECREASE_SIZE,()=>{this.fire(b.GALLERY_DECREASE_SIZE)}),this.extensionHost.subscribe(b.GALLERY_INCREASE_SIZE,()=>{this.fire(b.GALLERY_INCREASE_SIZE)}),this.extensionHost.subscribe(b.GALLERY_THUMB_SELECTED,()=>{this.fire(b.GALLERY_THUMB_SELECTED)}),this.extensionHost.subscribe(b.HOME,()=>{this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.helper.getFirstPageIndex())}),this.extensionHost.subscribe(B.IMAGE_SEARCH,e=>{this.fire(B.IMAGE_SEARCH,e),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,e)}),this.extensionHost.subscribe(b.LAST,()=>{this.fire(b.LAST),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.helper.getLastPageIndex())}),this.extensionHost.subscribe(b.LEFT_ARROW,()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.getPrevPageIndex()):this.centerPanel.setFocus()}),this.extensionHost.subscribe(b.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.isDesktopMetric()&&this.shell.$rightPanel.show()}),this.extensionHost.subscribe(b.LEFTPANEL_COLLAPSE_FULL_FINISH,()=>{this.shell.$centerPanel.show(),this.resize()}),this.extensionHost.subscribe(b.LEFTPANEL_EXPAND_FULL_START,()=>{this.shell.$centerPanel.hide(),this.shell.$rightPanel.hide()}),this.extensionHost.subscribe(b.MINUS,()=>{this.centerPanel.setFocus()}),this.extensionHost.subscribe(B.MODE_CHANGE,e=>{this.fire(B.MODE_CHANGE,e),this.mode=new ye(e);let i=this.getSettings();this.extensionHost.publish(b.SETTINGS_CHANGE,i)}),this.extensionHost.subscribe(b.MULTISELECTION_MADE,e=>{let i=new Et;i.manifestUri=this.helper.manifestUri,i.allCanvases=e.length===this.helper.getCanvases().length,i.canvases=e,i.format=this.data.config.options.multiSelectionMimeType,i.sequence=this.helper.getCurrentSequence().id,this.fire(b.MULTISELECTION_MADE,i)}),this.extensionHost.subscribe(b.NEXT,()=>{this.fire(b.NEXT),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.getNextPageIndex())}),this.extensionHost.subscribe(B.NEXT_SEARCH_RESULT,()=>{this.fire(B.NEXT_SEARCH_RESULT)}),this.extensionHost.subscribe(B.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE,()=>{this.fire(B.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.nextSearchResult()}),this.extensionHost.subscribe(B.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE,()=>{this.fire(B.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE),this.prevSearchResult()}),this.extensionHost.subscribe(b.OPEN_THUMBS_VIEW,()=>{this.fire(b.OPEN_THUMBS_VIEW)}),this.extensionHost.subscribe(b.OPEN_TREE_VIEW,()=>{this.fire(b.OPEN_TREE_VIEW)}),this.extensionHost.subscribe(b.PAGE_DOWN,()=>{this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.getNextPageIndex())}),this.extensionHost.subscribe(B.PAGE_SEARCH,e=>{this.fire(B.PAGE_SEARCH,e),this.viewLabel(e)}),this.extensionHost.subscribe(b.PAGE_UP,()=>{this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())}),this.extensionHost.subscribe(B.PAGING_TOGGLED,e=>{this.fire(B.PAGING_TOGGLED,e)}),this.extensionHost.subscribe(b.PLUS,()=>{this.centerPanel.setFocus()}),this.extensionHost.subscribe(b.PREV,()=>{this.fire(b.PREV),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.getPrevPageIndex())}),this.extensionHost.subscribe(B.PREV_SEARCH_RESULT,()=>{this.fire(B.PREV_SEARCH_RESULT)}),this.extensionHost.subscribe(B.PRINT,()=>{this.print()}),this.extensionHost.subscribe(ze.RELOAD,()=>{this.extensionHost.publish(b.CLEAR_ANNOTATIONS)}),this.extensionHost.subscribe(b.RIGHT_ARROW,()=>{this.useArrowKeysToNavigate()?this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.getNextPageIndex()):this.centerPanel.setFocus()}),this.extensionHost.subscribe(B.OPENSEADRAGON_ANIMATION,()=>{this.fire(B.OPENSEADRAGON_ANIMATION)}),this.extensionHost.subscribe(B.OPENSEADRAGON_ROTATION,e=>{this.fire(B.OPENSEADRAGON_ROTATION,e)}),this.extensionHost.subscribe(B.OPENSEADRAGON_ANIMATION_FINISH,e=>{let i=this.centerPanel.getViewportBounds(),n=this.helper.getCurrentCanvas();this.centerPanel&&i&&n&&(this.extensionHost.publish(B.XYWH_CHANGE,i.toString()),this.data.target=n.id+"#xywh="+i.toString(),this.fire(b.TARGET_CHANGE,this.data.target)),this.fire(B.CURRENT_VIEW_URI,{cropUri:this.getCroppedImageUri(n,this.getViewer()),fullUri:this.getConfinedImageUri(n,n.getWidth())})}),this.extensionHost.subscribe(B.OPENSEADRAGON_ANIMATION_START,()=>{this.fire(B.OPENSEADRAGON_ANIMATION_START)}),this.extensionHost.subscribe(B.OPENSEADRAGON_OPEN,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus(),this.fire(B.OPENSEADRAGON_OPEN)}),this.extensionHost.subscribe(B.OPENSEADRAGON_RESIZE,()=>{this.fire(B.OPENSEADRAGON_RESIZE)}),this.extensionHost.subscribe(B.OPENSEADRAGON_ROTATION,e=>{this.data.rotation=e,this.fire(B.OPENSEADRAGON_ROTATION,this.data.rotation),this.currentRotation=e}),this.extensionHost.subscribe(B.SEARCH,e=>{this.fire(B.SEARCH,e),this.search(e)}),this.extensionHost.subscribe(B.SEARCH_PREVIEW_FINISH,()=>{this.fire(B.SEARCH_PREVIEW_FINISH)}),this.extensionHost.subscribe(B.SEARCH_PREVIEW_START,()=>{this.fire(B.SEARCH_PREVIEW_START)}),this.extensionHost.subscribe(b.ANNOTATIONS,e=>{this.fire(b.ANNOTATIONS,e)}),this.extensionHost.subscribe(b.ANNOTATION_CANVAS_CHANGE,e=>{this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,e[0].canvasIndex)}),this.extensionHost.subscribe(b.ANNOTATIONS_EMPTY,()=>{this.fire(b.ANNOTATIONS_EMPTY)}),this.extensionHost.subscribe(b.THUMB_SELECTED,e=>{this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,e.index)}),this.extensionHost.subscribe(b.TREE_NODE_SELECTED,e=>{this.fire(b.TREE_NODE_SELECTED,e.data.path),this.treeNodeSelected(e)}),this.extensionHost.subscribe(b.UP_ARROW,()=>{this.useArrowKeysToNavigate()||this.centerPanel.setFocus()}),this.extensionHost.subscribe(b.UPDATE_SETTINGS,()=>{this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.helper.canvasIndex);let e=this.getSettings();this.extensionHost.publish(b.SETTINGS_CHANGE,e)})}createModules(){super.createModules(),this.isHeaderPanelEnabled()?this.headerPanel=new Tt(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new kt(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new St(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new Vt(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new xt(this.shell.$footerPanel),this.mobileFooterPanel=new wt(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new jt(this.$helpDialogue),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new Zt(this.$moreInfoDialogue),this.$multiSelectDialogue=$('<div class="overlay multiSelect" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$multiSelectDialogue),this.multiSelectDialogue=new yt(this.$multiSelectDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new Ct(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new ft(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new Rt(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new mt(this.$externalContentDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()}render(){super.render(),this.checkForTarget(),this.checkForAnnotations(),this.checkForSearchParam(),this.checkForRotationParam()}checkForTarget(){if(this.data.target){let e=this.data.target.split("#"),i=e[0],n=this.helper.getCanvasIndexById(i);n!==null&&this.helper.canvasIndex!==n&&this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,n);let s=e[1];this.extensionHost.publish(b.SET_TARGET,be.fromString(s))}}checkForAnnotations(){if(this.data.annotations){let e=[],i=this.data.annotations;Array.isArray(i)?e=this.groupWebAnnotationsByTarget(this.data.annotations):i.resources.length&&(e=this.groupOpenAnnotationsByTarget(this.data.annotations),this.extensionHost.publish(b.CLEAR_ANNOTATIONS)),this.annotate(e)}}annotate(e,i){this.annotations=e,this.annotations=e.sort((s,o)=>s.canvasIndex-o.canvasIndex);let n=new qt;n.terms=i,n.annotations=this.annotations,this.extensionHost.publish(b.ANNOTATIONS,n)}groupWebAnnotationsByTarget(e){let i=[];for(let n=0;n<e.length;n++){let s=e[n],o=s.target.match(/(.*)#/)[1],a=this.helper.getCanvasIndexById(o),r=new pt(o);r.canvasIndex=a;let c=i.filter(u=>u.canvasId===r.canvasId)[0];c?c.addRect(s):(r.addRect(s),i.push(r))}return i}groupOpenAnnotationsByTarget(e){let i=[];for(let n=0;n<e.resources.length;n++){let s=e.resources[n],o=s.on.match(/(.*)#/)[1],a=this.helper.getCanvasIndexById(o),r=new pt(o);r.canvasIndex=a;let c=i.filter(u=>u.canvasId===r.canvasId)[0];c?c.addRect(s):(r.addRect(s),i.push(r))}return i.sort((n,s)=>n.canvasIndex-s.canvasIndex),i}checkForSearchParam(){let e=this.data.highlight;e&&(e.replace(/\+/g," ").replace(/"/g,""),this.extensionHost.publish(B.SEARCH,e))}checkForRotationParam(){let e=this.data.rotation;e&&this.extensionHost.publish(b.SET_ROTATION,e)}changeCanvas(e){if(e===-1)return;let i=!1;if(e===this.helper.canvasIndex&&(i=!0),this.helper.isCanvasIndexOutOfRange(e)&&(this.showMessage(this.data.config.content.canvasIndexOutOfRange),e=0),this.isPagingSettingEnabled()&&!i&&this.getPagedIndices(e).includes(this.helper.canvasIndex)){this.viewCanvas(e);return}this.viewCanvas(e)}getViewer(){return this.centerPanel.viewer}getMode(){if(this.mode)return this.mode;switch(this.helper.getManifestType()){case Ve.MONOGRAPH:return ye.page;case Ve.MANUSCRIPT:return ye.page;default:return ye.image}}getViewportBounds(){if(!this.centerPanel)return null;let e=this.centerPanel.getViewportBounds();return e?e.toString():null}getViewerRotation(){return this.centerPanel?this.currentRotation:null}viewRange(e){let i=this.helper.getRangeByPath(e);if(!i)return;let n=i.getCanvasIds()[0],s=this.helper.getCanvasIndexById(n);this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,s),this.extensionHost.publish(b.RANGE_CHANGE,i)}viewLabel(e){if(!e){this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE_FAILED);return}let i=this.helper.getCanvasIndexByLabel(e);i!=-1?this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,i):(this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE_FAILED))}treeNodeSelected(e){let i=e.data;if(!!i.type)switch(i.type){case Ae.IIIFResourceType.MANIFEST:this.viewManifest(i);break;case Ae.IIIFResourceType.COLLECTION:this.viewCollection(i);break;default:this.viewRange(i.path);break}}clearAnnotations(){this.annotations=[],this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.helper.canvasIndex)}prevSearchResult(){let e;if(!!this.annotations)for(let i=this.annotations.length-1;i>=0;i--){let n=this.annotations[i];if(n.canvasIndex<=this.getPrevPageIndex()){e=n,this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,e.canvasIndex);break}}}nextSearchResult(){if(!!this.annotations)for(let e=0;e<this.annotations.length;e++){let i=this.annotations[e];if(i&&i.canvasIndex>=this.getNextPageIndex()){this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,i.canvasIndex);break}}}bookmark(){super.bookmark();let e=this.helper.getCurrentCanvas(),i=new Jt;i.index=this.helper.canvasIndex,i.label=Re.getValue(e.getLabel()),i.path=this.getCroppedImageUri(e,this.getViewer()),i.thumb=e.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth),i.title=this.helper.getLabel(),i.trackingLabel=window.trackingLabel,i.type=Ae.ExternalResourceType.IMAGE,this.fire(b.BOOKMARK,i)}print(){window.print(),this.fire(B.PRINT)}getCroppedImageDimensions(e,i){if(!i||!i.viewport)return null;let n,s;if(e.getWidth()?n=e.getWidth():n=e.externalResource.width,e.getHeight()?s=e.getHeight():s=e.externalResource.height,!n||!s)return null;let o=i.viewport.getBounds(!0),a=new gt,r=Math.floor(o.width),c=Math.floor(o.height),u=Math.floor(o.x),g=Math.floor(o.y);u+r>n?r=n-u:u<0&&(r=r+u),u<0&&(u=0),g+c>s?c=s-g:g<0&&(c=c+g),g<0&&(g=0),r=Math.min(r,n),c=Math.min(c,s);let m=r,x=c,S=e.getMaxDimensions();if(S){if(r>S.width){let E=S.width;c=Math.round(E*(c/r)),r=E}if(c>S.height){let E=S.height;r=Math.round(r/c*E),c=E}}return a.region=new He(m,x),a.regionPos=new Ue(u,g),a.size=new He(r,c),a}getCroppedImageUri(e,i){if(!i||!i.viewport)return null;let n=this.getCroppedImageDimensions(e,i);if(!n)return null;let s=this.getImageBaseUri(e),o=this.getImageId(e);if(!o)return null;let a=n.regionPos.x+","+n.regionPos.y+","+n.region.width+","+n.region.height,r=n.size.width+","+n.size.height,c=this.getViewerRotation();return`${s}/${o}/${a}/${r}/${c}/default.jpg`}getConfinedImageDimensions(e,i){let n=e.getWidth();n||(n=e.externalResource.width);let s=e.getHeight();s||(s=e.externalResource.height);let o=new He(0,0);o.width=i;let a=Bt.normalise(i,0,n);return o.height=Math.floor(s*a),o}getConfinedImageUri(e,i){let n=this.getImageBaseUri(e),s=this.getImageId(e);if(!s)return null;let o="full",a=this.getConfinedImageDimensions(e,i),r=a.width+","+a.height,c=this.getViewerRotation();return`${n}/${s}/${o}/${r}/${c}/default.jpg`}getImageId(e){if(e.externalResource){let i=e.externalResource.data["@id"];if(i)return i.substr(i.lastIndexOf("/")+1)}return null}getImageBaseUri(e){let i=this.getInfoUri(e);return i=i.substr(0,i.lastIndexOf("/")),i.substr(0,i.lastIndexOf("/"))}getInfoUri(e){let i=null,n=e.getImages();if(n&&n.length){let a=n[0].getResource().getServices();for(let r=0;r<a.length;r++){let c=a[r],u=c.id;u.endsWith("/")||(u+="/"),Ge.isImageProfile(c.getProfile())&&(i=u+"info.json")}}else{n=e.getContent();let o=n[0].getBody();if(o.length){let a=o[0].getServices();for(let r=0;r<a.length;r++){let c=a[r],u=c.id;u.endsWith("/")||(u+="/"),Ge.isImageProfile(c.getProfile())&&(i=u+"info.json")}}}return i||(i="lib/imageunavailable.json"),i}getEmbedScript(e,i,n,s,o){let a=this.data.config.uri||"",r=this.getSerializedLocales(),u=`${this.getAppUri()}#?manifest=${this.helper.manifestUri}&c=${this.helper.collectionIndex}&m=${this.helper.manifestIndex}&cv=${this.helper.canvasIndex}&config=${a}&locales=${r}&xywh=${s}&r=${o}`;return ue.format(e,u,i.toString(),n.toString())}getPrevPageIndex(e=this.helper.canvasIndex){let i;if(this.isPagingSettingEnabled()){let n=this.getPagedIndices(e);this.helper.isRightToLeft()?i=n[n.length-1]-1:i=n[0]-1}else i=e-1;return i}isSearchEnabled(){return!(!ie.getBool(this.data.config.options.searchWithinEnabled,!1)||!this.helper.getSearchService())}isPagingSettingEnabled(){return this.helper.isPagingAvailable()?this.getSettings().pagingEnabled:!1}getNextPageIndex(e=this.helper.canvasIndex){let i;if(this.isPagingSettingEnabled()){let n=this.getPagedIndices(e);this.helper.isRightToLeft()?i=n[0]+1:i=n[n.length-1]+1}else i=e+1;return i>this.helper.getTotalCanvases()-1?-1:i}getAutoCompleteService(){let e=this.helper.getSearchService();return e?e.getService(Ae.ServiceProfile.SEARCH_0_AUTO_COMPLETE)||e.getService(Ae.ServiceProfile.SEARCH_1_AUTO_COMPLETE):null}getAutoCompleteUri(){let e=this.getAutoCompleteService();return e?e.id+"?q={0}":null}getSearchServiceUri(){let e=this.helper.getSearchService();if(!e)return null;let i=e.id;return i=i+"?q={0}",i}search(e){if(this.isAnnotating)return;this.isAnnotating=!0,this.annotations=[];let i=this,n=this.getSearchServiceUri();!n||(n=ue.format(n,encodeURIComponent(e)),this.getSearchResults(n,e,this.annotations,s=>{i.isAnnotating=!1,s.length?i.annotate(s,e):i.showMessage(i.data.config.modules.genericDialogue.content.noMatches,()=>{this.extensionHost.publish(b.ANNOTATIONS_EMPTY)})}))}getSearchResults(e,i,n,s){fetch(e).then(o=>o.json()).then(o=>{o.resources&&o.resources.length&&(n=n.concat(this.groupOpenAnnotationsByTarget(o))),o.next?this.getSearchResults(o.next,i,n,s):s(n)})}getAnnotationRects(){return this.annotations.length?this.annotations.map(e=>e.rects).reduce((e,i)=>e.concat(i)):[]}getCurrentAnnotationRectIndex(){let e=this.getAnnotationRects();return this.currentAnnotationRect?e.indexOf(this.currentAnnotationRect):-1}getTotalAnnotationRects(){return this.getAnnotationRects().length}isFirstAnnotationRect(){return this.getCurrentAnnotationRectIndex()===0}getLastAnnotationRectIndex(){return this.getTotalAnnotationRects()-1}getPagedIndices(e=this.helper.canvasIndex){let i=[];return this.helper.isContinuous()?i=$.map(this.helper.getCanvases(),(n,s)=>s):this.isPagingSettingEnabled()?(this.helper.isFirstCanvas(e)||this.helper.isLastCanvas(e)&&this.helper.isTotalCanvasesEven()?i=[e]:e%2?i=[e,e+1]:i=[e-1,e],this.helper.isRightToLeft()&&(i=i.reverse())):i.push(this.helper.canvasIndex),i}};export{ri as default};
/*! @openseadragon-imaging/openseadragon-viewerinputhook 2.2.1 ab9b394 (clean)  @license MIT */
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! License: http://openseadragon.github.io/license/
//! http://openseadragon.github.io
//! openseadragon 2.4.2
