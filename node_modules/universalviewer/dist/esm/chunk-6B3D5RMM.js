import{a as Ee}from"./chunk-GRBPDKZ2.js";import{a as ne,g as _e}from"./chunk-J75QZD36.js";import{a as fe,c as ie,h as ge,i as Q}from"./chunk-26XKPDNT.js";import{b as k,g as te,n as se,p as U}from"./chunk-OEMHC5TT.js";import{a as ee,d as de}from"./chunk-2OYNMPAF.js";import{b as Re,c as Me}from"./chunk-YAXTLTJC.js";var Ce=Re((X,ue)=>{(function(m,v){typeof X=="object"&&typeof ue=="object"?ue.exports=v():typeof define=="function"&&define.amd?define("IIIFTreeComponent",[],v):typeof X=="object"?X.IIIFTreeComponent=v():m.IIIFTreeComponent=v()})(typeof self!="undefined"?self:X,function(){return function(m){var v={};function E(_){if(v[_])return v[_].exports;var u=v[_]={i:_,l:!1,exports:{}};return m[_].call(u.exports,u,u.exports,E),u.l=!0,u.exports}return E.m=m,E.c=v,E.d=function(_,u,d){E.o(_,u)||Object.defineProperty(_,u,{enumerable:!0,get:d})},E.r=function(_){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},E.t=function(_,u){if(1&u&&(_=E(_)),8&u||4&u&&typeof _=="object"&&_&&_.__esModule)return _;var d=Object.create(null);if(E.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:_}),2&u&&typeof _!="string")for(var i in _)E.d(d,i,function(h){return _[h]}.bind(null,i));return d},E.n=function(_){var u=_&&_.__esModule?function(){return _.default}:function(){return _};return E.d(u,"a",u),u},E.o=function(_,u){return Object.prototype.hasOwnProperty.call(_,u)},E.p="",E(E.s=2)}([function(m,v,E){m.exports=function(_){var u={};function d(i){if(u[i])return u[i].exports;var h=u[i]={i,l:!1,exports:{}};return _[i].call(h.exports,h,h.exports,d),h.l=!0,h.exports}return d.m=_,d.c=u,d.d=function(i,h,p){d.o(i,h)||Object.defineProperty(i,h,{enumerable:!0,get:p})},d.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},d.t=function(i,h){if(1&h&&(i=d(i)),8&h||4&h&&typeof i=="object"&&i&&i.__esModule)return i;var p=Object.create(null);if(d.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:i}),2&h&&typeof i!="string")for(var a in i)d.d(p,a,function(l){return i[l]}.bind(null,a));return p},d.n=function(i){var h=i&&i.__esModule?function(){return i.default}:function(){return i};return d.d(h,"a",h),h},d.o=function(i,h){return Object.prototype.hasOwnProperty.call(i,h)},d.p="",d(d.s=4)}([function(_,u,d){"use strict";function i(h){for(var p in h)u.hasOwnProperty(p)||(u[p]=h[p])}Object.defineProperty(u,"__esModule",{value:!0}),i(d(6)),i(d(7)),i(d(8)),i(d(9)),i(d(10)),i(d(11)),i(d(12)),i(d(13)),i(d(14)),i(d(15)),i(d(16)),i(d(17)),i(d(18)),i(d(19)),i(d(20)),i(d(21)),i(d(22)),i(d(23)),i(d(24)),i(d(25)),i(d(26)),i(d(27)),i(d(28)),i(d(29)),i(d(30)),i(d(31)),i(d(32)),i(d(2))},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(i){i.BOOKMARKING="oa:bookmarking",i.CLASSIFYING="oa:classifying",i.COMMENTING="oa:commenting",i.DESCRIBING="oa:describing",i.EDITING="oa:editing",i.HIGHLIGHTING="oa:highlighting",i.IDENTIFYING="oa:identifying",i.LINKING="oa:linking",i.MODERATING="oa:moderating",i.PAINTING="sc:painting",i.QUESTIONING="oa:questioning",i.REPLYING="oa:replying",i.TAGGING="oa:tagging",i.TRANSCRIBING="oad:transcribing"}(u.AnnotationMotivation||(u.AnnotationMotivation={})),function(i){i.AUTO_ADVANCE="auto-advance",i.CONTINUOUS="continuous",i.FACING_PAGES="facing-pages",i.HIDDEN="hidden",i.INDIVIDUALS="individuals",i.MULTI_PART="multi-part",i.NO_NAV="no-nav",i.NON_PAGED="non-paged",i.PAGED="paged",i.REPEAT="repeat",i.SEQUENCE="sequence",i.THUMBNAIL_NAV="thumbnail-nav",i.TOGETHER="together",i.UNORDERED="unordered"}(u.Behavior||(u.Behavior={})),function(i){i.CANVAS="canvas",i.CHOICE="choice",i.CONTENT_AS_TEXT="contentastext",i.DOCUMENT="document",i.IMAGE="image",i.MOVING_IMAGE="movingimage",i.PDF="pdf",i.PHYSICAL_OBJECT="physicalobject",i.SOUND="sound",i.TEXTUALBODY="textualbody",i.VIDEO="video"}(u.ExternalResourceType||(u.ExternalResourceType={})),function(i){i.ANNOTATION="annotation",i.CANVAS="canvas",i.COLLECTION="collection",i.MANIFEST="manifest",i.RANGE="range",i.SEQUENCE="sequence"}(u.IIIFResourceType||(u.IIIFResourceType={})),function(i){i.AUDIO_MP4="audio/mp4",i.CORTO="application/corto",i.DRACO="application/draco",i.GLTF="model/gltf+json",i.JPG="image/jpeg",i.M3U8="application/vnd.apple.mpegurl",i.MP3="audio/mp3",i.MPEG_DASH="application/dash+xml",i.OBJ="text/plain",i.PDF="application/pdf",i.PLY="application/ply",i.THREEJS="application/vnd.threejs+json",i.VIDEO_MP4="video/mp4",i.WEBM="video/webm"}(u.MediaType||(u.MediaType={})),function(i){i.DOC="application/msword",i.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",i.PDF="application/pdf"}(u.RenderingFormat||(u.RenderingFormat={})),function(i){i.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",i.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",i.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",i.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",i.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",i.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",i.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",i.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",i.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",i.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",i.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",i.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",i.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",i.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",i.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",i.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",i.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",i.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",i.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",i.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",i.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",i.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",i.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",i.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",i.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",i.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",i.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",i.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",i.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",i.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",i.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",i.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",i.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",i.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",i.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",i.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",i.SEARCH_0="http://iiif.io/api/search/0/search",i.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",i.SEARCH_1="http://iiif.io/api/search/1/search",i.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",i.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",i.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",i.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",i.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",i.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",i.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(u.ServiceProfile||(u.ServiceProfile={})),function(i){i.BOTTOM_TO_TOP="bottom-to-top",i.LEFT_TO_RIGHT="left-to-right",i.RIGHT_TO_LEFT="right-to-left",i.TOP_TO_BOTTOM="top-to-bottom"}(u.ViewingDirection||(u.ViewingDirection={})),function(i){i.CONTINUOUS="continuous",i.INDIVIDUALS="individuals",i.NON_PAGED="non-paged",i.PAGED="paged",i.TOP="top"}(u.ViewingHint||(u.ViewingHint={}))},function(_,u,d){"use strict";var i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(f,y){function I(L){try{C(r.next(L))}catch(b){y(b)}}function A(L){try{C(r.throw(L))}catch(b){y(b)}}function C(L){var b;L.done?f(L.value):(b=L.value,b instanceof n?b:new n(function(P){P(b)})).then(I,A)}C((r=r.apply(t,e||[])).next())})},h=this&&this.__generator||function(t,e){var n,r,f,y,I={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return y={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function A(C){return function(L){return function(b){if(n)throw new TypeError("Generator is already executing.");for(;I;)try{if(n=1,r&&(f=2&b[0]?r.return:b[0]?r.throw||((f=r.return)&&f.call(r),0):r.next)&&!(f=f.call(r,b[1])).done)return f;switch(r=0,f&&(b=[2&b[0],f.value]),b[0]){case 0:case 1:f=b;break;case 4:return I.label++,{value:b[1],done:!1};case 5:I.label++,r=b[1],b=[0];continue;case 7:b=I.ops.pop(),I.trys.pop();continue;default:if(!(f=(f=I.trys).length>0&&f[f.length-1])&&(b[0]===6||b[0]===2)){I=0;continue}if(b[0]===3&&(!f||b[1]>f[0]&&b[1]<f[3])){I.label=b[1];break}if(b[0]===6&&I.label<f[1]){I.label=f[1],f=b;break}if(f&&I.label<f[2]){I.label=f[2],I.ops.push(b);break}f[2]&&I.ops.pop(),I.trys.pop();continue}b=e.call(t,I)}catch(P){b=[6,P],r=0}finally{n=f=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}([C,L])}}};Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=d(1),l=d(33);d(34);var o=function(){function t(){}return t.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},t.getImageQuality=function(e){return e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_LEVEL_1||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_LEVEL_2||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},t.getInexactLocale=function(e){return e.indexOf("-")!==-1?e.substr(0,e.indexOf("-")):e},t.getLocalisedValue=function(e,n){if(!Array.isArray(e))return e;for(var r=0;r<e.length;r++){var f=e[r];if(n===f["@language"])return f["@value"]}var y=n.substr(0,n.indexOf("-"));for(r=0;r<e.length;r++){var I=e[r];if(I["@language"]===y)return I["@value"]}return null},t.generateTreeNodeIds=function(e,n){var r;n===void 0&&(n=0),r=e.parentNode?e.parentNode.id+"-"+n:"0",e.id=r;for(var f=0;f<e.nodes.length;f++){var y=e.nodes[f];t.generateTreeNodeIds(y,f)}},t.normaliseType=function(e){return(e=e.toLowerCase()).indexOf(":")!==-1?e.split(":")[1]:e},t.normaliseUrl=function(e){return(e=e.substr(e.indexOf("://"))).indexOf("#")!==-1&&(e=e.split("#")[0]),e},t.normalisedUrlsMatch=function(e,n){return t.normaliseUrl(e)===t.normaliseUrl(n)},t.isImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.isLevel0ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},t.isLevel1ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},t.isLevel2ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.parseManifest=function(e,n){return p.Deserialiser.parse(e,n)},t.checkStatus=function(e){if(e.ok)return e;var n=new Error(e.statusText);return n.response=e,Promise.reject(n)},t.loadManifest=function(e){return new Promise(function(n){fetch(e).then(t.checkStatus).then(function(r){return r.json()}).then(function(r){n(r)})})},t.loadExternalResourcesAuth1=function(e,n,r,f,y,I,A,C){return new Promise(function(L,b){var P=e.map(function(w){return t.loadExternalResourceAuth1(w,n,r,f,y,I,A,C)});Promise.all(P).then(function(){L(e)}).catch(function(w){b(w)})})},t.loadExternalResourceAuth1=function(e,n,r,f,y,I,A,C){return i(this,void 0,void 0,function(){var L;return h(this,function(b){switch(b.label){case 0:return[4,f(e)];case 1:return(L=b.sent())?[4,e.getData(L)]:[3,6];case 2:return b.sent(),e.status!==l.OK?[3,3]:[2,e];case 3:return[4,t.doAuthChain(e,n,r,y,I,A,C)];case 4:b.sent(),b.label=5;case 5:if(e.status===l.OK||e.status===l.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError();case 6:return[4,e.getData()];case 7:return b.sent(),e.status!==l.MOVED_TEMPORARILY&&e.status!==l.UNAUTHORIZED?[3,9]:[4,t.doAuthChain(e,n,r,y,I,A,C)];case 8:b.sent(),b.label=9;case 9:if(e.status===l.OK||e.status===l.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError()}})})},t.doAuthChain=function(e,n,r,f,y,I,A){return i(this,void 0,void 0,function(){var C,L,b,P,w,D,F,W;return h(this,function(c){switch(c.label){case 0:return e.isAccessControlled()?((C=e.externalService)&&(C.options=e.options),(L=e.kioskService)&&(L.options=e.options),(b=e.clickThroughService)&&(b.options=e.options),(P=e.loginService)&&(P.options=e.options),e.isResponseHandled||e.status!==l.MOVED_TEMPORARILY?[3,2]:[4,I(e)]):[2,e];case 1:return c.sent(),[2,e];case 2:return w=null,D=null,(w=C)?(D=w,[4,t.attemptResourceWithToken(e,r,w)]):[3,4];case 3:return c.sent(),[2,e];case 4:return(w=L)?(D=w,(F=n(w))?[4,f(F)]:[3,7]):[3,7];case 5:return c.sent(),[4,t.attemptResourceWithToken(e,r,w)];case 6:return c.sent(),[2,e];case 7:return(w=b)?(D=w,[4,y(e,w)]):[3,11];case 8:return(W=c.sent())?[4,f(W)]:[3,11];case 9:return c.sent(),[4,t.attemptResourceWithToken(e,r,w)];case 10:return c.sent(),[2,e];case 11:return(w=P)?(D=w,[4,y(e,w)]):[3,15];case 12:return(W=c.sent())?[4,f(W)]:[3,15];case 13:return c.sent(),[4,t.attemptResourceWithToken(e,r,w)];case 14:return c.sent(),[2,e];case 15:return D&&A(e,D),[2]}})})},t.attemptResourceWithToken=function(e,n,r){return i(this,void 0,void 0,function(){var f,y;return h(this,function(I){switch(I.label){case 0:return(f=r.getService(a.ServiceProfile.AUTH_1_TOKEN))?[4,n(e,f)]:[3,3];case 1:return(y=I.sent())&&y.accessToken?[4,e.getData(y)]:[3,3];case 2:return I.sent(),[2,e];case 3:return[2]}})})},t.loadExternalResourcesAuth09=function(e,n,r,f,y,I,A,C,L,b){return new Promise(function(P,w){var D=e.map(function(F){return t.loadExternalResourceAuth09(F,n,r,f,y,I,A,C,L,b)});Promise.all(D).then(function(){P(e)}).catch(function(F){w(F)})})},t.loadExternalResourceAuth09=function(e,n,r,f,y,I,A,C,L,b){return new Promise(function(P,w){b&&b.pessimisticAccessControl?e.getData().then(function(){e.isAccessControlled()?e.clickThroughService?(P(r(e)),P(f(e))):y(e).then(function(){I(e,!0).then(function(D){e.getData(D).then(function(){P(L(e))}).catch(function(F){w(t.createInternalServerError(F))})}).catch(function(D){w(t.createInternalServerError(D))})}).catch(function(D){w(t.createInternalServerError(D))}):P(e)}).catch(function(D){w(t.createInternalServerError(D))}):C(e,n).then(function(D){D?e.getData(D).then(function(){e.status===l.OK?P(L(e)):t.authorize(e,n,r,f,y,I,A,C).then(function(){P(L(e))}).catch(function(F){w(t.createAuthorizationFailedError())})}).catch(function(F){w(t.createAuthorizationFailedError())}):t.authorize(e,n,r,f,y,I,A,C).then(function(){P(L(e))}).catch(function(F){w(t.createAuthorizationFailedError())})}).catch(function(D){w(t.createAuthorizationFailedError())})})},t.createError=function(e,n){var r=new Error;return r.message=n,r.name=String(e),r},t.createAuthorizationFailedError=function(){return t.createError(p.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},t.createRestrictedError=function(){return t.createError(p.StatusCode.RESTRICTED,"Restricted")},t.createInternalServerError=function(e){return t.createError(p.StatusCode.INTERNAL_SERVER_ERROR,e)},t.authorize=function(e,n,r,f,y,I,A,C){return new Promise(function(L,b){e.getData().then(function(){e.isAccessControlled()?C(e,n).then(function(P){P?e.getData(P).then(function(){e.status===l.OK?L(e):t.showAuthInteraction(e,n,r,f,y,I,A,L,b)}).catch(function(w){b(t.createInternalServerError(w))}):I(e,!1).then(function(w){w?A(e,w,n).then(function(){e.getData(w).then(function(){e.status===l.OK?L(e):t.showAuthInteraction(e,n,r,f,y,I,A,L,b)}).catch(function(D){b(t.createInternalServerError(D))})}).catch(function(D){b(t.createInternalServerError(D))}):t.showAuthInteraction(e,n,r,f,y,I,A,L,b)})}).catch(function(P){b(t.createInternalServerError(P))}):L(e)})})},t.showAuthInteraction=function(e,n,r,f,y,I,A,C,L){e.status!==l.MOVED_TEMPORARILY||e.isResponseHandled?e.clickThroughService&&!e.isResponseHandled?r(e).then(function(){I(e,!0).then(function(b){A(e,b,n).then(function(){e.getData(b).then(function(){C(e)}).catch(function(P){L(t.createInternalServerError(P))})}).catch(function(P){L(t.createInternalServerError(P))})}).catch(function(b){L(t.createInternalServerError(b))})}):y(e).then(function(){I(e,!0).then(function(b){A(e,b,n).then(function(){e.getData(b).then(function(){C(e)}).catch(function(P){L(t.createInternalServerError(P))})}).catch(function(P){L(t.createInternalServerError(P))})}).catch(function(b){L(t.createInternalServerError(b))})}):C(e)},t.getService=function(e,n){for(var r=this.getServices(e),f=0;f<r.length;f++){var y=r[f];if(y.getProfile()===n)return y}return null},t.getResourceById=function(e,n){return t.traverseAndFind(e.__jsonld,"@id",n)},t.traverseAndFind=function(e,n,r){if(e.hasOwnProperty(n)&&e[n]===r)return e;for(var f=0;f<Object.keys(e).length;f++)if(typeof e[Object.keys(e)[f]]=="object"){var y=t.traverseAndFind(e[Object.keys(e)[f]],n,r);if(y!=null)return y}},t.getServices=function(e){var n,r=[];if(!(n=e.__jsonld?e.__jsonld.service:e.service))return r;Array.isArray(n)||(n=[n]);for(var f=0;f<n.length;f++){var y=n[f];if(typeof y=="string"){var I=this.getResourceById(e.options.resource,y);I&&r.push(new p.Service(I.__jsonld||I,e.options))}else r.push(new p.Service(y,e.options))}return r},t.getTemporalComponent=function(e){var n=/t=([^&]+)/g.exec(e),r=null;return n&&n[1]&&(r=n[1].split(",")),r},t}();u.Utils=o},function(_,u,d){"use strict";d.r(u),u.default=function(i,h){return h=h||{},new Promise(function(p,a){var l=new XMLHttpRequest,o=[],t=[],e={},n=function(){return{ok:(l.status/100|0)==2,statusText:l.statusText,status:l.status,url:l.responseURL,text:function(){return Promise.resolve(l.responseText)},json:function(){return Promise.resolve(JSON.parse(l.responseText))},blob:function(){return Promise.resolve(new Blob([l.response]))},clone:n,headers:{keys:function(){return o},entries:function(){return t},get:function(f){return e[f.toLowerCase()]},has:function(f){return f.toLowerCase()in e}}}};for(var r in l.open(h.method||"get",i,!0),l.onload=function(){l.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(f,y,I){o.push(y=y.toLowerCase()),t.push([y,I]),e[y]=e[y]?e[y]+","+I:I}),p(n())},l.onerror=a,l.withCredentials=h.credentials=="include",h.headers)l.setRequestHeader(r,h.headers[r]);l.send(h.body||null)})}},function(_,u,d){_.exports=d(5)},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(h){for(var p in h)u.hasOwnProperty(p)||(u[p]=h[p])}(d(0));var i=d(2);u.loadManifest=function(h){return i.Utils.loadManifest(h)},u.parseManifest=function(h,p){return i.Utils.parseManifest(h,p)}},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var i=function(){function h(p){this.__jsonld=p,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return h.prototype.getProperty=function(p){var a=null;return this.__jsonld&&((a=this.__jsonld[p])||(a=this.__jsonld["@"+p])),a},h}();u.JSONLDResource=i},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=d(1),l=function(o){function t(e,n){var r=o.call(this,e)||this;return r.options=n,r}return h(t,o),t.prototype.getIIIFResourceType=function(){return p.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?p.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDefaultLabel=function(){return p.LanguageMap.getValue(this.getLabel())},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),n=[];if(!e)return n;for(var r=0;r<e.length;r++){var f=e[r],y=new p.LabelValuePair(this.options.locale);y.parse(f),n.push(y)}return n},t.prototype.getRendering=function(e){for(var n=this.getRenderings(),r=0;r<n.length;r++){var f=n[r];if(f.getFormat()===e)return f}return null},t.prototype.getRenderings=function(){var e,n=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return n;Array.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++){var f=e[r];n.push(new p.Rendering(f,this.options))}return n},t.prototype.getService=function(e){return p.Utils.getService(this,e)},t.prototype.getServices=function(){return p.Utils.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new p.Thumbnail(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===a.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===a.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===a.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===a.IIIFResourceType.SEQUENCE},t}(p.JSONLDResource);u.ManifestResource=l},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return h(o,l),o.prototype.getFormat=function(){var t=this.getProperty("format");return t?t.toLowerCase():null},o.prototype.getResources=function(){var t=[];if(!this.__jsonld.resources)return t;for(var e=0;e<this.__jsonld.resources.length;e++){var n=this.__jsonld.resources[e],r=new p.Annotation(n,this.options);t.push(r)}return t},o.prototype.getType=function(){var t=this.getProperty("type");return t?p.Utils.normaliseType(t):null},o.prototype.getWidth=function(){return this.getProperty("width")},o.prototype.getHeight=function(){return this.getProperty("height")},o.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},o.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},o}(p.ManifestResource);u.Resource=a},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=d(1),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;r.index=-1,r.isLoaded=!1;var f={defaultLabel:"-",locale:"en-GB",resource:r,pessimisticAccessControl:!1};return r.options=Object.assign(f,n),r}return h(t,o),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?p.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?p.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getIIIFResourceType=function(){return p.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?typeof e=="string"?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return p.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(a.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new p.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,n=this.getProperty("requiredStatement");if(n)(e=new p.LabelValuePair(this.options.locale)).parse(n);else{var r=this.getAttribution();r&&((e=new p.LabelValuePair(this.options.locale)).value=r)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise(function(n){if(e.isLoaded)n(e);else{var r=e.options;r.navDate=e.getNavDate();var f=e.__jsonld.id;f||(f=e.__jsonld["@id"]),p.Utils.loadManifest(f).then(function(y){e.parentLabel=p.LanguageMap.getValue(e.getLabel(),r.locale);var I=p.Deserialiser.parse(y,r);(e=Object.assign(e,I)).index=r.index,n(e)})}})},t}(p.ManifestResource);u.IIIFResource=l},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return h(o,l),o.prototype.getBody=function(){var t=[],e=this.getProperty("body");if(e)if(Array.isArray(e))for(var n=0;n<e.length;n++)if((y=e[n]).items)for(var r=0;r<y.items.length;r++){var f=y.items[r];t.push(new p.AnnotationBody(f,this.options))}else t.push(new p.AnnotationBody(y,this.options));else if(e.items)for(n=0;n<e.items.length;n++){var y=e.items[n];t.push(new p.AnnotationBody(y,this.options))}else t.push(new p.AnnotationBody(e,this.options));return t},o.prototype.getMotivation=function(){return this.getProperty("motivation")||null},o.prototype.getOn=function(){return this.getProperty("on")},o.prototype.getTarget=function(){return this.getProperty("target")},o.prototype.getResource=function(){return new p.Resource(this.getProperty("resource"),this.options)},o}(p.ManifestResource);u.Annotation=a},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return h(o,l),o.prototype.getFormat=function(){var t=this.getProperty("format");return t?p.Utils.getMediaType(t):null},o.prototype.getType=function(){return this.getProperty("type")?p.Utils.normaliseType(this.getProperty("type")):null},o.prototype.getWidth=function(){return this.getProperty("width")},o.prototype.getHeight=function(){return this.getProperty("height")},o}(p.ManifestResource);u.AnnotationBody=a},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=function(l){function o(t,e,n){var r=l.call(this,e)||this;return r.label=t,r.options=n,r}return h(o,l),o.prototype.getIIIFResourceType=function(){return p.Utils.normaliseType(this.getProperty("type"))},o.prototype.getLabel=function(){return this.label},o.prototype.getResources=function(){var t=this;return this.getProperty("resources").map(function(e){return new p.Annotation(e,t.options)})},o.prototype.load=function(){var t=this;return new Promise(function(e,n){if(t.isLoaded)e(t);else{var r=t.__jsonld.id;r||(r=t.__jsonld["@id"]),p.Utils.loadManifest(r).then(function(f){t.__jsonld=f,t.context=t.getProperty("context"),t.id=t.getProperty("id"),t.isLoaded=!0,e(t)}).catch(n)}})},o}(p.JSONLDResource);u.AnnotationList=a},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(a,l){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(a,l)},function(a,l){function o(){this.constructor=a}i(a,l),a.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)});Object.defineProperty(u,"__esModule",{value:!0});var p=function(a){function l(o,t){return a.call(this,o,t)||this}return h(l,a),l.prototype.getItems=function(){return this.getProperty("items")},l}(d(0).ManifestResource);u.AnnotationPage=p},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return h(o,l),o.prototype.getCanonicalImageUri=function(t){var e,n=null,r="default",f=t;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],f||(f=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(r="native");else{var y=this.getImages();if(y&&y.length){var I=y[0].getResource(),A=I.getServices();if(f||(f=I.getWidth()),A.length){var C=A[0];n=C.id,r=p.Utils.getImageQuality(C.getProfile())}else if(f===I.getWidth())return I.id}if(!n){var L=this.getProperty("thumbnail");if(L){if(typeof L=="string")return L;if(L["@id"])return L["@id"];if(L.length)return L[0].id}}}return e=f+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",e,0,r+".jpg"].join("/")},o.prototype.getMaxDimensions=function(){var t,e=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(t=this.externalResource.data.profile,Array.isArray(t)&&(t=t.filter(function(n){return n.maxWidth})[0])&&(e=new p.Size(t.maxWidth,t.maxHeight?t.maxHeight:t.maxWidth))),e},o.prototype.getContent=function(){var t=[],e=this.__jsonld.items||this.__jsonld.content;if(!e)return t;var n=null;if(e.length&&(n=new p.AnnotationPage(e[0],this.options)),!n)return t;for(var r=n.getItems(),f=0;f<r.length;f++){var y=r[f],I=new p.Annotation(y,this.options);t.push(I)}return t},o.prototype.getDuration=function(){return this.getProperty("duration")},o.prototype.getImages=function(){var t=[];if(!this.__jsonld.images)return t;for(var e=0;e<this.__jsonld.images.length;e++){var n=this.__jsonld.images[e],r=new p.Annotation(n,this.options);t.push(r)}return t},o.prototype.getIndex=function(){return this.getProperty("index")},o.prototype.getOtherContent=function(){var t=this,e=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter(function(n){return n&&typeof(r=n["@type"])=="string"&&r.toLowerCase()==r.toLowerCase();var r}).map(function(n,r){return new p.AnnotationList(n.label||"Annotation list "+r,n,t.options)}).map(function(n){return n.load()});return Promise.all(e)},o.prototype.getWidth=function(){return this.getProperty("width")},o.prototype.getHeight=function(){return this.getProperty("height")},o}(p.Resource);u.Canvas=a},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(1),a=d(0),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;return r.items=[],r._collections=null,r._manifests=null,e.__collection=r,r}return h(t,o),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(e){return e.isCollection()})},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(e){return e.isManifest()})},t.prototype.getCollectionByIndex=function(e){for(var n,r=this.getCollections(),f=0;f<r.length;f++){var y=r[f];y.index===e&&(n=y)}if(n)return n.options.index=e,n.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var n,r=this.getManifests(),f=0;f<r.length;f++){var y=r[f];y.index===e&&(n=y)}if(n)return n.options.index=e,n.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):p.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getDefaultTree=function(){return o.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var n=0;n<e.getManifests().length;n++){var r=e.getManifests()[n],f=r.getDefaultTree();f.label=r.parentLabel||a.LanguageMap.getValue(r.getLabel(),this.options.locale)||"manifest "+(n+1),f.navDate=r.getNavDate(),f.data.id=r.id,f.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),e.defaultTree.addNode(f)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var n=0;n<e.getCollections().length;n++){var r=e.getCollections()[n],f=r.getDefaultTree();f.label=r.parentLabel||a.LanguageMap.getValue(r.getLabel(),this.options.locale)||"collection "+(n+1),f.navDate=r.getNavDate(),f.data.id=r.id,f.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),e.defaultTree.addNode(f)}},t}(a.IIIFResource);u.Collection=l},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var i=function(){function h(p,a){this.start=p,this.end=a}return h.prototype.getLength=function(){return this.end-this.start},h}();u.Duration=i},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var i=d(0),h=function(){function p(a){this.defaultLocale=a}return p.prototype.parse=function(a){this.resource=a,this.label=i.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=i.LanguageMap.parse(this.resource.value,this.defaultLocale)},p.prototype.getLabel=function(){return this.label?i.LanguageMap.getValue(this.label,this.defaultLocale):null},p.prototype.setLabel=function(a){var l=this;if(this.label&&this.label.length){var o=this.label.filter(function(t){return t.locale===l.defaultLocale||t.locale===i.Utils.getInexactLocale(l.defaultLocale)})[0];o&&(o.value=a)}},p.prototype.getValue=function(){if(this.value){var a=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(a=this.label[0].locale),i.LanguageMap.getValue(this.value,a)}return null},p.prototype.setValue=function(a){var l=this;if(this.value&&this.value.length){var o=this.value.filter(function(t){return t.locale===l.defaultLocale||t.locale===i.Utils.getInexactLocale(l.defaultLocale)})[0];o&&(o.value=a)}},p}();u.LabelValuePair=h},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.Language=function(i,h){Array.isArray(i)?i.length===1?this.value=i[0]:this.value=i.join("<br/>"):this.value=i,this.locale=h}},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=function(l){function o(){return l!==null&&l.apply(this,arguments)||this}return h(o,l),o.parse=function(t,e){var n,r=[];if(!t)return r;if(Array.isArray(t))for(var f=0;f<t.length;f++){var y=t[f];n=typeof y=="string"?new p.Language(y,e):new p.Language(y["@value"],y["@language"]||e),r.push(n)}else{if(typeof t=="string")return n=new p.Language(t,e),r.push(n),r;t["@value"]?(n=new p.Language(t["@value"],t["@language"]||e),r.push(n)):Object.keys(t).forEach(function(I){if(!t[I].length)throw new Error("language must have a value");n=new p.Language(t[I],I),r.push(n)})}return r},o.getValue=function(t,e){if(t.length){if(e){var n=t.filter(function(r){return r.locale===e||p.Utils.getInexactLocale(r.locale)===p.Utils.getInexactLocale(e)})[0];if(n)return n.value}return t[0].value}return null},o}(Array);u.LanguageMap=a},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(1),a=d(0),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;if(r.index=0,r._allRanges=null,r.items=[],r._topRanges=[],r.__jsonld.structures&&r.__jsonld.structures.length)for(var f=r._getTopRanges(),y=0;y<f.length;y++){var I=f[y];r._parseRanges(I,String(y))}return r}return h(t,o),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new a.Canvas(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(o.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var e=this.getTopRanges();return e.length&&e[0].getTree(this.defaultTree),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];r.viewingHint===p.ViewingHint.TOP&&e.push(r)}if(!e.length){var f={};f.ranges=this.__jsonld.structures,e.push(f)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];if(r["@id"]===e||r.id===e)return r}return null},t.prototype._parseRanges=function(e,n,r){var f,y=null;if(typeof e=="string"&&(y=e,e=this._getRangeById(y)),e){(f=new a.Range(e,this.options)).parentRange=r,f.path=n,r?r.items.push(f):this._topRanges.push(f);var I=e.items||e.members;if(I)for(var A=0;A<I.length;A++){var C=I[A];if(C["@type"]&&C["@type"].toLowerCase()==="sc:range"||C.type&&C.type.toLowerCase()==="range")this._parseRanges(C,n+"/"+A,f);else if(C["@type"]&&C["@type"].toLowerCase()==="sc:canvas"||C.type&&C.type.toLowerCase()==="canvas"){f.canvases||(f.canvases=[]);var L=C.id||C["@id"];f.canvases.push(L)}}else if(e.ranges)for(A=0;A<e.ranges.length;A++)this._parseRanges(e.ranges[A],n+"/"+A,f)}else console.warn("Range:",y,"does not exist")},t.prototype.getAllRanges=function(){if(this._allRanges!=null)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),n=function(y){var I=e[y];I.id&&r._allRanges.push(I);var A=function(L,b){L.add(b);var P=b.getRanges();return P.length?P.reduce(A,L):L},C=Array.from(I.getRanges().reduce(A,new Set));r._allRanges=r._allRanges.concat(C)},r=this,f=0;f<e.length;f++)n(f);return this._allRanges},t.prototype.getRangeById=function(e){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var f=n[r];if(f.id===e)return f}return null},t.prototype.getRangeByPath=function(e){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var f=n[r];if(f.path===e)return f}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var n=0;n<e.length;n++){var r=e[n],f=new a.Sequence(r,this.options);this.items.push(f)}else this.__jsonld.items&&(f=new a.Sequence(this.__jsonld.items,this.options),this.items.push(f));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(p.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):a.ManifestType.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===p.ViewingHint.PAGED;var n=this.getBehavior();return!!n&&n===p.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(a.IIIFResource);u.Manifest=l},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(i){i.EMPTY="",i.MANUSCRIPT="manuscript",i.MONOGRAPH="monograph"}(u.ManifestType||(u.ManifestType={}))},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=d(1),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;return r._ranges=null,r.canvases=null,r.items=[],r}return h(t,o),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){var e,n;if(this.canvases&&this.canvases.length)for(var r=0;r<this.canvases.length;r++){var f=this.canvases[r],y=p.Utils.getTemporalComponent(f);y&&y.length>1&&(r===0&&(e=Number(y[0])),r===this.canvases.length-1&&(n=Number(y[1])))}else{var I=this.getRanges();for(r=0;r<I.length;r++){var A=I[r].getDuration();A&&(r===0&&(e=A.start),r===I.length-1&&(n=A.end))}}if(e!==void 0&&n!==void 0)return new p.Duration(e,n)},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(e){return e.isRange()})},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var n=this.getRanges();if(n&&n.length)for(var r=0;r<n.length;r++){var f=n[r],y=new p.TreeNode;e.addNode(y),this._parseTreeNode(y,f)}return p.Utils.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var n=this.getDuration();return!!(n&&e>=n.start&&e<=n.end)},t.prototype._parseTreeNode=function(e,n){e.label=p.LanguageMap.getValue(n.getLabel(),this.options.locale),e.data=n,e.data.type=p.Utils.normaliseType(p.TreeNodeType.RANGE),n.treeNode=e;var r=n.getRanges();if(r&&r.length)for(var f=0;f<r.length;f++){var y=r[f];if(y.getBehavior()!==a.Behavior.NO_NAV){var I=new p.TreeNode;e.addNode(I),this._parseTreeNode(I,y)}}},t}(p.ManifestResource);u.Range=l},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(a,l){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(a,l)},function(a,l){function o(){this.constructor=a}i(a,l),a.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)});Object.defineProperty(u,"__esModule",{value:!0});var p=function(a){function l(o,t){return a.call(this,o,t)||this}return h(l,a),l.prototype.getFormat=function(){return this.getProperty("format")},l}(d(0).ManifestResource);u.Rendering=p},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(1),a=d(0),l=function(o){function t(e,n){var r=o.call(this,e,n)||this;return r.items=[],r._thumbnails=null,r}return h(t,o),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var n=0;n<e.length;n++){var r=e[n];(f=new a.Canvas(r,this.options)).index=n,this.items.push(f)}else if(this.__jsonld)for(n=0;n<this.__jsonld.length;n++){var f;r=this.__jsonld[n],(f=new a.Canvas(r,this.options)).index=n,this.items.push(f)}return this.items},t.prototype.getCanvasById=function(e){for(var n=0;n<this.getTotalCanvases();n++){var r=this.getCanvasByIndex(n),f=a.Utils.normaliseUrl(r.id);if(a.Utils.normaliseUrl(e)===f)return r}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===e)return n;return null},t.prototype.getCanvasIndexByLabel=function(e,n){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),n&&(e+="r"));for(var r,f,y,I=/(\d*)\D+(\d*)/,A=0;A<this.getTotalCanvases();A++){var C=this.getCanvasByIndex(A);if(a.LanguageMap.getValue(C.getLabel(),this.options.locale)===e||(r=I.exec(e))&&(f=r[1],(y=r[2])&&new RegExp("^"+f+"\\D+"+y+"$").test(C.getLabel().toString())))return A}return-1},t.prototype.getLastCanvasLabel=function(e){for(var n=this.getTotalCanvases()-1;n>=0;n--){var r=this.getCanvasByIndex(n),f=a.LanguageMap.getValue(r.getLabel(),this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(f))return f}else if(f)return f}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,n){var r;if(n){var f=this.getPagedIndices(e),y=this.getViewingDirection();r=y&&y===p.ViewingDirection.RIGHT_TO_LEFT?f[0]+1:f[f.length-1]+1}else r=e+1;return r>this.getLastPageIndex()?-1:r},t.prototype.getPagedIndices=function(e,n){var r=[];if(n){r=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var f=this.getViewingDirection();f&&f===p.ViewingDirection.RIGHT_TO_LEFT&&(r=r.reverse())}else r.push(e);return r},t.prototype.getPrevPageIndex=function(e,n){var r;if(n){var f=this.getPagedIndices(e),y=this.getViewingDirection();r=y&&y===p.ViewingDirection.RIGHT_TO_LEFT?f[f.length-1]-1:f[0]-1}else r=e-1;return r},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===e)return n}return 0},t.prototype.getThumbs=function(e,n){for(var r=[],f=this.getTotalCanvases(),y=0;y<f;y++){var I=this.getCanvasByIndex(y),A=new a.Thumb(e,I);r.push(A)}return r},t.prototype.getThumbnails=function(){if(this._thumbnails!=null)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),n=0;n<e.length;n++){var r=e[n].getThumbnail();r&&this._thumbnails.push(r)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return e===0},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===p.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(a.ManifestResource);u.Sequence=l},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var i=d(0),h=function(){function p(){}return p.parse=function(a,l){return typeof a=="string"&&(a=JSON.parse(a)),this.parseJson(a,l)},p.parseJson=function(a,l){var o;if(l&&l.navDate&&!isNaN(l.navDate.getTime())&&(a.navDate=l.navDate.toString()),a["@type"])switch(a["@type"]){case"sc:Collection":o=this.parseCollection(a,l);break;case"sc:Manifest":o=this.parseManifest(a,l);break;default:return null}else switch(a.type){case"Collection":o=this.parseCollection(a,l);break;case"Manifest":o=this.parseManifest(a,l);break;default:return null}return o.isLoaded=!0,o},p.parseCollection=function(a,l){var o=new i.Collection(a,l);return l?(o.index=l.index||0,l.resource&&(o.parentCollection=l.resource.parentCollection)):o.index=0,this.parseCollections(o,l),this.parseManifests(o,l),this.parseItems(o,l),o},p.parseCollections=function(a,l){var o;if(a.__jsonld.collections?o=a.__jsonld.collections:a.__jsonld.items&&(o=a.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="collection"})),o)for(var t=0;t<o.length;t++){l&&(l.index=t);var e=this.parseCollection(o[t],l);e.index=t,e.parentCollection=a,a.items.push(e)}},p.parseManifest=function(a,l){return new i.Manifest(a,l)},p.parseManifests=function(a,l){var o;if(a.__jsonld.manifests?o=a.__jsonld.manifests:a.__jsonld.items&&(o=a.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="manifest"})),o)for(var t=0;t<o.length;t++){var e=this.parseManifest(o[t],l);e.index=t,e.parentCollection=a,a.items.push(e)}},p.parseItem=function(a,l){if(a["@type"]){if(a["@type"].toLowerCase()==="sc:manifest")return this.parseManifest(a,l);if(a["@type"].toLowerCase()==="sc:collection")return this.parseCollection(a,l)}else if(a.type){if(a.type.toLowerCase()==="manifest")return this.parseManifest(a,l);if(a.type.toLowerCase()==="collection")return this.parseCollection(a,l)}return null},p.parseItems=function(a,l){var o=a.__jsonld.members||a.__jsonld.items;if(o)for(var t=function(f){l&&(l.index=f);var y=e.parseItem(o[f],l);return y?a.items.filter(function(I){return I.id===y.id})[0]?"continue":(y.index=f,y.parentCollection=a,void a.items.push(y)):{value:void 0}},e=this,n=0;n<o.length;n++){var r=t(n);if(typeof r=="object")return r.value}},p}();u.Deserialiser=h},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(l,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(l,o)},function(l,o){function t(){this.constructor=l}i(l,o),l.prototype=o===null?Object.create(o):(t.prototype=o.prototype,new t)});Object.defineProperty(u,"__esModule",{value:!0});var p=d(0),a=function(l){function o(t,e){return l.call(this,t,e)||this}return h(o,l),o.prototype.getProfile=function(){var t=this.getProperty("profile");return t||(t=this.getProperty("dcterms:conformsTo")),Array.isArray(t)?t[0]:t},o.prototype.getConfirmLabel=function(){return p.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},o.prototype.getDescription=function(){return p.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},o.prototype.getFailureDescription=function(){return p.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},o.prototype.getFailureHeader=function(){return p.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},o.prototype.getHeader=function(){return p.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},o.prototype.getServiceLabel=function(){return p.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},o.prototype.getInfoUri=function(){var t=this.id;return t.endsWith("/")||(t+="/"),t+"info.json"},o}(p.ManifestResource);u.Service=a},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.Size=function(i,h){this.width=i,this.height=h}},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(i){i[i.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",i[i.FORBIDDEN=2]="FORBIDDEN",i[i.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",i[i.RESTRICTED=4]="RESTRICTED"}(u.StatusCode||(u.StatusCode={}))},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var i=d(0);u.Thumb=function(h,p){this.data=p,this.index=p.index,this.width=h;var a=p.getHeight()/p.getWidth();this.height=a?Math.floor(this.width*a):h,this.uri=p.getCanonicalImageUri(h),this.label=i.LanguageMap.getValue(p.getLabel())}},function(_,u,d){"use strict";var i,h=this&&this.__extends||(i=function(a,l){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(a,l)},function(a,l){function o(){this.constructor=a}i(a,l),a.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)});Object.defineProperty(u,"__esModule",{value:!0});var p=function(a){function l(o,t){return a.call(this,o,t)||this}return h(l,a),l}(d(0).Resource);u.Thumbnail=p},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var i=d(0),h=function(){function p(a,l){this.label=a,this.data=l||{},this.nodes=[]}return p.prototype.addNode=function(a){this.nodes.push(a),a.parentNode=this},p.prototype.isCollection=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.COLLECTION)},p.prototype.isManifest=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.MANIFEST)},p.prototype.isRange=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.RANGE)},p}();u.TreeNode=h},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),function(i){i.COLLECTION="collection",i.MANIFEST="manifest",i.RANGE="range"}(u.TreeNodeType||(u.TreeNodeType={}))},function(_,u,d){_.exports=function(i){var h={};function p(a){if(h[a])return h[a].exports;var l=h[a]={i:a,l:!1,exports:{}};return i[a].call(l.exports,l,l.exports,p),l.l=!0,l.exports}return p.m=i,p.c=h,p.d=function(a,l,o){p.o(a,l)||Object.defineProperty(a,l,{enumerable:!0,get:o})},p.r=function(a){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},p.t=function(a,l){if(1&l&&(a=p(a)),8&l||4&l&&typeof a=="object"&&a&&a.__esModule)return a;var o=Object.create(null);if(p.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:a}),2&l&&typeof a!="string")for(var t in a)p.d(o,t,function(e){return a[e]}.bind(null,t));return o},p.n=function(a){var l=a&&a.__esModule?function(){return a.default}:function(){return a};return p.d(l,"a",l),l},p.o=function(a,l){return Object.prototype.hasOwnProperty.call(a,l)},p.p="",p(p.s=0)}([function(i,h,p){i.exports=p(1)},function(i,h,p){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.CONTINUE=100,h.SWITCHING_PROTOCOLS=101,h.PROCESSING=102,h.OK=200,h.CREATED=201,h.ACCEPTED=202,h.NON_AUTHORITATIVE_INFORMATION=203,h.NO_CONTENT=204,h.RESET_CONTENT=205,h.PARTIAL_CONTENT=206,h.MULTI_STATUS=207,h.MULTIPLE_CHOICES=300,h.MOVED_PERMANENTLY=301,h.MOVED_TEMPORARILY=302,h.SEE_OTHER=303,h.NOT_MODIFIED=304,h.USE_PROXY=305,h.TEMPORARY_REDIRECT=307,h.BAD_REQUEST=400,h.UNAUTHORIZED=401,h.PAYMENT_REQUIRED=402,h.FORBIDDEN=403,h.NOT_FOUND=404,h.METHOD_NOT_ALLOWED=405,h.NOT_ACCEPTABLE=406,h.PROXY_AUTHENTICATION_REQUIRED=407,h.REQUEST_TIME_OUT=408,h.CONFLICT=409,h.GONE=410,h.LENGTH_REQUIRED=411,h.PRECONDITION_FAILED=412,h.REQUEST_ENTITY_TOO_LARGE=413,h.REQUEST_URI_TOO_LARGE=414,h.UNSUPPORTED_MEDIA_TYPE=415,h.REQUESTED_RANGE_NOT_SATISFIABLE=416,h.EXPECTATION_FAILED=417,h.IM_A_TEAPOT=418,h.UNPROCESSABLE_ENTITY=422,h.LOCKED=423,h.FAILED_DEPENDENCY=424,h.UNORDERED_COLLECTION=425,h.UPGRADE_REQUIRED=426,h.PRECONDITION_REQUIRED=428,h.TOO_MANY_REQUESTS=429,h.REQUEST_HEADER_FIELDS_TOO_LARGE=431,h.INTERNAL_SERVER_ERROR=500,h.NOT_IMPLEMENTED=501,h.BAD_GATEWAY=502,h.SERVICE_UNAVAILABLE=503,h.GATEWAY_TIME_OUT=504,h.HTTP_VERSION_NOT_SUPPORTED=505,h.VARIANT_ALSO_NEGOTIATES=506,h.INSUFFICIENT_STORAGE=507,h.BANDWIDTH_LIMIT_EXCEEDED=509,h.NOT_EXTENDED=510,h.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(_,u,d){_.exports=window.fetch||(window.fetch=d(3).default||d(3))}])},function(m,v,E){m.exports=function(_){var u={};function d(i){if(u[i])return u[i].exports;var h=u[i]={i,l:!1,exports:{}};return _[i].call(h.exports,h,h.exports,d),h.l=!0,h.exports}return d.m=_,d.c=u,d.d=function(i,h,p){d.o(i,h)||Object.defineProperty(i,h,{enumerable:!0,get:p})},d.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},d.t=function(i,h){if(1&h&&(i=d(i)),8&h||4&h&&typeof i=="object"&&i&&i.__esModule)return i;var p=Object.create(null);if(d.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:i}),2&h&&typeof i!="string")for(var a in i)d.d(p,a,function(l){return i[l]}.bind(null,a));return p},d.n=function(i){var h=i&&i.__esModule?function(){return i.default}:function(){return i};return d.d(h,"a",h),h},d.o=function(i,h){return Object.prototype.hasOwnProperty.call(i,h)},d.p="",d(d.s=0)}([function(_,u,d){_.exports=d(1)},function(_,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.CONTINUE=100,u.SWITCHING_PROTOCOLS=101,u.PROCESSING=102,u.OK=200,u.CREATED=201,u.ACCEPTED=202,u.NON_AUTHORITATIVE_INFORMATION=203,u.NO_CONTENT=204,u.RESET_CONTENT=205,u.PARTIAL_CONTENT=206,u.MULTI_STATUS=207,u.MULTIPLE_CHOICES=300,u.MOVED_PERMANENTLY=301,u.MOVED_TEMPORARILY=302,u.SEE_OTHER=303,u.NOT_MODIFIED=304,u.USE_PROXY=305,u.TEMPORARY_REDIRECT=307,u.BAD_REQUEST=400,u.UNAUTHORIZED=401,u.PAYMENT_REQUIRED=402,u.FORBIDDEN=403,u.NOT_FOUND=404,u.METHOD_NOT_ALLOWED=405,u.NOT_ACCEPTABLE=406,u.PROXY_AUTHENTICATION_REQUIRED=407,u.REQUEST_TIME_OUT=408,u.CONFLICT=409,u.GONE=410,u.LENGTH_REQUIRED=411,u.PRECONDITION_FAILED=412,u.REQUEST_ENTITY_TOO_LARGE=413,u.REQUEST_URI_TOO_LARGE=414,u.UNSUPPORTED_MEDIA_TYPE=415,u.REQUESTED_RANGE_NOT_SATISFIABLE=416,u.EXPECTATION_FAILED=417,u.IM_A_TEAPOT=418,u.UNPROCESSABLE_ENTITY=422,u.LOCKED=423,u.FAILED_DEPENDENCY=424,u.UNORDERED_COLLECTION=425,u.UPGRADE_REQUIRED=426,u.PRECONDITION_REQUIRED=428,u.TOO_MANY_REQUESTS=429,u.REQUEST_HEADER_FIELDS_TOO_LARGE=431,u.INTERNAL_SERVER_ERROR=500,u.NOT_IMPLEMENTED=501,u.BAD_GATEWAY=502,u.SERVICE_UNAVAILABLE=503,u.GATEWAY_TIME_OUT=504,u.HTTP_VERSION_NOT_SUPPORTED=505,u.VARIANT_ALSO_NEGOTIATES=506,u.INSUFFICIENT_STORAGE=507,u.BANDWIDTH_LIMIT_EXCEEDED=509,u.NOT_EXTENDED=510,u.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(m,v,E){m.exports=E(3)},function(m,v,E){"use strict";var _,u=this&&this.__extends||(_=function(a,l){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(a,l)},function(a,l){function o(){this.constructor=a}_(a,l),a.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)});Object.defineProperty(v,"__esModule",{value:!0});var d=E(0),i=E(5),h=function(a){function l(o){var t=a.call(this,o)||this;return t._data=t.data(),t._data=t.options.data,t._init(),t._resize(),t}return u(l,a),l.prototype._init=function(){a.prototype._init.call(this),this._$element=$(this.el);var o=this;return this._$tree=$('<ul class="tree"></ul>'),this._$element.append(this._$tree),$.templates({pageTemplate:"{^{for nodes}}					{^{tree/}}				{{/for}}",treeTemplate:`<li>						{^{if nodes && nodes.length}}							<div class="toggle" data-link="class{merge:expanded toggle='expanded'}"></div>						{{else}}						<div class="spacer"></div>						{{/if}}						{^{if multiSelectEnabled}}							<input id="tree-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? 'checked' : ''}" class="multiSelect" />						{{/if}}						{^{if selected}}							<a id="tree-link-{{>id}}" href="#" title="{{>label}}" class="selected">{{>label}}</a>						{{else}}							<a id="tree-link-{{>id}}" href="#" title="{{>label}}">{{>label}}</a>						{{/if}}				</li>				{^{if expanded}}					<li>							<ul>									{^{for nodes}}										{^{tree/}}									{{/for}}							</ul>					</li>				{{/if}}`}),$.views.tags({tree:{toggleExpanded:function(){var t=this.data;o._setNodeExpanded(t,!t.expanded)},toggleMultiSelect:function(){var t=this.data;if(o._setNodeMultiSelected(t,!t.multiSelected),t.isRange()){var e=o._getMultiSelectState();e&&e.selectRange(t.data,t.multiSelected)}o.fire(p.TREE_NODE_MULTISELECTED,t)},init:function(t,e,n){this.data=t.view.data},onAfterLink:function(){var t=this;t.contents("li").first().on("click",".toggle",function(){t.toggleExpanded()}).on("click","a",function(e){e.preventDefault();var n=t.data;n.nodes.length&&o._data.branchNodesExpandOnClick&&t.toggleExpanded(),n.multiSelectEnabled?t.toggleMultiSelect():n.nodes.length?o._data.branchNodesSelectable&&(o.fire(p.TREE_NODE_SELECTED,n),o.selectNode(n)):(o.fire(p.TREE_NODE_SELECTED,n),o.selectNode(n))}).on("click","input.multiSelect",function(e){t.toggleMultiSelect()})},template:$.templates.treeTemplate}}),!0},l.prototype.set=function(o){var t=this;if(this._data=Object.assign(this._data,o),this._data.helper){this._rootNode=this._data.helper.getTree(this._data.topRangeIndex,this._data.treeSortType),this._flattenedTree=null,this._multiSelectableNodes=null,this._$tree.link($.templates.pageTemplate,this._rootNode);var e=this._getMultiSelectState();if(e)for(var n=function(y){var I=e.ranges[y],A=r._getMultiSelectableNodes().filter(function(C){return C.data.id===I.id})[0];A&&(r._setNodeMultiSelectEnabled(A,I.multiSelectEnabled),r._setNodeMultiSelected(A,I.multiSelected))},r=this,f=0;f<e.ranges.length;f++)n(f);this._data.autoExpand&&this.getAllNodes().forEach(function(y,I){t._setNodeExpanded(y,!0)})}},l.prototype._getMultiSelectState=function(){return this._data.helper?this._data.helper.getMultiSelectState():null},l.prototype.data=function(){return{autoExpand:!1,branchNodesExpandOnClick:!0,branchNodesSelectable:!0,helper:null,topRangeIndex:0,treeSortType:i.TreeSortType.NONE}},l.prototype.allNodesSelected=function(){var o=this._getMultiSelectableNodes(),t=this.getMultiSelectedNodes();return o.length===t.length},l.prototype._getMultiSelectableNodes=function(){var o=this;if(this._multiSelectableNodes)return this._multiSelectableNodes;var t=this.getAllNodes();return t?this._multiSelectableNodes=t.filter(function(e){return o._nodeIsMultiSelectable(e)}):[]},l.prototype._nodeIsMultiSelectable=function(o){return!!(o.data.type===d.TreeNodeType.MANIFEST&&o.nodes&&o.nodes.length>0||o.data.type===d.TreeNodeType.RANGE)},l.prototype.getAllNodes=function(){return this._flattenedTree?this._flattenedTree:this._data.helper?this._flattenedTree=this._data.helper.getFlattenedTree(this._rootNode):[]},l.prototype.getMultiSelectedNodes=function(){var o=this;return this.getAllNodes().filter(function(t){return o._nodeIsMultiSelectable(t)&&t.multiSelected})},l.prototype.getNodeById=function(o){return this.getAllNodes().filter(function(t){return t.id===o})[0]},l.prototype.expandParents=function(o,t){o&&o.parentNode&&(this._setNodeExpanded(o.parentNode,t),this.expandParents(o.parentNode,t))},l.prototype._setNodeSelected=function(o,t){$.observable(o).setProperty("selected",t)},l.prototype._setNodeExpanded=function(o,t){$.observable(o).setProperty("expanded",t)},l.prototype._setNodeMultiSelected=function(o,t){$.observable(o).setProperty("multiSelected",t)},l.prototype._setNodeMultiSelectEnabled=function(o,t){$.observable(o).setProperty("multiSelectEnabled",t)},l.prototype.selectPath=function(o){if(this._rootNode){var t=o.split("/");t.length>=1&&t.shift();var e=this.getNodeByPath(this._rootNode,t);this.selectNode(e)}},l.prototype.deselectCurrentNode=function(){this.selectedNode&&this._setNodeSelected(this.selectedNode,!1)},l.prototype.selectNode=function(o){this._rootNode&&(this.deselectCurrentNode(),this.selectedNode=o,this._setNodeSelected(this.selectedNode,!0))},l.prototype.expandNode=function(o,t){this._rootNode&&this._setNodeExpanded(o,t)},l.prototype.getNodeByPath=function(o,t){if(t.length===0)return o;var e=Number(t.shift()),n=o.nodes[e];return this.getNodeByPath(n,t)},l.prototype.show=function(){this._$element.show()},l.prototype.hide=function(){this._$element.hide()},l.prototype._resize=function(){},l}(E(4).BaseComponent);v.TreeComponent=h;var p=function(){function a(){}return a.TREE_NODE_MULTISELECTED="treeNodeMultiSelected",a.TREE_NODE_SELECTED="treeNodeSelected",a}();v.Events=p},function(m,v,E){"use strict";E.r(v),E.d(v,"BaseComponent",function(){return _});var _=function(){function u(d){this.options=d,this.options.data=Object.assign({},this.data(),d.data)}return u.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},u.prototype.data=function(){return{}},u.prototype.on=function(d,i,h){var p=this._e||(this._e={});(p[d]||(p[d]=[])).push({fn:i,ctx:h})},u.prototype.fire=function(d){for(var i=[],h=1;h<arguments.length;h++)i[h-1]=arguments[h];for(var p=[].slice.call(arguments,1),a=((this._e||(this._e={}))[d]||[]).slice(),l=0,o=a.length;l<o;l++)a[l].fn.apply(a[l].ctx,p)},u.prototype._resize=function(){},u.prototype.set=function(d){},u}()},function(m,v,E){"use strict";E.r(v);var _,u,d,i,h,p,a,l,o,t,e=function(c){this.isVisible=!0;var s=c.on.match(/.*xywh=(\d*),(\d*),(\d*),(\d*)/);this.x=Number(s[1]),this.y=Number(s[2]),this.width=Number(s[3]),this.height=Number(s[4]),this.chars=c.resource.chars},n=function(){function c(s,g){this.rects=[],this.canvasIndex=g,this.addRect(s)}return c.prototype.addRect=function(s){var g=new e(s);g.canvasIndex=this.canvasIndex,g.index=this.rects.length,this.rects.push(g),this.rects.sort(function(T,N){return T.index-N.index})},c}(),r=E(0),f=function(){function c(){this.isEnabled=!1,this.ranges=[],this.canvases=[]}return c.prototype.allCanvasesSelected=function(){return this.canvases.length>0&&this.getAllSelectedCanvases().length===this.canvases.length},c.prototype.allRangesSelected=function(){return this.ranges.length>0&&this.getAllSelectedRanges().length===this.ranges.length},c.prototype.allSelected=function(){return this.allRangesSelected()&&this.allCanvasesSelected()},c.prototype.getAll=function(){return this.canvases.concat(this.ranges)},c.prototype.getAllSelectedCanvases=function(){return this.canvases.filter(function(s){return s.multiSelected})},c.prototype.getAllSelectedRanges=function(){return this.ranges.filter(function(s){return s.multiSelected})},c.prototype.getCanvasById=function(s){return this.canvases.filter(function(g){return r.Utils.normaliseUrl(g.id)===r.Utils.normaliseUrl(s)})[0]},c.prototype.getCanvasesByIds=function(s){for(var g=[],T=0;T<s.length;T++){var N=s[T];g.push(this.getCanvasById(N))}return g},c.prototype.getRangeCanvases=function(s){var g=s.getCanvasIds();return this.getCanvasesByIds(g)},c.prototype.selectAll=function(s){this.selectRanges(this.ranges,s),this.selectCanvases(this.canvases,s)},c.prototype.selectCanvas=function(s,g){this.canvases.filter(function(T){return T.id===s.id})[0].multiSelected=g},c.prototype.selectAllCanvases=function(s){this.selectCanvases(this.canvases,s)},c.prototype.selectCanvases=function(s,g){for(var T=0;T<s.length;T++)s[T].multiSelected=g},c.prototype.selectRange=function(s,g){var T=this.ranges.filter(function(O){return O.id===s.id})[0];T.multiSelected=g;var N=this.getRangeCanvases(T);this.selectCanvases(N,g)},c.prototype.selectAllRanges=function(s){this.selectRanges(this.ranges,s)},c.prototype.selectRanges=function(s,g){for(var T=0;T<s.length;T++){var N=s[T];N.multiSelected=g;var O=this.getCanvasesByIds(N.getCanvasIds());this.selectCanvases(O,g)}},c.prototype.setEnabled=function(s){this.isEnabled=s;for(var g=this.getAll(),T=0;T<g.length;T++){var N=g[T];N.multiSelectEnabled=this.isEnabled,s||(N.multiSelected=!1)}},c}(),y=function(){function c(s,g){this.items=[],this.resource=s,this.label=g}return c.prototype.addItem=function(s){this.items.push(s)},c.prototype.addMetadata=function(s,g){g===void 0&&(g=!1);for(var T=0;T<s.length;T++){var N=s[T];N.isRootLevel=g,this.addItem(N)}},c}();(function(c){c.DATE="date",c.NONE="none"})(_||(_={})),function(c){c.BOOKMARKING="oa:bookmarking",c.CLASSIFYING="oa:classifying",c.COMMENTING="oa:commenting",c.DESCRIBING="oa:describing",c.EDITING="oa:editing",c.HIGHLIGHTING="oa:highlighting",c.IDENTIFYING="oa:identifying",c.LINKING="oa:linking",c.MODERATING="oa:moderating",c.PAINTING="sc:painting",c.QUESTIONING="oa:questioning",c.REPLYING="oa:replying",c.TAGGING="oa:tagging",c.TRANSCRIBING="oad:transcribing"}(u||(u={})),function(c){c.AUTO_ADVANCE="auto-advance",c.CONTINUOUS="continuous",c.FACING_PAGES="facing-pages",c.HIDDEN="hidden",c.INDIVIDUALS="individuals",c.MULTI_PART="multi-part",c.NO_NAV="no-nav",c.NON_PAGED="non-paged",c.PAGED="paged",c.REPEAT="repeat",c.SEQUENCE="sequence",c.THUMBNAIL_NAV="thumbnail-nav",c.TOGETHER="together",c.UNORDERED="unordered"}(d||(d={})),function(c){c.CANVAS="canvas",c.CHOICE="choice",c.CONTENT_AS_TEXT="contentastext",c.DATASET="dataset",c.DOCUMENT="document",c.IMAGE="image",c.MODEL="model",c.MOVING_IMAGE="movingimage",c.PDF="pdf",c.PHYSICAL_OBJECT="physicalobject",c.SOUND="sound",c.TEXT="text",c.TEXTUALBODY="textualbody",c.VIDEO="video"}(i||(i={})),function(c){c.ANNOTATION="annotation",c.CANVAS="canvas",c.COLLECTION="collection",c.MANIFEST="manifest",c.RANGE="range",c.SEQUENCE="sequence"}(h||(h={})),function(c){c.AUDIO_MP4="audio/mp4",c.CORTO="application/corto",c.DRACO="application/draco",c.EPUB="application/epub+zip",c.GLTF="model/gltf+json",c.JPG="image/jpeg",c.M3U8="application/vnd.apple.mpegurl",c.MP3="audio/mp3",c.MPEG_DASH="application/dash+xml",c.OBJ="text/plain",c.OPF="application/oebps-package+xml",c.PDF="application/pdf",c.PLY="application/ply",c.THREEJS="application/vnd.threejs+json",c.VIDEO_MP4="video/mp4",c.WEBM="video/webm"}(p||(p={})),function(c){c.DOC="application/msword",c.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",c.PDF="application/pdf"}(a||(a={})),function(c){c.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",c.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",c.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",c.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",c.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",c.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",c.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",c.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",c.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",c.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",c.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",c.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",c.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",c.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",c.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",c.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",c.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",c.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",c.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",c.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",c.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",c.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",c.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",c.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",c.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",c.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",c.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",c.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",c.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",c.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",c.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",c.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",c.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",c.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",c.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",c.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",c.SEARCH_0="http://iiif.io/api/search/0/search",c.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",c.SEARCH_1="http://iiif.io/api/search/1/search",c.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",c.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",c.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",c.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",c.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",c.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",c.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(l||(l={})),function(c){c.BOTTOM_TO_TOP="bottom-to-top",c.LEFT_TO_RIGHT="left-to-right",c.RIGHT_TO_LEFT="right-to-left",c.TOP_TO_BOTTOM="top-to-bottom"}(o||(o={})),function(c){c.CONTINUOUS="continuous",c.INDIVIDUALS="individuals",c.NON_PAGED="non-paged",c.PAGED="paged",c.TOP="top"}(t||(t={}));var I=function(){function c(){}return c.manifestNotLoaded="Manifest has not loaded yet",c}(),A=function(){function c(s){this.options=s,this.iiifResource=this.options.iiifResource,this.manifestUri=this.options.manifestUri,this.manifest=this.options.manifest,this.collectionIndex=this.options.collectionIndex||0,this.manifestIndex=this.options.manifestIndex||0,this.sequenceIndex=this.options.sequenceIndex||0,this.canvasIndex=this.options.canvasIndex||0}return c.prototype.getAutoCompleteService=function(){var s=this.getSearchService(),g=null;return s&&((g=s.getService(l.SEARCH_0_AUTO_COMPLETE))||(g=s.getService(l.SEARCH_1_AUTO_COMPLETE))),g},c.prototype.getAttribution=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.manifest.getAttribution();return s?r.LanguageMap.getValue(s,this.options.locale):null},c.prototype.getCanvases=function(){return this.getCurrentSequence().getCanvases()},c.prototype.getCanvasById=function(s){return this.getCurrentSequence().getCanvasById(s)},c.prototype.getCanvasesById=function(s){for(var g=[],T=0;T<s.length;T++){var N=s[T],O=this.getCanvasById(N);O&&g.push(O)}return g},c.prototype.getCanvasByIndex=function(s){return this.getCurrentSequence().getCanvasByIndex(s)},c.prototype.getCanvasIndexById=function(s){return this.getCurrentSequence().getCanvasIndexById(s)},c.prototype.getCanvasIndexByLabel=function(s){var g=this.getManifestType()===r.ManifestType.MANUSCRIPT;return this.getCurrentSequence().getCanvasIndexByLabel(s,g)},c.prototype.getCanvasRange=function(s,g){var T=this.getCanvasRanges(s);if(g){for(var N=0;N<T.length;N++){var O=T[N];if(O.path===g)return O}return null}return T[0]},c.prototype.getCanvasRanges=function(s){if(!this.manifest)throw new Error(I.manifestNotLoaded);return s.ranges||(s.ranges=this.manifest.getAllRanges().filter(function(g){return g.getCanvasIds().some(function(T){return r.Utils.normaliseUrl(T)===r.Utils.normaliseUrl(s.id)})})),s.ranges},c.prototype.getCollectionIndex=function(s){if(!s.parentCollection||s.parentCollection.parentCollection)return s.parentCollection?s.parentCollection.index:void 0},c.prototype.getCurrentCanvas=function(){return this.getCurrentSequence().getCanvasByIndex(this.canvasIndex)},c.prototype.getCurrentSequence=function(){return this.getSequenceByIndex(this.sequenceIndex)},c.prototype.getDescription=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.manifest.getDescription();return s?r.LanguageMap.getValue(s,this.options.locale):null},c.prototype.getLabel=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.manifest.getLabel();return s?r.LanguageMap.getValue(s,this.options.locale):null},c.prototype.getLastCanvasLabel=function(s){return this.getCurrentSequence().getLastCanvasLabel(s)},c.prototype.getFirstPageIndex=function(){return 0},c.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},c.prototype.getLicense=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getLicense()},c.prototype.getLogo=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getLogo()},c.prototype.getManifestType=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.manifest.getManifestType();return s===r.ManifestType.EMPTY&&(s=r.ManifestType.MONOGRAPH),s},c.prototype.getMetadata=function(s){if(!this.manifest)throw new Error(I.manifestNotLoaded);var g=[],T=this.manifest.getMetadata(),N=new y(this.manifest),O=this.options.locale;T&&T.length&&N.addMetadata(T,!0),this.manifest.getDescription().length&&((M=new r.LabelValuePair(O)).label=[new r.Language("description",O)],M.value=this.manifest.getDescription(),M.isRootLevel=!0,N.addItem(M)),this.manifest.getAttribution().length&&((M=new r.LabelValuePair(O)).label=[new r.Language("attribution",O)],M.value=this.manifest.getAttribution(),M.isRootLevel=!0,N.addItem(M));var S=this.manifest.getLicense();if(S){var R={label:"license",value:s&&s.licenseFormatter?s.licenseFormatter.format(S):S};(M=new r.LabelValuePair(O)).parse(R),M.isRootLevel=!0,N.addItem(M)}if(this.manifest.getLogo()){var M;R={label:"logo",value:'<img src="'+this.manifest.getLogo()+'"/>'},(M=new r.LabelValuePair(O)).parse(R),M.isRootLevel=!0,N.addItem(M)}return g.push(N),s?this._parseMetadataOptions(s,g):g},c.prototype.getRequiredStatement=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.manifest.getRequiredStatement();return s?{label:s.getLabel(),value:s.getValue()}:null},c.prototype._parseMetadataOptions=function(s,g){var T=this.getCurrentSequence(),N=T.getMetadata();if(N&&N.length){var O=new y(T);O.addMetadata(N),g.push(O)}if(s.range){var S=this._getRangeMetadata([],s.range);S=S.reverse(),g=g.concat(S)}if(s.canvases&&s.canvases.length)for(var R=0;R<s.canvases.length;R++){var M=s.canvases[R],G=M.getMetadata();if(G&&G.length){var B=new y(M);B.addMetadata(M.getMetadata()),g.push(B)}for(var j=M.getImages(),Y=0;Y<j.length;Y++){var Z=j[Y],oe=Z.getMetadata();if(oe&&oe.length){var pe=new y(Z);pe.addMetadata(oe),g.push(pe)}}}return g},c.prototype._getRangeMetadata=function(s,g){var T=g.getMetadata();if(T&&T.length){var N=new y(g);N.addMetadata(T),s.push(N)}else if(g.parentRange)return this._getRangeMetadata(s,g.parentRange);return s},c.prototype.getMultiSelectState=function(){return this._multiSelectState||(this._multiSelectState=new f,this._multiSelectState.ranges=this.getRanges().slice(0),this._multiSelectState.canvases=this.getCurrentSequence().getCanvases().slice(0)),this._multiSelectState},c.prototype.getCurrentRange=function(){return this.rangeId?this.getRangeById(this.rangeId):null},c.prototype.getPosterCanvas=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getPosterCanvas()},c.prototype.getPosterImage=function(){var s=this.getPosterCanvas();if(s){var g=s.getContent();if(g&&g.length)return g[0].getBody()[0].id}return null},c.prototype.getPreviousRange=function(s){var g=null;if(g=s||this.getCurrentRange()){var T=this.getFlattenedTree();if(T)for(var N=0;N<T.length;N++){var O=T[N];if(O&&O.data.id===g.id){for(;N>0;)return T[--N].data;break}}}return null},c.prototype.getNextRange=function(s){var g=null;if(g=s||this.getCurrentRange()){var T=this.getFlattenedTree();if(T)for(var N=0;N<T.length;N++){var O=T[N];if(O&&O.data.id===g.id){for(;N<T.length-1;){var S=T[++N];if(S.data.canvases&&S.data.canvases.length)return S.data}break}}}return null},c.prototype.getFlattenedTree=function(s){var g=null;return(g=s||this.getTree())?this._flattenTree(g,"nodes"):null},c.prototype._flattenTree=function(s,g){var T=this,N=[s];return s[g]&&s[g].length>0?N.concat(s[g].map(function(O){return T._flattenTree(O,g)}).reduce(function(O,S){return O.concat(S)},[])):N},c.prototype.getRanges=function(){return this.manifest.getAllRanges()},c.prototype.getRangeByPath=function(s){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getRangeByPath(s)},c.prototype.getRangeById=function(s){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getRangeById(s)},c.prototype.getRangeCanvases=function(s){var g=s.getCanvasIds();return this.getCanvasesById(g)},c.prototype.getRelated=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getRelated()},c.prototype.getSearchService=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.manifest.getService(l.SEARCH_0);return s||(s=this.manifest.getService(l.SEARCH_1)),s},c.prototype.getSeeAlso=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getSeeAlso()},c.prototype.getSequenceByIndex=function(s){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getSequenceByIndex(s)},c.prototype.getShareServiceUrl=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=null,g=this.manifest.getService(l.SHARE_EXTENSIONS);return g&&(g.length&&(g=g[0]),s=g.__jsonld.shareUrl),s},c.prototype._getSortedTreeNodesByDate=function(s,g){var T=this.getFlattenedTree(g);if(T){var N=T.filter(function(O){return O.data.type===r.TreeNodeType.MANIFEST});this.createDecadeNodes(s,T),this.sortDecadeNodes(s),this.createYearNodes(s,T),this.sortYearNodes(s),this.createMonthNodes(s,N),this.sortMonthNodes(s),this.createDateNodes(s,N),this.pruneDecadeNodes(s)}},c.prototype.getStartCanvasIndex=function(){return this.getCurrentSequence().getStartCanvasIndex()},c.prototype.getThumbs=function(s,g){return this.getCurrentSequence().getThumbs(s,g)},c.prototype.getTopRanges=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getTopRanges()},c.prototype.getTotalCanvases=function(){return this.getCurrentSequence().getTotalCanvases()},c.prototype.getTrackingLabel=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.getTrackingLabel()},c.prototype._getTopRanges=function(){return this.iiifResource.getTopRanges()},c.prototype.getTree=function(s,g){if(s===void 0&&(s=0),g===void 0&&(g=_.NONE),!this.iiifResource)return null;var T;if(this.iiifResource.isCollection())T=this.iiifResource.getDefaultTree();else{var N=this._getTopRanges(),O=new r.TreeNode;if(O.label="root",O.data=this.iiifResource,!N.length)return O;T=N[s].getTree(O)}var S=new r.TreeNode;switch(g.toString()){case _.DATE.toString():if(this.treeHasNavDates(T)){this._getSortedTreeNodesByDate(S,T);break}default:S=T}return S},c.prototype.treeHasNavDates=function(s){var g=this.getFlattenedTree(s);return!!g&&g.some(function(T){return!isNaN(T.navDate)})},c.prototype.getViewingDirection=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.getCurrentSequence().getViewingDirection();return s||(s=this.manifest.getViewingDirection()),s},c.prototype.getViewingHint=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.getCurrentSequence().getViewingHint();return s||(s=this.manifest.getViewingHint()),s},c.prototype.hasParentCollection=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return!!this.manifest.parentCollection},c.prototype.hasRelatedPage=function(){var s=this.getRelated();return!!s&&(s.length&&(s=s[0]),s.format==="text/html")},c.prototype.hasResources=function(){return this.getCurrentCanvas().getResources().length>0},c.prototype.isBottomToTop=function(){var s=this.getViewingDirection();return!!s&&s===o.BOTTOM_TO_TOP},c.prototype.isCanvasIndexOutOfRange=function(s){return this.getCurrentSequence().isCanvasIndexOutOfRange(s)},c.prototype.isContinuous=function(){var s=this.getViewingHint();return!!s&&s===t.CONTINUOUS},c.prototype.isFirstCanvas=function(s){return s!==void 0?this.getCurrentSequence().isFirstCanvas(s):this.getCurrentSequence().isFirstCanvas(this.canvasIndex)},c.prototype.isHorizontallyAligned=function(){return this.isLeftToRight()||this.isRightToLeft()},c.prototype.isLastCanvas=function(s){return s!==void 0?this.getCurrentSequence().isLastCanvas(s):this.getCurrentSequence().isLastCanvas(this.canvasIndex)},c.prototype.isLeftToRight=function(){var s=this.getViewingDirection();return!!s&&s===o.LEFT_TO_RIGHT},c.prototype.isMultiCanvas=function(){return this.getCurrentSequence().isMultiCanvas()},c.prototype.isMultiSequence=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.isMultiSequence()},c.prototype.isPaged=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);var s=this.getViewingHint();return s?s===t.PAGED:this.manifest.isPagingEnabled()},c.prototype.isPagingAvailable=function(){return this.isPagingEnabled()&&this.getTotalCanvases()>2},c.prototype.isPagingEnabled=function(){if(!this.manifest)throw new Error(I.manifestNotLoaded);return this.manifest.isPagingEnabled()||this.getCurrentSequence().isPagingEnabled()},c.prototype.isRightToLeft=function(){var s=this.getViewingDirection();return!!s&&s===o.RIGHT_TO_LEFT},c.prototype.isTopToBottom=function(){var s=this.getViewingDirection();return!!s&&s===o.TOP_TO_BOTTOM},c.prototype.isTotalCanvasesEven=function(){return this.getCurrentSequence().isTotalCanvasesEven()},c.prototype.isUIEnabled=function(s){if(!this.manifest)throw new Error(I.manifestNotLoaded);var g=this.manifest.getService(l.UI_EXTENSIONS);if(g){var T=g.getProperty("disableUI");if(T&&(T.indexOf(s)!==-1||T.indexOf(s.toLowerCase())!==-1))return!1}return!0},c.prototype.isVerticallyAligned=function(){return this.isTopToBottom()||this.isBottomToTop()},c.prototype.createDateNodes=function(s,g){for(var T=0;T<g.length;T++){var N=g[T],O=this.getNodeYear(N),S=this.getNodeMonth(N),R=new r.TreeNode;R.id=N.id,R.label=this.getNodeDisplayDate(N),R.data=N.data,R.data.type=r.TreeNodeType.MANIFEST,R.data.year=O,R.data.month=S;var M=this.getDecadeNode(s,O);if(M){var G=this.getYearNode(M,O);if(G){var B=this.getMonthNode(G,S);B&&B.addNode(R)}}}},c.prototype.createDecadeNodes=function(s,g){for(var T=0;T<g.length;T++){var N=g[T];if(N.navDate){var O=this.getNodeYear(N),S=Number(O.toString().substr(0,3)+"9");if(!this.getDecadeNode(s,O)){var R=new r.TreeNode;R.label=O+" - "+S,R.navDate=N.navDate,R.data.startYear=O,R.data.endYear=S,s.addNode(R)}}}},c.prototype.createMonthNodes=function(s,g){for(var T=0;T<g.length;T++){var N=g[T];if(N.navDate){var O=this.getNodeYear(N),S=this.getNodeMonth(N),R=this.getDecadeNode(s,O),M=null;if(R&&(M=this.getYearNode(R,O)),R&&M&&!this.getMonthNode(M,S)){var G=new r.TreeNode;G.label=this.getNodeDisplayMonth(N),G.navDate=N.navDate,G.data.year=O,G.data.month=S,M.addNode(G)}}}},c.prototype.createYearNodes=function(s,g){for(var T=0;T<g.length;T++){var N=g[T];if(N.navDate){var O=this.getNodeYear(N),S=this.getDecadeNode(s,O);if(S&&!this.getYearNode(S,O)){var R=new r.TreeNode;R.label=O.toString(),R.navDate=N.navDate,R.data.year=O,S.addNode(R)}}}},c.prototype.getDecadeNode=function(s,g){for(var T=0;T<s.nodes.length;T++){var N=s.nodes[T];if(g>=N.data.startYear&&g<=N.data.endYear)return N}return null},c.prototype.getMonthNode=function(s,g){for(var T=0;T<s.nodes.length;T++){var N=s.nodes[T];if(g===this.getNodeMonth(N))return N}return null},c.prototype.getNodeDisplayDate=function(s){return s.navDate.toDateString()},c.prototype.getNodeDisplayMonth=function(s){return["January","February","March","April","May","June","July","August","September","October","November","December"][s.navDate.getMonth()]},c.prototype.getNodeMonth=function(s){return s.navDate.getMonth()},c.prototype.getNodeYear=function(s){return s.navDate.getFullYear()},c.prototype.getYearNode=function(s,g){for(var T=0;T<s.nodes.length;T++){var N=s.nodes[T];if(g===this.getNodeYear(N))return N}return null},c.prototype.pruneDecadeNodes=function(s){for(var g=[],T=0;T<s.nodes.length;T++){var N=s.nodes[T];N.nodes.length||g.push(N)}for(var O=0;O<g.length;O++){var S=g[O],R=s.nodes.indexOf(S);R>-1&&s.nodes.splice(R,1)}},c.prototype.sortDecadeNodes=function(s){s.nodes=s.nodes.sort(function(g,T){return g.data.startYear-T.data.startYear})},c.prototype.sortMonthNodes=function(s){for(var g=this,T=0;T<s.nodes.length;T++)for(var N=s.nodes[T],O=0;O<N.nodes.length;O++){var S=N.nodes[O];S.nodes=S.nodes.sort(function(R,M){return g.getNodeMonth(R)-g.getNodeMonth(M)})}},c.prototype.sortYearNodes=function(s){for(var g=this,T=0;T<s.nodes.length;T++){var N=s.nodes[T];N.nodes=N.nodes.sort(function(O,S){return g.getNodeYear(O)-g.getNodeYear(S)})}},c}(),C=function(){function c(s){this._options=s,this._options.locale=this._options.locale||"en-GB"}return c.prototype.bootstrap=function(s,g){var T=this;return new Promise(function(N,O){s&&g&&(N=s,O=g),r.Utils.loadManifest(T._options.manifestUri).then(function(S){T._loaded(T,S,N,O)})})},c.prototype._loaded=function(s,g,T,N){var O=r.Utils.parseManifest(g,{locale:s._options.locale});if(O){s._options.iiifResource||(s._options.iiifResource=O);var S=s._options.collectionIndex,R=s._options.manifestIndex;if(O.getIIIFResourceType()===h.COLLECTION){var M=O.getManifests(),G=O.getCollections();M.length||S!==void 0||(S=0),S!==void 0&&G&&G.length?O.getCollectionByIndex(S).then(function(j){j||N("Collection index not found"),j.getTotalManifests()===0&&R===0&&j.getTotalCollections()>0?(s._options.collectionIndex=0,s._options.manifestUri=j.id,s.bootstrap(T,N)):R!==void 0&&j.getManifestByIndex(R).then(function(Y){s._options.manifest=Y;var Z=new A(s._options);T(Z)})}):O.getManifestByIndex(s._options.manifestIndex).then(function(j){s._options.manifest=j;var Y=new A(s._options);T(Y)})}else{s._options.manifest=O;var B=new A(s._options);T(B)}}else console.error("Unable to load IIIF resource")},c}(),L=E(1),b=function(){function c(s,g){this.authHoldingPage=null,this.clickThroughService=null,this.externalService=null,this.isProbed=!1,this.isResponseHandled=!1,this.kioskService=null,this.loginService=null,this.logoutService=null,this.probeService=null,this.restrictedService=null,this.tokenService=null,s.externalResource=this,this.dataUri=this._getDataUri(s),this.index=s.index,this.authAPIVersion=g.authApiVersion,this._parseAuthServices(s),this._parseCanvasDimensions(s)}return c.prototype._getImageServiceDescriptor=function(s){for(var g=null,T=0;T<s.length;T++){var N=s[T],O=N.id;O.endsWith("/")||(O+="/"),r.Utils.isImageProfile(N.getProfile())&&(g=O+"info.json")}return g},c.prototype._getDataUri=function(s){var g=s.getContent(),T=s.getImages(),N=null;if(g&&g.length){var O=g[0].getBody();return O.length?(S=O[0].getServices()).length&&(N=this._getImageServiceDescriptor(S))?N:O[0].id:null}if(T&&T.length){var S,R=T[0].getResource();return(S=R.getServices()).length&&(N=this._getImageServiceDescriptor(S))?N:R.id}var M=s.getService(l.IXIF);return M?M.getInfoUri():s.id},c.prototype._parseAuthServices=function(s){if(this.authAPIVersion===.9)this.clickThroughService=r.Utils.getService(s,l.AUTH_0_CLICK_THROUGH),this.loginService=r.Utils.getService(s,l.AUTH_0_LOGIN),this.restrictedService=r.Utils.getService(s,l.AUTH_0_RESTRICTED),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(l.AUTH_0_LOGOUT),this.tokenService=this.clickThroughService.getService(l.AUTH_0_TOKEN)):this.loginService?(this.logoutService=this.loginService.getService(l.AUTH_0_LOGOUT),this.tokenService=this.loginService.getService(l.AUTH_0_TOKEN)):this.restrictedService&&(this.logoutService=this.restrictedService.getService(l.AUTH_0_LOGOUT),this.tokenService=this.restrictedService.getService(l.AUTH_0_TOKEN));else{if(s.isCanvas!==void 0&&s.isCanvas()){var g=s.getContent();if(g&&g.length){var T=g[0].getBody();T&&T.length&&(s=T[0])}}this.clickThroughService=r.Utils.getService(s,l.AUTH_1_CLICK_THROUGH),this.loginService=r.Utils.getService(s,l.AUTH_1_LOGIN),this.externalService=r.Utils.getService(s,l.AUTH_1_EXTERNAL),this.kioskService=r.Utils.getService(s,l.AUTH_1_KIOSK),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(l.AUTH_1_LOGOUT),this.tokenService=this.clickThroughService.getService(l.AUTH_1_TOKEN),this.probeService=this.clickThroughService.getService(l.AUTH_1_PROBE)):this.loginService?(this.logoutService=this.loginService.getService(l.AUTH_1_LOGOUT),this.tokenService=this.loginService.getService(l.AUTH_1_TOKEN),this.probeService=this.loginService.getService(l.AUTH_1_PROBE)):this.externalService?(this.logoutService=this.externalService.getService(l.AUTH_1_LOGOUT),this.tokenService=this.externalService.getService(l.AUTH_1_TOKEN),this.probeService=this.externalService.getService(l.AUTH_1_PROBE)):this.kioskService&&(this.logoutService=this.kioskService.getService(l.AUTH_1_LOGOUT),this.tokenService=this.kioskService.getService(l.AUTH_1_TOKEN),this.probeService=this.kioskService.getService(l.AUTH_1_PROBE))}},c.prototype._parseCanvasDimensions=function(s){var g=s.getImages();if(g&&g.length){var T=g[0].getResource();this.width=T.getWidth(),this.height=T.getHeight()}else if((g=s.getContent()).length){var N=g[0].getBody();N.length&&(this.width=N[0].getWidth(),this.height=N[0].getHeight())}},c.prototype._parseDescriptorDimensions=function(s){s.width!==void 0&&(this.width=s.width),s.height!==void 0&&(this.height=s.height)},c.prototype.isAccessControlled=function(){return!!(this.clickThroughService||this.loginService||this.externalService||this.kioskService||this.probeService)},c.prototype.hasServiceDescriptor=function(){return!!this.dataUri&&this.dataUri.endsWith("info.json")},c.prototype.getData=function(s){var g=this;return g.data={},new Promise(function(T,N){if(g.dataUri)if(g.probeService){g.isProbed=!0;var O=new XMLHttpRequest;O.open("GET",g.probeService.id,!0),O.withCredentials=!0,O.onload=function(){var M=JSON.parse(O.responseText);unescape(M.contentLocation)!==g.dataUri?g.status=L.MOVED_TEMPORARILY:g.status=L.OK,T(g)},O.onerror=function(){g.status=O.status,T(g)},O.send()}else{var S="GET";if(!g.hasServiceDescriptor()){if(!g.isAccessControlled())return g.status=L.OK,void T(g);S="HEAD"}var R=new XMLHttpRequest;R.open(S,g.dataUri,!0),s&&R.setRequestHeader("Authorization","Bearer "+s.accessToken),R.onload=function(){var M=JSON.parse(R.responseText);if(M){var G=unescape(M["@id"]);g.data=M,g._parseAuthServices(g.data),g._parseDescriptorDimensions(g.data),G.endsWith("/info.json")&&(G=G.substr(0,G.lastIndexOf("/")));var B=g.dataUri;B&&B.endsWith("/info.json")&&(B=B.substr(0,B.lastIndexOf("/"))),G!==B&&g.loginService?g.status=L.MOVED_TEMPORARILY:g.status=L.OK,T(g)}else g.status=L.OK,T(g)},R.onerror=function(){g.status=R.status,R.responseText&&g._parseAuthServices(JSON.parse(R.responseText)),T(g)},R.send()}else N("There is no dataUri to fetch")})},c}(),P=function(){},w=function(){},D=function(c,s){this.value=c,this.locale=s},F=function(){function c(s){this.labels=s}return c.prototype.format=function(s){return s.indexOf("<a")!=-1?s:'<a href="'+s+'">'+(this.labels[s]?this.labels[s]:s)+"</a>"},c}();E.d(v,"loadManifest",function(){return W}),E.d(v,"AnnotationGroup",function(){return n}),E.d(v,"AnnotationRect",function(){return e}),E.d(v,"Bootstrapper",function(){return C}),E.d(v,"ExternalResource",function(){return b}),E.d(v,"Helper",function(){return A}),E.d(v,"ILabelValuePair",function(){return P}),E.d(v,"MetadataGroup",function(){return y}),E.d(v,"MetadataOptions",function(){return w}),E.d(v,"MultiSelectState",function(){return f}),E.d(v,"Translation",function(){return D}),E.d(v,"TreeSortType",function(){return _}),E.d(v,"UriLabeller",function(){return F});var W=function(c){return new C(c).bootstrap()}}])})});var re=class{constructor(v){this.value=v}toString(){return this.value}},z=re;z.image=new re("image"),z.page=new re("page");var V=class{},x=V;x.namespace="openseadragonExtension.",x.CURRENT_VIEW_URI=V.namespace+"currentViewUri",x.DOUBLECLICK=V.namespace+"doubleClick",x.IMAGE_SEARCH=V.namespace+"imageSearch",x.MODE_CHANGE=V.namespace+"modeChange",x.NEXT_SEARCH_RESULT=V.namespace+"nextSearchResult",x.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE=V.namespace+"nextImagesSearchResultUnavailable",x.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE=V.namespace+"prevImagesSearchResultUnavailable",x.PAGE_SEARCH=V.namespace+"pageSearch",x.PAGING_TOGGLED=V.namespace+"pagingToggled",x.PREV_SEARCH_RESULT=V.namespace+"prevSearchResult",x.PRINT=V.namespace+"print",x.ROTATE=V.namespace+"rotate",x.OPENSEADRAGON_ANIMATION_FINISH=V.namespace+"animationFinish",x.OPENSEADRAGON_ANIMATION_START=V.namespace+"animationStart",x.OPENSEADRAGON_ANIMATION=V.namespace+"animation",x.OPENSEADRAGON_OPEN=V.namespace+"open",x.OPENSEADRAGON_RESIZE=V.namespace+"resize",x.OPENSEADRAGON_ROTATION=V.namespace+"rotationChange",x.SEARCH_PREVIEW_FINISH=V.namespace+"searchPreviewFinish",x.SEARCH_PREVIEW_START=V.namespace+"searchPreviewStart",x.SEARCH=V.namespace+"search",x.XYWH_CHANGE=V.namespace+"xywhChange",x.ZOOM_IN=V.namespace+"zoomIn",x.ZOOM_OUT=V.namespace+"zoomOut";var ve;(function(m){m.BOOKMARKING="oa:bookmarking",m.CLASSIFYING="oa:classifying",m.COMMENTING="oa:commenting",m.DESCRIBING="oa:describing",m.EDITING="oa:editing",m.HIGHLIGHTING="oa:highlighting",m.IDENTIFYING="oa:identifying",m.LINKING="oa:linking",m.MODERATING="oa:moderating",m.PAINTING="sc:painting",m.QUESTIONING="oa:questioning",m.REPLYING="oa:replying",m.TAGGING="oa:tagging",m.TRANSCRIBING="oad:transcribing"})(ve||(ve={}));var me;(function(m){m.AUTO_ADVANCE="auto-advance",m.CONTINUOUS="continuous",m.FACING_PAGES="facing-pages",m.HIDDEN="hidden",m.INDIVIDUALS="individuals",m.MULTI_PART="multi-part",m.NO_NAV="no-nav",m.NON_PAGED="non-paged",m.PAGED="paged",m.REPEAT="repeat",m.SEQUENCE="sequence",m.THUMBNAIL_NAV="thumbnail-nav",m.TOGETHER="together",m.UNORDERED="unordered"})(me||(me={}));var Te;(function(m){m.CANVAS="canvas",m.CHOICE="choice",m.CONTENT_AS_TEXT="contentastext",m.DOCUMENT="document",m.IMAGE="image",m.MOVING_IMAGE="movingimage",m.PDF="pdf",m.PHYSICAL_OBJECT="physicalobject",m.SOUND="sound",m.TEXTUALBODY="textualbody",m.VIDEO="video"})(Te||(Te={}));var ye;(function(m){m.ANNOTATION="annotation",m.CANVAS="canvas",m.COLLECTION="collection",m.MANIFEST="manifest",m.RANGE="range",m.SEQUENCE="sequence"})(ye||(ye={}));var Ie;(function(m){m.AUDIO_MP4="audio/mp4",m.CORTO="application/corto",m.DRACO="application/draco",m.GLTF="model/gltf+json",m.JPG="image/jpeg",m.M3U8="application/vnd.apple.mpegurl",m.MP3="audio/mp3",m.MPEG_DASH="application/dash+xml",m.OBJ="text/plain",m.PDF="application/pdf",m.PLY="application/ply",m.THREEJS="application/vnd.threejs+json",m.VIDEO_MP4="video/mp4",m.WEBM="video/webm"})(Ie||(Ie={}));var Ne;(function(m){m.DOC="application/msword",m.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",m.PDF="application/pdf"})(Ne||(Ne={}));var Oe;(function(m){m.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",m.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",m.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",m.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",m.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",m.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",m.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",m.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",m.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",m.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",m.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",m.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",m.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",m.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",m.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",m.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",m.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",m.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",m.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",m.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",m.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",m.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",m.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",m.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",m.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",m.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",m.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",m.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",m.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",m.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",m.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",m.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",m.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",m.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",m.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",m.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",m.SEARCH_0="http://iiif.io/api/search/0/search",m.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",m.SEARCH_1="http://iiif.io/api/search/1/search",m.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",m.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",m.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",m.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",m.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",m.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",m.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"})(Oe||(Oe={}));var K;(function(m){m.BOTTOM_TO_TOP="bottom-to-top",m.LEFT_TO_RIGHT="left-to-right",m.RIGHT_TO_LEFT="right-to-left",m.TOP_TO_BOTTOM="top-to-bottom"})(K||(K={}));var be;(function(m){m.CONTINUOUS="continuous",m.INDIVIDUALS="individuals",m.NON_PAGED="non-paged",m.PAGED="paged",m.TOP="top"})(be||(be={}));var Ae=function(){function m(v){this.options=v,this.options.data=Object.assign({},this.data(),v.data)}return m.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},m.prototype.data=function(){return{}},m.prototype.on=function(v,E,_){var u=this._e||(this._e={});(u[v]||(u[v]=[])).push({fn:E,ctx:_})},m.prototype.fire=function(v){for(var E=[],_=1;_<arguments.length;_++)E[_-1]=arguments[_];var u=[].slice.call(arguments,1),d=((this._e||(this._e={}))[v]||[]).slice(),i=0,h=d.length;for(i;i<h;i++)d[i].fn.apply(d[i].ctx,u)},m.prototype._resize=function(){},m.prototype.set=function(v){},m}();var we=function(){var m=function(v,E){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,u){_.__proto__=u}||function(_,u){for(var d in u)u.hasOwnProperty(d)&&(_[d]=u[d])},m(v,E)};return function(v,E){m(v,E);function _(){this.constructor=v}v.prototype=E===null?Object.create(E):(_.prototype=E.prototype,new _)}}(),Le=function(m){we(v,m);function v(E){var _=m.call(this,E)||this;return _._data=_.data(),_._data=_.options.data,_._init(),_._resize(),_}return v.prototype._init=function(){var E=this;m.prototype._init.call(this),this._$element=$(this.el),this._$header=$('<div class="header"></div>'),this._$element.append(this._$header),this._$leftOptions=$('<div class="left"></div>'),this._$header.append(this._$leftOptions),this._$rightOptions=$('<div class="right"></div>'),this._$header.append(this._$rightOptions),this._$sizeDownButton=$('<input class="btn btn-default size-down" type="button" value="-" />'),this._$leftOptions.append(this._$sizeDownButton),this._$sizeRange=$('<input type="range" name="size" min="1" max="10" value="'+this.options.data.initialZoom+'" />'),this._$leftOptions.append(this._$sizeRange),this._$sizeUpButton=$('<input class="btn btn-default size-up" type="button" value="+" />'),this._$leftOptions.append(this._$sizeUpButton),this._$multiSelectOptions=$('<div class="multiSelectOptions"></div>'),this._$rightOptions.append(this._$multiSelectOptions),this._$selectAllButton=$('<div class="multiSelectAll"><input id="multiSelectAll" type="checkbox" tabindex="0" /><label for="multiSelectAll">'+this.options.data.content.selectAll+"</label></div>"),this._$multiSelectOptions.append(this._$selectAllButton),this._$selectAllButtonCheckbox=$(this._$selectAllButton.find("input:checkbox")),this._$selectButton=$('<a class="select" href="#">'+this.options.data.content.select+"</a>"),this._$multiSelectOptions.append(this._$selectButton),this._$main=$('<div class="main"></div>'),this._$element.append(this._$main),this._$thumbs=$('<div class="thumbs"></div>'),this._$main.append(this._$thumbs),this._$sizeDownButton.on("click",function(){var u=Number(E._$sizeRange.val())-1;u>=Number(E._$sizeRange.attr("min"))&&(E._$sizeRange.val(u.toString()),E._$sizeRange.trigger("change"),E.fire(J.DECREASE_SIZE))}),this._$sizeUpButton.on("click",function(){var u=Number(E._$sizeRange.val())+1;u<=Number(E._$sizeRange.attr("max"))&&(E._$sizeRange.val(u.toString()),E._$sizeRange.trigger("change"),E.fire(J.INCREASE_SIZE))}),this._$sizeRange.on("change",function(){E._updateThumbs(),E._scrollToThumb(E._getSelectedThumbIndex())}),this._$selectAllButton.checkboxButton(function(u){var d=E._getMultiSelectState();d&&(u?d.selectAll(!0):d.selectAll(!1)),E.set(E.options.data)}),this._$selectButton.on("click",function(){var u=E._getMultiSelectState();if(u){var d=u.getAllSelectedCanvases().map(function(i){return i.id});E.fire(J.MULTISELECTION_MADE,d)}}),this._setRange(),$.templates({galleryThumbsTemplate:`				<div class="{{:~galleryThumbClassName()}}" data-src="{{>uri}}" data-index="{{>index}}" data-visible="{{>visible}}" data-width="{{>width}}" data-height="{{>height}}" data-initialwidth="{{>initialWidth}}" data-initialheight="{{>initialHeight}}">						<div class="wrap" style="width:{{>initialWidth}}px; height:{{>initialHeight}}px" data-link="class{merge:multiSelected toggle='multiSelected'}">						{^{if multiSelectEnabled}}								<input id="thumb-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? 'checked' : ''}" class="multiSelect" />						{{/if}}						</div>						<div class="info">								<span class="index" style="width:{{>initialWidth}}px">{{:#index + 1}}</span>								<span class="label" style="width:{{>initialWidth}}px" title="{{>label}}">{{>label}}&nbsp;</span>								<span class="searchResults" title="{{:~galleryThumbSearchResultsTitle()}}">{{>data.searchResults}}</span>						</div>				</div>`});var _=this;return $.views.helpers({galleryThumbClassName:function(){var u="thumb preLoad";return this.data.index===0&&(u+=" first"),this.data.uri||(u+=" placeholder"),u},galleryThumbSearchResultsTitle:function(){var u=Number(this.data.data.searchResults);return u?u>1?se.format(_.options.data.content.searchResults,u.toString()):se.format(_.options.data.content.searchResult,u.toString()):null}}),this._$main.on("scroll",function(){E._updateThumbs()},this.options.data.scrollStopDuration),this.options.data.sizingEnabled||this._$sizeRange.hide(),!0},v.prototype.data=function(){return{chunkedResizingThreshold:400,content:{searchResult:"{0} search result",searchResults:"{0} search results",select:"Select",selectAll:"Select All"},debug:!1,helper:null,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:!1,scrollStopDuration:100,searchResults:[],sizingEnabled:!0,thumbHeight:320,thumbLoadPadding:3,thumbWidth:200,viewingDirection:K.LEFT_TO_RIGHT}},v.prototype.set=function(E){if(this._data=Object.assign(this._data,E),this._data.helper&&this._data.thumbWidth!==void 0&&this._data.thumbHeight!==void 0&&(this._thumbs=this._data.helper.getThumbs(this._data.thumbWidth,this._data.thumbHeight)),this._data.viewingDirection&&(this._data.viewingDirection===K.BOTTOM_TO_TOP&&this._thumbs.reverse(),this._$thumbs.addClass(this._data.viewingDirection)),this._data.searchResults&&this._data.searchResults.length)for(var _=0;_<this._data.searchResults.length;_++){var u=this._data.searchResults[_],d=this._thumbs.filter(function(t){return t.index===u.canvasIndex})[0],i=$.extend(!0,{},d.data);i.searchResults=u.rects.length,d.data=i}this._thumbsCache=null,this._createThumbs(),this._data.helper&&this.selectIndex(this._data.helper.canvasIndex);var h=this._getMultiSelectState();if(h&&h.isEnabled){this._$multiSelectOptions.show(),this._$thumbs.addClass("multiSelect");for(var _=0;_<h.canvases.length;_++){var p=h.canvases[_],d=this._getThumbByCanvas(p);this._setThumbMultiSelected(d,p.multiSelected)}for(var _=0;_<h.ranges.length;_++)for(var a=h.ranges[_],l=this._getThumbsByRange(a),o=0;o<l.length;o++){var d=l[o];this._setThumbMultiSelected(d,a.multiSelected)}}else this._$multiSelectOptions.hide(),this._$thumbs.removeClass("multiSelect");this._update()},v.prototype._update=function(){var E=this._getMultiSelectState();if(E&&E.isEnabled){this._$selectAllButtonCheckbox.prop("checked",E.allSelected());var _=E.getAll().filter(function(u){return u.multiSelected}).length>0;_?this._$selectButton.show():this._$selectButton.hide()}},v.prototype._getMultiSelectState=function(){return this._data.helper?this._data.helper.getMultiSelectState():null},v.prototype._createThumbs=function(){var E=this;if(!!this._thumbs){this._$thumbs.undelegate(".thumb","click"),this._$thumbs.empty();for(var _=this._getMultiSelectState(),u=[],d=0;d<this._thumbs.length;d++){var i=this._thumbs[d],h=i.width,p=i.height;i.initialWidth=h,u.push(p),i.multiSelectEnabled=_?_.isEnabled:!1}for(var a=te.median(u),l=0;l<this._thumbs.length;l++){var i=this._thumbs[l];i.initialHeight=a}if(this._$thumbs.link($.templates.galleryThumbsTemplate,this._thumbs),_&&!_.isEnabled)this._$thumbs.delegate(".thumb","click",function(r){r.preventDefault();var f=$.view(this).data;E.fire(J.THUMB_SELECTED,f)});else for(var o=this._$thumbs.find(".thumb"),t=function(){var r=e,f=$(o[n]);f.checkboxButton(function(y){var I=$.view(this).data;r._setThumbMultiSelected(I,!I.multiSelected);var A=r.options.data.helper.getCanvasRange(I.data),C=r._getMultiSelectState();C&&(A?C.selectRange(A,I.multiSelected):C.selectCanvas(I.data,I.multiSelected)),r._update(),r.fire(J.THUMB_MULTISELECTED,I)})},e=this,n=0;n<o.length;n++)t()}},v.prototype._getThumbByCanvas=function(E){return this._thumbs.filter(function(_){return _.data.id===E.id})[0]},v.prototype._sizeThumb=function(E){var _=E.data().initialwidth,u=E.data().initialheight,d=Number(_),i=Number(u),h=Math.floor(d*this._range),p=Math.floor(i*this._range),a=E.find(".wrap"),l=E.find(".label"),o=E.find(".index"),t=E.find(".searchResults"),e=h;this._data.searchResults&&this._data.searchResults.length&&(t.show(),e=h-t.outerWidth(),this._data.minLabelWidth!==void 0&&e<this._data.minLabelWidth?(t.hide(),e=h):t.show()),this._data.pageModeEnabled?(o.hide(),l.show()):(o.show(),l.hide()),a.outerWidth(h),a.outerHeight(p),o.outerWidth(e),l.outerWidth(e)},v.prototype._loadThumb=function(E,_){var u=E.find(".wrap");if(!(u.hasClass("loading")||u.hasClass("loaded"))){E.removeClass("preLoad");var d=E.attr("data-visible"),i=this._data.imageFadeInDuration||0;if(d!=="false"){u.addClass("loading");var h=E.attr("data-src"),p=$('<img class="thumbImage" src="'+h+'" />');p.hide(),p.on("load",function(){$(this).fadeIn(i,function(){$(this).parent().switchClass("loading","loaded")})}),u.prepend(p),_&&_(p)}else u.addClass("hidden")}},v.prototype._getThumbsByRange=function(E){var _=[];if(!this._data.helper)return _;for(var u=0;u<this._thumbs.length;u++){var d=this._thumbs[u],i=d.data,h=this._data.helper.getCanvasRange(i,E.path);h&&h.id===E.id&&_.push(d)}return _},v.prototype._updateThumbs=function(){var E=!!this._data.debug;this._setRange();var _=this._$main.scrollTop(),u=this._$main.height(),d=_+u;E&&console.log("scrollTop %s, scrollBottom %s",_,d);for(var i=this._getAllThumbs(),h=0,p=0;p<i.length;p++){var a=$(i[p]),l=a.position().top,o=a.outerHeight(),t=l+o,e=o*this._data.thumbLoadPadding;l<=d+e&&t>=_-e?(h+=1,this._sizeThumb(a),a.addClass("insideScrollArea"),this._loadThumb(a)):a.removeClass("insideScrollArea")}E&&console.log("number of thumbs to update: "+h)},v.prototype._getSelectedThumbIndex=function(){return Number(this._$selectedThumb.data("index"))},v.prototype._getAllThumbs=function(){return this._thumbsCache||(this._thumbsCache=this._$thumbs.find(".thumb")),this._thumbsCache},v.prototype._getThumbByIndex=function(E){return this._$thumbs.find('[data-index="'+E+'"]')},v.prototype._scrollToThumb=function(E){var _=this._getThumbByIndex(E);this._$main.scrollTop(_.position().top)},v.prototype.selectIndex=function(E){!this._thumbs||!this._thumbs.length||(this._getAllThumbs().removeClass("selected"),this._$selectedThumb=this._getThumbByIndex(E),this._$selectedThumb.addClass("selected"),this._scrollToThumb(E),this._updateThumbs())},v.prototype._setRange=function(){var E=te.normalise(Number(this._$sizeRange.val()),0,10);this._range=te.clamp(E,.05,1)},v.prototype._setThumbMultiSelected=function(E,_){$.observable(E).setProperty("multiSelected",_)},v.prototype._resize=function(){},v}(Ae);var J=function(){function m(){}return m.DECREASE_SIZE="decreaseSize",m.INCREASE_SIZE="increaseSize",m.MULTISELECTION_MADE="multiSelectionMade",m.THUMB_SELECTED="thumbSelected",m.THUMB_MULTISELECTED="thumbMultiSelected",m}();var Pe=ee(),ae=class extends ne{constructor(v){super(v,!0,!0);this.isOpen=!1}create(){this.setConfig("contentLeftPanel"),super.create(),this.$gallery=Pe('<div class="iiif-gallery-component"></div>'),this.$element.append(this.$gallery)}setup(){let v=this;this.galleryComponent=new Le({target:this.$gallery[0]}),this.galleryComponent.on("thumbSelected",function(E){v.extensionHost.publish(U.GALLERY_THUMB_SELECTED,E),v.extensionHost.publish(U.THUMB_SELECTED,E)},!1),this.galleryComponent.on("decreaseSize",function(){v.extensionHost.publish(U.GALLERY_DECREASE_SIZE)},!1),this.galleryComponent.on("increaseSize",function(){v.extensionHost.publish(U.GALLERY_INCREASE_SIZE)},!1)}databind(){this.galleryComponent.options.data=this.galleryData,this.galleryComponent.set(this.galleryData),this.resize()}show(){this.isOpen=!0,this.$element.show(),setTimeout(()=>{this.galleryComponent.selectIndex(this.extension.helper.canvasIndex)},10)}hide(){this.isOpen=!1,this.$element.hide()}resize(){super.resize();let v=this.$gallery.find(".main"),E=this.$gallery.find(".header");v.height(this.$element.height()-E.height())}};var q=ee(),le=class extends Ee{create(){this.setConfig("contentLeftPanel"),super.create(),this.extensionHost.subscribe(x.MODE_CHANGE,()=>{this.setLabel()}),this.extensionHost.subscribe(x.SEARCH_PREVIEW_START,E=>{this.searchPreviewStart(E)}),this.extensionHost.subscribe(x.SEARCH_PREVIEW_FINISH,()=>{this.searchPreviewFinish()}),this.extension.helper.isPaged()&&this.$thumbs.addClass("paged");var v=this;q.views.helpers({separator:function(){return v.extension.helper.isPaged()?(this.data.index-1)%2!=0:!0}})}addSelectedClassToThumbs(v){let E=this.extension.getPagedIndices(v);for(let _=0;_<E.length;_++)this.getThumbByIndex(E[_]).addClass("selected")}isPageModeEnabled(){return typeof this.extension.getMode=="function"?this.config.options.pageModeEnabled&&this.extension.getMode().toString()===z.page.toString():this.config.options.pageModeEnabled}searchPreviewStart(v){this.scrollToThumb(v),this.getThumbByIndex(v).addClass("searchpreview")}searchPreviewFinish(){this.scrollToThumb(this.extension.helper.canvasIndex),this.getAllThumbs().removeClass("searchpreview")}setLabel(){this.isPDF()?(q(this.$thumbs).find("span.index").hide(),q(this.$thumbs).find("span.label").hide()):this.isPageModeEnabled()?(q(this.$thumbs).find("span.index").hide(),q(this.$thumbs).find("span.label").show()):(q(this.$thumbs).find("span.index").show(),q(this.$thumbs).find("span.label").hide())}};var Se=Me(Ce()),xe=ee(),ce=class extends ne{constructor(v){super(v,!0,!0);this.isOpen=!1}create(){this.setConfig("contentLeftPanel"),super.create(),this.$tree=xe('<div class="iiif-tree-component"></div>'),this.$element.append(this.$tree)}setup(){let v=this;this.treeComponent=new Se.TreeComponent({target:this.$tree[0],data:this.treeData}),this.treeComponent.on("treeNodeSelected",function(E){v.extensionHost.publish(U.TREE_NODE_SELECTED,E)},!1),this.treeComponent.on("treeNodeMultiSelected",function(E){v.extensionHost.publish(U.TREE_NODE_MULTISELECTED,E)},!1)}databind(){this.treeComponent.set(this.treeData),this.resize()}show(){this.isOpen=!0,this.$element.show()}hide(){this.isOpen=!1,this.$element.hide()}selectNode(v){if(!this.treeComponent.selectedNode){this.treeComponent.expandParents(v,!0);let E=this.$tree.find("#tree-link-"+v.id)[0];E&&E.scrollIntoView()}this.treeComponent.selectNode(v)}expandNode(v,E){this.treeComponent.expandNode(v,E)}getAllNodes(){return this.treeComponent.getAllNodes()}deselectCurrentNode(){this.treeComponent.deselectCurrentNode()}getNodeById(v){return this.treeComponent.getNodeById(v)}resize(){super.resize()}};var H=ee(),he=fe().ViewingDirection,De=fe().ViewingHint,Ve=class extends _e{constructor(v){super(v);this.expandFullEnabled=!1;this.isThumbsViewOpen=!1;this.isTreeViewOpen=!1;this.treeSortType=Q.NONE}create(){this.setConfig("contentLeftPanel"),super.create(),this.extensionHost.subscribe(U.SETTINGS_CHANGE,()=>{this.databind()}),this.extensionHost.subscribe(U.GALLERY_THUMB_SELECTED,()=>{this.collapseFull()}),this.extensionHost.subscribe(U.METRIC_CHANGE,()=>{this.extension.isDesktopMetric()||this.isFullyExpanded&&this.collapseFull()}),this.extensionHost.subscribe(U.ANNOTATIONS,()=>{this.databindThumbsView(),this.databindGalleryView()}),this.extensionHost.subscribe(U.ANNOTATIONS_CLEARED,()=>{this.databindThumbsView(),this.databindGalleryView()}),this.extensionHost.subscribe(U.ANNOTATIONS_EMPTY,()=>{this.databindThumbsView(),this.databindGalleryView()}),this.extensionHost.subscribe(U.CANVAS_INDEX_CHANGE,()=>{this.isFullyExpanded&&this.collapseFull(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()}),this.extensionHost.subscribe(U.RANGE_CHANGE,()=>{this.isFullyExpanded&&this.collapseFull(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()}),this.$tabs=H('<div class="tabs"></div>'),this.$main.append(this.$tabs),this.$treeButton=H('<a class="index tab" tabindex="0">'+this.content.index+"</a>"),this.$tabs.append(this.$treeButton),this.$thumbsButton=H('<a class="thumbs tab" tabindex="0">'+this.content.thumbnails+"</a>"),this.$tabs.append(this.$thumbsButton),this.$tabsContent=H('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$options=H('<div class="options"></div>'),this.$tabsContent.append(this.$options),this.$topOptions=H('<div class="top"></div>'),this.$options.append(this.$topOptions),this.$treeSelect=H('<select aria-label="'+this.content.manifestRanges+'"></select>'),this.$topOptions.append(this.$treeSelect),this.$bottomOptions=H('<div class="bottom"></div>'),this.$options.append(this.$bottomOptions),this.$leftOptions=H('<div class="left"></div>'),this.$bottomOptions.append(this.$leftOptions),this.$rightOptions=H('<div class="right"></div>'),this.$bottomOptions.append(this.$rightOptions),this.$treeViewOptions=H('<div class="treeView"></div>'),this.$leftOptions.append(this.$treeViewOptions),this.$sortByLabel=H('<span class="sort">'+this.content.sortBy+"</span>"),this.$treeViewOptions.append(this.$sortByLabel),this.$sortButtonGroup=H('<div class="btn-group"></div>'),this.$treeViewOptions.append(this.$sortButtonGroup),this.$sortByDateButton=H('<button class="btn" tabindex="0">'+this.content.date+"</button>"),this.$sortButtonGroup.append(this.$sortByDateButton),this.$sortByVolumeButton=H('<button class="btn" tabindex="0">'+this.content.volume+"</button>"),this.$sortButtonGroup.append(this.$sortByVolumeButton),this.$views=H('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$treeView=H('<div class="treeView"></div>'),this.$views.append(this.$treeView),this.$thumbsView=H('<div class="thumbsView" tabindex="-1"></div>'),this.$views.append(this.$thumbsView),this.$galleryView=H('<div class="galleryView"></div>'),this.$views.append(this.$galleryView),this.$treeSelect.hide(),this.$treeSelect.change(()=>{this.databindTreeView(),this.selectCurrentTreeNode(),this.updateTreeTabBySelection()}),this.$sortByDateButton.on("click",()=>{this.sortByDate()}),this.$sortByVolumeButton.on("click",()=>{this.sortByVolume()}),this.$treeViewOptions.hide(),this.onAccessibleClick(this.$treeButton,()=>{this.openTreeView()}),this.onAccessibleClick(this.$thumbsButton,()=>{this.openThumbsView()}),this.setTitle(this.content.title),this.$sortByVolumeButton.addClass("on");var v=this.options.tabOrder;if(v){v=v.toLowerCase(),v=v.replace(/ /g,"");var E=v.split(",");E[0]==="thumbs"?(this.$treeButton.before(this.$thumbsButton),this.$thumbsButton.addClass("first")):this.$treeButton.addClass("first")}}createTreeView(){this.treeView=new ce(this.$treeView),this.treeView.treeData=this.getTreeData(),this.treeView.setup(),this.databindTreeView();let v=this.extension.helper.getTopRanges();if(v.length>1)for(let E=0;E<v.length;E++){let _=v[E];this.$treeSelect.append('<option value="'+_.id+'">'+ie.getValue(_.getLabel())+"</option>")}this.updateTreeViewOptions()}databind(){this.databindThumbsView(),this.databindTreeView(),this.databindGalleryView()}updateTreeViewOptions(){let v=this.getTree();!v||(this.isCollection()&&this.extension.helper.treeHasNavDates(v)?this.$treeViewOptions.show():this.$treeViewOptions.hide(),this.$treeSelect.find("option").length?this.$treeSelect.show():this.$treeSelect.hide())}sortByDate(){this.treeSortType=Q.DATE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.addClass("on"),this.$sortByVolumeButton.removeClass("on"),this.resize()}sortByVolume(){this.treeSortType=Q.NONE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.removeClass("on"),this.$sortByVolumeButton.addClass("on"),this.resize()}isCollection(){var v=this.getTree();if(v)return v.data.type===ge.COLLECTION;throw new Error("Tree not available")}databindTreeView(){!this.treeView||(this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode())}getTreeData(){return{autoExpand:this._isTreeAutoExpanded(),branchNodesExpandOnClick:k.getBool(this.config.options.branchNodesExpandOnClick,!0),branchNodesSelectable:k.getBool(this.config.options.branchNodesSelectable,!1),helper:this.extension.helper,topRangeIndex:this.getSelectedTopRangeIndex(),treeSortType:this.treeSortType}}_isTreeAutoExpanded(){let v=k.getBool(this.config.options.autoExpandTreeEnabled,!1),E=this.config.options.autoExpandTreeIfFewerThan||0;if(v){let _=this.extension.helper.getFlattenedTree();if(_&&_.length<E)return!0}return!1}updateTreeTabByCanvasIndex(){let v=this.extension.helper.getTopRanges();if(v.length>1){let E=this.getCurrentCanvasTopRangeIndex();if(E===-1)return;let _=v[E];this.setTreeTabTitle(ie.getValue(_.getLabel()))}else this.setTreeTabTitle(this.content.index)}setTreeTabTitle(v){this.$treeButton.text(v)}updateTreeTabBySelection(){let v=null,E=this.extension.helper.getTopRanges();E.length>1&&(this.treeView?v=this.getSelectedTree().text():v=ie.getValue(E[0].getLabel())),v?this.setTreeTabTitle(v):this.setTreeTabTitle(this.content.index)}getViewingHint(){return this.extension.helper.getViewingHint()}getViewingDirection(){return this.extension.helper.getViewingDirection()}createThumbsView(){this.thumbsView=new le(this.$thumbsView),this.databindThumbsView()}databindThumbsView(){if(!this.thumbsView)return;let v,E,_=this.getViewingHint(),u=this.getViewingDirection();u&&(u===he.LEFT_TO_RIGHT||u===he.RIGHT_TO_LEFT)?(v=this.config.options.twoColThumbWidth,E=this.config.options.twoColThumbHeight):_&&_===De.PAGED?(v=this.config.options.twoColThumbWidth,E=this.config.options.twoColThumbHeight):(v=this.config.options.oneColThumbWidth,E=this.config.options.oneColThumbHeight);let d=this.extension.helper.getThumbs(v,E);u&&u===he.BOTTOM_TO_TOP&&d.reverse();let i=this.extension.annotations;if(i&&i.length)for(let h=0;h<i.length;h++){let p=i[h],a=d.filter(l=>l.index===p.canvasIndex)[0];if(a){let l=H.extend(!0,{},a.data);l.searchResults=p.rects.length,a.data=l}}this.thumbsView.thumbs=d,this.thumbsView.databind()}createGalleryView(){this.galleryView=new ae(this.$galleryView),this.galleryView.galleryData=this.getGalleryData(),this.galleryView.setup(),this.databindGalleryView()}databindGalleryView(){!this.galleryView||(this.galleryView.galleryData=this.getGalleryData(),this.galleryView.databind())}getGalleryData(){return{helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),scrollStopDuration:100,searchResults:this.extension.annotations,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.getViewingDirection()}}isPageModeEnabled(){return typeof this.extension.getMode=="function"?k.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===z.page.toString():k.getBool(this.config.options.pageModeEnabled,!0)}getSelectedTree(){return this.$treeSelect.find(":selected")}getSelectedTopRangeIndex(){let v=this.getSelectedTree().index();return v===-1&&(v=0),v}getTree(){let v=this.getSelectedTopRangeIndex();return this.extension.helper.getTree(v,Q.NONE)}toggleFinish(){if(super.toggleFinish(),this.isUnopened){let v=k.getBool(this.config.options.treeEnabled,!0),E=k.getBool(this.config.options.thumbsEnabled,!0),_=this.getTree();(!_||!_.nodes.length)&&(v=!1),(!v||!E)&&this.$tabs.hide(),E&&this.defaultToThumbsView()?this.openThumbsView():v&&this.openTreeView()}}defaultToThumbsView(){let v=k.getBool(this.config.options.defaultToTreeEnabled,!1),E=this.config.options.defaultToTreeIfGreaterThan||0,_=this.getTree();return!(v&&_&&_.nodes.length>E)}expandFullStart(){super.expandFullStart(),this.extensionHost.publish(U.LEFTPANEL_EXPAND_FULL_START)}expandFullFinish(){super.expandFullFinish(),this.$treeButton.hasClass("on")?this.openTreeView():this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.extensionHost.publish(U.LEFTPANEL_EXPAND_FULL_FINISH)}collapseFullStart(){super.collapseFullStart(),this.extensionHost.publish(U.LEFTPANEL_COLLAPSE_FULL_START)}collapseFullFinish(){super.collapseFullFinish(),this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.extensionHost.publish(U.LEFTPANEL_COLLAPSE_FULL_FINISH)}openTreeView(){this.isTreeViewOpen=!0,this.isThumbsViewOpen=!1,this.treeView||this.createTreeView(),this.$treeButton.addClass("on"),this.$thumbsButton.removeClass("on"),this.treeView.show(),this.thumbsView&&this.thumbsView.hide(),this.galleryView&&this.galleryView.hide(),this.updateTreeViewOptions(),this.selectCurrentTreeNode(),this.resize(),this.treeView.resize(),this.extensionHost.publish(U.OPEN_TREE_VIEW)}openThumbsView(){this.isTreeViewOpen=!1,this.isThumbsViewOpen=!0,this.thumbsView||this.createThumbsView(),this.isFullyExpanded&&!this.galleryView&&this.createGalleryView(),this.$treeButton.removeClass("on"),this.$thumbsButton.addClass("on"),this.treeView&&this.treeView.hide(),this.$treeSelect.hide(),this.$treeViewOptions.hide(),this.resize(),this.isFullyExpanded?(this.thumbsView.hide(),this.galleryView&&this.galleryView.show(),this.galleryView&&this.galleryView.resize()):(this.galleryView&&this.galleryView.hide(),this.thumbsView.show(),this.thumbsView.resize()),this.extensionHost.publish(U.OPEN_THUMBS_VIEW)}selectTopRangeIndex(v){this.$treeSelect.prop("selectedIndex",v)}getCurrentCanvasTopRangeIndex(){let v=-1,E=this.extension.getCurrentCanvasRange();return E&&(v=Number(E.path.split("/")[0])),v}selectCurrentTreeNode(){this.extension.type?.name==="uv-openseadragon-extension"?this.selectCurrentTreeNodeByCanvas():this.selectCurrentTreeNodeByRange()}selectCurrentTreeNodeByRange(){if(this.treeView){let v=this.extension.helper.getCurrentRange(),E=null;v&&v.treeNode&&(E=this.treeView.getNodeById(v.treeNode.id)),E?this.treeView.selectNode(E):this.selectTreeNodeByManifest()}}selectCurrentTreeNodeByCanvas(){if(this.treeView){let v=null,E=this.getCurrentCanvasTopRangeIndex(),_=this.getSelectedTopRangeIndex(),u=E===_,d=null;E!==-1&&(d=this.extension.getCurrentCanvasRange(),d&&d.treeNode&&(v=this.treeView.getNodeById(d.treeNode.id))),v&&u?this.treeView.selectNode(v):(d=this.extension.helper.getCurrentRange(),d&&d.treeNode&&(v=this.treeView.getNodeById(d.treeNode.id)),v?this.treeView.selectNode(v):this.selectTreeNodeByManifest())}}selectTreeNodeByManifest(){let v=this.extension.helper.collectionIndex,E=this.extension.helper.manifestIndex,_=this.treeView.getAllNodes(),u=!1;_.map(d=>{d.isCollection()&&d.data.index===v&&(this.treeView.selectNode(d),this.treeView.expandNode(d,!0),u=!0),d.isManifest()&&d.data.index===E&&(this.treeView.selectNode(d),u=!0)}),u||this.treeView.deselectCurrentNode()}resize(){super.resize(),this.$tabsContent.height(this.$main.height()-(de(this.$tabs)?this.$tabs.height():0)-this.$tabsContent.verticalPadding()),this.$views.height(this.$tabsContent.height()-this.$options.outerHeight())}};export{Le as a,z as b,x as c,Ve as d};
