import{b as I,c as R}from"./chunk-YAXTLTJC.js";var M=I(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var Ee;(function(r){r.BOOKMARKING="oa:bookmarking",r.CLASSIFYING="oa:classifying",r.COMMENTING="oa:commenting",r.DESCRIBING="oa:describing",r.EDITING="oa:editing",r.HIGHLIGHTING="oa:highlighting",r.IDENTIFYING="oa:identifying",r.LINKING="oa:linking",r.MODERATING="oa:moderating",r.PAINTING="sc:painting",r.QUESTIONING="oa:questioning",r.REPLYING="oa:replying",r.TAGGING="oa:tagging",r.TRANSCRIBING="oad:transcribing"})(Ee=T.AnnotationMotivation||(T.AnnotationMotivation={}));var ye;(function(r){r.AUTO_ADVANCE="auto-advance",r.CONTINUOUS="continuous",r.FACING_PAGES="facing-pages",r.HIDDEN="hidden",r.INDIVIDUALS="individuals",r.MULTI_PART="multi-part",r.NO_NAV="no-nav",r.NON_PAGED="non-paged",r.PAGED="paged",r.REPEAT="repeat",r.SEQUENCE="sequence",r.THUMBNAIL_NAV="thumbnail-nav",r.TOGETHER="together",r.UNORDERED="unordered"})(ye=T.Behavior||(T.Behavior={}));var me;(function(r){r.CANVAS="canvas",r.CHOICE="choice",r.OA_CHOICE="oa:choice",r.CONTENT_AS_TEXT="contentastext",r.DATASET="dataset",r.DOCUMENT="document",r.IMAGE="image",r.MODEL="model",r.MOVING_IMAGE="movingimage",r.PDF="pdf",r.PHYSICAL_OBJECT="physicalobject",r.SOUND="sound",r.TEXT="text",r.TEXTUALBODY="textualbody",r.VIDEO="video"})(me=T.ExternalResourceType||(T.ExternalResourceType={}));var Ie;(function(r){r.ANNOTATION="annotation",r.CANVAS="canvas",r.COLLECTION="collection",r.MANIFEST="manifest",r.RANGE="range",r.SEQUENCE="sequence"})(Ie=T.IIIFResourceType||(T.IIIFResourceType={}));var Te;(function(r){r.AUDIO_MP4="audio/mp4",r.CORTO="application/corto",r.DICOM="application/dicom",r.DRACO="application/draco",r.EPUB="application/epub+zip",r.GIRDER="image/vnd.kitware.girder",r.GLB="model/gltf-binary",r.GLTF="model/gltf+json",r.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',r.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',r.JPG="image/jpeg",r.M3U8="application/vnd.apple.mpegurl",r.MP3="audio/mp3",r.MPEG_DASH="application/dash+xml",r.OBJ="text/plain",r.OPF="application/oebps-package+xml",r.PDF="application/pdf",r.PLY="application/ply",r.THREEJS="application/vnd.threejs+json",r.USDZ="model/vnd.usd+zip",r.VIDEO_MP4="video/mp4",r.WEBM="video/webm"})(Te=T.MediaType||(T.MediaType={}));var Ae;(function(r){r.DOC="application/msword",r.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",r.PDF="application/pdf"})(Ae=T.RenderingFormat||(T.RenderingFormat={}));var Oe;(function(r){r.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",r.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",r.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",r.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",r.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",r.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",r.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",r.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",r.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",r.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",r.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",r.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",r.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",r.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",r.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",r.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",r.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",r.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",r.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",r.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",r.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",r.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",r.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",r.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",r.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",r.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",r.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",r.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",r.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",r.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",r.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",r.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",r.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",r.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",r.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",r.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",r.SEARCH_0="http://iiif.io/api/search/0/search",r.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",r.SEARCH_1="http://iiif.io/api/search/1/search",r.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",r.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",r.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",r.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",r.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",r.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",r.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"})(Oe=T.ServiceProfile||(T.ServiceProfile={}));var Le;(function(r){r.BOTTOM_TO_TOP="bottom-to-top",r.LEFT_TO_RIGHT="left-to-right",r.RIGHT_TO_LEFT="right-to-left",r.TOP_TO_BOTTOM="top-to-bottom"})(Le=T.ViewingDirection||(T.ViewingDirection={}));var Re;(function(r){r.CONTINUOUS="continuous",r.INDIVIDUALS="individuals",r.NON_PAGED="non-paged",r.PAGED="paged",r.TOP="top"})(Re=T.ViewingHint||(T.ViewingHint={}))});var Tt=I((tr,It)=>{function be(r,t){for(var e=-1,n=t.length,i=r.length;++e<n;)r[i+e]=t[e];return r}It.exports=be});var Ot=I((er,At)=>{var Ue=typeof global=="object"&&global&&global.Object===Object&&global;At.exports=Ue});var Rt=I((nr,Lt)=>{var Ve=Ot(),Ge=typeof self=="object"&&self&&self.Object===Object&&self,He=Ve||Ge||Function("return this")();Lt.exports=He});var tt=I((rr,Ct)=>{var Fe=Rt(),je=Fe.Symbol;Ct.exports=je});var Pt=I((ir,Mt)=>{var Nt=tt(),St=Object.prototype,Be=St.hasOwnProperty,qe=St.toString,W=Nt?Nt.toStringTag:void 0;function Ye(r){var t=Be.call(r,W),e=r[W];try{r[W]=void 0;var n=!0}catch{}var i=qe.call(r);return n&&(t?r[W]=e:delete r[W]),i}Mt.exports=Ye});var wt=I((or,xt)=>{var ke=Object.prototype,Ke=ke.toString;function We(r){return Ke.call(r)}xt.exports=We});var Vt=I((ar,Ut)=>{var Dt=tt(),Qe=Pt(),ze=wt(),Xe="[object Null]",Je="[object Undefined]",bt=Dt?Dt.toStringTag:void 0;function Ze(r){return r==null?r===void 0?Je:Xe:bt&&bt in Object(r)?Qe(r):ze(r)}Ut.exports=Ze});var ot=I((sr,Gt)=>{function $e(r){return r!=null&&typeof r=="object"}Gt.exports=$e});var Ft=I((ur,Ht)=>{var tn=Vt(),en=ot(),nn="[object Arguments]";function rn(r){return en(r)&&tn(r)==nn}Ht.exports=rn});var Yt=I((fr,qt)=>{var jt=Ft(),on=ot(),Bt=Object.prototype,an=Bt.hasOwnProperty,sn=Bt.propertyIsEnumerable,un=jt(function(){return arguments}())?jt:function(r){return on(r)&&an.call(r,"callee")&&!sn.call(r,"callee")};qt.exports=un});var Kt=I((lr,kt)=>{var fn=Array.isArray;kt.exports=fn});var Xt=I((cr,zt)=>{var Wt=tt(),ln=Yt(),cn=Kt(),Qt=Wt?Wt.isConcatSpreadable:void 0;function hn(r){return cn(r)||ln(r)||!!(Qt&&r&&r[Qt])}zt.exports=hn});var at=I((hr,Zt)=>{var pn=Tt(),gn=Xt();function Jt(r,t,e,n,i){var o=-1,a=r.length;for(e||(e=gn),i||(i=[]);++o<a;){var s=r[o];t>0&&e(s)?t>1?Jt(s,t-1,e,n,i):pn(i,s):n||(i[i.length]=s)}return i}Zt.exports=Jt});var te=I((pr,$t)=>{var _n=at();function vn(r){var t=r==null?0:r.length;return t?_n(r,1):[]}$t.exports=vn});var ne=I((gr,ee)=>{var dn=at(),En=1/0;function yn(r){var t=r==null?0:r.length;return t?dn(r,En):[]}ee.exports=yn});var le=I(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.CONTINUE=100;_.SWITCHING_PROTOCOLS=101;_.PROCESSING=102;_.OK=200;_.CREATED=201;_.ACCEPTED=202;_.NON_AUTHORITATIVE_INFORMATION=203;_.NO_CONTENT=204;_.RESET_CONTENT=205;_.PARTIAL_CONTENT=206;_.MULTI_STATUS=207;_.MULTIPLE_CHOICES=300;_.MOVED_PERMANENTLY=301;_.MOVED_TEMPORARILY=302;_.SEE_OTHER=303;_.NOT_MODIFIED=304;_.USE_PROXY=305;_.TEMPORARY_REDIRECT=307;_.BAD_REQUEST=400;_.UNAUTHORIZED=401;_.PAYMENT_REQUIRED=402;_.FORBIDDEN=403;_.NOT_FOUND=404;_.METHOD_NOT_ALLOWED=405;_.NOT_ACCEPTABLE=406;_.PROXY_AUTHENTICATION_REQUIRED=407;_.REQUEST_TIME_OUT=408;_.CONFLICT=409;_.GONE=410;_.LENGTH_REQUIRED=411;_.PRECONDITION_FAILED=412;_.REQUEST_ENTITY_TOO_LARGE=413;_.REQUEST_URI_TOO_LARGE=414;_.UNSUPPORTED_MEDIA_TYPE=415;_.REQUESTED_RANGE_NOT_SATISFIABLE=416;_.EXPECTATION_FAILED=417;_.IM_A_TEAPOT=418;_.UNPROCESSABLE_ENTITY=422;_.LOCKED=423;_.FAILED_DEPENDENCY=424;_.UNORDERED_COLLECTION=425;_.UPGRADE_REQUIRED=426;_.PRECONDITION_REQUIRED=428;_.TOO_MANY_REQUESTS=429;_.REQUEST_HEADER_FIELDS_TOO_LARGE=431;_.INTERNAL_SERVER_ERROR=500;_.NOT_IMPLEMENTED=501;_.BAD_GATEWAY=502;_.SERVICE_UNAVAILABLE=503;_.GATEWAY_TIME_OUT=504;_.HTTP_VERSION_NOT_SUPPORTED=505;_.VARIANT_ALSO_NEGOTIATES=506;_.INSUFFICIENT_STORAGE=507;_.BANDWIDTH_LIMIT_EXCEEDED=509;_.NOT_EXTENDED=510;_.NETWORK_AUTHENTICATION_REQUIRED=511});var ct=I((Ii,ce)=>{ce.exports=function(r,t){return t=t||{},new Promise(function(e,n){var i=new XMLHttpRequest,o=[],a=[],s={},f=function(){return{ok:(i.status/100|0)==2,statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:f,headers:{keys:function(){return o},entries:function(){return a},get:function(l){return s[l.toLowerCase()]},has:function(l){return l.toLowerCase()in s}}}};for(var u in i.open(t.method||"get",r,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(l,c,h){o.push(c=c.toLowerCase()),a.push([c,h]),s[c]=s[c]?s[c]+","+h:h}),e(f())},i.onerror=n,i.withCredentials=t.credentials=="include",t.headers)i.setRequestHeader(u,t.headers[u]);i.send(t.body||null)})}});var pe=I((Ti,he)=>{he.exports=self.fetch||(self.fetch=ct().default||ct())});var de=I((it,gt)=>{(function(r,t){typeof it=="object"&&typeof gt=="object"?gt.exports=t():typeof define=="function"&&define.amd?define("httpstatuscodes",[],t):typeof it=="object"?it.httpstatuscodes=t():r.httpstatuscodes=t()})(window,function(){return function(r){var t={};function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=r,e.c=t,e.d=function(n,i,o){e.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:o})},e.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,i){if(1&i&&(n=e(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var a in n)e.d(o,a,function(s){return n[s]}.bind(null,a));return o},e.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(i,"a",i),i},e.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},e.p="",e(e.s=0)}([function(r,t,e){r.exports=e(1)},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511}])})});var _t=function(){function r(t){this.isVisible=!0;var e=t.target.match(/.*[^n]xyz=(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/),n=t.target.match(/.*nxyz=(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);this.bodyValue=t.bodyValue,this.x=Number(e[1]),this.y=Number(e[2]),this.z=Number(e[3]),this.nx=Number(n[1]),this.ny=Number(n[2]),this.nz=Number(n[3])}return r}();var vt=function(){function r(t){this.isVisible=!0;var e;t.on?(e=t.on.match(/.*xywh=(\d*),(\d*),(\d*),(\d*)/),this.chars=t.resource.chars):(e=t.target.match(/.*xywh=(\d*),(\d*),(\d*),(\d*)/),this.chars=t.bodyValue),this.x=Number(e[1]),this.y=Number(e[2]),this.width=Number(e[3]),this.height=Number(e[4])}return r}();var bn=function(){function r(t){this.rects=[],this.points3D=[],this.canvasId=t}return r.prototype.addRect=function(t){var e=new vt(t);e.canvasId=this.canvasId,e.canvasIndex=this.canvasIndex,e.index=this.rects.length,this.rects.push(e),this.rects.sort(function(n,i){return n.index-i.index})},r.prototype.addPoint3D=function(t){var e=new _t(t);e.canvasId=this.canvasId,e.canvasIndex=this.canvasIndex,e.index=this.points3D.length,this.points3D.push(e),this.points3D.sort(function(n,i){return n.index-i.index})},r}();var Ce=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Vn=function(r){Ce(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.getValue=function(e,n){return e.getValue(n,"<br/>")},t.getValues=function(e,n){return e.getValues(n)},t}(Array);var J=function(){function r(t){this.__jsonld=t,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return r.prototype.getProperty=function(t){var e=null;return this.__jsonld&&(e=this.__jsonld[t],e||(e=this.__jsonld["@"+t])),e},r}();var V=R(M()),Ne=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),A=function(r){Ne(t,r);function t(e,n){var i=r.call(this,e)||this;return i.options=n,i}return t.prototype.getIIIFResourceType=function(){return p.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?C.parse(e,this.options.locale):new C([],this.options.locale)},t.prototype.getDefaultLabel=function(){return this.getLabel().getValue(this.options.locale)},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),n=[];if(!e)return n;for(var i=0;i<e.length;i++){var o=e[i],a=new w(this.options.locale);a.parse(o),n.push(a)}return n},t.prototype.getRendering=function(e){for(var n=this.getRenderings(),i=0;i<n.length;i++){var o=n[i];if(o.getFormat()===e)return o}return null},t.prototype.getRenderings=function(){var e;this.__jsonld?e=this.__jsonld.rendering:e=this.rendering;var n=[];if(!e)return n;Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var o=e[i];n.push(new dt(o,this.options))}return n},t.prototype.getService=function(e){return p.getService(this,e)},t.prototype.getServices=function(){return p.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new Et(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===V.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===V.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===V.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===V.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===V.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===V.IIIFResourceType.SEQUENCE},t}(J);var Se=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),F=function(r){Se(t,r);function t(e,n){return r.call(this,e,n)||this}return t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var n=0;n<this.__jsonld.resources.length;n++){var i=this.__jsonld.resources[n],o=new G(i,this.options);e.push(o)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?p.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){var e=this.getProperty("maxHeight");return e?null:this.getMaxWidth()},t}(A);var k=R(M()),Me=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Z=function(r){Me(t,r);function t(e,n){var i=r.call(this,e,n)||this;i.index=-1,i.isLoaded=!1;var o={defaultLabel:"-",locale:"en-GB",resource:i,pessimisticAccessControl:!1};return i.options=Object.assign(o,n),i}return t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?C.parse(e,this.options.locale):new C([],this.options.locale)},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?C.parse(e,this.options.locale):new C([],this.options.locale)},t.prototype.getHomepage=function(){var e=this.getProperty("homepage");return e?typeof e=="string"?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getIIIFResourceType=function(){return p.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?typeof e=="string"?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return p.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(k.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new P("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,n=this.getProperty("requiredStatement");if(n)e=new w(this.options.locale),e.parse(n);else{var i=this.getAttribution();i&&(e=new w(this.options.locale),e.value=i)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===k.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===k.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise(function(n){if(e.isLoaded)n(e);else{var i=e.options;i.navDate=e.getNavDate();var o=e.__jsonld.id;o||(o=e.__jsonld["@id"]),p.loadManifest(o).then(function(a){e.parentLabel=e.getLabel().getValue(i.locale);var s=$.parse(a,i);e=Object.assign(e,s),e.index=i.index,n(e)})}})},t}(A);var Pe=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),G=function(r){Pe(t,r);function t(e,n){return r.call(this,e,n)||this}return t.prototype.getBody=function(){var e=[],n=this.getProperty("body");if(n)if(Array.isArray(n))for(var i=0;i<n.length;i++){var o=n[i];if(o.items)for(var a=0;a<o.items.length;a++){var s=o.items[a];e.push(new K(s,this.options))}else e.push(new K(o,this.options))}else if(n.items)for(var i=0;i<n.items.length;i++){var o=n.items[i];e.push(new K(o,this.options))}else e.push(new K(n,this.options));return e},t.prototype.getMotivation=function(){var e=this.getProperty("motivation");return e||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new F(this.getProperty("resource"),this.options)},t}(A);var xe=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),K=function(r){xe(t,r);function t(e,n){return r.call(this,e,n)||this}return t.prototype.getFormat=function(){var e=this.getProperty("format");return e?p.getMediaType(e):null},t.prototype.getType=function(){var e=this.getProperty("type");return e?p.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(A);var we=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),yt=function(r){we(t,r);function t(e,n,i){var o=r.call(this,n)||this;return o.label=e,o.options=i,o}return t.prototype.getIIIFResourceType=function(){return p.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this,n=this.getProperty("resources");return n.map(function(i){return new G(i,e.options)})},t.prototype.load=function(){var e=this;return new Promise(function(n,i){if(e.isLoaded)n(e);else{var o=e.__jsonld.id;o||(o=e.__jsonld["@id"]),p.loadManifest(o).then(function(a){e.__jsonld=a,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,n(e)}).catch(i)}})},t}(J);var De=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),mt=function(r){De(t,r);function t(e,n){return r.call(this,e,n)||this}return t.prototype.getItems=function(){return this.getProperty("items")},t}(A);var st=R(M());var et=R(te()),ut=R(ne()),mn=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),j=function(r){mn(t,r);function t(e,n){return r.call(this,e,n)||this}return t.prototype.getCanonicalImageUri=function(e){var n=null,i="full",o=0,a="default",s=e,f;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],s||(s=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(a="native");else{var u=this.getImages();if(u&&u.length){var l=u[0],c=l.getResource(),h=c.getServices();if(s||(s=c.getWidth()),h.length){var v=h[0];n=v.id,a=p.getImageQuality(v.getProfile())}else if(s===c.getWidth())return c.id}if(!n){var d=this.getProperty("thumbnail");if(d){if(typeof d=="string")return d;if(d["@id"])return d["@id"];if(d.length)return d[0].id}}}f=s+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1));var m=[n,i,f,o,a+".jpg"].join("/");return m},t.prototype.getMaxDimensions=function(){var e=null,n;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(n=this.externalResource.data.profile,Array.isArray(n)&&(n=n.filter(function(i){return i["maxWidth"]})[0],n&&(e=new re(n.maxWidth,n.maxHeight?n.maxHeight:n.maxWidth)))),e},t.prototype.getContent=function(){var e=[],n=this.__jsonld.items||this.__jsonld.content;if(!n)return e;var i=null;if(n.length&&(i=new mt(n[0],this.options)),!i)return e;for(var o=i.getItems(),a=0;a<o.length;a++){var s=o[a],f=new G(s,this.options);e.push(f)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var n=0;n<this.__jsonld.images.length;n++){var i=this.__jsonld.images[n],o=new G(i,this.options);e.push(o)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,n=Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")],i=function(a,s){return typeof a!="string"||typeof s!="string"?!1:a.toLowerCase()===a.toLowerCase()},o=n.filter(function(a){return a&&i(a["@type"],"sc:AnnotationList")}).map(function(a,s){return new yt(a.label||"Annotation list "+s,a,e.options)}).map(function(a){return a.load()});return Promise.all(o)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},Object.defineProperty(t.prototype,"imageResources",{get:function(){var e=this,n=(0,ut.default)([this.getImages().map(function(i){return i.getResource()}),this.getContent().map(function(i){return i.getBody()})]);return(0,et.default)(n.map(function(i){switch(i.getProperty("type").toLowerCase()){case st.ExternalResourceType.CHOICE:case st.ExternalResourceType.OA_CHOICE:return new t({images:(0,et.default)([i.getProperty("default"),i.getProperty("item")]).map(function(o){return{resource:o}})},e.options).getImages().map(function(o){return o.getResource()});default:return i}}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resourceAnnotations",{get:function(){return(0,ut.default)([this.getImages(),this.getContent()])},enumerable:!0,configurable:!0}),t.prototype.resourceAnnotation=function(e){return this.resourceAnnotations.find(function(n){return n.getResource().id===e||(0,et.default)(new Array(n.getBody())).some(function(i){return i.id===e})})},t.prototype.onFragment=function(e){var n=this.resourceAnnotation(e);if(!!n){var i=n.getProperty("on"),o=n.getProperty("target"),a=(i||o).match(/xywh=(.*)$/);if(!!a)return a[1].split(",").map(function(s){return parseInt(s,10)})}},Object.defineProperty(t.prototype,"iiifImageResources",{get:function(){return this.imageResources.filter(function(e){return e&&e.getServices()[0]&&e.getServices()[0].id})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageServiceIds",{get:function(){return this.iiifImageResources.map(function(e){return e.getServices()[0].id})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.getWidth()/this.getHeight()},enumerable:!0,configurable:!0}),t}(F);var ie=R(M());var In=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),oe=function(r){In(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.items=[],i._collections=null,i._manifests=null,e.__collection=i,i}return t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(e){return e.isCollection()})},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(e){return e.isManifest()})},t.prototype.getCollectionByIndex=function(e){for(var n=this.getCollections(),i,o=0;o<n.length;o++){var a=n[o];a.index===e&&(i=a)}if(i)return i.options.index=e,i.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var n=this.getManifests(),i,o=0;o<n.length;o++){var a=n[o];a.index===e&&(i=a)}if(i)return i.options.index=e,i.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):ie.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getDefaultTree=function(){return r.prototype.getDefaultTree.call(this),this.defaultTree.data.type=p.normaliseType(O.COLLECTION),this._parseManifests(this),this._parseCollections(this),p.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var n=0;n<e.getManifests().length;n++){var i=e.getManifests()[n],o=i.getDefaultTree();o.label=i.parentLabel||i.getLabel().getValue(this.options.locale)||"manifest "+(n+1),o.navDate=i.getNavDate(),o.data.id=i.id,o.data.type=p.normaliseType(O.MANIFEST),e.defaultTree.addNode(o)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var n=0;n<e.getCollections().length;n++){var i=e.getCollections()[n],o=i.getDefaultTree();o.label=i.parentLabel||i.getLabel().getValue(this.options.locale)||"collection "+(n+1),o.navDate=i.getNavDate(),o.data.id=i.id,o.data.type=p.normaliseType(O.COLLECTION),e.defaultTree.addNode(o)}},t}(Z);var nt=function(){function r(t,e){this.start=t,this.end=e}return r.prototype.getLength=function(){return this.end-this.start},r}();var w=function(){function r(t){this.defaultLocale=t}return r.prototype.parse=function(t){this.resource=t,this.label=C.parse(this.resource.label,this.defaultLocale),this.value=C.parse(this.resource.value,this.defaultLocale)},r.prototype.getLabel=function(t){return this.label===null?null:(Array.isArray(t)&&!t.length&&(t=void 0),this.label.getValue(t||this.defaultLocale))},r.prototype.setLabel=function(t){this.label===null&&(this.label=new C([])),this.label.setValue(t,this.defaultLocale)},r.prototype.getValue=function(t,e){return e===void 0&&(e="<br/>"),this.value===null?null:(Array.isArray(t)&&!t.length&&(t=void 0),this.value.getValue(t||this.defaultLocale,e))},r.prototype.getValues=function(t){return this.value===null?[]:(Array.isArray(t)&&!t.length&&(t=void 0),this.value.getValues(t||this.defaultLocale))},r.prototype.setValue=function(t){this.value===null&&(this.value=new C([])),this.value.setValue(t,this.defaultLocale)},r}();var Tn=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),An=function(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var n=Array(r),i=0,t=0;t<e;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},D=function(){function r(t,e,n){n===void 0&&(n="none"),Array.isArray(t)&&t.length===1?this._value=t[0]:this._value=t,(e==="none"||e==="@none")&&(e=void 0),this._locale=e,this._defaultLocale=n}return r.parseV2Value=function(t,e){return typeof t=="string"?new r(t,void 0,e):t["@value"]?new r(t["@value"],t["@language"],e):null},Object.defineProperty(r.prototype,"value",{get:function(){return Array.isArray(this._value)?this._value.join("<br/>"):this._value},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"locale",{get:function(){return this._locale===void 0?this._defaultLocale:this._locale},enumerable:!0,configurable:!0}),r.prototype.addValue=function(t){Array.isArray(this._value)||(this._value=[this._value]),Array.isArray(t)?this._value=this._value.concat(t):this._value.push(t)},r}();var C=function(r){Tn(t,r);function t(e,n){e===void 0&&(e=[]);var i=r.apply(this,e)||this;return i.__proto__=t.prototype,i._defaultLocale=n,i}return t.parse=function(e,n){if(!e)return new t([],n);if(Array.isArray(e)){var i=e.map(function(a){return D.parseV2Value(a,n)}).filter(function(a){return a!==null}),o=i.reduce(function(a,s){var f=s._locale;return f||(f="none"),a[f]?a[f].addValue(s._value):a[f]=s,a},{});return new t(Object.values(o),n)}else{if(typeof e=="string")return new t([new D(e,void 0,n)],n);if(e["@language"]){var i=D.parseV2Value(e);return new t(i!==null?[i]:[],n)}else return new t(Object.keys(e).map(function(a){var s=e[a];if(!Array.isArray(s))throw new Error("A IIIF v3 localized property value must have an array as the value for a given language.");return new D(s,a,n)}),n)}},t.prototype.getSuitableLocale=function(e){for(var n=An(this).map(function(v){return v._locale}).filter(function(v){return v!==void 0}),i=function(v){var d=n.find(function(m){return m===v});if(d)return{value:d}},o=0,a=e;o<a.length;o++){var s=a[o],f=i(s);if(typeof f=="object")return f.value}for(var u=function(v){var d=n.find(function(m){return p.getInexactLocale(m)===p.getInexactLocale(v)});if(d)return{value:d}},l=0,c=e;l<c.length;l++){var s=c[l],h=u(s);if(typeof h=="object")return h.value}},t.prototype.setValue=function(e,n){var i=void 0;if(!n)i=this.find(function(a){return a._locale===void 0});else{var o=this.getSuitableLocale([n]);o&&(i=this.find(function(a){return a._locale===o}))}i?i._value=e:this.push(new D(e,n,this._defaultLocale))},t.prototype.getValue=function(e,n){var i=this.getValues(e);return i.length===0?null:n?i.join(n):i[0]},t.prototype.getValues=function(e){if(!this.length)return[];var n;if(e?Array.isArray(e)?n=e:n=[e]:n=[],this.length===1&&this[0]._locale===void 0){var i=this[0]._value;return Array.isArray(i)?i:[i]}var o=this.getSuitableLocale(n);if(o){var i=this.find(function(u){return u._locale===o})._value;return Array.isArray(i)?i:[i]}var a=!this.find(function(f){return f._locale===void 0});if(a){var i=this[0]._value;return Array.isArray(i)?i:[i]}var s=this.find(function(f){return f._locale===void 0});return s?Array.isArray(s._value)?s._value:[s._value]:[]},t}(Array);var H=R(M());var On=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),ae=function(r){On(t,r);function t(e,n){var i=r.call(this,e,n)||this;if(i.index=0,i._allRanges=null,i.items=[],i._topRanges=[],i.__jsonld.structures&&i.__jsonld.structures.length)for(var o=i._getTopRanges(),a=0;a<o.length;a++){var s=o[a];i._parseRanges(s,String(a))}return i}return t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new j(e,this.options)),e},t.prototype.getAccompanyingCanvas=function(){var e=this.getProperty("accompanyingCanvas");return e&&(e=new j(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(r.prototype.getDefaultTree.call(this),this.defaultTree.data.type=p.normaliseType(O.MANIFEST),!this.isLoaded)return this.defaultTree;var e=this.getTopRanges();return e.length&&e[0].getTree(this.defaultTree),p.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var n=0;n<this.__jsonld.structures.length;n++){var i=this.__jsonld.structures[n];i.viewingHint===H.ViewingHint.TOP&&e.push(i)}if(!e.length){var o={};o.ranges=this.__jsonld.structures,e.push(o)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var n=0;n<this.__jsonld.structures.length;n++){var i=this.__jsonld.structures[n];if(i["@id"]===e||i.id===e)return i}return null},t.prototype._parseRanges=function(e,n,i){var o,a=null;if(typeof e=="string"&&(a=e,e=this._getRangeById(a)),!e){console.warn("Range:",a,"does not exist");return}o=new se(e,this.options),o.parentRange=i,o.path=n,i?i.items.push(o):this._topRanges.push(o);var s=e.items||e.members;if(s)for(var f=0;f<s.length;f++){var u=s[f];if(u["@type"]&&u["@type"].toLowerCase()==="sc:range"||u.type&&u.type.toLowerCase()==="range")this._parseRanges(u,n+"/"+f,o);else if(u["@type"]&&u["@type"].toLowerCase()==="sc:canvas"||u.type&&u.type.toLowerCase()==="canvas"){o.canvases||(o.canvases=[]);var l=u.id||u["@id"];o.canvases.push(l)}}else if(e.ranges)for(var f=0;f<e.ranges.length;f++)this._parseRanges(e.ranges[f],n+"/"+f,o)},t.prototype.getAllRanges=function(){if(this._allRanges!=null)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),n=function(a){var s=e[a];s.id&&i._allRanges.push(s);var f=function(l,c){l.add(c);var h=c.getRanges();return h.length?h.reduce(f,l):l},u=Array.from(s.getRanges().reduce(f,new Set));i._allRanges=i._allRanges.concat(u)},i=this,o=0;o<e.length;o++)n(o);return this._allRanges},t.prototype.getRangeById=function(e){for(var n=this.getAllRanges(),i=0;i<n.length;i++){var o=n[i];if(o.id===e)return o}return null},t.prototype.getRangeByPath=function(e){for(var n=this.getAllRanges(),i=0;i<n.length;i++){var o=n[i];if(o.path===e)return o}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var n=0;n<e.length;n++){var i=e[n],o=new ft(i,this.options);this.items.push(o)}else if(this.__jsonld.items){var o=new ft(this.__jsonld.items,this.options);this.items.push(o)}return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(H.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):b.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===H.ViewingHint.PAGED;var n=this.getBehavior();return n?n===H.Behavior.PAGED:!1},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(Z);var b;(function(r){r.EMPTY="",r.MANUSCRIPT="manuscript",r.MONOGRAPH="monograph"})(b||(b={}));var ue=R(M()),Ln=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),se=function(r){Ln(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i._ranges=null,i.canvases=null,i.items=[],i}return t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){if(this.canvases&&this.canvases.length){for(var e=[],n=[],i=0,o=this.canvases;i<o.length;i++){var a=o[i];if(!!a){var s=a.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,a],f=s[1],u=s[2],l=s[3];f&&(e.push(parseFloat(u)),n.push(parseFloat(l)))}}if(e.length&&n.length)return new nt(Math.min.apply(Math,e),Math.max.apply(Math,n))}else{for(var c=this.getRanges(),e=[],n=[],h=0,v=c;h<v.length;h++){var d=v[h],m=d.getDuration();m&&(e.push(m.start),n.push(m.end))}if(e.length&&n.length)return new nt(Math.min.apply(Math,e),Math.max.apply(Math,n))}var L,z;if(this.canvases&&this.canvases.length)for(var x=0;x<this.canvases.length;x++){var a=this.canvases[x],X=p.getTemporalComponent(a);X&&X.length>1&&(x===0&&(L=Number(X[0])),x===this.canvases.length-1&&(z=Number(X[1])))}else for(var c=this.getRanges(),x=0;x<c.length;x++){var d=c[x],m=d.getDuration();m&&(x===0&&(L=m.start),x===c.length-1&&(z=m.end))}if(L!==void 0&&z!==void 0)return new nt(L,z)},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(e){return e.isRange()})},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var n=this.getRanges();if(n&&n.length)for(var i=0;i<n.length;i++){var o=n[i],a=new P;e.addNode(a),this._parseTreeNode(a,o)}return p.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var n=this.getDuration();return!!(n&&e>=n.start&&e<=n.end)},t.prototype._parseTreeNode=function(e,n){e.label=n.getLabel().getValue(this.options.locale),e.data=n,e.data.type=p.normaliseType(O.RANGE),n.treeNode=e;var i=n.getRanges();if(i&&i.length)for(var o=0;o<i.length;o++){var a=i[o],s=a.getBehavior();if(s!==ue.Behavior.NO_NAV){var f=new P;e.addNode(f),this._parseTreeNode(f,a)}}},t}(A);var Rn=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),dt=function(r){Rn(t,r);function t(e,n){return r.call(this,e,n)||this}return t.prototype.getFormat=function(){return this.getProperty("format")},t}(A);var B=R(M());var Cn=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),ft=function(r){Cn(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.items=[],i._thumbnails=null,i}return t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var n=0;n<e.length;n++){var i=e[n],o=new j(i,this.options);o.index=n,this.items.push(o)}else if(this.__jsonld)for(var n=0;n<this.__jsonld.length;n++){var i=this.__jsonld[n],o=new j(i,this.options);o.index=n,this.items.push(o)}return this.items},t.prototype.getCanvasById=function(e){for(var n=0;n<this.getTotalCanvases();n++){var i=this.getCanvasByIndex(n),o=p.normaliseUrl(i.id);if(p.normaliseUrl(e)===o)return i}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var n=0;n<this.getTotalCanvases();n++){var i=this.getCanvasByIndex(n);if(i.id===e)return n}return null},t.prototype.getCanvasIndexByLabel=function(e,n){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),n&&(e+="r"));for(var i=/(\d*)\D+(\d*)/,o,a,s,f,u,l=0;l<this.getTotalCanvases();l++){var c=this.getCanvasByIndex(l);if(c.getLabel().getValue(this.options.locale)===e)return l;if(o=i.exec(e),!!o&&(f=o[1],u=o[2],!!u&&(s="^"+f+"\\D+"+u+"$",a=new RegExp(s),a.test(c.getLabel().toString()))))return l}return-1},t.prototype.getLastCanvasLabel=function(e){for(var n=this.getTotalCanvases()-1;n>=0;n--){var i=this.getCanvasByIndex(n),o=i.getLabel().getValue(this.options.locale);if(e){var a=/^[a-zA-Z0-9]*$/;if(a.test(o))return o}else if(o)return o}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,n){var i;if(n){var o=this.getPagedIndices(e),a=this.getViewingDirection();a&&a===B.ViewingDirection.RIGHT_TO_LEFT?i=o[0]+1:i=o[o.length-1]+1}else i=e+1;return i>this.getLastPageIndex()?-1:i},t.prototype.getPagedIndices=function(e,n){var i=[];if(!n)i.push(e);else{this.isFirstCanvas(e)||this.isLastCanvas(e)?i=[e]:e%2?i=[e,e+1]:i=[e-1,e];var o=this.getViewingDirection();o&&o===B.ViewingDirection.RIGHT_TO_LEFT&&(i=i.reverse())}return i},t.prototype.getPrevPageIndex=function(e,n){var i;if(n){var o=this.getPagedIndices(e),a=this.getViewingDirection();a&&a===B.ViewingDirection.RIGHT_TO_LEFT?i=o[o.length-1]-1:i=o[0]-1}else i=e-1;return i},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var n=0;n<this.getTotalCanvases();n++){var i=this.getCanvasByIndex(n);if(i.id===e)return n}return 0},t.prototype.getThumbs=function(e,n){for(var i=[],o=this.getTotalCanvases(),a=0;a<o;a++){var s=this.getCanvasByIndex(a),f=new fe(e,s);i.push(f)}return i},t.prototype.getThumbnails=function(){if(this._thumbnails!=null)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),n=0;n<e.length;n++){var i=e[n].getThumbnail();i&&this._thumbnails.push(i)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return e===0},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return e?e===B.ViewingHint.PAGED:!1},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(A);var $=function(){function r(){}return r.parse=function(t,e){return typeof t=="string"&&(t=JSON.parse(t)),this.parseJson(t,e)},r.parseJson=function(t,e){var n;if(e&&e.navDate&&!isNaN(e.navDate.getTime())&&(t.navDate=e.navDate.toString()),t["@type"])switch(t["@type"]){case"sc:Collection":n=this.parseCollection(t,e);break;case"sc:Manifest":n=this.parseManifest(t,e);break;default:return null}else switch(t.type){case"Collection":n=this.parseCollection(t,e);break;case"Manifest":n=this.parseManifest(t,e);break;default:return null}return n.isLoaded=!0,n},r.parseCollection=function(t,e){var n=new oe(t,e);return e?(n.index=e.index||0,e.resource&&(n.parentCollection=e.resource.parentCollection)):n.index=0,this.parseCollections(n,e),this.parseManifests(n,e),this.parseItems(n,e),n},r.parseCollections=function(t,e){var n;if(t.__jsonld.collections?n=t.__jsonld.collections:t.__jsonld.items&&(n=t.__jsonld.items.filter(function(a){return a.type.toLowerCase()==="collection"})),n)for(var i=0;i<n.length;i++){e&&(e.index=i);var o=this.parseCollection(n[i],e);o.index=i,o.parentCollection=t,t.items.push(o)}},r.parseManifest=function(t,e){var n=new ae(t,e);return n},r.parseManifests=function(t,e){var n;if(t.__jsonld.manifests?n=t.__jsonld.manifests:t.__jsonld.items&&(n=t.__jsonld.items.filter(function(a){return a.type.toLowerCase()==="manifest"})),n)for(var i=0;i<n.length;i++){var o=this.parseManifest(n[i],e);o.index=i,o.parentCollection=t,t.items.push(o)}},r.parseItem=function(t,e){if(t["@type"]){if(t["@type"].toLowerCase()==="sc:manifest")return this.parseManifest(t,e);if(t["@type"].toLowerCase()==="sc:collection")return this.parseCollection(t,e)}else if(t.type){if(t.type.toLowerCase()==="manifest")return this.parseManifest(t,e);if(t.type.toLowerCase()==="collection")return this.parseCollection(t,e)}return null},r.parseItems=function(t,e){var n=t.__jsonld.members||t.__jsonld.items;if(n)for(var i=function(f){e&&(e.index=f);var u=o.parseItem(n[f],e);if(!u)return{value:void 0};if(t.items.filter(function(l){return l.id===u.id})[0])return"continue";u.index=f,u.parentCollection=t,t.items.push(u)},o=this,a=0;a<n.length;a++){var s=i(a);if(typeof s=="object")return s.value}},r}();var Nn=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),lt=function(r){Nn(t,r);function t(e,n){return r.call(this,e,n)||this}return t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return p.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return p.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return p.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return p.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return p.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return p.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+="info.json",e},t}(A);var re=function(){function r(t,e){this.width=t,this.height=e}return r}();var q;(function(r){r[r.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",r[r.FORBIDDEN=2]="FORBIDDEN",r[r.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",r[r.RESTRICTED=4]="RESTRICTED"})(q||(q={}));var fe=function(){function r(t,e){this.data=e,this.index=e.index,this.width=t;var n=e.getHeight()/e.getWidth();n?this.height=Math.floor(this.width*n):this.height=t,this.uri=e.getCanonicalImageUri(t),this.label=e.getLabel().getValue()}return r}();var Sn=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},r(t,e)};return function(t,e){r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Et=function(r){Sn(t,r);function t(e,n){return r.call(this,e,n)||this}return t}(F);var P=function(){function r(t,e){this.label=t,this.data=e||{},this.nodes=[]}return r.prototype.addNode=function(t){this.nodes.push(t),t.parentNode=this},r.prototype.isCollection=function(){return this.data.type===p.normaliseType(O.COLLECTION)},r.prototype.isManifest=function(){return this.data.type===p.normaliseType(O.MANIFEST)},r.prototype.isRange=function(){return this.data.type===p.normaliseType(O.RANGE)},r}();var O;(function(r){r.COLLECTION="collection",r.MANIFEST="manifest",r.RANGE="range"})(O||(O={}));var g=R(M()),N=R(le()),Oi=R(pe()),ht=function(r,t,e,n){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function s(l){try{u(n.next(l))}catch(c){a(c)}}function f(l){try{u(n.throw(l))}catch(c){a(c)}}function u(l){l.done?o(l.value):i(l.value).then(s,f)}u((n=n.apply(r,t||[])).next())})},pt=function(r,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(l){return f([u,l])}}function f(u){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,i=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){e.label=u[1];break}if(u[0]===6&&e.label<o[1]){e.label=o[1],o=u;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(u);break}o[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(r,e)}catch(l){u=[6,l],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},p=function(){function r(){}return r.getMediaType=function(t){return t=t.toLowerCase(),t=t.split(";")[0],t.trim()},r.getImageQuality=function(t){return t===g.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||t===g.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||t===g.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||t===g.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||t===g.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||t===g.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||t===g.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||t===g.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||t===g.ServiceProfile.IMAGE_1_LEVEL_1||t===g.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||t===g.ServiceProfile.IMAGE_1_LEVEL_2||t===g.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},r.getInexactLocale=function(t){return t.indexOf("-")!==-1?t.substr(0,t.indexOf("-")):t},r.getLocalisedValue=function(t,e){if(!Array.isArray(t))return t;for(var n=0;n<t.length;n++){var i=t[n],o=i["@language"];if(e===o)return i["@value"]}for(var a=e.substr(0,e.indexOf("-")),n=0;n<t.length;n++){var s=t[n],f=s["@language"];if(f===a)return s["@value"]}return null},r.generateTreeNodeIds=function(t,e){e===void 0&&(e=0);var n;t.parentNode?n=t.parentNode.id+"-"+e:n="0",t.id=n;for(var i=0;i<t.nodes.length;i++){var o=t.nodes[i];r.generateTreeNodeIds(o,i)}},r.normaliseType=function(t){if(t=(t||"").toLowerCase(),t.indexOf(":")!==-1){var e=t.split(":");return e[1]}return t},r.normaliseUrl=function(t){return t=t.substr(t.indexOf("://")),t.indexOf("#")!==-1&&(t=t.split("#")[0]),t},r.normalisedUrlsMatch=function(t,e){return r.normaliseUrl(t)===r.normaliseUrl(e)},r.isImageProfile=function(t){return!!(r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},r.isLevel0ImageProfile=function(t){return!!(r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_LEVEL_0)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},r.isLevel1ImageProfile=function(t){return!!(r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_LEVEL_1)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},r.isLevel2ImageProfile=function(t){return!!(r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_LEVEL_2)||r.normalisedUrlsMatch(t,g.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},r.parseManifest=function(t,e){return $.parse(t,e)},r.checkStatus=function(t){if(t.ok)return t;var e=new Error(t.statusText);return e.response=t,Promise.reject(e)},r.loadManifest=function(t){return new Promise(function(e,n){fetch(t).then(r.checkStatus).then(function(i){return i.json()}).then(function(i){e(i)}).catch(function(i){n()})})},r.loadExternalResourcesAuth1=function(t,e,n,i,o,a,s,f){return new Promise(function(u,l){var c=t.map(function(h){return r.loadExternalResourceAuth1(h,e,n,i,o,a,s,f)});Promise.all(c).then(function(){u(t)}).catch(function(h){l(h)})})},r.loadExternalResourceAuth1=function(t,e,n,i,o,a,s,f){return ht(this,void 0,void 0,function(){var u;return pt(this,function(l){switch(l.label){case 0:return[4,i(t)];case 1:return u=l.sent(),u?[4,t.getData(u)]:[3,6];case 2:return l.sent(),t.status!==N.OK?[3,3]:[2,t];case 3:return[4,r.doAuthChain(t,e,n,o,a,s,f)];case 4:l.sent(),l.label=5;case 5:if(t.status===N.OK||t.status===N.MOVED_TEMPORARILY)return[2,t];throw r.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return l.sent(),t.status===N.MOVED_TEMPORARILY||t.status===N.UNAUTHORIZED?[4,r.doAuthChain(t,e,n,o,a,s,f)]:[3,9];case 8:l.sent(),l.label=9;case 9:if(t.status===N.OK||t.status===N.MOVED_TEMPORARILY)return[2,t];throw r.createAuthorizationFailedError()}})})},r.doAuthChain=function(t,e,n,i,o,a,s){return ht(this,void 0,void 0,function(){var f,u,l,c,h,v,d,m,m;return pt(this,function(L){switch(L.label){case 0:return t.isAccessControlled()?(f=t.externalService,f&&(f.options=t.options),u=t.kioskService,u&&(u.options=t.options),l=t.clickThroughService,l&&(l.options=t.options),c=t.loginService,c&&(c.options=t.options),!t.isResponseHandled&&t.status===N.MOVED_TEMPORARILY?[4,a(t)]:[3,2]):[2,t];case 1:return L.sent(),[2,t];case 2:return h=null,v=null,h=f,h?(v=h,[4,r.attemptResourceWithToken(t,n,h)]):[3,4];case 3:return L.sent(),[2,t];case 4:return h=u,h?(v=h,d=e(h),d?[4,i(d)]:[3,7]):[3,7];case 5:return L.sent(),[4,r.attemptResourceWithToken(t,n,h)];case 6:return L.sent(),[2,t];case 7:return h=l,h?(v=h,[4,o(t,h)]):[3,11];case 8:return m=L.sent(),m?[4,i(m)]:[3,11];case 9:return L.sent(),[4,r.attemptResourceWithToken(t,n,h)];case 10:return L.sent(),[2,t];case 11:return h=c,h?(v=h,[4,o(t,h)]):[3,15];case 12:return m=L.sent(),m?[4,i(m)]:[3,15];case 13:return L.sent(),[4,r.attemptResourceWithToken(t,n,h)];case 14:return L.sent(),[2,t];case 15:return v&&s(t,v),[2]}})})},r.attemptResourceWithToken=function(t,e,n){return ht(this,void 0,void 0,function(){var i,o;return pt(this,function(a){switch(a.label){case 0:return i=n.getService(g.ServiceProfile.AUTH_1_TOKEN),i?[4,e(t,i)]:[3,3];case 1:return o=a.sent(),o&&o.accessToken?[4,t.getData(o)]:[3,3];case 2:return a.sent(),[2,t];case 3:return[2]}})})},r.loadExternalResourcesAuth09=function(t,e,n,i,o,a,s,f,u,l){return new Promise(function(c,h){var v=t.map(function(d){return r.loadExternalResourceAuth09(d,e,n,i,o,a,s,f,u,l)});Promise.all(v).then(function(){c(t)}).catch(function(d){h(d)})})},r.loadExternalResourceAuth09=function(t,e,n,i,o,a,s,f,u,l){return new Promise(function(c,h){l&&l.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(c(n(t)),c(i(t))):o(t).then(function(){a(t,!0).then(function(v){t.getData(v).then(function(){c(u(t))}).catch(function(d){h(r.createInternalServerError(d))})}).catch(function(v){h(r.createInternalServerError(v))})}).catch(function(v){h(r.createInternalServerError(v))}):c(t)}).catch(function(v){h(r.createInternalServerError(v))}):f(t,e).then(function(v){v?t.getData(v).then(function(){t.status===N.OK?c(u(t)):r.authorize(t,e,n,i,o,a,s,f).then(function(){c(u(t))}).catch(function(d){h(r.createAuthorizationFailedError())})}).catch(function(d){h(r.createAuthorizationFailedError())}):r.authorize(t,e,n,i,o,a,s,f).then(function(){c(u(t))}).catch(function(d){h(r.createAuthorizationFailedError())})}).catch(function(v){h(r.createAuthorizationFailedError())})})},r.createError=function(t,e){var n=new Error;return n.message=e,n.name=String(t),n},r.createAuthorizationFailedError=function(){return r.createError(q.AUTHORIZATION_FAILED,"Authorization failed")},r.createRestrictedError=function(){return r.createError(q.RESTRICTED,"Restricted")},r.createInternalServerError=function(t){return r.createError(q.INTERNAL_SERVER_ERROR,t)},r.authorize=function(t,e,n,i,o,a,s,f){return new Promise(function(u,l){t.getData().then(function(){t.isAccessControlled()?f(t,e).then(function(c){c?t.getData(c).then(function(){t.status===N.OK?u(t):r.showAuthInteraction(t,e,n,i,o,a,s,u,l)}).catch(function(h){l(r.createInternalServerError(h))}):a(t,!1).then(function(h){h?s(t,h,e).then(function(){t.getData(h).then(function(){t.status===N.OK?u(t):r.showAuthInteraction(t,e,n,i,o,a,s,u,l)}).catch(function(v){l(r.createInternalServerError(v))})}).catch(function(v){l(r.createInternalServerError(v))}):r.showAuthInteraction(t,e,n,i,o,a,s,u,l)})}).catch(function(c){l(r.createInternalServerError(c))}):u(t)})})},r.showAuthInteraction=function(t,e,n,i,o,a,s,f,u){t.status===N.MOVED_TEMPORARILY&&!t.isResponseHandled?f(t):t.clickThroughService&&!t.isResponseHandled?n(t).then(function(){a(t,!0).then(function(l){s(t,l,e).then(function(){t.getData(l).then(function(){f(t)}).catch(function(c){u(r.createInternalServerError(c))})}).catch(function(c){u(r.createInternalServerError(c))})}).catch(function(l){u(r.createInternalServerError(l))})}):o(t).then(function(){a(t,!0).then(function(l){s(t,l,e).then(function(){t.getData(l).then(function(){f(t)}).catch(function(c){u(r.createInternalServerError(c))})}).catch(function(c){u(r.createInternalServerError(c))})}).catch(function(l){u(r.createInternalServerError(l))})})},r.getService=function(t,e){for(var n=this.getServices(t),i=0;i<n.length;i++){var o=n[i];if(o.getProfile()===e)return o}return null},r.getResourceById=function(t,e){return r.traverseAndFind(t.__jsonld,"@id",e)},r.traverseAndFind=function(t,e,n){if(t.hasOwnProperty(e)&&t[e]===n)return t;for(var i=0;i<Object.keys(t).length;i++)if(typeof t[Object.keys(t)[i]]=="object"){var o=r.traverseAndFind(t[Object.keys(t)[i]],e,n);if(o!=null)return o}},r.getServices=function(t){var e;t.__jsonld?e=t.__jsonld.service:e=t.service;var n=[];if(!e)return n;Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var o=e[i];if(typeof o=="string"){var a=this.getResourceById(t.options.resource,o);a&&n.push(new lt(a.__jsonld||a,t.options))}else n.push(new lt(o,t.options))}return n},r.getTemporalComponent=function(t){var e=/t=([^&]+)/g.exec(t),n=null;return e&&e[1]&&(n=e[1].split(",")),n},r}();var ge=function(){function r(){this.isEnabled=!1,this.ranges=[],this.canvases=[]}return r.prototype.allCanvasesSelected=function(){return this.canvases.length>0&&this.getAllSelectedCanvases().length===this.canvases.length},r.prototype.allRangesSelected=function(){return this.ranges.length>0&&this.getAllSelectedRanges().length===this.ranges.length},r.prototype.allSelected=function(){return this.allRangesSelected()&&this.allCanvasesSelected()},r.prototype.getAll=function(){return this.canvases.concat(this.ranges)},r.prototype.getAllSelectedCanvases=function(){return this.canvases.filter(function(t){return t.multiSelected})},r.prototype.getAllSelectedRanges=function(){return this.ranges.filter(function(t){return t.multiSelected})},r.prototype.getCanvasById=function(t){return this.canvases.filter(function(e){return p.normaliseUrl(e.id)===p.normaliseUrl(t)})[0]},r.prototype.getCanvasesByIds=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];e.push(this.getCanvasById(i))}return e},r.prototype.getRangeCanvases=function(t){var e=t.getCanvasIds();return this.getCanvasesByIds(e)},r.prototype.selectAll=function(t){this.selectRanges(this.ranges,t),this.selectCanvases(this.canvases,t)},r.prototype.selectCanvas=function(t,e){var n=this.canvases.filter(function(i){return i.id===t.id})[0];n.multiSelected=e},r.prototype.selectAllCanvases=function(t){this.selectCanvases(this.canvases,t)},r.prototype.selectCanvases=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];i.multiSelected=e}},r.prototype.selectRange=function(t,e){var n=this.ranges.filter(function(o){return o.id===t.id})[0];n.multiSelected=e;var i=this.getRangeCanvases(n);this.selectCanvases(i,e)},r.prototype.selectAllRanges=function(t){this.selectRanges(this.ranges,t)},r.prototype.selectRanges=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];i.multiSelected=e;var o=this.getCanvasesByIds(i.getCanvasIds());this.selectCanvases(o,e)}},r.prototype.setEnabled=function(t){this.isEnabled=t;for(var e=this.getAll(),n=0;n<e.length;n++){var i=e[n];i.multiSelectEnabled=this.isEnabled,t||(i.multiSelected=!1)}},r}();var Y=function(){function r(t,e){this.items=[],this.resource=t,this.label=e}return r.prototype.addItem=function(t){this.items.push(t)},r.prototype.addMetadata=function(t,e){e===void 0&&(e=!1);for(var n=0;n<t.length;n++){var i=t[n];i.isRootLevel=e,this.addItem(i)}},r}();var Q;(function(r){r.DATE="date",r.NONE="none"})(Q||(Q={}));var S=R(M());var E=function(){function r(){}return r.manifestNotLoaded="Manifest has not loaded yet",r}();var rt=function(){function r(t){this.options=t,this.iiifResource=this.options.iiifResource,this.manifestUri=this.options.manifestUri,this.manifest=this.options.manifest,this.collectionIndex=this.options.collectionIndex||0,this.manifestIndex=this.options.manifestIndex||0,this.sequenceIndex=this.options.sequenceIndex||0,this.canvasIndex=this.options.canvasIndex||0}return r.prototype.getAutoCompleteService=function(){var t=this.getSearchService(),e=null;return t&&(e=t.getService(S.ServiceProfile.SEARCH_0_AUTO_COMPLETE),e||(e=t.getService(S.ServiceProfile.SEARCH_1_AUTO_COMPLETE))),e},r.prototype.getAttribution=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.manifest.getAttribution();return t?t.getValue(this.options.locale):null},r.prototype.getCanvases=function(){return this.getCurrentSequence().getCanvases()},r.prototype.getCanvasById=function(t){return this.getCurrentSequence().getCanvasById(t)},r.prototype.getCanvasesById=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n],o=this.getCanvasById(i);o&&e.push(o)}return e},r.prototype.getCanvasByIndex=function(t){return this.getCurrentSequence().getCanvasByIndex(t)},r.prototype.getCanvasIndexById=function(t){return this.getCurrentSequence().getCanvasIndexById(t)},r.prototype.getCanvasIndexByLabel=function(t){var e=this.getManifestType()===b.MANUSCRIPT;return this.getCurrentSequence().getCanvasIndexByLabel(t,e)},r.prototype.getCanvasRange=function(t,e){var n=this.getCanvasRanges(t);if(e){for(var i=0;i<n.length;i++){var o=n[i];if(o.path===e)return o}return null}else return n[0]},r.prototype.getCanvasRanges=function(t){if(!this.manifest)throw new Error(E.manifestNotLoaded);return t.ranges||(t.ranges=this.manifest.getAllRanges().filter(function(e){return e.getCanvasIds().some(function(n){return p.normaliseUrl(n)===p.normaliseUrl(t.id)})})),t.ranges},r.prototype.getCollectionIndex=function(t){if(!(t.parentCollection&&!t.parentCollection.parentCollection)&&t.parentCollection)return t.parentCollection.index},r.prototype.getCurrentCanvas=function(){return this.getCurrentSequence().getCanvasByIndex(this.canvasIndex)},r.prototype.getCurrentSequence=function(){return this.getSequenceByIndex(this.sequenceIndex)},r.prototype.getDescription=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.manifest.getDescription();return t?t.getValue(this.options.locale):null},r.prototype.getLabel=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.manifest.getLabel();return t?t.getValue(this.options.locale):null},r.prototype.getLastCanvasLabel=function(t){return this.getCurrentSequence().getLastCanvasLabel(t)},r.prototype.getFirstPageIndex=function(){return 0},r.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},r.prototype.getLicense=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getLicense()},r.prototype.getLogo=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getLogo()},r.prototype.getManifestType=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.manifest.getManifestType();return t===b.EMPTY&&(t=b.MONOGRAPH),t},r.prototype.getMetadata=function(t){if(!this.manifest)throw new Error(E.manifestNotLoaded);var e=[],n=this.manifest.getMetadata(),i=new Y(this.manifest),o=this.options.locale;if(n&&n.length&&i.addMetadata(n,!0),this.manifest.getDescription().length){var a=new w(o);a.label=new C([new D("description",o)]),a.value=this.manifest.getDescription(),a.isRootLevel=!0,i.addItem(a)}if(this.manifest.getAttribution().length){var a=new w(o);a.label=new C([new D("attribution",o)]),a.value=this.manifest.getAttribution(),a.isRootLevel=!0,i.addItem(a)}var s=this.manifest.getLicense();if(s){var f={label:"license",value:t&&t.licenseFormatter?t.licenseFormatter.format(s):s},a=new w(o);a.parse(f),a.isRootLevel=!0,i.addItem(a)}if(this.manifest.getLogo()){var f={label:"logo",value:'<img alt="logo" src="'+this.manifest.getLogo()+'"/>'},a=new w(o);a.parse(f),a.isRootLevel=!0,i.addItem(a)}return e.push(i),t?this._parseMetadataOptions(t,e):e},r.prototype.getRequiredStatement=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.manifest.getRequiredStatement();return t?{label:t.label?t.getLabel():"",value:t.value&&t.value.length?t.getValue():""}:null},r.prototype._parseMetadataOptions=function(t,e){var n=this.getCurrentSequence(),i=n.getMetadata();if(i&&i.length){var o=new Y(n);o.addMetadata(i),e.push(o)}if(t.range){var a=this._getRangeMetadata([],t.range);a=a.reverse(),e=e.concat(a)}if(t.canvases&&t.canvases.length)for(var s=0;s<t.canvases.length;s++){var f=t.canvases[s],u=f.getMetadata();if(u&&u.length){var l=new Y(f);l.addMetadata(f.getMetadata()),e.push(l)}for(var c=f.getImages(),h=0;h<c.length;h++){var v=c[h],d=v.getMetadata();if(d&&d.length){var m=new Y(v);m.addMetadata(d),e.push(m)}}}return e},r.prototype._getRangeMetadata=function(t,e){var n=e.getMetadata();if(n&&n.length){var i=new Y(e);i.addMetadata(n),t.push(i)}else if(e.parentRange)return this._getRangeMetadata(t,e.parentRange);return t},r.prototype.getMultiSelectState=function(){return this._multiSelectState||(this._multiSelectState=new ge,this._multiSelectState.ranges=this.getRanges().slice(0),this._multiSelectState.canvases=this.getCurrentSequence().getCanvases().slice(0)),this._multiSelectState},r.prototype.getCurrentRange=function(){return this.rangeId?this.getRangeById(this.rangeId):null},r.prototype.getPosterCanvas=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getPosterCanvas()},r.prototype.getAccompanyingCanvas=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getAccompanyingCanvas()},r.prototype.getPosterImage=function(){var t=this.getPosterCanvas();if(t){var e=t.getContent();if(e&&e.length){var n=e[0],i=n.getBody();return i[0].id}}return null},r.prototype.getAccompanyingCanvasImage=function(){var t=this.getAccompanyingCanvas();if(t){var e=t.getContent();if(e&&e.length){var n=e[0],i=n.getBody();return i[0].id}}return null},r.prototype.getPreviousRange=function(t){var e=null;if(t?e=t:e=this.getCurrentRange(),e){var n=this.getFlattenedTree();if(n)for(var i=0;i<n.length;i++){var o=n[i];if(o&&o.data.id===e.id){for(;i>0;){i--;var a=n[i];return a.data}break}}}return null},r.prototype.getNextRange=function(t){var e=null;if(t?e=t:e=this.getCurrentRange(),e){var n=this.getFlattenedTree();if(n)for(var i=0;i<n.length;i++){var o=n[i];if(o&&o.data.id===e.id){for(;i<n.length-1;){i++;var a=n[i];if(a.data.canvases&&a.data.canvases.length)return a.data}break}}}return null},r.prototype.getFlattenedTree=function(t){var e=null;return t?e=t:e=this.getTree(),e?this._flattenTree(e,"nodes"):null},r.prototype._flattenTree=function(t,e){var n=this,i=[t];return t[e]&&t[e].length>0?i.concat(t[e].map(function(o){return n._flattenTree(o,e)}).reduce(function(o,a){return o.concat(a)},[])):i},r.prototype.getRanges=function(){return this.manifest.getAllRanges()},r.prototype.getRangeByPath=function(t){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getRangeByPath(t)},r.prototype.getRangeById=function(t){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getRangeById(t)},r.prototype.getRangeCanvases=function(t){var e=t.getCanvasIds();return this.getCanvasesById(e)},r.prototype.getRelated=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getRelated()},r.prototype.getSearchService=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.manifest.getService(S.ServiceProfile.SEARCH_0);return t||(t=this.manifest.getService(S.ServiceProfile.SEARCH_1)),t},r.prototype.getSeeAlso=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getSeeAlso()},r.prototype.getSequenceByIndex=function(t){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getSequenceByIndex(t)},r.prototype.getShareServiceUrl=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=null,e=this.manifest.getService(S.ServiceProfile.SHARE_EXTENSIONS);return e&&(e.length&&(e=e[0]),t=e.__jsonld.shareUrl),t},r.prototype._getSortedTreeNodesByDate=function(t,e){var n=this.getFlattenedTree(e);if(n){var i=n.filter(function(o){return o.data.type===O.MANIFEST});this.createDecadeNodes(t,n),this.sortDecadeNodes(t),this.createYearNodes(t,n),this.sortYearNodes(t),this.createMonthNodes(t,i),this.sortMonthNodes(t),this.createDateNodes(t,i),this.pruneDecadeNodes(t)}},r.prototype.getStartCanvasIndex=function(){return this.getCurrentSequence().getStartCanvasIndex()},r.prototype.getThumbs=function(t,e){return this.getCurrentSequence().getThumbs(t,e)},r.prototype.getTopRanges=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getTopRanges()},r.prototype.getTotalCanvases=function(){return this.getCurrentSequence().getTotalCanvases()},r.prototype.getTrackingLabel=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.getTrackingLabel()},r.prototype._getTopRanges=function(){return this.iiifResource.getTopRanges()},r.prototype.getTree=function(t,e){if(t===void 0&&(t=0),e===void 0&&(e=Q.NONE),!this.iiifResource)return null;var n;if(this.iiifResource.isCollection())n=this.iiifResource.getDefaultTree();else{var i=this._getTopRanges(),o=new P;if(o.label="root",o.data=this.iiifResource,i.length){var a=i[t];n=a.getTree(o)}else return o}var s=new P;switch(e.toString()){case Q.DATE.toString():if(this.treeHasNavDates(n))return this._getSortedTreeNodesByDate(s,n),s;break}return n},r.prototype.treeHasNavDates=function(t){var e=this.getFlattenedTree(t);return e?e.some(function(n){return!isNaN(n.navDate)}):!1},r.prototype.getViewingDirection=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.getCurrentSequence().getViewingDirection();return t||(t=this.manifest.getViewingDirection()),t},r.prototype.getViewingHint=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.getCurrentSequence().getViewingHint();return t||(t=this.manifest.getViewingHint()),t},r.prototype.hasParentCollection=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return!!this.manifest.parentCollection},r.prototype.hasRelatedPage=function(){var t=this.getRelated();return t?(t.length&&(t=t[0]),t.format==="text/html"):!1},r.prototype.hasResources=function(){var t=this.getCurrentCanvas();return t.getResources().length>0},r.prototype.isBottomToTop=function(){var t=this.getViewingDirection();return t?t===S.ViewingDirection.BOTTOM_TO_TOP:!1},r.prototype.isCanvasIndexOutOfRange=function(t){return this.getCurrentSequence().isCanvasIndexOutOfRange(t)},r.prototype.isContinuous=function(){var t=this.getViewingHint();return t?t===S.ViewingHint.CONTINUOUS:!1},r.prototype.isFirstCanvas=function(t){return typeof t!="undefined"?this.getCurrentSequence().isFirstCanvas(t):this.getCurrentSequence().isFirstCanvas(this.canvasIndex)},r.prototype.isHorizontallyAligned=function(){return this.isLeftToRight()||this.isRightToLeft()},r.prototype.isLastCanvas=function(t){return typeof t!="undefined"?this.getCurrentSequence().isLastCanvas(t):this.getCurrentSequence().isLastCanvas(this.canvasIndex)},r.prototype.isLeftToRight=function(){var t=this.getViewingDirection();return t?t===S.ViewingDirection.LEFT_TO_RIGHT:!1},r.prototype.isMultiCanvas=function(){return this.getCurrentSequence().isMultiCanvas()},r.prototype.isMultiSequence=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.isMultiSequence()},r.prototype.isPaged=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);var t=this.getViewingHint();return t?t===S.ViewingHint.PAGED:this.manifest.isPagingEnabled()},r.prototype.isPagingAvailable=function(){return this.isPagingEnabled()&&this.getTotalCanvases()>2},r.prototype.isPagingEnabled=function(){if(!this.manifest)throw new Error(E.manifestNotLoaded);return this.manifest.isPagingEnabled()||this.getCurrentSequence().isPagingEnabled()},r.prototype.isRightToLeft=function(){var t=this.getViewingDirection();return t?t===S.ViewingDirection.RIGHT_TO_LEFT:!1},r.prototype.isTopToBottom=function(){var t=this.getViewingDirection();return t?t===S.ViewingDirection.TOP_TO_BOTTOM:!1},r.prototype.isTotalCanvasesEven=function(){return this.getCurrentSequence().isTotalCanvasesEven()},r.prototype.isUIEnabled=function(t){if(!this.manifest)throw new Error(E.manifestNotLoaded);var e=this.manifest.getService(S.ServiceProfile.UI_EXTENSIONS);if(e){var n=e.getProperty("disableUI");if(n&&(n.indexOf(t)!==-1||n.indexOf(t.toLowerCase())!==-1))return!1}return!0},r.prototype.isVerticallyAligned=function(){return this.isTopToBottom()||this.isBottomToTop()},r.prototype.createDateNodes=function(t,e){for(var n=0;n<e.length;n++){var i=e[n],o=this.getNodeYear(i),a=this.getNodeMonth(i),s=new P;s.id=i.id,s.label=this.getNodeDisplayDate(i),s.data=i.data,s.data.type=O.MANIFEST,s.data.year=o,s.data.month=a;var f=this.getDecadeNode(t,o);if(f){var u=this.getYearNode(f,o);if(u){var l=this.getMonthNode(u,a);l&&l.addNode(s)}}}},r.prototype.createDecadeNodes=function(t,e){for(var n=0;n<e.length;n++){var i=e[n];if(!!i.navDate){var o=this.getNodeYear(i),a=Number(o.toString().substr(0,3)+"9");if(!this.getDecadeNode(t,o)){var s=new P;s.label=o+" - "+a,s.navDate=i.navDate,s.data.startYear=o,s.data.endYear=a,t.addNode(s)}}}},r.prototype.createMonthNodes=function(t,e){for(var n=0;n<e.length;n++){var i=e[n];if(!!i.navDate){var o=this.getNodeYear(i),a=this.getNodeMonth(i),s=this.getDecadeNode(t,o),f=null;if(s&&(f=this.getYearNode(s,o)),s&&f&&!this.getMonthNode(f,a)){var u=new P;u.label=this.getNodeDisplayMonth(i),u.navDate=i.navDate,u.data.year=o,u.data.month=a,f.addNode(u)}}}},r.prototype.createYearNodes=function(t,e){for(var n=0;n<e.length;n++){var i=e[n];if(!!i.navDate){var o=this.getNodeYear(i),a=this.getDecadeNode(t,o);if(a&&!this.getYearNode(a,o)){var s=new P;s.label=o.toString(),s.navDate=i.navDate,s.data.year=o,a.addNode(s)}}}},r.prototype.getDecadeNode=function(t,e){for(var n=0;n<t.nodes.length;n++){var i=t.nodes[n];if(e>=i.data.startYear&&e<=i.data.endYear)return i}return null},r.prototype.getMonthNode=function(t,e){for(var n=0;n<t.nodes.length;n++){var i=t.nodes[n];if(e===this.getNodeMonth(i))return i}return null},r.prototype.getNodeDisplayDate=function(t){return t.navDate.toDateString()},r.prototype.getNodeDisplayMonth=function(t){var e=["January","February","March","April","May","June","July","August","September","October","November","December"];return e[t.navDate.getMonth()]},r.prototype.getNodeMonth=function(t){return t.navDate.getMonth()},r.prototype.getNodeYear=function(t){return t.navDate.getFullYear()},r.prototype.getYearNode=function(t,e){for(var n=0;n<t.nodes.length;n++){var i=t.nodes[n];if(e===this.getNodeYear(i))return i}return null},r.prototype.pruneDecadeNodes=function(t){for(var e=[],n=0;n<t.nodes.length;n++){var i=t.nodes[n];i.nodes.length||e.push(i)}for(var o=0;o<e.length;o++){var a=e[o],s=t.nodes.indexOf(a);s>-1&&t.nodes.splice(s,1)}},r.prototype.sortDecadeNodes=function(t){t.nodes=t.nodes.sort(function(e,n){return e.data.startYear-n.data.startYear})},r.prototype.sortMonthNodes=function(t){for(var e=this,n=0;n<t.nodes.length;n++)for(var i=t.nodes[n],o=0;o<i.nodes.length;o++){var a=i.nodes[o];a.nodes=a.nodes.sort(function(s,f){return e.getNodeMonth(s)-e.getNodeMonth(f)})}},r.prototype.sortYearNodes=function(t){for(var e=this,n=0;n<t.nodes.length;n++){var i=t.nodes[n];i.nodes=i.nodes.sort(function(o,a){return e.getNodeYear(o)-e.getNodeYear(a)})}},r}();var _e=R(M());var ve=function(){function r(t){this._options=t,this._options.locale=this._options.locale||"en-GB"}return r.prototype.bootstrap=function(t,e){var n=this;return new Promise(function(i,o){t&&e&&(i=t,o=e),p.loadManifest(n._options.manifestUri).then(function(a){n._loaded(n,a,i,o)})})},r.prototype._loaded=function(t,e,n,i){var o=p.parseManifest(e,{locale:t._options.locale});if(o){t._options.iiifResource||(t._options.iiifResource=o);var a=t._options.collectionIndex,s=t._options.manifestIndex;if(o.getIIIFResourceType()===_e.IIIFResourceType.COLLECTION){var f=o.getManifests(),u=o.getCollections();!f.length&&a===void 0&&(a=0),a!==void 0&&u&&u.length?o.getCollectionByIndex(a).then(function(c){c||i("Collection index not found"),c.getTotalManifests()===0&&s===0&&c.getTotalCollections()>0?(t._options.collectionIndex=0,t._options.manifestUri=c.id,t.bootstrap(n,i)):s!==void 0&&c.getManifestByIndex(s).then(function(h){t._options.manifest=h;var v=new rt(t._options);n(v)})}):o.getManifestByIndex(t._options.manifestIndex).then(function(c){t._options.manifest=c;var h=new rt(t._options);n(h)})}else{t._options.manifest=o;var l=new rt(t._options);n(l)}}else console.error("Unable to load IIIF resource")},r}();var y=R(M()),U=R(de());var Yi=function(){function r(t,e){this.authHoldingPage=null,this.clickThroughService=null,this.externalService=null,this.isProbed=!1,this.isResponseHandled=!1,this.kioskService=null,this.loginService=null,this.logoutService=null,this.probeService=null,this.restrictedService=null,this.tokenService=null,t.externalResource=this,this.dataUri=this._getDataUri(t),this.index=t.index,this.authAPIVersion=e.authApiVersion,this._parseAuthServices(t),this._parseCanvasDimensions(t)}return r.prototype._getImageServiceDescriptor=function(t){for(var e=null,n=0;n<t.length;n++){var i=t[n],o=i.id;o.endsWith("/")||(o+="/"),p.isImageProfile(i.getProfile())&&(e=o+"info.json")}return e},r.prototype._getDataUri=function(t){var e=t.getContent(),n=t.getImages(),i=null;if(e&&e.length){var o=e[0],a=o.getBody();if(a.length){var s=a[0],f=s.getServices();return f.length&&(i=this._getImageServiceDescriptor(f),i)?i:a[0].id}return null}else if(n&&n.length){var u=n[0],l=u.getResource(),f=l.getServices();return f.length&&(i=this._getImageServiceDescriptor(f),i)?i:l.id}else{var c=t.getService(y.ServiceProfile.IXIF);return c?c.getInfoUri():t.id}},r.prototype._parseAuthServices=function(t){if(this.authAPIVersion===.9)this.clickThroughService=p.getService(t,y.ServiceProfile.AUTH_0_CLICK_THROUGH),this.loginService=p.getService(t,y.ServiceProfile.AUTH_0_LOGIN),this.restrictedService=p.getService(t,y.ServiceProfile.AUTH_0_RESTRICTED),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(y.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.clickThroughService.getService(y.ServiceProfile.AUTH_0_TOKEN)):this.loginService?(this.logoutService=this.loginService.getService(y.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.loginService.getService(y.ServiceProfile.AUTH_0_TOKEN)):this.restrictedService&&(this.logoutService=this.restrictedService.getService(y.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.restrictedService.getService(y.ServiceProfile.AUTH_0_TOKEN));else{if(t.isCanvas!==void 0&&t.isCanvas()){var e=t.getContent();if(e&&e.length){var n=e[0].getBody();if(n&&n.length){var i=n[0];t=i}}}this.clickThroughService=p.getService(t,y.ServiceProfile.AUTH_1_CLICK_THROUGH),this.loginService=p.getService(t,y.ServiceProfile.AUTH_1_LOGIN),this.externalService=p.getService(t,y.ServiceProfile.AUTH_1_EXTERNAL),this.kioskService=p.getService(t,y.ServiceProfile.AUTH_1_KIOSK),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(y.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.clickThroughService.getService(y.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.clickThroughService.getService(y.ServiceProfile.AUTH_1_PROBE)):this.loginService?(this.logoutService=this.loginService.getService(y.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.loginService.getService(y.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.loginService.getService(y.ServiceProfile.AUTH_1_PROBE)):this.externalService?(this.logoutService=this.externalService.getService(y.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.externalService.getService(y.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.externalService.getService(y.ServiceProfile.AUTH_1_PROBE)):this.kioskService&&(this.logoutService=this.kioskService.getService(y.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.kioskService.getService(y.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.kioskService.getService(y.ServiceProfile.AUTH_1_PROBE))}},r.prototype._parseCanvasDimensions=function(t){var e=t.getImages();if(e&&e.length){var n=e[0],i=n.getResource();this.width=i.getWidth(),this.height=i.getHeight()}else if(e=t.getContent(),e.length){var o=e[0],a=o.getBody();a.length&&(this.width=a[0].getWidth(),this.height=a[0].getHeight())}},r.prototype._parseDescriptorDimensions=function(t){t.width!==void 0&&(this.width=t.width),t.height!==void 0&&(this.height=t.height)},r.prototype.isAccessControlled=function(){return!!(this.clickThroughService||this.loginService||this.externalService||this.kioskService||this.probeService)},r.prototype.hasServiceDescriptor=function(){return this.dataUri?this.dataUri.endsWith("info.json"):!1},r.prototype.getData=function(t){var e=this;return e.data={},new Promise(function(n,i){if(!e.dataUri){i("There is no dataUri to fetch");return}if(e.probeService){e.isProbed=!0;var o=new XMLHttpRequest;o.open("GET",e.probeService.id,!0),o.withCredentials=!0,o.onload=function(){var f=JSON.parse(o.responseText),u=unescape(f.contentLocation);u!==e.dataUri?e.status=U.MOVED_TEMPORARILY:e.status=U.OK,n(e)},o.onerror=function(){e.status=o.status,n(e)},o.send()}else{var a="GET";if(!e.hasServiceDescriptor()){if(!e.isAccessControlled()){e.status=U.OK,n(e);return}a="HEAD"}var s=new XMLHttpRequest;s.open(a,e.dataUri,!0),t&&s.setRequestHeader("Authorization","Bearer "+t.accessToken),s.onload=function(){if(!s.responseText)e.status=U.OK,n(e);else{var f=JSON.parse(s.responseText),u=unescape(f["@id"]);e.data=f,e._parseAuthServices(e.data),e._parseDescriptorDimensions(e.data),u.endsWith("/info.json")&&(u=u.substr(0,u.lastIndexOf("/")));var l=e.dataUri;l&&l.endsWith("/info.json")&&(l=l.substr(0,l.lastIndexOf("/"))),u!==l&&e.loginService?e.status=U.MOVED_TEMPORARILY:e.status=U.OK,n(e)}},s.onerror=function(){e.status=s.status,s.responseText&&e._parseAuthServices(JSON.parse(s.responseText)),n(e)},s.send()}})},r}();var Ki=function(){function r(){}return r}();var Qi=function(){function r(){}return r}();var Xi=function(){function r(t,e){this.value=t,this.locale=e}return r}();var Zi=function(){function r(t){this.labels=t}return r.prototype.format=function(t){if(t.indexOf("<a")!=-1)return t;var e=this.labels[t]?this.labels[t]:t;return'<a href="'+t+'">'+e+"</a>"},r}();var eo=function(r){return new ve(r).bootstrap()};export{M as a,bn as b,Vn as c,p as d,b as e,re as f,q as g,O as h,Q as i,de as j,Yi as k,Zi as l,eo as m};
