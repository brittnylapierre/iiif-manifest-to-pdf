import{A as He,B as De,a as C,b as Re,c as v,d as _e,e as z,h as ke,l as Ne,m as S,n as K,o as Ue,p as U,q as s,r as Lt,u as ee,x as H}from"./chunk-WDDAVPLK.js";import{b as R,c as de}from"./chunk-YAXTLTJC.js";var fe=R(W=>{function Fe(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function Ot(e,t,i){}function xt(e,t,i){}var Rt=/javascript\s*\:/img;function _t(e,t){return Rt.test(t)?"":t}W.whiteList=Fe();W.getDefaultWhiteList=Fe;W.onAttr=Ot;W.onIgnoreAttr=xt;W.safeAttrValue=_t});var pe=R((Gi,Ge)=>{Ge.exports={indexOf:function(e,t){var i,n;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var n,r;if(Array.prototype.forEach)return e.forEach(t,i);for(n=0,r=e.length;n<r;n++)t.call(i,e[n],n,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}}});var Be=R((wi,we)=>{var J=pe();function kt(e,t){e=J.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,n=!1,r=0,a=0,l="";function o(){if(!n){var h=J.trim(e.slice(r,a)),f=h.indexOf(":");if(f!==-1){var I=J.trim(h.slice(0,f)),b=J.trim(h.slice(f+1));if(I){var A=t(r,l.length,I,b,h);A&&(l+=A+"; ")}}}r=a+1}for(;a<i;a++){var u=e[a];if(u==="/"&&e[a+1]==="*"){var c=e.indexOf("*/",a+2);if(c===-1)break;a=c+1,r=a+1,n=!1}else u==="("?n=!0:u===")"?n=!1:u===";"?n||o():u===`
`&&o()}return J.trim(l)}we.exports=kt});var Ve=R((Pi,We)=>{var ie=fe(),Nt=Be(),Bi=pe();function Pe(e){return e==null}function Ut(e){var t={};for(var i in e)t[i]=e[i];return t}function Me(e){e=Ut(e||{}),e.whiteList=e.whiteList||ie.whiteList,e.onAttr=e.onAttr||ie.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||ie.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||ie.safeAttrValue,this.options=e}Me.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,n=i.whiteList,r=i.onAttr,a=i.onIgnoreAttr,l=i.safeAttrValue,o=Nt(e,function(u,c,h,f,I){var b=n[h],A=!1;if(b===!0?A=b:typeof b=="function"?A=b(f):b instanceof RegExp&&(A=b.test(f)),A!==!0&&(A=!1),f=l(h,f),!!f){var T={position:c,sourcePosition:u,source:I,isWhite:A};if(A){var E=r(h,f,T);return Pe(E)?h+":"+f:E}else{var E=a(h,f,T);if(!Pe(E))return E}}});return o};We.exports=Me});var ne=R((se,me)=>{var ye=fe(),Qe=Ve();function Ht(e,t){var i=new Qe(t);return i.process(e)}se=me.exports=Ht;se.FilterCSS=Qe;for(ge in ye)se[ge]=ye[ge];var ge;typeof window!="undefined"&&(window.filterCSS=me.exports)});var re=R((Mi,ze)=>{ze.exports={indexOf:function(e,t){var i,n;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var n,r;if(Array.prototype.forEach)return e.forEach(t,i);for(n=0,r=e.length;n<r;n++)t.call(i,e[n],n,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}}});var be=R(g=>{var Dt=ne().FilterCSS,Ft=ne().getDefaultWhiteList,ae=re();function qe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}var Je=new Dt;function Gt(e,t,i){}function wt(e,t,i){}function Bt(e,t,i){}function Pt(e,t,i){}function Xe(e){return e.replace(Wt,"&lt;").replace(Vt,"&gt;")}function Mt(e,t,i,n){if(i=st(i),t==="href"||t==="src"){if(i=ae.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(oe.lastIndex=0,oe.test(i))return""}else if(t==="style"){if(je.lastIndex=0,je.test(i)||(Ze.lastIndex=0,Ze.test(i)&&(oe.lastIndex=0,oe.test(i))))return"";n!==!1&&(n=n||Je,i=n.process(i))}return i=nt(i),i}var Wt=/</g,Vt=/>/g,yt=/"/g,Qt=/&quot;/g,zt=/&#([a-zA-Z0-9]*);?/gim,qt=/&colon;?/gim,Jt=/&newline;?/gim,oe=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,je=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Ze=/u\s*r\s*l\s*\(.*/gi;function Ye(e){return e.replace(yt,"&quot;")}function Ke(e){return e.replace(Qt,'"')}function et(e){return e.replace(zt,function(i,n){return n[0]==="x"||n[0]==="X"?String.fromCharCode(parseInt(n.substr(1),16)):String.fromCharCode(parseInt(n,10))})}function tt(e){return e.replace(qt,":").replace(Jt," ")}function it(e){for(var t="",i=0,n=e.length;i<n;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return ae.trim(t)}function st(e){return e=Ke(e),e=et(e),e=tt(e),e=it(e),e}function nt(e){return e=Ye(e),e=Xe(e),e}function Xt(){return""}function jt(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function n(l){return i?!0:ae.indexOf(e,l)!==-1}var r=[],a=!1;return{onIgnoreTag:function(l,o,u){if(n(l))if(u.isClosing){var c="[/removed]",h=u.position+c.length;return r.push([a!==!1?a:u.position,h]),a=!1,c}else return a||(a=u.position),"[removed]";else return t(l,o,u)},remove:function(l){var o="",u=0;return ae.forEach(r,function(c){o+=l.slice(u,c[0]),u=c[1]}),o+=l.slice(u),o}}}function Zt(e){return e.replace(Yt,"")}var Yt=/<!--[\s\S]*?-->/g;function Kt(e){var t=e.split("");return t=t.filter(function(i){var n=i.charCodeAt(0);return n===127?!1:n<=31?n===10||n===13:!0}),t.join("")}g.whiteList=qe();g.getDefaultWhiteList=qe;g.onTag=Gt;g.onIgnoreTag=wt;g.onTagAttr=Bt;g.onIgnoreTagAttr=Pt;g.safeAttrValue=Mt;g.escapeHtml=Xe;g.escapeQuote=Ye;g.unescapeQuote=Ke;g.escapeHtmlEntities=et;g.escapeDangerHtml5Entities=tt;g.clearNonPrintableCharacter=it;g.friendlyAttrValue=st;g.escapeAttrValue=nt;g.onIgnoreTagStripAll=Xt;g.StripTagBody=jt;g.stripCommentTag=Zt;g.stripBlankChar=Kt;g.cssFilter=Je;g.getDefaultCSSWhiteList=Ft});var ve=R(Ee=>{var D=re();function ei(e){var t=D.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=D.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function ti(e){return e.slice(0,2)==="</"}function ii(e,t,i){var n="",r=0,a=!1,l=!1,o=0,u=e.length,c="",h="";for(o=0;o<u;o++){var f=e.charAt(o);if(a===!1){if(f==="<"){a=o;continue}}else if(l===!1){if(f==="<"){n+=i(e.slice(r,o)),a=o,r=o;continue}if(f===">"){n+=i(e.slice(r,a)),h=e.slice(a,o+1),c=ei(h),n+=t(a,n.length,c,h,ti(h)),r=o+1,a=!1;continue}if((f==='"'||f==="'")&&e.charAt(o-1)==="="){l=f;continue}}else if(f===l){l=!1;continue}}return r<e.length&&(n+=i(e.substr(r))),n}var si=/[^a-zA-Z0-9_:\.\-]/gim;function ni(e,t){var i=0,n=[],r=!1,a=e.length;function l(f,I){if(f=D.trim(f),f=f.replace(si,"").toLowerCase(),!(f.length<1)){var b=t(f,I||"");b&&n.push(b)}}for(var o=0;o<a;o++){var u=e.charAt(o),c,h;if(r===!1&&u==="="){r=e.slice(i,o),i=o+1;continue}if(r!==!1&&o===i&&(u==='"'||u==="'")&&e.charAt(o-1)==="="){if(h=e.indexOf(u,o+1),h===-1)break;c=D.trim(e.slice(i+1,h)),l(r,c),r=!1,o=h,i=o+1;continue}if(/\s|\n|\t/.test(u))if(e=e.replace(/\s|\n|\t/g," "),r===!1)if(h=ri(e,o),h===-1){c=D.trim(e.slice(i,o)),l(c),r=!1,i=o+1;continue}else{o=h-1;continue}else if(h=ai(e,o-1),h===-1){c=D.trim(e.slice(i,o)),c=rt(c),l(r,c),r=!1,i=o+1;continue}else continue}return i<e.length&&(r===!1?l(e.slice(i)):l(r,rt(D.trim(e.slice(i))))),D.trim(n.join(" "))}function ri(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function ai(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function oi(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function rt(e){return oi(e)?e.substr(1,e.length-2):e}Ee.parseTag=ii;Ee.parseAttr=ni});var ct=R((yi,lt)=>{var li=ne().FilterCSS,$=be(),at=ve(),ci=at.parseTag,ui=at.parseAttr,le=re();function ce(e){return e==null}function hi(e){var t=le.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=le.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=le.trim(e.slice(0,-1))),{html:e,closing:i}}function di(e){var t={};for(var i in e)t[i]=e[i];return t}function ot(e){e=di(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=$.onIgnoreTagStripAll),e.whiteList=e.whiteList||$.whiteList,e.onTag=e.onTag||$.onTag,e.onTagAttr=e.onTagAttr||$.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||$.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||$.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||$.safeAttrValue,e.escapeHtml=e.escapeHtml||$.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new li(e.css))}ot.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,n=i.whiteList,r=i.onTag,a=i.onIgnoreTag,l=i.onTagAttr,o=i.onIgnoreTagAttr,u=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=$.stripBlankChar(e)),i.allowCommentTag||(e=$.stripCommentTag(e));var f=!1;if(i.stripIgnoreTagBody){var f=$.StripTagBody(i.stripIgnoreTagBody,a);a=f.onIgnoreTag}var I=ci(e,function(b,A,T,E,Ct){var Y={sourcePosition:b,position:A,isClosing:Ct,isWhite:n.hasOwnProperty(T)},y=r(T,E,Y);if(!ce(y))return y;if(Y.isWhite){if(Y.isClosing)return"</"+T+">";var Oe=hi(E),St=n[T],xe=ui(Oe.html,function(B,P){var he=le.indexOf(St,B)!==-1,Q=l(T,B,P,he);if(!ce(Q))return Q;if(he)return P=u(T,B,P,h),P?B+'="'+P+'"':B;var Q=o(T,B,P,he);return ce(Q)?void 0:Q}),E="<"+T;return xe&&(E+=" "+xe),Oe.closing&&(E+=" /"),E+=">",E}else{var y=a(T,E,Y);return ce(y)?c(E):y}},c);return f&&(I=f.remove(I)),I};lt.exports=ot});var ft=R((X,ue)=>{var ut=be(),ht=ve(),dt=ct();function fi(e,t){var i=new dt(t);return i.process(e)}X=ue.exports=fi;X.FilterXSS=dt;for(F in ut)X[F]=ut[F];var F;for(F in ht)X[F]=ht[F];var F;typeof window!="undefined"&&(window.filterXSS=ue.exports);function pi(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}pi()&&(self.filterXSS=ue.exports)});var q=class{constructor(t,i){this.informationType=t;this.param=i}};var M;(function(i){i[i.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",i[i.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE"})(M||(M={}));var te=class{};te.FORBIDDEN="forbiddenResourceMessage";var L=de(He()),$t=C(),p=class{static loadExternalResources(t,i){return new Promise(n=>{ee.loadExternalResourcesAuth09(t,i,p.clickThrough,p.restricted,p.login,p.getAccessToken,p.storeAccessToken,p.getStoredAccessToken,p.handleExternalResourceResponse).then(r=>{n(r)}).catch(r=>{switch(r.name){case H.AUTHORIZATION_FAILED.toString():p.publish(s.LOGIN_FAILED);break;case H.FORBIDDEN.toString():p.publish(s.FORBIDDEN);break;case H.RESTRICTED.toString():break;default:p.publish(s.SHOW_MESSAGE,[r.message||r])}})})}static clickThrough(t){return new Promise(i=>{p.publish(s.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:t,acceptCallback:()=>{if(t.clickThroughService){let n=window.open(t.clickThroughService.id),r=window.setInterval(()=>{n&&n.closed&&(window.clearInterval(r),p.publish(s.CLICKTHROUGH),i())},500)}}}])})}static restricted(t){return new Promise((i,n)=>{p.publish(s.SHOW_RESTRICTED_DIALOGUE,[{resource:t,acceptCallback:()=>{p.publish(s.LOAD_FAILED),n(t)}}])})}static login(t){return new Promise(i=>{let n={};t.status===L.FORBIDDEN&&(n.warningMessage=te.FORBIDDEN,n.showCancelButton=!0),p.publish(s.SHOW_LOGIN_DIALOGUE,[{resource:t,loginCallback:()=>{if(t.loginService){let r=window.open(t.loginService.id+"?t="+new Date().getTime()),a=window.setInterval(function(){r&&r.closed&&(window.clearInterval(a),p.publish(s.LOGIN),i())},500)}},logoutCallback:()=>{if(t.logoutService){let r=window.open(t.logoutService.id+"?t="+new Date().getTime()),a=window.setInterval(function(){r&&r.closed&&(window.clearInterval(a),p.publish(s.LOGOUT),i())},500)}},options:n}])})}static getAccessToken(t,i){return new Promise((n,r)=>{if(t.tokenService){let a=t.tokenService.id,l=a+"|"+new Date().getTime(),o=c=>{window.removeEventListener("message",o);let h=c.data;h.error?r(i?h.errorDescription:void 0):n(h)};window.addEventListener("message",o,!1);let u=a+"?messageId="+l;$t("#commsFrame").prop("src",u)}else r("Token service not found")})}static storeAccessToken(t,i,n){return new Promise((r,a)=>{t.tokenService?(S.set(t.tokenService.id,i,i.expiresIn,n),r()):a("Token service not found")})}static getStoredAccessToken(t,i){return new Promise((n,r)=>{let a=[],l=null;if(t.tokenService&&(l=S.get(t.tokenService.id,i)),l)a.push(l);else{let u=U.getUrlParts(t.dataUri).hostname,c=S.getItems(i);for(let h=0;h<c.length;h++)l=c[h],l.key.includes(u)&&a.push(l)}a=a.sort((u,c)=>u.expiresAt-c.expiresAt);let o;a.length&&(o=a[a.length-1].value,n(o))})}static handleExternalResourceResponse(t){return new Promise((i,n)=>{if(t.isResponseHandled=!0,t.status===L.OK)i(t);else if(t.status===L.MOVED_TEMPORARILY)i(t),p.publish(s.RESOURCE_DEGRADED,[t]);else if(t.error.status===L.UNAUTHORIZED||t.error.status===L.INTERNAL_SERVER_ERROR)n(t.error.statusText);else if(t.error.status===L.FORBIDDEN){let r=new Error;r.message="Forbidden",r.name=H.FORBIDDEN.toString(),n(r)}else n(t.error.statusText)})}static handleDegraded(t){let i=new q(M.DEGRADED_RESOURCE,t);p.publish(s.SHOW_INFORMATION,[i])}};var gi=ft(),_=e=>gi(e,{whiteList:{a:["href","title","target","class"],b:[],br:[],i:[],img:["src","alt"],p:[],small:[],span:[],strong:[],sub:[],sup:[]}});var Qi=(e,t)=>{let i;return function(...n){let r=this;clearTimeout(i),i=setTimeout(()=>e.apply(r,n),t)}};function mi(e){return new Promise(t=>{let i=document.createElement("script");i.src=e,i.onload=()=>t(),document.head.appendChild(i)})}function bi(e){return new Promise(t=>{let i=document.createElement("link");i.rel="stylesheet",i.href=e,i.onload=()=>t(),document.head.appendChild(i)})}var zi=async e=>{await Promise.all(e.map(async t=>{await mi(t)}))},qi=async e=>{await Promise.all(e.map(async t=>{await bi(t)}))},O=e=>e.is(":visible");var pt=de(He()),Ei=C(),d=class{static loadExternalResources(t,i,n){return new Promise(r=>{d.storageStrategy=i,t=t.map(a=>(a.authAPIVersion=1,a.options=n,a)),ee.loadExternalResourcesAuth1(t,d.openContentProviderInteraction,d.openTokenService,d.getStoredAccessToken,d.userInteractedWithContentProvider,d.getContentProviderInteraction,d.handleMovedTemporarily,d.showOutOfOptionsMessages).then(a=>{r(a)}).catch(a=>{switch(a.name){case H.AUTHORIZATION_FAILED.toString():d.publish(s.LOGIN_FAILED);break;case H.FORBIDDEN.toString():d.publish(s.FORBIDDEN);break;case H.RESTRICTED.toString():break;default:d.publish(s.SHOW_MESSAGE,[a.message||a])}})})}static getCookieServiceUrl(t){return t.id+"?origin="+d.getOrigin()}static openContentProviderInteraction(t){let i=d.getCookieServiceUrl(t);return window.open(i)}static getOrigin(t){let i=window.location;return t&&(i=document.createElement("a"),i.href=t),i.protocol+"//"+i.hostname+(i.port?":"+i.port:"")}static userInteractedWithContentProvider(t){return new Promise(i=>{let n=window.setInterval(()=>{t.closed&&(window.clearInterval(n),i(!0))},500)})}static handleMovedTemporarily(t){return new Promise(i=>{d.showDegradedMessage(t),t.isResponseHandled=!0,i()})}static showDegradedMessage(t){let i=new q(M.DEGRADED_RESOURCE,t);d.publish(s.SHOW_INFORMATION,[i])}static storeAccessToken(t,i){return new Promise((n,r)=>{t.tokenService?(S.set(t.tokenService.id,i,i.expiresIn,d.storageStrategy),n()):r("Token service not found")})}static getStoredAccessToken(t){return new Promise((i,n)=>{let r=[],a=null;if(t.tokenService&&(a=S.get(t.tokenService.id,d.storageStrategy)),a)r.push(a);else{let o=U.getUrlParts(t.dataUri).hostname,u=S.getItems(d.storageStrategy);for(let c=0;c<u.length;c++)a=u[c],a.key.includes(o)&&r.push(a)}r=r.sort((o,u)=>o.expiresAt-u.expiresAt);let l=null;r.length&&(l=r[r.length-1].value),i(l)})}static getContentProviderInteraction(t,i){return new Promise(n=>{t.isResponseHandled&&!t.authHoldingPage?(d.showDegradedMessage(t),n(null)):t.authHoldingPage?(t.authHoldingPage.location.href=d.getCookieServiceUrl(i),n(t.authHoldingPage)):d.publish(s.SHOW_AUTH_DIALOGUE,[{service:i,closeCallback:()=>{n(null)},confirmCallback:()=>{let r=d.openContentProviderInteraction(i);n(r)},cancelCallback:()=>{n(null)}}])})}static openTokenService(t,i){return new Promise((n,r)=>{let a=d.getOrigin(i.id),l=new Date().getTime();d.messages[l]={resolve:n,reject:r,serviceOrigin:a,resource:t},window.addEventListener("message",d.receiveToken,!1);let o=i.id+"?messageId="+l+"&origin="+d.getOrigin();Ei("#commsFrame").prop("src",o);let u=5e3;setTimeout(()=>{d.messages[l]&&(d.messages[l].reject("Message unhandled after "+u+"ms, rejecting"),delete d.messages[l])},u)})}static receiveToken(t){if(t.data.hasOwnProperty("messageId")){let i=d.messages[t.data.messageId];i&&t.origin==i.serviceOrigin&&d.storeAccessToken(i.resource,t.data).then(()=>{i.resolve(t.data),delete d.messages[t.data.messageId]})}}static showOutOfOptionsMessages(t,i){if(t.status==pt.MOVED_TEMPORARILY)return;let n="";i.getFailureHeader()&&(n+="<p>"+i.getFailureHeader()+"</p>"),i.getFailureDescription()&&(n+=i.getFailureDescription()),d.publish(s.SHOW_MESSAGE,[_(n)])}},j=d;j.messages={};var Ie=class{constructor(t,i,n){this.isResized=!1;this.$element=t,this.fitToParentWidth=i||!1,this.fitToParentHeight=n||!1,this.create()}create(){this.component.subscribe(s.RESIZE,()=>{this.resize()})}whenResized(t){Re.waitFor(()=>this.isResized,t)}onAccessibleClick(t,i,n=!0){n&&t.on("click",r=>{i(r)}),t.on("keyup",r=>{r.keyCode===32&&i(r)})}resize(){let t=this.$element.parent();this.fitToParentWidth&&this.$element.width(t.width()),this.fitToParentHeight&&this.$element.height(t.height()),this.isResized=!0}};var vi=C(),G=class extends Ie{constructor(t,i,n){super(t,i,n)}create(){this.component=this.$element.closest(".uv-extension-host").data("component"),super.create(),this.extension=this.component.extension,this.config={},this.config.content={},this.config.options={};var t=this;t.modules&&t.modules.length&&(t.modules=t.modules.reverse(),t.modules.forEach(i=>{t.config=vi.extend(!0,t.config,t.extension.data.config.modules[i])})),this.content=this.config.content,this.options=this.config.options}init(){}setConfig(t){this.modules||(this.modules=[]),this.modules.push(t)}resize(){super.resize()}};var w=C(),x=class extends G{constructor(t){super(t,!1,!1);this.allowClose=!0;this.isActive=!1;this.isUnopened=!0}create(){this.setConfig("dialogue"),super.create(),this.component.subscribe(s.CLOSE_ACTIVE_DIALOGUE,()=>{this.isActive&&this.allowClose&&this.close()}),this.component.subscribe(s.ESCAPE,()=>{this.isActive&&this.allowClose&&this.close()}),this.$top=w('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=w('<button type="button" class="btn btn-default close" tabindex="0">'+this.content.close+"</button>"),this.$middle=w('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=w('<div class="content"></div>'),this.$middle.append(this.$content),this.$buttons=w('<div class="buttons"></div>'),this.$middle.append(this.$buttons),this.$bottom=w('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.config.topCloseButtonEnabled?this.$top.append(this.$closeButton):this.$buttons.append(this.$closeButton),this.$closeButton.on("click",t=>{t.preventDefault(),this.close()}),this.returnFunc=this.close}enableClose(){this.allowClose=!0,this.$closeButton.show()}disableClose(){this.allowClose=!1,this.$closeButton.hide()}setDockedPosition(){let t=Math.floor(this.extension.height()-this.$element.outerHeight(!0)),i=0,n=0,r=0;if(this.$triggerButton){let a=4,l=2,o=this.$triggerButton.offset().top,u=this.extension.$element.offset().top,c=this.$element.outerHeight(!0);t=o-u-c+a;let f=this.$triggerButton.offset().left,I=this.extension.$element.offset().left,b=f-I;r=ke.normalise(b,0,this.extension.width()),i=Math.floor(this.extension.width()*r-this.$element.width()*r)+l,n=Math.floor(this.$element.width()*r)}this.$bottom.css("backgroundPosition",n+"px 0px"),this.$element.css({top:t,left:i})}open(t){this.$element.attr("aria-hidden","false"),this.$element.show(),t?(this.$triggerButton=w(t),this.$bottom.show()):this.$bottom.hide(),this.isActive=!0,setTimeout(()=>{let i=this.$element.find(".default");if(i.length)i.focus();else{let n=this.$element.find("input:visible").first();n.length?n.focus():this.$closeButton.focus()}},1),this.component.publish(s.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()}afterFirstOpen(){}close(){!this.isActive||(this.$element.attr("aria-hidden","true"),this.$element.hide(),this.isActive=!1,this.component.publish(this.closeCommand),this.component.publish(s.HIDE_OVERLAY))}resize(){super.resize(),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})}};var gt=C(),Ae=class extends x{constructor(t){super(t)}create(){this.setConfig("authDialogue"),super.create(),this.openCommand=s.SHOW_AUTH_DIALOGUE,this.closeCommand=s.HIDE_AUTH_DIALOGUE,this.component.subscribe(this.openCommand,t=>{this.closeCallback=t.closeCallback,this.confirmCallback=t.confirmCallback,this.cancelCallback=t.cancelCallback,this.service=t.service,this.open()}),this.component.subscribe(this.closeCommand,()=>{this.close()}),this.$title=gt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>            </div>'),this.$buttons.prepend(this._buttonsToAdd()),this.$message=this.$content.find(".message"),this.$confirmButton=this.$buttons.find(".confirm"),this.$confirmButton.text(this.content.confirm),this.$cancelButton=this.$buttons.find(".close"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$confirmButton.on("click",t=>{t.preventDefault(),this.confirmCallback&&this.confirmCallback(),this.close()}),this.$cancelButton.on("click",t=>{t.preventDefault(),this.cancelCallback&&this.cancelCallback(),this.close()})}open(){super.open();let t=this.service.getHeader(),i=this.service.getDescription(),n=this.service.getConfirmLabel();t&&this.$title.text(_(t)),i&&(this.$message.html(_(i)),this.$message.targetBlank(),this.$message.find("a").on("click",function(){let r=gt(this).attr("href");this.component.publish(s.EXTERNAL_LINK_CLICKED,r)})),n&&this.$confirmButton.text(_(n)),this.resize()}resize(){super.resize()}_buttonsToAdd(){var t='<a class="confirm btn btn-primary" href="#" target="_parent"></a>';return this.config.topCloseButtonEnabled&&(t+='<button class="close btn btn-default"></button>'),t}};var mt=C(),Te=class extends x{constructor(t){super(t)}create(){this.setConfig("clickThroughDialogue"),super.create(),this.openCommand=s.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=s.HIDE_CLICKTHROUGH_DIALOGUE,this.component.subscribe(this.openCommand,t=>{this.acceptCallback=t.acceptCallback,this.resource=t.resource,this.open()}),this.component.subscribe(this.closeCommand,()=>{this.close()}),this.$title=mt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",t=>{t.preventDefault(),this.close(),this.component.publish(s.ACCEPT_TERMS),this.acceptCallback&&this.acceptCallback()})}open(){super.open(),this.resource.clickThroughService&&(this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank()),this.$message.find("a").on("click",function(){var t=mt(this).attr("href");this.component.publish(s.EXTERNAL_LINK_CLICKED,t)}),this.resize()}resize(){super.resize()}};var bt=C(),Ce=class extends x{constructor(t){super(t)}create(){this.setConfig("loginDialogue"),super.create(),this.openCommand=s.SHOW_LOGIN_DIALOGUE,this.closeCommand=s.HIDE_LOGIN_DIALOGUE,this.component.subscribe(this.openCommand,t=>{this.loginCallback=t.loginCallback,this.logoutCallback=t.logoutCallback,this.options=t.options,this.resource=t.resource,this.open()}),this.component.subscribe(this.closeCommand,()=>{this.close()}),this.$title=bt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",t=>{t.preventDefault(),this.close(),this.loginCallback&&this.loginCallback()}),this.$logoutButton.on("click",t=>{t.preventDefault(),this.close(),this.logoutCallback&&this.logoutCallback()}),this.$cancelButton.on("click",t=>{t.preventDefault(),this.close()}),this.updateLogoutButton()}open(){super.open();let t="";this.resource.loginService&&(this.$title.text(this.resource.loginService.getProperty("label")),t=this.resource.loginService.getProperty("description")),this.options.warningMessage&&(t='<span class="warning">'+this.extension.data.config.content[this.options.warningMessage]+'</span><span class="description">'+t+"</span>"),this.updateLogoutButton(),this.$message.html(t),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var i=bt(this).attr("href");this.component.publish(s.EXTERNAL_LINK_CLICKED,i)}),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()}updateLogoutButton(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()}resize(){super.resize()}};var Et=C(),Se=class extends x{constructor(t){super(t)}create(){this.setConfig("restrictedDialogue"),super.create(),this.openCommand=s.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=s.HIDE_RESTRICTED_DIALOGUE,this.component.subscribe(this.openCommand,t=>{this.acceptCallback=t.acceptCallback,this.options=t.options,this.resource=t.resource,this.open()}),this.component.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Et('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",t=>{t.preventDefault(),this.close()})}open(){super.open(),this.isAccepted=!1;let t="";this.resource.restrictedService&&(this.$title.text(this.resource.restrictedService.getProperty("label")),t=this.resource.restrictedService.getProperty("description")),this.$message.html(t),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var i=Et(this).attr("href");this.component.publish(s.EXTERNAL_LINK_CLICKED,i)}),this.resize()}close(){super.close(),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())}resize(){super.resize()}};var vt=C(),Le=class extends x{constructor(t){super(t)}create(){this.setConfig("genericDialogue"),super.create(),this.openCommand=s.SHOW_GENERIC_DIALOGUE,this.closeCommand=s.HIDE_GENERIC_DIALOGUE,this.component.subscribe(this.openCommand,t=>{this.acceptCallback=t.acceptCallback,this.showMessage(t)}),this.component.subscribe(this.closeCommand,()=>{this.close()}),this.$message=vt("<p></p>"),this.$content.append(this.$message),this.$acceptButton=vt(`
          <button class="btn btn-primary accept default">
            ${this.content.ok}
          </button>
        `),this.$buttons.append(this.$acceptButton),this.$buttons.find(".close").hide(),this.$acceptButton.onPressed(()=>{this.accept()}),this.returnFunc=()=>{this.isActive&&this.accept()},this.$element.hide()}accept(){this.component.publish(s.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()}showMessage(t){this.$message.html(t.message),t.buttonText?this.$acceptButton.text(t.buttonText):this.$acceptButton.text(this.content.ok),t.allowClose===!1&&this.disableClose(),this.open()}resize(){super.resize()}};var k=C(),$e=class extends G{constructor(t){super(t,!0,!0)}create(){super.create(),this.component.subscribe(s.SHOW_OVERLAY,()=>{this.$overlays.show()}),this.component.subscribe(s.HIDE_OVERLAY,()=>{this.$overlays.hide()}),this.$element.append('<a class="sr-only" href="#download-btn">'+this.extension.data.config.content.skipToDownload+"</a>"),this.$headerPanel=k('<div class="headerPanel"></div>'),this.$element.append(this.$headerPanel),this.$mainPanel=k('<div class="mainPanel"></div>'),this.$element.append(this.$mainPanel),this.$centerPanel=k('<div class="centerPanel"></div>'),this.$centerPanel.append('<h2 class="sr-only">'+this.extension.data.config.content.mediaViewer+"</h2>"),this.$mainPanel.append(this.$centerPanel),this.$leftPanel=k('<div class="leftPanel"></div>'),this.$mainPanel.append(this.$leftPanel),this.$rightPanel=k('<div class="rightPanel"></div>'),this.$mainPanel.append(this.$rightPanel),this.$footerPanel=k('<div class="footerPanel"></div>'),this.$element.append(this.$footerPanel),this.$mobileFooterPanel=k('<div class="mobileFooterPanel"></div>'),this.$element.append(this.$mobileFooterPanel),this.$overlays=k('<div class="overlays"></div>'),this.$element.append(this.$overlays),this.$overlays.hide(),this.$genericDialogue=k('<div class="overlay genericDialogue" aria-hidden="true"></div>'),this.$overlays.append(this.$genericDialogue),this.$overlays.on("click",t=>{k(t.target).hasClass("overlays")&&(t.preventDefault(),this.component.publish(s.CLOSE_ACTIVE_DIALOGUE))}),new Le(this.$genericDialogue)}resize(){super.resize(),setTimeout(()=>{this.$overlays.width(this.extension.width()),this.$overlays.height(this.extension.height())},1);let t=this.$element.height()-parseInt(this.$mainPanel.css("paddingTop"))-(O(this.$headerPanel)?this.$headerPanel.height():0)-(O(this.$footerPanel)?this.$footerPanel.height():0)-(O(this.$mobileFooterPanel)?this.$mobileFooterPanel.height():0);this.$mainPanel.height(t)}};var At=de(Lt());var m;(function(e){e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.PauseBreak=19]="PauseBreak",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.Spacebar=32]="Spacebar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.PrintScrn=44]="PrintScrn",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Zero=48]="Zero",e[e.One=49]="One",e[e.Two=50]="Two",e[e.Three=51]="Three",e[e.Four=52]="Four",e[e.Five=53]="Five",e[e.Six=54]="Six",e[e.Seven=55]="Seven",e[e.Eight=56]="Eight",e[e.Nine=57]="Nine",e[e.a=65]="a",e[e.b=66]="b",e[e.c=67]="c",e[e.d=68]="d",e[e.e=69]="e",e[e.f=70]="f",e[e.g=71]="g",e[e.h=72]="h",e[e.i=73]="i",e[e.j=74]="j",e[e.k=75]="k",e[e.l=76]="l",e[e.m=77]="m",e[e.n=78]="n",e[e.o=79]="o",e[e.p=80]="p",e[e.q=81]="q",e[e.r=82]="r",e[e.s=83]="s",e[e.t=84]="t",e[e.u=85]="u",e[e.v=86]="v",e[e.w=87]="w",e[e.x=88]="x",e[e.y=89]="y",e[e.z=90]="z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.NumpadPlus=107]="NumpadPlus",e[e.NumpadMinus=109]="NumpadMinus",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.Semicolon=186]="Semicolon",e[e.Equals=187]="Equals",e[e.Comma=188]="Comma",e[e.LessThan=188]="LessThan",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.GreaterThan=190]="GreaterThan",e[e.ForwardSlash=191]="ForwardSlash",e[e.QuestionMark=191]="QuestionMark",e[e.GraveAccent=192]="GraveAccent",e[e.Tilde=192]="Tilde",e[e.OpenCurlyBracket=219]="OpenCurlyBracket",e[e.OpenSquareBracket=219]="OpenSquareBracket",e[e.BackSlash=220]="BackSlash",e[e.VerticalPipe=220]="VerticalPipe",e[e.CloseCurlyBracket=221]="CloseCurlyBracket",e[e.CloseSquareBracket=221]="CloseSquareBracket",e[e.Quote=222]="Quote",e[e.CommandFF=224]="CommandFF"})(m||(m={}));var It;(function(e){e[e.Backspace=8]="Backspace",e[e.Enter=13]="Enter",e[e.Spacebar=32]="Spacebar",e[e.Hash=35]="Hash",e[e.GraveAccent=39]="GraveAccent",e[e.DoubleQuote=34]="DoubleQuote",e[e.Asterisk=42]="Asterisk",e[e.Plus=43]="Plus",e[e.Comma=44]="Comma",e[e.Minus=45]="Minus",e[e.Period=46]="Period",e[e.ForwardSlash=47]="ForwardSlash",e[e.Zero=48]="Zero",e[e.One=49]="One",e[e.Two=50]="Two",e[e.Three=51]="Three",e[e.Four=52]="Four",e[e.Five=53]="Five",e[e.Six=54]="Six",e[e.Seven=55]="Seven",e[e.Eight=56]="Eight",e[e.Nine=57]="Nine",e[e.Colon=58]="Colon",e[e.Semicolon=59]="Semicolon",e[e.LessThan=60]="LessThan",e[e.Equals=61]="Equals",e[e.GreaterThan=62]="GreaterThan",e[e.QuestionMark=63]="QuestionMark",e[e.At=64]="At",e[e.OpenSquareBracket=91]="OpenSquareBracket",e[e.BackSlash=92]="BackSlash",e[e.CloseSquareBracket=93]="CloseSquareBracket",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.OpenCurlyBracket=123]="OpenCurlyBracket",e[e.VerticalPipe=124]="VerticalPipe",e[e.CloseCurlyBracket=125]="CloseCurlyBracket",e[e.Tilde=126]="Tilde"})(It||(It={}));var N=C(),Ii=class{constructor(){this.isCreated=!1;this.isLoggedIn=!1;this.metrics=[];this.shifted=!1;this.tabbing=!1;this.locales={}}create(){let t=this;if(this.browserDetect=new Tt,this.browserDetect.init(),p.publish=this.component.publish.bind(this.component),j.publish=this.component.publish.bind(this.component),this.$element=N(this.component.options.target),this.$element.data("component",this.component),this.fire(s.CREATE,{data:this.data,settings:this.getSettings(),preview:this.getSharePreview()}),this._parseMetrics(),this._initLocales(),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("uv-extension-host"),this.$element.addClass("loading"),this.data.locales&&this.$element.addClass(this.data.locales[0].name.toLowerCase()),this.$element.addClass(this.type.name),this.$element.addClass("browser-"+this.browserDetect.browser),this.$element.addClass("browser-version-"+this.browserDetect.version),this.$element.prop("tabindex",-1),this.data.embedded&&this.$element.addClass("embedded"),this.isMobile()&&this.$element.addClass("mobile"),z.supportsFullscreen()&&this.$element.addClass("fullscreen-supported"),this.isFullScreen()&&this.$element.addClass("fullscreen"),this.$element.on("mousemove",i=>{this.mouseX=i.pageX,this.mouseY=i.pageY}),!this.data.isReload){let i=z.getHiddenProp();if(i){let n=i.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(n,()=>{z.isHidden()||this.resize()})}v.getBool(this.data.config.options.dropEnabled,!0)&&this.$element.on("drop",n=>{n.preventDefault();let r=n.originalEvent.dataTransfer.getData("URL"),a=U.getUrlParts(r),l=U.getQuerystringParameterFromString("manifest",a.search);if(l||(l=U.getQuerystringParameterFromString("collection",a.search)),l){this.fire(s.DROP,l);let o={};o.manifest=l,this.reload(o)}}),this.$element.on("dragover",n=>{n.preventDefault()}),this.$element.on("keyup keydown",n=>{this.shifted=n.shiftKey,this.tabbing=n.keyCode===m.Tab}),this.$element.on("keydown",n=>{let r=null,a=!0;!n.ctrlKey&&!n.altKey&&!n.shiftKey&&(n.keyCode===m.Enter&&(r=s.RETURN,a=!1),n.keyCode===m.Escape&&(r=s.ESCAPE),n.keyCode===m.PageUp&&(r=s.PAGE_UP),n.keyCode===m.PageDown&&(r=s.PAGE_DOWN),n.keyCode===m.End&&(r=s.END),n.keyCode===m.Home&&(r=s.HOME),(n.keyCode===m.NumpadPlus||n.keyCode===171||n.keyCode===m.Equals)&&(r=s.PLUS,a=!1),(n.keyCode===m.NumpadMinus||n.keyCode===173||n.keyCode===m.Dash)&&(r=s.MINUS,a=!1),t.useArrowKeysToNavigate()&&(n.keyCode===m.LeftArrow&&(r=s.LEFT_ARROW),n.keyCode===m.UpArrow&&(r=s.UP_ARROW),n.keyCode===m.RightArrow&&(r=s.RIGHT_ARROW),n.keyCode===m.DownArrow&&(r=s.DOWN_ARROW))),r&&(a&&n.preventDefault(),this.component.publish(r))})}this.component.subscribe(s.EXIT_FULLSCREEN,()=>{this.isOverlayActive()&&this.component.publish(s.ESCAPE),this.component.publish(s.ESCAPE),this.component.publish(s.RESIZE)}),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),this.component.subscribe(s.ACCEPT_TERMS,()=>{this.fire(s.ACCEPT_TERMS)}),this.component.subscribe(s.LOGIN_FAILED,()=>{this.fire(s.LOGIN_FAILED),this.showMessage(this.data.config.content.authorisationFailedMessage)}),this.component.subscribe(s.LOGIN,()=>{this.isLoggedIn=!0,this.fire(s.LOGIN)}),this.component.subscribe(s.LOGOUT,()=>{this.isLoggedIn=!1,this.fire(s.LOGOUT)}),this.component.subscribe(s.BOOKMARK,()=>{this.bookmark(),this.fire(s.BOOKMARK)}),this.component.subscribe(s.CANVAS_INDEX_CHANGE_FAILED,()=>{this.fire(s.CANVAS_INDEX_CHANGE_FAILED)}),this.component.subscribe(s.CANVAS_INDEX_CHANGE,i=>{this.data.canvasIndex=i,this.lastCanvasIndex=this.helper.canvasIndex,this.helper.canvasIndex=i,this.fire(s.CANVAS_INDEX_CHANGE,this.data.canvasIndex)}),this.component.subscribe(s.CLICKTHROUGH,()=>{this.fire(s.CLICKTHROUGH)}),this.component.subscribe(s.CLOSE_ACTIVE_DIALOGUE,()=>{this.fire(s.CLOSE_ACTIVE_DIALOGUE)}),this.component.subscribe(s.CLOSE_LEFT_PANEL,()=>{this.fire(s.CLOSE_LEFT_PANEL),this.resize()}),this.component.subscribe(s.CLOSE_RIGHT_PANEL,()=>{this.fire(s.CLOSE_RIGHT_PANEL),this.resize()}),this.component.subscribe(s.COLLECTION_INDEX_CHANGE,i=>{this.data.collectionIndex=i,this.fire(s.COLLECTION_INDEX_CHANGE,this.data.collectionIndex)}),this.component.subscribe(s.CREATED,()=>{this.isCreated=!0,this.fire(s.CREATED)}),this.component.subscribe(s.DOWN_ARROW,()=>{this.fire(s.DOWN_ARROW)}),this.component.subscribe(s.DOWNLOAD,i=>{this.fire(s.DOWNLOAD,i)}),this.component.subscribe(s.END,()=>{this.fire(s.END)}),this.component.subscribe(s.ESCAPE,()=>{this.fire(s.ESCAPE),this.isFullScreen()&&!this.isOverlayActive()&&this.component.publish(s.TOGGLE_FULLSCREEN)}),this.component.subscribe(s.EXTERNAL_LINK_CLICKED,i=>{this.fire(s.EXTERNAL_LINK_CLICKED,i)}),this.component.subscribe(s.LOAD,()=>{setTimeout(()=>{this.component.publish(s.RESIZE),this.fire(s.LOAD,this.helper.getCurrentCanvas().id),this.$element.removeClass("loading")},100)}),this.component.subscribe(s.FEEDBACK,()=>{this.feedback()}),this.component.subscribe(s.FORBIDDEN,()=>{this.fire(s.FORBIDDEN),this.component.publish(s.OPEN_EXTERNAL_RESOURCE)}),this.component.subscribe(s.HIDE_DOWNLOAD_DIALOGUE,()=>{this.fire(s.HIDE_DOWNLOAD_DIALOGUE)}),this.component.subscribe(s.HIDE_EMBED_DIALOGUE,()=>{this.fire(s.HIDE_EMBED_DIALOGUE)}),this.component.subscribe(s.HIDE_EXTERNALCONTENT_DIALOGUE,()=>{this.fire(s.HIDE_EXTERNALCONTENT_DIALOGUE)}),this.component.subscribe(s.HIDE_GENERIC_DIALOGUE,()=>{this.fire(s.HIDE_GENERIC_DIALOGUE)}),this.component.subscribe(s.HIDE_HELP_DIALOGUE,()=>{this.fire(s.HIDE_HELP_DIALOGUE)}),this.component.subscribe(s.HIDE_INFORMATION,()=>{this.fire(s.HIDE_INFORMATION)}),this.component.subscribe(s.HIDE_LOGIN_DIALOGUE,()=>{this.fire(s.HIDE_LOGIN_DIALOGUE)}),this.component.subscribe(s.HIDE_OVERLAY,()=>{this.fire(s.HIDE_OVERLAY)}),this.component.subscribe(s.HIDE_RESTRICTED_DIALOGUE,()=>{this.fire(s.HIDE_RESTRICTED_DIALOGUE)}),this.component.subscribe(s.HIDE_SETTINGS_DIALOGUE,()=>{this.fire(s.HIDE_SETTINGS_DIALOGUE)}),this.component.subscribe(s.HOME,()=>{this.fire(s.HOME)}),this.component.subscribe(s.LEFT_ARROW,()=>{this.fire(s.LEFT_ARROW)}),this.component.subscribe(s.LEFTPANEL_COLLAPSE_FULL_FINISH,()=>{this.fire(s.LEFTPANEL_COLLAPSE_FULL_FINISH)}),this.component.subscribe(s.LEFTPANEL_COLLAPSE_FULL_START,()=>{this.fire(s.LEFTPANEL_COLLAPSE_FULL_START)}),this.component.subscribe(s.LEFTPANEL_EXPAND_FULL_FINISH,()=>{this.fire(s.LEFTPANEL_EXPAND_FULL_FINISH)}),this.component.subscribe(s.LEFTPANEL_EXPAND_FULL_START,()=>{this.fire(s.LEFTPANEL_EXPAND_FULL_START)}),this.component.subscribe(s.LOAD_FAILED,()=>{this.fire(s.LOAD_FAILED),!t.lastCanvasIndex==null&&t.lastCanvasIndex!==t.helper.canvasIndex&&this.component.publish(s.CANVAS_INDEX_CHANGE,t.lastCanvasIndex)}),this.component.subscribe(s.MANIFEST_INDEX_CHANGE,i=>{this.data.manifestIndex=i,this.fire(s.MANIFEST_INDEX_CHANGE,this.data.manifestIndex)}),this.component.subscribe(s.NOT_FOUND,()=>{this.fire(s.NOT_FOUND)}),this.component.subscribe(s.OPEN,()=>{this.fire(s.OPEN);let i=Ue.format(this.data.config.options.openTemplate,this.helper.manifestUri);window.open(i)}),this.component.subscribe(s.OPEN_LEFT_PANEL,()=>{this.fire(s.OPEN_LEFT_PANEL),this.$element.hasClass("loading")||this.resize()}),this.component.subscribe(s.OPEN_EXTERNAL_RESOURCE,()=>{this.fire(s.OPEN_EXTERNAL_RESOURCE)}),this.component.subscribe(s.EXTERNAL_RESOURCE_OPENED,()=>{this.fire(s.EXTERNAL_RESOURCE_OPENED)}),this.component.subscribe(s.OPEN_RIGHT_PANEL,()=>{this.fire(s.OPEN_RIGHT_PANEL),this.$element.hasClass("loading")||this.resize()}),this.component.subscribe(s.PAGE_DOWN,()=>{this.fire(s.PAGE_DOWN)}),this.component.subscribe(s.PAGE_UP,()=>{this.fire(s.PAGE_UP)}),this.component.subscribe(s.RANGE_CHANGE,i=>{i?(this.data.rangeId=i.id,this.helper.rangeId=i.id,this.fire(s.RANGE_CHANGE,this.data.rangeId)):(this.data.rangeId=void 0,this.helper.rangeId=void 0,this.fire(s.RANGE_CHANGE,null))}),this.component.subscribe(s.RESOURCE_DEGRADED,i=>{this.fire(s.RESOURCE_DEGRADED),p.handleDegraded(i)}),this.component.subscribe(s.RETURN,()=>{this.fire(s.RETURN)}),this.component.subscribe(s.RIGHT_ARROW,()=>{this.fire(s.RIGHT_ARROW)}),this.component.subscribe(s.RIGHTPANEL_COLLAPSE_FULL_FINISH,()=>{this.fire(s.RIGHTPANEL_COLLAPSE_FULL_FINISH)}),this.component.subscribe(s.RIGHTPANEL_COLLAPSE_FULL_START,()=>{this.fire(s.RIGHTPANEL_COLLAPSE_FULL_START)}),this.component.subscribe(s.RIGHTPANEL_EXPAND_FULL_FINISH,()=>{this.fire(s.RIGHTPANEL_EXPAND_FULL_FINISH)}),this.component.subscribe(s.RIGHTPANEL_EXPAND_FULL_START,()=>{this.fire(s.RIGHTPANEL_EXPAND_FULL_START)}),this.component.subscribe(s.SETTINGS_CHANGE,i=>{this.fire(s.SETTINGS_CHANGE,i)}),this.component.subscribe(s.SHOW_DOWNLOAD_DIALOGUE,()=>{this.fire(s.SHOW_DOWNLOAD_DIALOGUE)}),this.component.subscribe(s.SHOW_EMBED_DIALOGUE,()=>{this.fire(s.SHOW_EMBED_DIALOGUE)}),this.component.subscribe(s.SHOW_EXTERNALCONTENT_DIALOGUE,()=>{this.fire(s.SHOW_EXTERNALCONTENT_DIALOGUE)}),this.component.subscribe(s.SHOW_GENERIC_DIALOGUE,()=>{this.fire(s.SHOW_GENERIC_DIALOGUE)}),this.component.subscribe(s.SHOW_HELP_DIALOGUE,()=>{this.fire(s.SHOW_HELP_DIALOGUE)}),this.component.subscribe(s.SHOW_INFORMATION,()=>{this.fire(s.SHOW_INFORMATION)}),this.component.subscribe(s.SHOW_LOGIN_DIALOGUE,()=>{this.fire(s.SHOW_LOGIN_DIALOGUE)}),this.component.subscribe(s.SHOW_CLICKTHROUGH_DIALOGUE,()=>{this.fire(s.SHOW_CLICKTHROUGH_DIALOGUE)}),this.component.subscribe(s.SHOW_MESSAGE,i=>{this.showMessage(i)}),this.component.subscribe(s.SHOW_RESTRICTED_DIALOGUE,()=>{this.fire(s.SHOW_RESTRICTED_DIALOGUE)}),this.component.subscribe(s.SHOW_OVERLAY,()=>{this.fire(s.SHOW_OVERLAY)}),this.component.subscribe(s.SHOW_SETTINGS_DIALOGUE,()=>{this.fire(s.SHOW_SETTINGS_DIALOGUE)}),this.component.subscribe(s.SHOW_TERMS_OF_USE,()=>{this.fire(s.SHOW_TERMS_OF_USE);let i=this.helper.getLicense();if(!i){let n=this.helper.getRequiredStatement();n&&n.value&&(i=n.value)}i&&this.showMessage(i)}),this.component.subscribe(s.THUMB_SELECTED,i=>{this.fire(s.THUMB_SELECTED,i.index)}),this.component.subscribe(s.TOGGLE_FULLSCREEN,()=>{let i=this.data.config.options.overrideFullScreen;this.component.isFullScreen=!this.component.isFullScreen,i||(N("#top").focus(),this.component.isFullScreen?this.$element.addClass("fullscreen"):this.$element.removeClass("fullscreen")),this.fire(s.TOGGLE_FULLSCREEN,{isFullScreen:this.component.isFullScreen,overrideFullScreen:i})}),this.component.subscribe(s.UP_ARROW,()=>{this.fire(s.UP_ARROW)}),this.component.subscribe(s.UPDATE_SETTINGS,()=>{this.fire(s.UPDATE_SETTINGS)}),this.component.subscribe(s.VIEW_FULL_TERMS,()=>{this.fire(s.VIEW_FULL_TERMS)}),this.component.subscribe(s.WINDOW_UNLOAD,()=>{this.fire(s.WINDOW_UNLOAD)}),this.shell=new $e(this.$element),this.createModules(),this.component.publish(s.RESIZE),setTimeout(()=>{this.render(),this.component.publish(s.CREATED),this._setDefaultFocus()},1)}async loadConfig(t){let i=this.locales[t]||this.defaultConfig;if(i!==this.defaultConfig&&(i=await i()),!i)throw new Error("Unable to load config");return i=JSON.parse(JSON.stringify(i)),i}createModules(){this.$authDialogue=N('<div class="overlay auth" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$authDialogue),this.authDialogue=new Ae(this.$authDialogue),this.$clickThroughDialogue=N('<div class="overlay clickthrough" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new Te(this.$clickThroughDialogue),this.$restrictedDialogue=N('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new Se(this.$restrictedDialogue),this.$loginDialogue=N('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$loginDialogue),this.loginDialogue=new Ce(this.$loginDialogue)}_setDefaultFocus(){setTimeout(()=>{this.data.config.options.allowStealFocus&&N("[tabindex=0]").focus()},1)}width(){return this.$element.width()}height(){return this.$element.height()}exitFullScreen(){this.component.publish(s.EXIT_FULLSCREEN)}fire(t,...i){this.component.fire(t,arguments[1])}redirect(t){this.fire(s.REDIRECT,t)}refresh(){this.fire(s.REFRESH,null)}render(){if((!this.isCreated||this.data.collectionIndex!==this.helper.collectionIndex)&&this.component.publish(s.COLLECTION_INDEX_CHANGE,this.data.collectionIndex),(!this.isCreated||this.data.manifestIndex!==this.helper.manifestIndex)&&this.data.manifest!==void 0&&this.component.publish(s.MANIFEST_INDEX_CHANGE,this.data.manifestIndex),(!this.isCreated||this.data.canvasIndex!==this.helper.canvasIndex)&&(this.data.canvasIndex!==void 0?this.component.publish(s.CANVAS_INDEX_CHANGE,this.data.canvasIndex):console.error("canvasIndex is undefined")),(!this.isCreated||this.data.rangeId!==this.helper.rangeId)&&this.data.rangeId){let t=this.helper.getRangeById(this.data.rangeId);t?this.component.publish(s.RANGE_CHANGE,t):console.warn("range id not found:",this.data.rangeId)}}_initLocales(){let t=this.data.config.localisation.locales.slice(0),i=this.data.locales,n=[];i?(i.forEach(a=>{let l=t.filter(u=>u.name===a.name);if(l.length){var o=l[0];a.label&&(o.label=a.label),o.added=!0,n.push(o)}}),v.getBool(this.data.config.options.limitLocales,!1)||t.forEach(a=>{a.added||n.push(a),delete a.added}),this.data.locales=n):console.warn("No locales configured")}_parseMetrics(){let t=this.data.config.options.metrics;if(t)for(let i=0;i<t.length;i++){let n=t[i];this.metrics.push(n)}}_updateMetric(){setTimeout(()=>{for(let t=this.metrics.length-1;t>=0;t--){let i=this.metrics[t];if(window.innerWidth>=i.minWidth){this.metric!==i.type&&(this.metric=i.type,this.component.publish(s.METRIC_CHANGE));break}}},1)}resize(){this._updateMetric(),this.component.publish(s.RESIZE)}reload(t){this.component.publish(s.RELOAD,t)}isSeeAlsoEnabled(){return this.data.config.options.seeAlsoEnabled!==!1}getShareUrl(){if(this.data.embedded){if(this.helper.hasRelatedPage()){var t=this.helper.getRelated();return t&&t.length&&(t=t[0]),t["@id"]}}else return z.isInIFrame()?parent.document.location.href:document.location.href;return null}getIIIFShareUrl(t=!1){let i;return t&&(this.helper.manifest?i=this.helper.manifest.id:i=this.helper.manifestUri),`${i}?manifest=${i}`}addTimestamp(t){return t+"?t="+_e.getTimeStamp()}getDomain(){return U.getUrlParts(this.helper.manifestUri).host}getAppUri(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/uv.html"}getSettings(){if(v.getBool(this.data.config.options.saveUserSettings,!1)){let t=S.get("uv.settings",K.LOCAL);if(t)return N.extend(this.data.config.options,t.value)}return this.data.config.options}updateSettings(t){if(v.getBool(this.data.config.options.saveUserSettings,!1)){let i=S.get("uv.settings",K.LOCAL);i&&(t=N.extend(i.value,t)),S.set("uv.settings",t,31536e4,K.LOCAL)}this.data.config.options=N.extend(this.data.config.options,t)}getLocale(){return this.helper.options.locale}getSharePreview(){let t=this.helper.getLabel(),i=this.helper.getCurrentCanvas(),n=i.getProperty("thumbnail");return(!n||typeof n!="string")&&(n=i.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth)),{title:t,image:n}}getPagedIndices(t=this.helper.canvasIndex){return[t]}getCurrentCanvases(){let t=this.getPagedIndices(this.helper.canvasIndex),i=[];for(let n=0;n<t.length;n++){let r=t[n],a=this.helper.getCanvasByIndex(r);i.push(a)}return i}getCanvasLabels(t){let i=this.getPagedIndices(),n="";if(i.length===1)n=t;else for(let r=1;r<=i.length;r++)n.length&&(n+=","),n+=t+" "+r;return n}getCurrentCanvasRange(){return this.helper.getCanvasRange(this.helper.getCurrentCanvas())}getExternalResources(t){let i=this.getPagedIndices(),n=[];i.forEach(l=>{let o=this.helper.getCanvasByIndex(l),u;if(o.externalResource?u=o.externalResource:u=new De(o,{authApiVersion:this.data.config.options.authAPIVersion}),t){let c=t.find(h=>h.dataUri===u.dataUri);c?n.push(c):n.push(u)}else n.push(u)});let r=this.data.config.options.tokenStorage;return this.data.config.options.authAPIVersion===1?new Promise(l=>{let o={locale:this.helper.options.locale};j.loadExternalResources(n,r,o).then(u=>{this.resources=u.map(c=>this._prepareResourceData(c)),l(this.resources)})}):new Promise(l=>{p.loadExternalResources(n,r).then(o=>{this.resources=o.map(u=>this._prepareResourceData(u)),l(this.resources)})})}_prepareResourceData(t){return t.data.hasServiceDescriptor=t.hasServiceDescriptor(),t.hasServiceDescriptor()||(t.data.id=t.dataUri,t.data.width=t.width,t.data.height=t.height),t.data.index=t.index,Ne.toPlainObject(t.data)}getMediaFormats(t){let i=t.getContent();return i&&i.length?i[0].getBody():[{id:t.id,type:t.getType(),getFormat:function(){return""}}]}viewCanvas(t){if(this.helper.isCanvasIndexOutOfRange(t)){this.showMessage(this.data.config.content.canvasIndexOutOfRange);return}this.component.publish(s.OPEN_EXTERNAL_RESOURCE)}showMessage(t,i,n,r){this.closeActiveDialogue(),this.component.publish(s.SHOW_GENERIC_DIALOGUE,{message:t,acceptCallback:i,buttonText:n,allowClose:r})}closeActiveDialogue(){this.component.publish(s.CLOSE_ACTIVE_DIALOGUE)}isOverlayActive(){return O(this.shell.$overlays)}isDesktopMetric(){return this.metric==="lg"||this.metric==="xl"}isMobileMetric(){return this.metric==="sm"||this.metric==="md"}viewManifest(t){let i={};i.manifest=this.helper.manifestUri,i.collectionIndex=this.helper.getCollectionIndex(t),i.manifestIndex=t.index,i.canvasIndex=0,this.reload(i)}viewCollection(t){let i={};i.manifest=t.parentCollection?t.parentCollection.id:this.helper.manifestUri,i.collectionIndex=t.index,i.manifestIndex=0,i.canvasIndex=0,this.reload(i)}isFullScreen(){return this.component.isFullScreen}isHeaderPanelEnabled(){return v.getBool(this.data.config.options.headerPanelEnabled,!0)}isLeftPanelEnabled(){if(v.getBool(this.data.config.options.leftPanelEnabled,!0)){if(this.helper.hasParentCollection())return!0;if(this.helper.isMultiCanvas()){let t=this.helper.getViewingHint();if(!t||t&&t!==At.ViewingHint.CONTINUOUS)return!0}}return!1}isRightPanelEnabled(){return v.getBool(this.data.config.options.rightPanelEnabled,!0)}isFooterPanelEnabled(){return v.getBool(this.data.config.options.footerPanelEnabled,!0)}isMobile(){let t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}useArrowKeysToNavigate(){return v.getBool(this.data.config.options.useArrowKeysToNavigate,!0)}bookmark(){}feedback(){this.fire(s.FEEDBACK,this.data)}getAlternateLocale(){let t=null;return this.data.locales&&this.data.locales.length>1&&(t=this.data.locales[1]),t}getSerializedLocales(){return this.data.locales?this.serializeLocales(this.data.locales):null}serializeLocales(t){let i="";for(let n=0;n<t.length;n++){let r=t[n];n>0&&(i+=","),i+=r.name,r.label&&(i+=":"+r.label)}return i}changeLocale(t){let i={};if(this.data.locales){i.locales=this.data.locales.slice(0);let n=i.locales.findIndex(a=>a.name===t),r=0;i.locales.splice(r,0,i.locales.splice(n,1)[0]),this.reload(i)}}},Tt=class{constructor(){this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]}init(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown",this.browser=="Explorer"&&this.version=="7"&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())}searchString(t){for(var i=0;i<t.length;i++){var n=t[i].string;if(this.versionSearchString=t[i].subString,n.indexOf(t[i].subString)!=-1)return t[i].identity}}searchVersion(t){var i=t.indexOf(this.versionSearchString);if(i!=-1)return parseFloat(t.substring(i+this.versionSearchString.length+1))}searchVersionIE(){var t=navigator.userAgent.toString().toLowerCase(),i=/(trident)(?:.*rv:([\w.]+))?/.exec(t)||/(msie) ([\w.]+)/.exec(t)||["",null,-1],n="unknown";return i!==null&&i.length===3&&i[2]&&(n=i[2].split(".")[0]),n}};var V;(function(c){c[c.TOP_LEFT=0]="TOP_LEFT",c[c.TOP_CENTER=1]="TOP_CENTER",c[c.TOP_RIGHT=2]="TOP_RIGHT",c[c.CENTER_LEFT=3]="CENTER_LEFT",c[c.CENTER=4]="CENTER",c[c.CENTER_RIGHT=5]="CENTER_RIGHT",c[c.BOTTOM_LEFT=6]="BOTTOM_LEFT",c[c.BOTTOM_CENTER=7]="BOTTOM_CENTER",c[c.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(V||(V={}));var Z=C(),Ai=class extends G{constructor(t){super(t,!1,!0);this.subtitleExpanded=!1;this.isAttributionOpen=!1;this.attributionPosition=V.BOTTOM_LEFT}create(){super.create(),this.$title=Z('<h1 class="title"></h1>'),this.$element.append(this.$title),this.$subtitle=Z(`<div class="subtitle">
                                <div class="wrapper">
                                    <button type="button" class="expand-btn" aria-label="Expand">
                                        <span aria-hidden="true">+</span>
                                    </button>
                                    <span class="text"></span>
                                </div>
                            </div>`),this.$element.append(this.$subtitle),this.$subtitleWrapper=this.$subtitle.find(".wrapper"),this.$subtitleExpand=this.$subtitle.find(".expand-btn"),this.$subtitleText=this.$subtitle.find(".text"),this.$content=Z('<div id="content" class="content"></div>'),this.$element.append(this.$content),this.$attribution=Z(`
                                <div class="attribution">
                                  <div class="header">
                                    <div class="title"></div>
                                    <button type="button" class="close" aria-label="Close">
                                      <span aria-hidden="true">&#215;</span>
                                    </button>
                                  </div>
                                  <div class="main">
                                    <div class="attribution-text"></div>
                                    <div class="license"></div>
                                    <div class="logo"></div>
                                  </div>
                                </div>
        `),this.$attribution.find(".header .title").text(this.content.attribution),this.$content.append(this.$attribution),this.closeAttribution(),this.$closeAttributionButton=this.$attribution.find(".header .close"),this.$closeAttributionButton.on("click",t=>{t.preventDefault(),this.closeAttribution()}),this.$subtitleExpand.on("click",t=>{t.preventDefault(),this.subtitleExpanded=!this.subtitleExpanded,this.subtitleExpanded?(this.$subtitleWrapper.addClass("expanded"),this.$subtitleExpand.text("-")):(this.$subtitleWrapper.removeClass("expanded"),this.$subtitleExpand.text("+")),this.resize()}),v.getBool(this.options.titleEnabled,!0)?this.$title.show():this.$title.hide(),v.getBool(this.options.subtitleEnabled,!1)?this.$subtitle.show():this.$subtitle.hide(),this.whenResized(()=>{this.updateRequiredStatement()})}openAttribution(){this.$attribution.show(),this.isAttributionOpen=!0}closeAttribution(){this.$attribution.hide(),this.isAttributionOpen=!1}updateRequiredStatement(){let t=this.extension.helper.getRequiredStatement(),i=v.getBool(this.options.requiredStatementEnabled,!0);if(!t||!t.value||!i)return;this.openAttribution();let n=this.$attribution.find(".title"),r=this.$attribution.find(".attribution-text"),a=this.$attribution.find(".license"),l=this.$attribution.find(".logo");if(t.label){let o=_(t.label);n.html(o)}else n.text(this.content.attribution);if(t.value){let o=_(t.value);r.html(o),r.find("img").one("load",()=>{this.resize()}).each(function(){this.complete&&Z(this).load()}),r.targetBlank()}a.hide(),l.hide(),this.resize()}resize(){super.resize();let t=O(this.extension.shell.$leftPanel)?Math.floor(this.extension.shell.$leftPanel.width()):0,i=O(this.extension.shell.$rightPanel)?Math.floor(this.extension.shell.$rightPanel.width()):0,n=Math.floor(this.$element.parent().width()-t-i);this.$element.css({left:t,width:n});let r,a;if(this.options&&this.options.titleEnabled===!1||!O(this.$title)?r=0:r=this.$title.outerHeight(!0),this.options&&this.options.subtitleEnabled===!1||!O(this.$subtitle)?a=0:a=this.$subtitle.outerHeight(!0),this.$content.height(this.$element.height()-r-a),this.$content.width(this.$element.width()),this.$attribution&&this.isAttributionOpen){switch(this.attributionPosition){case V.BOTTOM_LEFT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",0);break;case V.BOTTOM_RIGHT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",this.$content.width()-this.$attribution.outerWidth()-this.$attribution.horizontalMargins());break}this.$content.width()<=this.$attribution.width()?this.$attribution.hide():this.$attribution.show()}this.subtitle&&this.options.subtitleEnabled?(this.$subtitleText.html(_(this.subtitle.replace(/<br\s*[\/]?>/gi,"; "))),this.$subtitleText.removeClass("elided"),this.$subtitle.show(),this.$subtitleWrapper.css("max-height",this.$content.height()+this.$subtitle.outerHeight()),this.$subtitleWrapper.width(this.$content.width()),this.subtitleExpanded?this.$subtitleText.width(this.$content.width()-this.$subtitleText.horizontalMargins()-2):(this.$subtitleText.width("auto"),this.$subtitleWrapper.width("auto"),this.$subtitleExpand.hide(),this.$subtitleText.width()>this.$content.width()&&(this.$subtitleExpand.show(),this.$subtitleText.addClass("elided"),this.$subtitleText.width(this.$content.width()-(this.$subtitleExpand.outerWidth()+this.$subtitleText.horizontalMargins()))))):this.$subtitle.hide()}};export{G as a,V as b,_ as c,Qi as d,zi as e,qi as f,O as g,Ai as h,M as i,x as j,m as k,Ii as l};
