import{j as R}from"./chunk-VUSGURX2.js";import{a as I,c as E,f as m,o as p,q as h,t as c}from"./chunk-J7R3MGAK.js";var u;(function(e){e.CANVAS_RENDERINGS="canvasRenderings",e.CURRENT_VIEW="currentView",e.ENTIRE_DOCUMENT_AS_PDF="entireDocumentAsPdf",e.ENTIRE_DOCUMENT_AS_TEXT="entireDocumentAsText",e.ENTIRE_FILE_AS_ORIGINAL="entireFileAsOriginal",e.IMAGE_RENDERINGS="imageRenderings",e.MANIFEST_RENDERINGS="manifestRenderings",e.RANGE_RENDERINGS="rangeRenderings",e.SELECTION="selection",e.UNKNOWN="unknown",e.WHOLE_IMAGE_HIGH_RES="wholeImageHighRes",e.WHOLE_IMAGE_LOW_RES="wholeImageLowRes",e.WHOLE_IMAGES_HIGH_RES="wholeImagesHighRes"})(u||(u={}));var g=I(),A=class extends R{constructor(t){super(t)}create(){this.setConfig("downloadDialogue"),super.create(),this.$element.attr("role","region"),this.$element.attr("aria-label",this.content.title),this.openCommand=h.SHOW_DOWNLOAD_DIALOGUE,this.closeCommand=h.HIDE_DOWNLOAD_DIALOGUE;let t;this.extensionHost.subscribe(this.openCommand,n=>{t=n,this.open(n)}),this.extensionHost.subscribe(this.closeCommand,()=>{t&&t.focus(),this.close()}),this.$title=g(`<div role="heading" class="heading">${this.content.title}</div>`),this.$content.append(this.$title),this.$noneAvailable=g('<div class="noneAvailable">'+this.content.noneAvailable+"</div>"),this.$content.append(this.$noneAvailable),this.$downloadOptions=g('<ol class="options"></ol>'),this.$content.append(this.$downloadOptions),this.$footer=g('<div class="footer"></div>'),this.$content.append(this.$footer),this.$termsOfUseButton=g('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$termsOfUseButton.onPressed(()=>{this.extensionHost.publish(h.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.updateTermsOfUseButton()}addEntireFileDownloadOptions(){if(this.isDownloadOptionAvailable(u.ENTIRE_FILE_AS_ORIGINAL)){this.$downloadOptions.empty();let t=this.extension.helper.getCurrentCanvas(),n=!1,l=t.getRenderings();for(let i=0;i<l.length;i++){let r=l[i],o=r.getFormat(),a="";o&&(a=o.toString()),this.addEntireFileDownloadOption(r.id,c.getValue(r.getLabel()),a),n=!0}if(!n){let i=!1,r=t.getContent();for(let o=0;o<r.length;o++){let s=r[o].getBody();if(s.length){let d=s[0].getFormat();d&&(this.addEntireFileDownloadOption(s[0].id,"",d.toString()),i=!0)}}i||this.addEntireFileDownloadOption(t.id,"","")}}}addEntireFileDownloadOption(t,n,l){let i;l?i=m.simplifyMimeType(l):i=this.getFileExtension(t),n||(n=this.content.entireFileAsOriginal),i&&(n+=" ("+i+")"),this.$downloadOptions.append('<li><a href="'+t+'" target="_blank" download tabindex="0">'+n+"</li>")}resetDynamicDownloadOptions(){this.renderingUrls=[],this.renderingUrlsCount=0,this.$downloadOptions.find("li.dynamic").remove()}getDownloadOptionsForRenderings(t,n,l){let i=t.getRenderings(),r=[];for(let o=0;o<i.length;o++){let a=i[o];if(a){let s=c.getValue(a.getLabel(),this.extension.getLocale()),d="downloadOption"+ ++this.renderingUrlsCount;s?s+=" ({0})":s=n;let f=m.simplifyMimeType(a.getFormat().toString());s=p.format(s,f),this.renderingUrls[d]=a.id;let v=g('<li class="option dynamic"><input id="'+d+'" data-mime="'+f+'" title="'+s+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+d+'">'+s+"</label></li>");r.push({type:l,button:v})}}return r}getSelectedOption(){return this.$downloadOptions.find("li.option input:checked")}getCurrentResourceId(){return this.extension.helper.getCurrentCanvas().externalResource.data.id}getCurrentResourceFormat(){let t=this.getCurrentResourceId();return t.substr(t.lastIndexOf(".")+1).toLowerCase()}updateNoneAvailable(){this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show()}updateTermsOfUseButton(){let t=this.extension.helper.getRequiredStatement();E.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&t&&t.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}getFileExtension(t){let n=t.split(".").pop();return n.length>5||n.indexOf("/")!==-1?null:n}isMediaDownloadEnabled(){return this.extension.helper.isUIEnabled("mediaDownload")}isDownloadOptionAvailable(t){switch(t){case u.ENTIRE_FILE_AS_ORIGINAL:return this.isMediaDownloadEnabled()}return!0}close(){super.close()}resize(){this.setDockedPosition()}};export{u as a,A as b};
